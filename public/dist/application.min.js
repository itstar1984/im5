"use strict";var ApplicationConfiguration={applicationModuleName:"MEAN",applicationModuleVendorDependencies:["ngResource","ui.router","ui.utils","angularFileUpload","ngMaterial","ngMdIcons","ngLodash","ngMap","nvd3","md.data.table","infinite-scroll"],registerModule:function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module("MEAN").requires.push(moduleName)}};angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$mdThemingProvider",function($locationProvider,$mdThemingProvider){$locationProvider.html5Mode(!0).hashPrefix("!"),$mdThemingProvider.theme("default").primaryPalette("blue",{default:"800","hue-1":"500","hue-2":"600","hue-3":"A400"}).accentPalette("red")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$mdSidenav",function($rootScope,$mdSidenav){var a,check=!1;a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0),$rootScope.isMobile=check,$rootScope.isSideNavOpen=!1,$rootScope.$on("$stateChangeStart",function(){$mdSidenav("left").close()}),console.log("isMobile:",$rootScope.isMobile)}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("clients"),ApplicationConfiguration.registerModule("actividades"),ApplicationConfiguration.registerModule("areas"),ApplicationConfiguration.registerModule("arqueos"),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("cajas"),ApplicationConfiguration.registerModule("categories"),ApplicationConfiguration.registerModule("chat"),ApplicationConfiguration.registerModule("compras"),ApplicationConfiguration.registerModule("comprobantes"),ApplicationConfiguration.registerModule("condicionventas"),ApplicationConfiguration.registerModule("contacts"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("costcenters"),ApplicationConfiguration.registerModule("costosindirectos"),ApplicationConfiguration.registerModule("empleados"),ApplicationConfiguration.registerModule("enterprises"),ApplicationConfiguration.registerModule("entregas"),ApplicationConfiguration.registerModule("finanzas"),ApplicationConfiguration.registerModule("historialCompras"),ApplicationConfiguration.registerModule("impuestos"),ApplicationConfiguration.registerModule("liquidaciones"),ApplicationConfiguration.registerModule("movimientos"),ApplicationConfiguration.registerModule("pagos"),ApplicationConfiguration.registerModule("pedidos"),ApplicationConfiguration.registerModule("personas"),ApplicationConfiguration.registerModule("posts"),ApplicationConfiguration.registerModule("procedimientos"),ApplicationConfiguration.registerModule("procesos"),ApplicationConfiguration.registerModule("products"),ApplicationConfiguration.registerModule("providers"),ApplicationConfiguration.registerModule("puestos"),ApplicationConfiguration.registerModule("remuneraciones"),ApplicationConfiguration.registerModule("reportes"),ApplicationConfiguration.registerModule("rrhhs"),ApplicationConfiguration.registerModule("servicios"),ApplicationConfiguration.registerModule("stocks"),ApplicationConfiguration.registerModule("subs"),ApplicationConfiguration.registerModule("sucursales"),ApplicationConfiguration.registerModule("tareas"),ApplicationConfiguration.registerModule("taxconditions"),ApplicationConfiguration.registerModule("transferencias"),ApplicationConfiguration.registerModule("users"),ApplicationConfiguration.registerModule("ventas"),angular.module("clients").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Clients",state:"clients",type:"dropdown"}),Menus.addSubMenuItem("topbar","clients",{title:"List Clients",state:"clients.list"}),Menus.addSubMenuItem("topbar","clients",{title:"Create Client",state:"clients.create"})}]),angular.module("clients").config(["$stateProvider",function($stateProvider){$stateProvider.state("clients",{abstract:!0,url:"/clients",template:"<ui-view/>"}).state("clients.list",{url:"",templateUrl:"modules/clients/views/list-clients.client.view.html"}).state("clients.create",{url:"/create",templateUrl:"modules/clients/views/create-client.client.view.html"}).state("clients.view",{url:"/:clientId",templateUrl:"modules/clients/views/view-client.client.view.html"}).state("clients.edit",{url:"/:clientId/edit",templateUrl:"modules/clients/views/edit-client.client.view.html"})}]),angular.module("clients").controller("ClientsCreateController",["$state","$scope","user","clientes","client","enterprises","uens","condicionventas","categorias","contactos","condicionesdeiva","comprobantes","users","$http",function($state,$scope,user,clientes,client,enterprises,uens,condicionventas,categorias,contactos,condicionesdeiva,comprobantes,users,$http){this.user=user,this.client=client,this.enterprises=enterprises,this.turnos=["Mañana","Tarde","Noche"],this.zones=["Zona 1","Zona 2","Zona 3","Zona 4","Zona 5"],this.subs=uens,this.condicionPagos=condicionventas,this.categories=categorias,this.contacts=contactos,this.taxconditions=condicionesdeiva,this.comprobantes=comprobantes,this.create=function(){if(void 0!==this.name)if(void 0!==this.address)if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.tipoComprobante){var client=new clientes({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,taxCondition:this.taxcondition._id,condicionPago:this.condicionPago._id,comprobante:this.tipoComprobante._id,discountRate:this.discountRate?this.discountRate:0,loc:[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()],observaciones:this.observaciones?this.observaciones:void 0,paymentMethod:this.paymentMethod,contacts:this.contact?this.contact._id:void 0,country:this.country,city:this.city,region:this.region?this.region:void 0,turno:this.turno?this.turno:void 0,postalCode:this.postalCode?this.postalCode:1900,address:this.address,phone:this.phone?this.phone:void 0,web:this.web?this.web:void 0,mail:this.mail?this.mail:void 0,isUser:this.isUser,category1:this.category1?this.category1._id:void 0,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id,productosAsociados:[]});this.isUser?void 0!==this.userName?function(client,userName){var rol=[];rol.push("cliente");var persona=new users({displayName:client.name,username:userName,email:client.mail,enterprise:client.enterprise,roles:rol,password:angular.lowercase(client.name+"pass").split(" ").join("")});$http.post("/api/auth/signup",persona).success(function(response){client.userLogin=response._id,client.$save(function(response){$state.go("home.clients")},function(errorResponse){this.error=errorResponse.data.message})})}(client,this.userName):this.errorName="Se debe indicar el nombre de usuario para el nuevo usuario":client.$save(function(response){$state.go("home.clients")},function(errorResponse){this.error=errorResponse.data.message})}else this.errorComprobante="Se debe elegir un tipo de comprobante";else this.errorCondicion="Se debe elegir una condicion de pago";else this.errorTax="Se debe ingresar la condicion de IVA";else this.errorDir="Se debe ingresar la direccion";else this.errorName="Se debe ingresar la razon social del cliente"},this.borrarError=function(){this.errorName=void 0,this.errorDir=void 0,this.errorSub=void 0,this.errorCategory=void 0,this.errorTax=void 0,this.errorCondicion=void 0,this.errorComprobante=void 0},$scope.placeChanged=function(){$scope.place=this.getPlace(),this.errorDir=void 0}}]),angular.module("clients").controller("ClientsEditController",["$state","$scope","user","clientes","client","enterprises","uens","condicionventas","categorias","contactos","condicionesdeiva","comprobantes",function($state,$scope,user,clientes,client,enterprises,uens,condicionventas,categorias,contactos,condicionesdeiva,comprobantes){this.user=user,this.client=client,this.enterprises=enterprises,this.turnos=["Mañana","Tarde","Noche"],this.zones=["Zona 1","Zona 2","Zona 3","Zona 4","Zona 5"],this.subs=uens,this.condicionPagos=condicionventas,this.categories=categorias,this.contacts=contactos,this.taxconditions=condicionesdeiva,this.comprobantes=comprobantes,this.selectedMode="md-scale",this.selectedDirection="up",this.update=function(){var client=this.client;void 0!==this.enterprise?client.enterprise=this.enterprise:void 0!==client.enterprise&&null!==client.enterprise&&(client.enterprise=client.enterprise._id);void 0!==this.contact?client.contacts=this.contact:void 0!==client.contacts&&null!==client.contacts&&(client.contacts=client.contacts._id);void 0!==this.taxcondition?client.taxCondition=this.taxcondition:void 0!==client.taxCondition&&null!==client.taxCondition&&(client.taxCondition=client.taxCondition._id);void 0!==this.comprobante?client.comprobante=this.comprobante:void 0!==client.comprobante&&null!==client.comprobante&&(client.comprobante=client.comprobante._id);void 0!==this.condicionPago?client.condicionPago=this.condicionPago:void 0!==client.condicionPago&&null!==client.condicionPago&&(client.condicionPago=client.condicionPago._id);void 0!==this.category?client.category1=this.category:void 0!==client.category1&&null!==client.category1&&(client.category1=client.category1._id);void 0!==this.region?client.region=this.region:void 0!==client.region&&null!==client.region&&(client.region=client.region);void 0!==this.turno?client.turno=this.turno:void 0!==client.turno&&null!==client.turno&&(client.turno=client.turno);void 0!==$scope.place?client.loc=[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()]:void 0!==client.loc&&null!==client.loc&&(client.loc=client.loc);client.$update(function(){$state.go("home.clients")},function(errorResponse){this.error=errorResponse.data.message})},$scope.placeChanged=function(){$scope.place=this.getPlace(),this.errorDir=void 0}}]),angular.module("clients").controller("ClientsListController",["$rootScope","$mdBottomSheet","$mdDialog","$state","user","clientes","enterprises",function($rootScope,$mdBottomSheet,$mdDialog,$state,user,clientes,enterprises){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Cliente").content("¿Está seguro que desea eliminar este cliente?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){!function(client){client?client.$remove():this.client.$remove(function(){});$mdBottomSheet.hide()}(item)},function(){})}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],this.user=user,this.clients=clientes||[],this.enterprises=enterprises,this.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),angular.module("clients").controller("ClientsViewController",["user","client","products","pedidos","ventas","$scope",function(user,client,products,pedidos,ventas,$scope){this.user=user,this.client=client,this.products=products,this.pedidos=pedidos,this.ventas=ventas,this.isOpen=!1,this.selectedMode="md-scale",this.selectedDirection="up",this.calcularDeuda=function(ventas){ventas.$promise.then(angular.bind(this,function(data){for(var i in this.totalDeuda=0,data)void 0!==data[i].cliente&&null!==data[i].cliente&&data[i].cliente._id==client._id&&("Pendiente de pago y entrega"!=data[i].estado&&"Pendiente de pago2"!=data[i].estado||(this.totalDeuda=this.totalDeuda+data[i].total))}))},this.calcularDeuda(ventas)}]),angular.module("clients").controller("ClientsController",["$scope","$rootScope","$stateParams","$location","Authentication","Clients","Enterprises","Subs","$mdBottomSheet","Contacts","Taxconditions","Categories","Ventas","Comprobantes","Pedidos","$filter","$timeout","$mdDialog","$state","Condicionventas","$q",function($scope,$rootScope,$stateParams,$location,Authentication,Clients,Enterprises,Subs,$mdBottomSheet,Contacts,Taxconditions,Categories,Ventas,Comprobantes,Pedidos,$filter,$timeout,$mdDialog,$state,Condicionventas,$q){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Cliente").content("¿Está seguro que desea eliminar este cliente?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item),$mdBottomSheet.hide()},function(){$mdBottomSheet.hide(),console.log("cancelaste borrar")})},$scope.remove=function(client){if(client)for(var i in $rootScope.clients)$rootScope.clients[i]._id===client._id?($rootScope.clients.splice(i,1),client.$remove()):console.log("hubo un error al eliminar");else $scope.client.$remove(function(){});$mdBottomSheet.hide()}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findAll(),$scope.findZones(),$scope.findCondicionPagos()}),$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.place=this.getPlace(),$scope.errorDir=void 0},$scope.create=function(){if(void 0!==this.name)if(void 0!==this.address)if(void 0!==this.sub)if(void 0!==this.category1)if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.tipoComprobante){var client=new Clients({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,taxCondition:this.taxcondition._id,condicionPago:this.condicionPago._id,comprobante:this.tipoComprobante._id,discountRate:this.discountRate?this.discountRate:0,loc:[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()],observaciones:this.observaciones?this.observaciones:void 0,paymentMethod:this.paymentMethod,contacts:this.contact?[this.contact._id]:[],country:this.country,city:this.city,region:this.region?this.region:void 0,turno:this.turno?this.turno:void 0,postalCode:this.postalCode?this.postalCode:1900,address:this.address,phone:this.phone?this.phone:void 0,web:this.web?this.web:void 0,category1:this.category?this.category._id:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,sub:this.sub?this.sub._id:void 0,productosAsociados:[]});client.$save(function(response){response._id&&(client._id=response._id,$rootScope.clients.unshift(client)),$state.go("home.clients"),$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web=""},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Se debe elegir un tipo de comprobante";else $scope.errorCondicion="Se debe elegir una condicion de pago";else $scope.errorTax="Se debe ingresar la condicion de IVA";else $scope.errorCategory="Se debe ingresar la categoria";else $scope.errorSub="Se debe ingresar la UEN";else $scope.errorDir="Se debe ingresar la direccion";else $scope.errorName="Se debe ingresar la razon social del cliente"},$scope.borrarError=function(){$scope.errorName=void 0,$scope.errorDir=void 0,$scope.errorSub=void 0,$scope.errorCategory=void 0,$scope.errorTax=void 0,$scope.errorCondicion=void 0,$scope.errorComprobante=void 0},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Cliente").content("¿Está seguro que desea eliminar este cliente?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item),$mdBottomSheet.hide()},function(){$mdBottomSheet.hide(),console.log("cancelaste borrar")})},$scope.remove=function(client){if(console.log("---\x3e remover item disparado"),client)for(var i in console.log("client es: ",client),$rootScope.clients)$rootScope.clients[i]._id===client._id?(console.log("---\x3e se encuentra en el array en la posicion ",i),$rootScope.clients.splice(i,1),client.$remove()):console.log("La concha de la lora");else console.log("--\x3e No se encuentra en el array"),$scope.client.$remove(function(){$location.path("clients")})},$scope.update=function(){var client=$scope.client;void 0!==this.enterprise?client.enterprise=this.enterprise._id:void 0!==client.enterprise&&null!==client.enterprise&&(client.enterprise=client.enterprise._id),void 0!==this.sub?client.sub=this.sub._id:void 0!==client.sub&&null!==client.sub&&(client.sub=client.sub._id),void 0!==this.contact?client.contacts=[this.contact._id]:void 0!==client.contacts[0]&&null!==client.contacts[0]&&(client.contacts=[client.contacts[0]._id]),void 0!==this.taxcondition?client.taxCondition=this.taxcondition._id:void 0!==client.taxCondition&&null!==client.taxCondition&&(client.taxCondition=client.taxCondition._id),void 0!==this.comprobante?client.comprobante=this.comprobante._id:void 0!==client.comprobante&&null!==client.comprobante&&(client.comprobante=client.comprobante._id),void 0!==this.condicionPago?client.condicionPago=this.condicionPago._id:void 0!==client.condicionPago&&null!==client.condicionPago&&(client.condicionPago=client.condicionPago._id),void 0!==this.category?client.category1=this.category._id:void 0!==client.category1&&null!==client.category1&&(client.category1=client.category1._id),void 0!==this.region?client.region=this.region:void 0!==client.region&&null!==client.region&&(client.region=client.region),void 0!==this.turno?client.turno=this.turno:void 0!==client.turno&&null!==client.turno&&(client.turno=client.turno),void 0!==$scope.place?client.loc=[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()]:void 0!==client.loc&&null!==client.loc&&(client.loc=client.loc),client.$update(function(){$location.path("clientes")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.clients=Clients.query({e:$scope.SEARCH.enterprise}))},$scope.setZone=function(s){$scope.fzone=""!==s?{region:s}:void 0},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}))},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}))},$scope.findZones=function(){void 0!==$scope.SEARCH&&($scope.zones=["Zona 1","Zona 2","Zona 3","Zona 4","Zona 5"],$scope.clientsInZone=[],$timeout(function(){$scope.zones.forEach(function(zone){$scope.clientsInZone[zone]=$filter("filter")($rootScope.clients,{region:zone})})},500))},$scope.findTurnos=function(){void 0!==$scope.SEARCH&&($scope.turnos=["Mañana","Tarde","Noche"])},$scope.findCitys=function(){void 0!==$scope.SEARCH&&($scope.citys=["Berisso","Ensenala","La Plata"])},$scope.findOne=function(){$scope.client=Clients.get({clientId:$stateParams.clientId}),$scope.idClient=$stateParams.clientId},$scope.findAll=function(){$scope.findComprobantes(),$scope.findVentas(),$scope.findPedidos()},$scope.findAllView=function(){var deferred;$scope.findOne(),$scope.findComprobantes(),$scope.findPedidos(),$scope.findVentas(),(deferred=$q.defer(),setTimeout(function(){void 0!==$scope.ventas?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise).then(function(response){!function(){$scope.totalDeuda=0;for(var i=$scope.ventas.length-1;i>=0;i--)$scope.ventas[i].cliente._id==$scope.client._id&&("Pendiente de pago y entrega"!=$scope.ventas[i].estado&&"Pendiente de pago2"!=$scope.ventas[i].estado||($scope.totalDeuda=$scope.totalDeuda+$scope.ventas[i].total))}()})},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&($scope.comprobantes=Comprobantes.query({e:$scope.SEARCH.enterprise},function(res){for(var i in $rootScope.comprobantes=res,$rootScope.comprobantes)"Presupuesto"===$rootScope.comprobantes[i].name&&($scope.idPresupuesto=$rootScope.comprobantes[i]._id),"Factura A"===$rootScope.comprobantes[i].name&&($rootScope.idFacturaA=$rootScope.comprobantes[i]._id),"Factura B"===$rootScope.comprobantes[i].name&&($rootScope.idFacturaB=$rootScope.comprobantes[i]._id),"Factura C"===$rootScope.comprobantes[i].name&&($rootScope.idFacturaC=$rootScope.comprobantes[i]._id),"Remito"===$rootScope.comprobantes[i].name&&($rootScope.idRemito=$rootScope.comprobantes[i]._id),"Remito de Devolucion"===$rootScope.comprobantes[i].name&&($rootScope.idRemitoDev=$rootScope.comprobantes[i]._id),"Nota de Credito"===$rootScope.comprobantes[i].name&&($rootScope.idNotaC=$rootScope.comprobantes[i]._id),"Nota de Debito"===$rootScope.comprobantes[i].name&&($rootScope.idNotaD=$rootScope.comprobantes[i]._id),"Orden de Pago"===$rootScope.comprobantes[i].name&&($rootScope.idOrden=$rootScope.comprobantes[i]._id)}))},$scope.findCondicionPagos=function(){void 0!==$scope.SEARCH&&($scope.condicionPagos=Condicionventas.query({e:$scope.SEARCH.enterprise}))},$scope.findVentas=function(){void 0!==$scope.SEARCH&&($scope.ventas=Ventas.query({e:$scope.SEARCH.enterprise}))},$scope.findPedidos=function(){void 0!==$scope.SEARCH&&($scope.pedidos=Pedidos.query({e:$scope.SEARCH.enterprise}))},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),angular.module("clients").factory("Clients",["$resource",function($resource){return $resource("api/clients/:clientId",{clientId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("actividades").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Actividades",state:"actividades",type:"dropdown"}),Menus.addSubMenuItem("topbar","actividades",{title:"List actividades",state:"actividades.list"}),Menus.addSubMenuItem("topbar","actividades",{title:"Create Liquidacion",state:"actividades.create"})}]),angular.module("actividades").config(["$stateProvider",function($stateProvider){$stateProvider.state("actividades",{abstract:!0,url:"/actividades",template:"<ui-view/>"})}]),angular.module("actividades").controller("ActividadListController",["$scope","$http","$stateParams","$mdDialog","Empleados","Actividades",function($scope,$http,$stateParams,$mdDialog,Empleados,Actividades){function DialogController($scope,$mdDialog,$state,item){$scope.item=item,$scope.item.name=item.userLogin.displayName,$scope.closeDialog=function(){$mdDialog.hide()},$scope.createActividad=function($event,item){new Actividades({enterprise:item.enterprise,operacion:$scope.operacion,observaciones:$scope.observaciones,empleado:item._id}).$save(function(){$scope.closeDialog(),$state.go("home.actividades",{empleadoId:item._id,displayName:item.userLogin.displayName},{reload:!0})},function(errorResponse){$scope.error=errorResponse.data.message})}}DialogController.$inject=["$scope","$mdDialog","$state","item"],$scope.centroDeCosto=$stateParams.centroDeCosto,$scope.findActividad=function(){$http.put("/api/actividades",{empleadoId:$stateParams.empleadoId}).success(function(response){$scope.actividades=response,$scope.name=$stateParams.displayName})},$scope.showObservacion=function(ev,obs){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(obs).ariaLabel("Alert Dialog Demo").targetEvent(ev).ok("Cerrar"))},$scope.showDialogActividad=function($event){Empleados.get({empleadoId:$stateParams.empleadoId},function(response){$mdDialog.show({targetEvent:$event,templateUrl:"modules/actividades/views/create-actividad.client.view.html",locals:{item:response},controller:DialogController})})}}]),angular.module("actividades").factory("Actividades",["$resource",function($resource){return $resource("api/actividades/:actividadId",{liquidacionId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("areas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Areas",state:"areas",type:"dropdown"}),Menus.addSubMenuItem("topbar","areas",{title:"List Areas",state:"areas.list"}),Menus.addSubMenuItem("topbar","areas",{title:"Create Area",state:"areas.create"})}]),angular.module("areas").config(["$stateProvider",function($stateProvider){$stateProvider.state("areas__",{abstract:!0,url:"/areas__",template:"<ui-view/>"}).state("areas__.list",{url:"",templateUrl:"modules/areas/views/list-areas.client.view.html"}).state("areas__.create",{url:"/create",templateUrl:"modules/areas/views/create-area.client.view.html"}).state("areas__.view",{url:"/:areaId",templateUrl:"modules/areas/views/view-area.client.view.html"}).state("areas__.edit",{url:"/:areaId/edit",templateUrl:"modules/areas/views/edit-area.client.view.html"})}]),angular.module("areas").controller("AreasController",["$scope","$rootScope","$stateParams","$location","Authentication","Areas","$mdBottomSheet","Enterprises","$mdDialog","$http","$state","Procesos","Subs",function($scope,$rootScope,$stateParams,$location,Authentication,Areas,$mdBottomSheet,Enterprises,$mdDialog,$http,$state,Procesos,Subs){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){if(0!==item.nivel)var confirm=$mdDialog.confirm().title("Eliminar Area").content("¿Está seguro que desea eliminar este area?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);else confirm=$mdDialog.confirm().title("Eliminar Area").content("No se puede eliminar el area de nivel 0").ariaLabel("Lucky day").ok("OK").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){})},$scope.remove=function(area){if(0!==area.nivel){for(var hijos=[],i=$rootScope.areas.length-1;i>=0;i--)if(0==$rootScope.areas[i].deleted&&null!==$rootScope.areas[i].parent&&$rootScope.areas[i].parent._id==area._id){$scope.updateParent($rootScope.areas[i],area.parent);var hijo=$rootScope.areas[i];hijos.push(hijo)}if(function recorroHijos(hijos){console.log("recorro hijos");var nietos=[];for(var m=hijos.length-1;m>=0;m--)for(var area=hijos[m],i=$rootScope.areas.length-1;i>=0;i--)if(0==$rootScope.areas[i].deleted&&null!==$rootScope.areas[i].parent&&$rootScope.areas[i].parent._id==area._id){$scope.updateParent($rootScope.areas[i],area);var nieto=$rootScope.areas[i];nietos.push(nieto)}nietos.length>0&&recorroHijos(nietos)}(hijos),area)for(var i in area.$remove(),$scope.$parent.areas)$scope.$parent.areas[i]===area&&$scope.$parent.areas.splice(i,1);else $scope.area.$remove(function(){});$mdBottomSheet.hide()}},$scope.updateParent=function(area,parent){area.parent=parent,area.nivel=parseInt(parent.nivel)+1,void 0!==this.enterprise?area.enterprise=this.enterprise._id:void 0!==area.enterprise&&null!==area.enterprise&&(area.enterprise=area.enterprise._id),area.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findAll(),void 0!==$stateParams.areaId&&$scope.findOne()}),$rootScope.procesosEdit=[],$scope.submitEdit=function(){$scope.clickedEdit=!0,$scope.update()},$scope.create=function(){if(void 0!==this.name)if(void 0!==this.parent||0==$rootScope.areas.length){$scope.error=void 0;var area=new Areas({name:this.name,nivel:this.nivel,parent:$scope.parent,objetivos:this.objetivos?this.objetivos:void 0,politicas:this.politicas?this.politicas:void 0,reglas:this.reglas?this.reglas:void 0,sectores:this.sectores?this.sectores:void 0,bienesUso:this.bienesUso?this.bienesUso:void 0,procesos:$rootScope.procesosAgregados,sub:this.sub?this.sub._id:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});area.$save(function(response){response._id&&(area._id=response._id,$rootScope.areas.unshift(area),$rootScope.procesosAgregados=[],$location.path("/rrhh")),$scope.name="",$scope.nivel="",$scope.parent="",$scope.objetivos="",$scope.politicas="",$scope.reglas="",$scope.sectores="",$scope.bienesUso="",$location.path("rrhh")},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error="Debes asignar un area superior";else $scope.errorName="Indicar nombre para el area"},$scope.asignoAreaSuperior=function(){$scope.error=void 0,$scope.area.nivel=parseInt($scope.parent.nivel)+1},$scope.asignoAreaSuperiorCreate=function(){$scope.error=void 0,console.log($scope.parent.nivel),$scope.nivel=parseInt($scope.parent.nivel)+1},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Area").content("¿Está seguro que desea eliminar este area?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){})},$scope.remove=function(area){if(area)for(var i in area.$remove(),$scope.areas)$scope.areas[i]===area&&$scope.areas.splice(i,1);else $scope.area.$remove(function(){});$mdBottomSheet.hide()},$scope.removeProceso=function(item){for(var i in $rootScope.procesosEdit=this.area.procesos,$rootScope.procesosEdit)$rootScope.procesosEdit[i].proceso._id===item._id&&$rootScope.procesosEdit.splice(i,1)},$scope.addProceso=function(proceso){var p={proceso:{}};p.proceso=proceso,$rootScope.procesosEdit=this.area.procesos,$rootScope.procesosEdit.push(p)},$scope.eliminarArea=function(area){if(area)for(var i in console.log(area._id),$http({method:"GET",url:"/api/borrarArea",params:{areaId:$stateParams.areaId}}).then(function(response){},function(response){}),$scope.areas)$scope.areas[i]===area&&$scope.areas.splice(i,1);else $scope.area.$remove(function(){$location.path("areas")})},$scope.update=function(){if(!0===$scope.clickedEdit){console.log($scope.parent,"parent");var area=$scope.area;0!==$rootScope.procesosEdit.length&&(area.procesos=$rootScope.procesosEdit),void 0!==this.enterprise?area.enterprise=this.enterprise._id:void 0!==area.enterprise&&null!==area.enterprise&&(area.enterprise=area.enterprise._id),void 0!==this.sub?area.sub=this.sub:void 0!==area.sub&&null!==area.sub&&(area.sub=area.sub._id),void 0!==$scope.parent?area.parent=$scope.parent._id:void 0!==area.parent&&null!==area.parent&&(area.parent=area.parent._id),console.log(area,"area"),area.$update(function(){$location.path("areas")},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.findAll=function(){$scope.find(),$scope.findProcesos()},$scope.find=function(){void 0!==$scope.SEARCH&&Areas.query({e:$scope.SEARCH.enterprise},function(res){$rootScope.areas=res,0==$rootScope.areas.length&&($scope.nivel=0,$scope.name="Directorio")})},$scope.findOne=function(){$scope.area=Areas.get({areaId:$stateParams.areaId}),$scope.idProvider=$stateParams.providerId},$rootScope.procesosAgregados=[],$scope.selected=[],$scope.toggle=function(item,list){var idx=list.indexOf(item);idx>-1?list.splice(idx,1):(list.push(item),$scope.agregarProceso(item))},$scope.exists=function(item,list){return list.indexOf(item)>-1},$scope.agregarProceso=function(item){var p={proceso:{}};p.proceso=item,$rootScope.procesosAgregados.push(p)},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findProcesos=function(){void 0!==$scope.SEARCH&&($scope.procesos=Procesos.query({e:$scope.SEARCH.enterprise}))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){console.log("por aqui ando")})}}]),angular.module("areas").factory("Areas",["$resource",function($resource){return $resource("api/areas/:areaId",{areaId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("arqueos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Arqueos",state:"arqueos",type:"dropdown"}),Menus.addSubMenuItem("topbar","arqueos",{title:"List Arqueos",state:"arqueos.list"}),Menus.addSubMenuItem("topbar","arqueos",{title:"Create Caja",state:"arqueos.create"})}]),angular.module("arqueos").config(["$stateProvider",function($stateProvider){$stateProvider.state("arqueos",{abstract:!0,url:"/arqueos",template:"<ui-view/>"}).state("arqueos.list",{url:"",templateUrl:"modules/arqueos/views/list-arqueos.client.view.html"}).state("arqueos.create",{url:"/create",templateUrl:"modules/arqueos/views/create-arqueo.client.view.html"}).state("arqueos.view",{url:"/:arqueoId",templateUrl:"modules/arqueos/views/view-arqueo.client.view.html"}).state("arqueos.edit",{url:"/:arqueoId/edit",templateUrl:"modules/arqueos/views/edit-arqueo.client.view.html"})}]),angular.module("arqueos").controller("CreateArqueosController",["user","arqueo","enterprises","$state","arqueos",function(user,arqueo,enterprises,$state,arqueos){this.user=user,this.arqueo=arqueo,this.enterprises=enterprises,this.arqueos=arqueos,this.create=function(){new arqueos({name:res,descripcion:this.descripcion,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.arqueos")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("arqueos").controller("ArqueosEditController",["user","arqueo","enterprises","$location",function(user,arqueo,enterprises,$location){this.user=user,this.arqueo=arqueo,this.enterprises=enterprises,this.update=function(){this.arqueo;void 0!==this.enterprise?caja.enterprise=this.enterprise._id:caja.enterprise=caja.enterprise._id;void 0!==this.modoFacturacion?caja.modoFacturacion=this.modoFacturacion:caja.modoFacturacion=sucursal.modoFacturacion}}]),angular.module("arqueos").controller("ListArqueosController",["$location","user","arqueos","enterprises","$mdDialog",function($location,user,arqueos,enterprises,$mdDialog){this.user=user,this.arqueos=arqueos,this.enterprises=enterprises,this.remove=function(arqueo){arqueo?arqueo.$remove():this.arqueo.$remove(function(){$location.path("arqueos")})}}]),angular.module("arqueos").controller("ArqueosViewController",["user","arqueo",function(user,arqueo){this.user=user,this.arqueo=arqueo}]),angular.module("arqueos").controller("ArqueosController",["$scope","$rootScope","$stateParams","$location","Authentication","Sucursales","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Sucursales,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var caja=new Cajas({name:this.name,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});caja.$save(function(response){response._id&&(caja._id=response._id,$rootScope.cajas.unshift(caja))},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(caja){if(caja)for(var i in caja.$remove(),$scope.cajas)$scope.cajas[i]===caja&&$scope.cajas.splice(i,1);else $scope.caja.$remove(function(){$location.path("cajas")})},$scope.update=function(){var caja=$scope.caja;void 0!==this.enterprise?caja.enterprise=this.enterprise._id:caja.enterprise=caja.enterprise._id,caja.$update(function(){$location.path("cajas/view/"+caja._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.cajas=Cajas.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findOne=function(){$scope.caja=Cajas.get({cajaId:$stateParams.cajaId})}}]),angular.module("arqueos").factory("Arqueos",["$resource",function($resource){return $resource("api/arqueos/:arqueoId",{arqueoId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("arqueos").factory("ArqueosExtra",["$http",function($http){return{loadMore:function(enterprise,last,limit,cajaId){return $http({method:"get",url:"/api/arqueos/loadmoreByCaja",params:{e:enterprise,p:last,limit:limit,caja:cajaId}})},loadMoreByDate:function(enterprise,startdate,enddate,cajaId){return $http({method:"get",url:"/api/arqueos/loadmoreByCaja_Date",params:{e:enterprise,start:startdate,end:enddate,caja:cajaId}})}}}]),angular.module("articles").run(["Menus",function(Menus){}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("articles",{abstract:!0,url:"/articles",template:"<ui-view/>"}).state("articles.list",{url:"",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("articles.create",{url:"/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("articles.view",{url:"/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("articles.edit",{url:"/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function($scope,$stateParams,$location,Authentication,Articles){$scope.authentication=Authentication,$scope.create=function(){new Articles({title:this.title,content:this.content}).$save(function(response){$location.path("articles/"+response._id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(article){if(article)for(var i in article.$remove(),$scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1);else $scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(){var article=$scope.article;article.$update(function(){$location.path("articles/"+article._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.articles=Articles.query()},$scope.findOne=function(){$scope.article=Articles.get({articleId:$stateParams.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("api/articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("cajas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Cajas",state:"cajas",type:"dropdown"}),Menus.addSubMenuItem("topbar","cajas",{title:"List Cajas",state:"cajas.list"}),Menus.addSubMenuItem("topbar","cajas",{title:"Create Caja",state:"cajas.create"})}]),angular.module("cajas").config(["$stateProvider",function($stateProvider){$stateProvider.state("cajas",{abstract:!0,url:"/cajas",template:"<ui-view/>"}).state("cajas.list",{url:"",templateUrl:"modules/cajas/views/list-cajas.client.view.html"}).state("cajas.create",{url:"/create",templateUrl:"modules/cajas/views/create-caja.client.view.html"}).state("cajas.view",{url:"/:cajaId",templateUrl:"modules/cajas/views/view-caja.client.view.html"}).state("cajas.edit",{url:"/:cajaId/edit",templateUrl:"modules/cajas/views/edit-caja.client.view.html"})}]),angular.module("cajas").controller("CajasCreateController",["user","caja","enterprises","$state","cajas","puestos","totalCajas",function(user,caja,enterprises,$state,cajas,puestos,totalCajas){this.user=user,this.caja=caja,this.enterprises=enterprises,this.puestos=puestos,this.cajas=cajas,this.puestosAgregados=[],this.create=function(){var num=totalCajas.length+1,res="Caja ".concat(num);new cajas({name:res,descripcion:this.descripcion,puestos:this.puestosAgregados,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.sucursales")},function(errorResponse){this.error=errorResponse.data.message})},this.agregarPuesto=function(puesto){var ok=!1;if(void 0!==puesto&&null!==puesto){for(var i in this.puestosAgregados)if(this.puestosAgregados[i]._id===puesto._id)var ok=!0;ok||this.puestosAgregados.push(puesto)}console.log(this.puestosAgregados,"puestos agregados")}}]),angular.module("cajas").controller("CajasEditController",["user","caja","enterprises","$location",function(user,caja,enterprises,$location){this.user=user,this.caja=caja,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.update=function(){var caja=this.caja;void 0!==this.enterprise?caja.enterprise=this.enterprise._id:caja.enterprise=caja.enterprise._id;void 0!==this.modoFacturacion?caja.modoFacturacion=this.modoFacturacion:caja.modoFacturacion=sucursal.modoFacturacion}}]),angular.module("cajas").controller("CajasListController",["$location","user","cajas","enterprises","$mdDialog",function($location,user,cajas,enterprises,$mdDialog){function remove(caja){caja?caja.$remove():this.caja.$remove(function(){$location.path("cajas")})}this.user=user,this.cajas=cajas,this.enterprises=enterprises,this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){remove(item)},function(){console.log("cancelaste borrar")})},this.remove=remove}]),angular.module("cajas").controller("CajasViewController",["$stateParams","user","Authentication","caja","TransferenciasExtra","ArqueosExtra","$mdDialog","ComprasExtra","MovimientosExtra","CondicionventasExtra","CajasExtra","$scope","PagosExtra",function($stateParams,user,authentication,caja,TransferenciasExtra,ArqueosExtra,$mdDialog,ComprasExtra,MovimientosExtra,condicionventasExtra,CajasExtra,$scope,PagosExtra){var global=this;this.user=user,this.caja=caja,this.cajaId=$stateParams.cajaId,this.ventasFinalizada=[],this.movimientos=[],this.waiting=!1,this.idCuenta,this.startdate=new Date,this.startdate.setDate(this.startdate.getDate()-5),this.startdate.setHours(0,0,0),this.enddate=new Date,this.enddate.setHours(23,59,0),this.findMovimientos=function(){console.log("Movimientos: "),console.log("Pagos Service: "),this.waiting=!0,condicionventasExtra.loadMore(enterprise,"Cuenta Corriente").then(angular.bind(this,function(res){res.data.length>0&&(global.idCuenta=res.data[0]._id)})),global.commonService(),this.waiting=!1},this.commonService=function(){ArqueosExtra.loadMoreByDate(enterprise,global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)global.movimientos.push(data[i]);console.log(global.movimientos),console.log(global.cajaId)})),TransferenciasExtra.loadMoreByDate(enterprise,global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)global.movimientos.push(data[i]);console.log(global.movimientos),console.log(global.cajaId)})),MovimientosExtra.loadMoreByDate(enterprise,"haber",global.cajaId,global.startdate,global.enddate).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)void 0!=data[i].provider&&global.movimientos.push(data[i]);console.log(global.movimientos),console.log(global.cajaId)})),MovimientosExtra.loadMoreByDate(enterprise,"debe",global.cajaId,global.startdate,global.enddate).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)void 0!=data[i].client&&global.movimientos.push(data[i]);console.log(global.movimientos),console.log(global.cajaId)})),CajasExtra.loadMoreByDate(enterprise,"Pendiente de pago y entrega",global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)data[i].condicionVenta!==global.idCuenta&&data[i].caja===global.cajaId&&global.movimientos.push(data[i])})),CajasExtra.loadMoreByDate(enterprise,"Pendiente de entrega",global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)data[i].condicionVenta!=global.idCuenta&&data[i].caja===global.cajaId&&global.movimientos.push(data[i])})),CajasExtra.loadMoreByDate(enterprise,"Anulada",global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)data[i].condicionVenta!==global.idCuenta&&data[i].caja===global.cajaId&&global.movimientos.push(data[i]),console.log(global.movimientos)})),ComprasExtra.loadMoreByCajaDate(enterprise,"Finalizada",global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)global.movimientos.push(data[i])})),PagosExtra.loadMoreByCajaDate(enterprise,global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)global.movimientos.push(data[i])})),CajasExtra.loadMoreByDate(enterprise,"Finalizada",global.startdate,global.enddate,global.cajaId).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)data[i].condicionVenta!==global.idCuenta&&data[i].caja===global.cajaId&&global.movimientos.push(data[i]);global.loadingCaja=!1}))},this.showAlert=function($event,cierreDeCaja){DialogController.$inject=["$scope","$mdDialog","items","selectedCaja","cierreDeCaja"];var parentEl=angular.element(document.body);function DialogController($scope,$mdDialog,items,selectedCaja,cierreDeCaja){$scope.aperturaValue=0,$scope.ingresosSum=0,$scope.egresosSum=0,$scope.total=0,$scope.items=items,$scope.total=cierreDeCaja.total,$scope.itemsSorted=[],function(){var sortedMovimientos=(itemsNotSorted=$scope.items,sortedItems=itemsNotSorted.sort(function(a,b){var dateA=new Date(a.created),dateB=new Date(b.created);return dateA-dateB}),sortedItems.reverse(),sortedItems),oneWeekAgo=new Date;var itemsNotSorted,sortedItems;oneWeekAgo.setDate(oneWeekAgo.getDate()-7);for(var i=0;i<sortedMovimientos.length;i++){var item=sortedMovimientos[i];if(new Date(item.created)<new Date(cierreDeCaja.created)){if(item.operacion&&"Apertura de Caja"===item.operacion||new Date(item.created)<oneWeekAgo)return void($scope.aperturaValue=item.total);item.cajaD&&item.cajaD._id===selectedCaja._id?$scope.ingresosSum+=item.montoE+item.montoC+item.montoD+item.montoTD+item.montoTC:"haber"==item.estado?$scope.ingresosSum+=item.saldoCaja:item.cliente&&"Finalizada"==item.estado?$scope.ingresosSum+=item.total:item.operacion&&item.ajuste>0?$scope.ingresosSum+=item.ajuste:item.cajaO&&item.cajaO._id===selectedCaja._id?$scope.egresosSum+=item.montoE+item.montoC+item.montoD+item.montoTD+item.montoTC:item.operacion&&item.ajuste<0?$scope.egresosSum-=item.ajuste:item.cliente&&"Anulada"==item.estado?$scope.egresosSum+=item.total:item.proveedor?$scope.egresosSum+=item.total:"debe"==item.estado&&($scope.egresosSum+=item.monto)}}$scope.egresosSum||($scope.egresosSum=0);$scope.ingresosSum||($scope.ingresosSum=0)}(),$scope.closeDialog=function(){$mdDialog.hide()}}$mdDialog.show({parent:parentEl,targetEvent:$event,template:'<md-dialog aria-label="List dialog">  <md-dialog-content>     <h3>Apertura: {{aperturaValue | number: 2}}</h3>     <h3>Ingresos: {{ingresosSum | number: 2}}</h3>     <h3>Egresos: {{egresosSum | number: 2}}</h3>     <h3>Total: {{total | number: 2}}</h3>  </md-dialog-content>  <md-dialog-actions>    <md-button ng-click="closeDialog()" class="md-primary">      Cerrar    </md-button>  </md-dialog-actions></md-dialog>',locals:{items:global.movimientos,selectedCaja:global.caja,cierreDeCaja:cierreDeCaja},controller:DialogController})};var enterprise=this.user?this.user.enterprise.enterprise:authentication.user.enterprise.enterprise;this.findMovimientos(),this.loadmore=function(){global.loadingCaja||global.doneCaja||(global.enddate=new Date(global.startdate),global.startdate.setDate(global.startdate.getDate()-10),global.enddate.setDate(global.enddate.getDate()-1),global.loadingCaja=!0,global.commonService())},global.ventasFinalizada=[],this.loadmoreCaja1=function(){global.loadingCaja=!0,global.movimientosList=global.movimientos,setTimeout(function(){console.log(authentication),console.log("áuth");var p=global.ventasFinalizada.length?global.ventasFinalizada.length:0,enterprise=this.user?this.user.enterprise.enterprise:authentication.user.enterprise.enterprise;CajasExtra.loadMore(enterprise,"Finalizada",p,30).then(angular.bind(this,function(data){data=data.data,global.ventasFinalizada=global.ventasFinalizada.concat(data),console.log(data.length);for(var i=0;i<data.length;i++)data[i].caja==caja._id&&data[i].condicionVenta!=global.idCuenta&&(console.log("data pushed1"),global.movimientos.push(data[i]));global.loadingCaja=!1,global.movimientosList=global.movimientos}))},1e3)}}]),angular.module("cajas").controller("CajasController",["$scope","$rootScope","$stateParams","$location","Authentication","Sucursales","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Sucursales,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var caja=new Cajas({name:this.name,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});caja.$save(function(response){response._id&&(caja._id=response._id,$rootScope.cajas.unshift(caja))},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(caja){if(caja)for(var i in caja.$remove(),$scope.cajas)$scope.cajas[i]===caja&&$scope.cajas.splice(i,1);else $scope.caja.$remove(function(){$location.path("cajas")})},$scope.update=function(){var caja=$scope.caja;void 0!==this.enterprise?caja.enterprise=this.enterprise._id:caja.enterprise=caja.enterprise._id,caja.$update(function(){$location.path("cajas/view/"+caja._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.cajas=Cajas.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findOne=function(){$scope.caja=Cajas.get({cajaId:$stateParams.cajaId})}}]),angular.module("cajas").factory("Cajas",["$resource",function($resource){return $resource("api/cajas/:cajaId",{cajaId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("cajas").factory("CajasExtra",["$http",function($http){return{select:function(estado,enterprise){return $http({method:"get",url:"/api/ventas/select",params:{e:enterprise,estado:estado}})},loadMoreByDate:function(enterprise,estado,startdate,enddate,cajaId){return $http({method:"get",url:"/api/ventas/loadmoreByCaja_Date",params:{e:enterprise,start:startdate,end:enddate,caja:cajaId,estado:estado}})}}}]),angular.module("categories").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Categories",state:"categories",type:"dropdown"}),Menus.addSubMenuItem("topbar","categories",{title:"List Categories",state:"categories.list"}),Menus.addSubMenuItem("topbar","categories",{title:"Create Category",state:"categories.create"})}]),angular.module("categories").config(["$stateProvider",function($stateProvider){$stateProvider.state("categories",{abstract:!0,url:"/categories",template:"<ui-view/>"}).state("categories.list",{url:"",templateUrl:"modules/categories/views/list-categories.client.view.html"}).state("categories.create",{url:"/create",templateUrl:"modules/categories/views/create-category.client.view.html"}).state("categories.view",{url:"/:categoryId",templateUrl:"modules/categories/views/view-category.client.view.html"}).state("categories.edit",{url:"/:categoryId/edit",templateUrl:"modules/categories/views/edit-category.client.view.html"})}]),angular.module("categories").controller("CategoriesController",["$scope","$rootScope","$stateParams","$location","Authentication","Categories","Enterprises","$mdBottomSheet","$mdDialog","$state","Subs",function($scope,$rootScope,$stateParams,$location,Authentication,Categories,Enterprises,$mdBottomSheet,$mdDialog,$state,Subs){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Categoría").content("¿Está seguro que desea eliminar esta categoría?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(category){if(category)for(var i in category.$remove(),$scope.categories)$scope.categories[i]===category&&$scope.categories.splice(i,1);else $scope.category.$remove(function(){$location.path("categories")})}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findCategoryTypes()}),$scope.selectedMode="md-scale",$scope.selectedDirection="up",$scope.create=function(){if(void 0!==this.name)if(void 0!==this.categoryType)if(void 0!==this.sub){var category=new Categories({name:this.name,description:this.description?this.description:void 0,type1:this.categoryType,sub:this.sub,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});category.$save(function(response){response._id&&(category._id=response._id,$rootScope.categories.unshift(category)),$scope.name="",$scope.description="",$state.go("home.categories")},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorName="Indicar UEN";else $scope.errorName="Indicar el tipo de la categoria ";else $scope.errorName="Indicar el nombre para la categoria "},$scope.update=function(){var category=$scope.category;void 0!==this.sub?category.sub=this.sub._id:void 0!==category.sub&&null!==category.sub&&(category.sub=category.sub._id),void 0!==this.enterprise?category.enterprise=this.enterprise._id:void 0!==category.enterprise&&null!==category.enterprise&&(category.enterprise=category.enterprise._id),void 0!==this.categoryType&&(category.type1=this.categoryType),void 0==category.mostrador&&(category.mostrador=!1),category.$update(function(){$location.path("categorias")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.categories=Categories.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findCategoryTypes=function(){void 0!==$scope.SEARCH&&($scope.categoryTypes=["Centro de Costo","Tipo de Venta","Tipo de Compra","Cliente","Contacto","Insumo","Materia Prima","Producto","Producto Interno","Proveedor","Proceso","Remuneracione"])},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findOne=function(){$scope.category=Categories.get({categoryId:$stateParams.categoryId})},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){console.log("por aqui ando")})},$scope.borrarError=function(){$scope.errorName=void 0}}]),angular.module("categories").controller("CategoriesListController",["$rootScope","user","categories","enterprises","$mdBottomSheet","$mdDialog","categoryTypes","$state",function($rootScope,user,categories,enterprises,$mdBottomSheet,$mdDialog,categoryTypes,$state){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Categoría").content("¿Está seguro que desea eliminar esta categoría?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){!function(category){category?category.$remove():this.category.$remove(function(){});$mdBottomSheet.hide()}(item)},function(){$mdBottomSheet.hide()})}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],this.user=user,this.categories=categories,this.enterprises=enterprises,this.categoryTypes=categoryTypes,this.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),angular.module("categories").controller("CategoriesViewController",["user","category",function(user,category){this.user=user,this.category=category,this.selectedMode="md-scale",this.selectedDirection="up"}]),angular.module("categories").factory("Categories",["$resource",function($resource){return $resource("api/categories/:categoryId",{categoryId:"@_id",e:"@enterprise",type1:"@type1"},{update:{method:"PUT"}})}]),angular.module("chat").run(["Menus",function(Menus){}]),angular.module("chat").config(["$stateProvider",function($stateProvider){$stateProvider.state("chat",{url:"/chat",templateUrl:"modules/chat/views/chat.client.view.html"})}]),angular.module("chat").controller("ChatController",["$scope","Socket","Posts","lodash","Authentication",function($scope,Socket,Posts,lodash,Authentication){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null}});var _=lodash;$scope.posts=[],Socket.on("PostList",function(message){message.length>0&&message[0].enterprise===$scope.SEARCH.enterprise&&($scope.posts=message)}),Socket.on("newPost",function(message){void 0!==$scope.SEARCH&&message.enterprise===$scope.SEARCH.enterprise&&(_.some($scope.posts,function(p){return p._id===message._id})||$scope.posts.unshift(message))}),Socket.on("newComment",function(message){if(void 0!==$scope.SEARCH&&message.user.enterprise._id===$scope.SEARCH.enterprise){var post=_.find($scope.posts,function(post){return post._id===message.postId});post&&!_.some(post.comments,function(c){return c._id===message._id})&&post.comments.push(message)}}),$scope.sendPost=function(){var post={message:this.messageText};Socket.emit("createPost",post),this.messageText=""},$scope.sendComment=function($event,post){if(13===$event.keyCode){var comment={postId:post._id,message:post.commentBox.message};Socket.emit("createComment",comment),this.post.commentBox.message=""}},$scope.findPosts=function(){Socket.emit("getPosts",null)},$scope.$on("$destroy",function(){Socket.removeListener("chatMessage")})}]),angular.module("compras").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Compras",state:"compras",type:"dropdown"}),Menus.addSubMenuItem("topbar","compras",{title:"List Compras",state:"compras.list"}),Menus.addSubMenuItem("topbar","compras",{title:"Create Compra",state:"compras.create"})}]),angular.module("compras").config(["$stateProvider",function($stateProvider){$stateProvider.state("compras_",{abstract:!0,url:"/compras_",template:"<ui-view/>"}).state("compras.list",{url:"",templateUrl:"modules/compras/views/list-compras.client.view.html"}).state("compras.create",{url:"/create",templateUrl:"modules/compras/views/create-compra.client.view.html"}).state("compras.view",{url:"/:compraId",templateUrl:"modules/compras/views/view-compra.client.view.html"}).state("compras.edit",{url:"/:compraId/edit",templateUrl:"modules/compras/views/edit-compra.client.view.html"})}]),angular.module("compras").controller("ComprasController",["$scope","$rootScope","$stateParams","$location","Authentication","Compras","Enterprises","Comprobantes","Condicionventas","Products","Providers","$mdBottomSheet","$state","lodash","$mdDialog","$timeout","$filter","Modal","Categories","Subs","Metrics","$http","Contacts","Taxconditions","HistorialCompras","$q",function($scope,$rootScope,$stateParams,$location,Authentication,Compras,Enterprises,Comprobantes,Condicionventas,Products,Providers,$mdBottomSheet,$state,lodash,$mdDialog,$timeout,$filter,Modal,Categories,Subs,Metrics,$http,Contacts,Taxconditions,HistorialCompras,$q){DialogController.$inject=["$scope","$mdDialog","item","Ventas"],CrearController.$inject=["$scope","$mdDialog","Modal","Products","Contacts"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findProveedores(),$scope.findProductos(),$scope.findComprobantes(),$scope.findCondicionesventas(),$scope.findOne()});var created=new Date;$scope.created=new Date(created.setTime(created.getTime()+108e5)),$scope.$watchCollection("compraVerificada",function(){}),$rootScope.$watchCollection("nuevoProveedor",function(){void 0!==$rootScope.nuevoProveedor?($scope.mostrar=!0,$scope.proveedor=$rootScope.nuevoProveedor,$scope.selectedItemChange($scope.proveedor),$rootScope.nuevoProveedor=void 0):$scope.mostrar=!1}),$rootScope.$watchCollection("nuevaMateriaPrima",function(){void 0!==$rootScope.nuevaMateriaPrima?($scope.mostrarMateria=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevaMateriaPrima._id,params:{}}).then(function(response){$scope.producto=response.data},function(response){console.log("error")}),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarMateria=!1}),$scope.modoEdicion=!1,$scope.isFocus=!1,$scope.initAutocomplete=function(){$scope.findProductos(),$scope.searchTextChangeProduct("")},$scope.activarEdicion=function(compra){$scope.modoEdicion=!0,$scope.compraVerificada=angular.copy(compra),$location.hash("verificacion")},$scope.cerrarEdicion=function(compra){$scope.modoEdicion=!1,$scope.compraVerificada=void 0},$scope.modificoProducto=function(p){!function(p){for(var i=0;i<$scope.compraVerificada.products.length;i++)if($scope.compraVerificada.products[i]._id==p._id){var total=0,desc=$scope.compraVerificada.products[i].descuento*$scope.compraVerificada.products[i].product.costPerUnit/100,descTotal=desc*$scope.compraVerificada.products[i].cantidad;total=$scope.compraVerificada.products[i].product.costPerUnit*$scope.compraVerificada.products[i].cantidad,$scope.compraVerificada.products[i].total=total-descTotal,$scope.compraVerificada.products[i].subtotal=total}}(p),function(){var i,sub=0,totTax1=0,totTax2=0,totTax3=0,tax1=[],tax2=[],tax3=[];void 0!==$scope.compraVerificada.descuentoPorcentaje&&parseFloat($scope.compraVerificada.descuentoPorcentaje);for(i=0;i<$scope.compraVerificada.products.length;i++){void 0===$scope.compraVerificada.products[i].descuento&&($scope.compraVerificada.products[i].descuento=0),void 0!==$scope.compraVerificada.products[i].cantidad&&null!==$scope.compraVerificada.products[i].cantidad||($scope.compraVerificada.products[i].cantidad=0),void 0===$scope.compraVerificada.products[i].product.costPerUnit&&($scope.compraVerificada.products[i].product.costPerUnit=0);var desc=parseFloat($scope.compraVerificada.products[i].descuento)*$scope.compraVerificada.products[i].product.costPerUnit/100,finalPrice=parseFloat($scope.compraVerificada.products[i].product.costPerUnit)-desc,additionalIva=parseFloat($scope.compraVerificada.products[i].product.tax)*parseFloat(finalPrice)/100;10.5===parseFloat($scope.compraVerificada.products[i].product.tax)&&tax1.push(additionalIva*parseFloat($scope.compraVerificada.products[i].cantidad)),21===parseFloat($scope.compraVerificada.products[i].product.tax)&&tax2.push(additionalIva*parseFloat($scope.compraVerificada.products[i].cantidad)),27===parseFloat($scope.compraVerificada.products[i].product.tax)&&tax3.push(additionalIva*parseFloat($scope.compraVerificada.products[i].cantidad)),sub+=parseFloat($scope.compraVerificada.products[i].cantidad)*finalPrice}if(tax1.length>0)for(i=0;i<tax1.length;i++)totTax1+=parseFloat(tax1[i]);if(tax2.length>0)for(i=0;i<tax2.length;i++)totTax2+=parseFloat(tax2[i]);if(tax3.length>0)for(i=0;i<tax3.length;i++)totTax3+=parseFloat(tax3[i]);$scope.compraVerificada.subtotal=sub;var d=$scope.compraVerificada.descuentoPorcentaje*$scope.compraVerificada.subtotal/100;$scope.compraVerificada.descuentoValor=d,$scope.compraVerificada.neto=$scope.compraVerificada.subtotal-d,$scope.compraVerificada.tax1=totTax1,$scope.compraVerificada.tax2=totTax2,$scope.compraVerificada.tax3=totTax3,$scope.compraVerificada.totalTax=totTax1+totTax2+totTax3,$scope.compraVerificada.total=$scope.compraVerificada.neto+totTax1+totTax2+totTax3}(),$scope.modificarPrecioProducto(p.product)},$scope.modificarPrecioProducto=function(p){for(var i in $rootScope.products=$scope.products,$rootScope.products)if($rootScope.products[i]._id===p._id){var cost=p.costPerUnit;p=$rootScope.products[i];var product=new Products({_id:p._id,name:p.name,description:p.description,code:p.code,brandName:p.brandName,unitPrice:cost,costPerUnit:cost,discontinued:p.discontinued,provider:p.provider,quantityPerUnit:p.quantityPerUnit,unitsInStock:p.unitsInStock,idealStock:p.idealStock,criticalStock:p.criticalStock,unitsOnOrder:p.unitsOnOrder,storedIn:p.storedIn,metric:p.metric,reseller:p.reseller,visible:p.visible,esProducto:p.esProducto,esMateriaPrima:p.esMateriaPrima,esInsumo:p.esInsumo,tax:p.tax,enterprise:p.enterprise,sub:p.sub._id,category1:p.category1,category2:p.category2});product.enterprise=product.enterprise._id,void 0!==product.sub&&null!==product.sub&&(product.sub=product.sub._id),void 0!==product.category1&&null!==product.category1&&(product.category1=product.category1._id),void 0!==product.category2&&null!==product.category2&&(product.category2=product.category2?product.category2._id:void 0),void 0!==product.provider&&null!==product.provider&&(product.provider=product.provider._id),product.$update(function(response){},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.historialDeCompra=function(compraO){var historialCompra=new HistorialCompras({compra:$scope.historialCompra});console.log("ISTORIJAA"),historialCompra.$save(function(response){$scope.modoEdicion=!1;var compra=$scope.compraVerificada;compra.historial=response,compra.estado="Finalizada",void 0!==compra.enterprise&&(compra.enterprise=compra.enterprise._id),void 0!==compra.tipoComprobante&&(compra.tipoComprobante=compra.tipoComprobante._id),void 0!==compra.proveedor&&(compra.proveedor=compra.proveedor._id),void 0!==compra.condicionVenta&&(compra.condicionVenta=compra.condicionVenta._id),void 0!==compra.caja&&(compra.caja=compra.caja._id),compra.$update(function(){$scope.findOne()},function(errorResponse){$scope.error=errorResponse.data.message}),$scope.compraVerificada=null},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.productoCompra={cantidad:void 0,descuento:void 0,observaciones:""},$scope.mostrarFormulario=!0,$scope.mostrarForm=!1,$scope.deshabilitarProveedor=!1,$scope.idProveedor=0,$rootScope.productosAgregados=[],$scope.productoEditado=[],$scope.comprobanteEditado=!1,$scope.mostrarProductos=!1,$scope.verAnuladas=0,$scope.verCerradas=0,$scope.tipeando=!1,$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.total=parseFloat(0),$scope.totalTax=0,$scope.showConfirmRecepcion=function(ev,item){var confirm=$mdDialog.confirm().title("Recibir compra").content("¿Confirmar recibo de la compra?").ariaLabel("Lucky day").ok("Confirmar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){item.estado="Finalizada",$scope.update(item)},function(){console.log("cancelaste cerrar")})},$scope.showConfirmPago=function(ev,item){var confirm=$mdDialog.confirm().title("Pagar compra").content("¿Confirmar pago de la compra?").ariaLabel("Lucky day").ok("Confirmar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){item.estado="Finalizada",$scope.update(item)},function(){console.log("cancelaste cerrar")})},$scope.showConfirm=function(ev,item,n){switch(console.log(n),n){case 1:var confirm=$mdDialog.confirm().title("Anular Compra").content("¿Está seguro que desea anular esta compra?").ariaLabel("Lucky day").ok("Anular").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){item.estado="Anulada",$scope.update(item),$scope.montoTotal()},function(){console.log("cancelaste anular")});break;case 3:confirm=$mdDialog.confirm().title("Verificar Compra").content("¿Está seguro que verificar esta compra?").ariaLabel("Lucky day").ok("Verificar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.historialDeCompra(item)},function(){console.log("cancelaste verificar")})}},$scope.descProveedor=function(){null!==$scope.proveedor&&void 0!==$scope.proveedor?($scope.idProveedor=$scope.proveedor._id,$scope.errorProv=void 0):$scope.idProveedor=0,void 0!==this.producto&&null!==this.producto&&!1===$scope.tipeando&&(this.producto=void 0,$scope.searchText=void 0)},$scope.agregar=function(item){$scope.producto=item,item=void 0},$scope.sendProduct=function($event,productoCompra,producto){$scope.mensajeP=void 0,13===$event.keyCode&&($event.preventDefault(),null===producto||void 0===producto?$scope.mensajeP="No seleccionaste un producto":($scope.mensajeP=void 0,void 0===productoCompra&&(productoCompra={cantidad:0}),null===productoCompra.cantidad||void 0===productoCompra.cantidad||0===productoCompra.cantidad?$scope.mensajeP="No seleccionaste una cantidad para el producto":($scope.mensajeP=void 0,$scope.producto=producto,$scope.agregarProducto(producto,productoCompra))))},$scope.agregarProducto=function(producto,productoCompra){$scope.clicked=!1,$scope.errorProd=void 0,$scope.mensajeP=void 0;var p={product:{},cantidad:void 0,descuento:void 0,total:void 0,subtotal:void 0,observaciones:void 0};if(void 0==producto)return 0;if(void 0==producto.total&&(producto.total=0),p.product=producto,$scope.proveedor&&producto.provider[0].id)for(var item in producto.provider)if(producto.provider[item].id==$scope.proveedor._id){p.product.costPerUnit=producto.provider[item].price,p.product.tax=producto.provider[item].tax;break}p.cantidad=productoCompra.cantidad,void 0==productoCompra.descuento?p.descuento=0:p.descuento=productoCompra.descuento,void 0==productoCompra.observaciones?p.observaciones="":p.observaciones=productoCompra.observaciones,p.total=0,p.subtotal=0;var subtotal=calcularSubtotal(p);p.total=p.total+subtotal,$rootScope.productosAgregados.push(p),productoCompra=void 0,p=void 0,$scope.productoCompra={cantidad:void 0,descuento:void 0,observaciones:""},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.searchText="",$scope.deshabilitarProveedor=!0,document.getElementById("buscaP").focus()},$scope.reverse=function(array){return[].concat(array).reverse()},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.searchText=null;var calcularSubtotal=function(p){var total,descuentoPorcentaje=p.descuento,precio=parseFloat(p.product.costPerUnit),cant=parseFloat(p.cantidad),subtotal=parseFloat(precio*cant),descuentoValor=subtotal*descuentoPorcentaje/100;return p.subtotal=subtotal,total=subtotal-descuentoValor,$scope.subtotal=$scope.subtotal+total,$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,10.5==p.product.tax&&($scope.tax1=$scope.tax1+10.5*total/100),21==p.product.tax&&($scope.tax2=$scope.tax2+21*total/100),27==p.product.tax&&($scope.tax3=$scope.tax3+27*total/100),$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3,$scope.totalTax=$scope.tax1+$scope.tax2+$scope.tax3,total};function DialogController($scope,$mdDialog,item,Ventas){$scope.item=item,$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.actualizarCompra=function(data){var compra=$scope.item;if("pagado"===data)var estado="Pendiente de recepcion";if("recibido"===data)estado="Pendiente de pago2";if("pYr"===data)estado="Finalizada";compra.estado=estado,compra.enterprise=compra.enterprise._id,compra.tipoComprobante=compra.tipoComprobante._id,compra.proveedor=compra.proveedor._id,compra.condicionVenta=compra.condicionVenta._id,compra.$update(function(){$mdDialog.hide(),$location.path("compras")},function(errorResponse){$scope.error=errorResponse.data.message})}}function CrearController($scope,$mdDialog,Modal,Products,Contacts){void 0!==$rootScope.provider&&null!==$rootScope.provider?$scope.provider=$rootScope.provider.name:$scope.provider=void 0,$scope.contacts=Modal.getContactos(),$scope.taxconditions=Modal.getCondiciones(),$scope.comprobantes=Modal.getComprobantes(),$scope.categories2=["Materia Prima","Insumo"],$scope.categories=Modal.getCategorias(),$scope.subcategorias=Modal.getSubcategorias(),$scope.subs=Modal.getSubs(),$scope.proveedores=Modal.getProveedores(),$scope.taxes=Modal.getTaxes(),$scope.metrics=Modal.getMetrics(),$scope.quantityPerUnit=0,$scope.unitsInStock=0,$scope.idealStock=0,$scope.criticalStock=0,$scope.unitPrice=0,$scope.costPerUnit=0,$scope.condicionPagos=Modal.getCondicionesVentas(),$scope.banco={name:void 0,account:void 0,cbu:void 0,identity:void 0},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.postalCode="1900",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.placeChangedContact=function(){$scope.placeContact=this.getPlace()},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.crearMateriaPrima=function(){var esMp=!1,esI=!1;for(var i in $scope.categories)if($scope.categories[i].name===this.category1)var categoria=$scope.categories[i];for(var i in"Insumo"===categoria.name?esI=!0:esMp=!0,$scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;if(void 0===$rootScope.provider){for(var i in $scope.proveedores)if($scope.proveedores[i].name===this.provider)var idProveedorModal=$scope.proveedores[i]._id}else idProveedorModal=$rootScope.provider._id;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.tax)if(void 0!==categoria.name)if(void 0!==this.category2)if(void 0!==this.sub)if(void 0!==this.provider){var product=new Products({name:this.name,description:this.description?this.description:void 0,code:this.code,brandName:this.brandName?this.brandName:void 0,unitPrice:this.unitPrice,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:idProveedorModal,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esInsumo:esI,esMateriaPrima:esMp,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub._id,category1:categoria._id,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevaMateriaPrima=product},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorSub="Se debe especificar la UEN para el producto";else $scope.errorCategory="Se debe especificar la subcategoria para el producto";else $scope.errorCategory2="Indicar la categoria del producto";else $scope.errorTax="Se debe especificar el iva para el producto";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"},$scope.borrarError=function(){$scope.errorCode=void 0,$scope.errorProv=void 0,$scope.errorName=void 0,$scope.errorNameProv=void 0,$scope.errorTax=void 0,$scope.errorSub=void 0,$scope.errorCategory=void 0,$scope.errorCategory2=void 0,$scope.errorCondicion=void 0,$scope.errorComprobante=void 0},$scope.crearProveedor=function(){var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==this.address){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng();if(void 0!==this.category1)if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.comprobante){var provider=new Providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,comprobante:this.comprobante?this.comprobante._id:void 0,banco:this.banco,taxCondition:this.taxcondition?this.taxcondition._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter,paymentMethod:this.paymentMethod,contacts:this.contact?this.contact._id:void 0,country:this.country,city:this.city,region:this.region?this.region:void 0,postalCode:this.postalCode,address:this.address,phone:this.phone?this.phone:void 0,loc:[latitud,longitud],web:this.web?this.web:void 0,enterprise:empresa,category1:this.category1?this.category1._id:void 0});provider.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoProveedor=provider},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Indicar el tipo de comprobante";else $scope.errorCondicion="Indicar condicion de pago";else $scope.errorTax="Indicar la condicion de iva";else $scope.errorCategory="Indicar la categoria"}else $scope.errorDir="Indicar la direccion";else $scope.errorNameProv="Indicar la razón social"}}$scope.borrarProducto=function(producto){var subt,iva,descProd,descGen,totalIva,tax1=0,tax2=0,tax3=0;descProd=parseFloat(producto.product.costPerUnit*producto.cantidad*producto.descuento/100),subt=parseFloat(producto.product.costPerUnit*producto.cantidad-descProd),descGen=parseFloat(subt*$scope.descuentoPorcentaje/100),10.5==(iva=producto.product.tax)&&(tax1=parseFloat(10.5*subt/100),$scope.tax1=parseFloat($scope.tax1-tax1)),21==iva&&(tax2=parseFloat(21*subt/100),$scope.tax2=parseFloat($scope.tax2-tax2)),27==iva&&(tax3=parseFloat(27*subt/100),$scope.tax3=parseFloat($scope.tax3-tax3)),$scope.neto=parseFloat($scope.neto-(subt-descGen)),$scope.subtotal=parseFloat($scope.subtotal-subt),totalIva=subt-descGen+tax1+tax2+tax3,$scope.descuentoValor=parseFloat($scope.descuentoValor-descGen),$scope.total=$scope.total-totalIva,$scope.totalTax=$scope.totalTax-tax1-tax2-tax3,$rootScope.productosAgregados.splice(producto,1),0==$rootScope.productosAgregados.length&&($scope.deshabilitarProveedor=!1)},$scope.cantProductos=function(){if($rootScope.productosAgregados.length>0)return!0},$scope.clickSubmit=function(){$scope.clicked=!0,$scope.create()},$scope.create=function(){if(!0===$scope.clicked)if(0!==$scope.productosAgregados.length)if(void 0!==$scope.proveedor)if(void 0!==$scope.comprobante)if(void 0!==$scope.tipoComprobante)if(void 0!==this.condicionV){var compra=new Compras({created:$scope.created,comprobante:this.comprobante,tipoComprobante:this.tipoComprobante,products:$rootScope.productosAgregados,proveedor:$scope.proveedor,observaciones:this.observaciones,subtotal:this.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:this.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,total:this.total,condicionVenta:this.condicionV._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});compra.$save(function(response){response._id&&(compra._id=response._id,$rootScope.compras.unshift(compra)),$state.go("home.compras"),$scope.comprobante="",$scope.tipoComprobante="",$scope.observaciones="",$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.total=0,$scope.condicionVenta="",$scope.clicked=!1,$rootScope.nuevoProveedor="",$rootScope.nuevaMateriaPrima="",$scope.proveedor="",$scope.producto=""},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorCondicion="No elegiste una condicion de compra";else $scope.errorTipoC="No elegiste un tipo de comprobante";else $scope.errorComprobante="Se debe especificar un numero de comprobante";else $scope.errorProv="No elegiste un proveedor";else $scope.errorProd="Tenes que elegir productos para la compra"},$scope.editar=function(index){$scope.productoEditado[index]=!0},$scope.editarProducto=function(index,p){var subt=0,tax1=0,tax2=0,tax3=0,descuento=p.product.costPerUnit*p.descuento/100;p.subtotal=p.cantidad*p.product.costPerUnit,p.total=p.cantidad*(p.product.costPerUnit-descuento),$rootScope.productosAgregados[index]=p;for(var i=0;i<$rootScope.productosAgregados.length;i++){subt+=$rootScope.productosAgregados[i].total;var iva=$rootScope.productosAgregados[i].product.tax;10.5==iva&&(tax1+=10.5*$rootScope.productosAgregados[i].total/100),21==iva&&(tax2+=21*$rootScope.productosAgregados[i].total/100),27==iva&&(tax3+=27*$rootScope.productosAgregados[i].total/100)}$scope.descuentoValor=subt*$scope.descuentoPorcentaje/100,$scope.subtotal=subt,$scope.neto=subt-$scope.descuentoValor,$scope.tax1=tax1,$scope.tax2=tax2,$scope.tax3=tax3,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3,this.p=void 0,$scope.productoEditado[index]=!1},$scope.remove=function(compra){if(compra)for(var i in compra.$remove(),$scope.compras)$scope.compras[i]===compra&&$scope.compras.splice(i,1);else $scope.compra.$remove(function(){$location.path("compras")})},$scope.update=function(item){var compra=item;void 0!==this.enterprise?compra.enterprise=this.enterprise._id:void 0!==compra.enterprise&&null!==compra.enterprise&&(compra.enterprise=compra.enterprise._id),void 0!==this.tipoComprobante?compra.tipoComprobante=this.tipoComprobante._id:void 0!==compra.tipoComprobante&&null!==compra.tipoComprobante&&(compra.tipoComprobante=compra.tipoComprobante._id),void 0!==$scope.proveedor?compra.proveedor=$scope.proveedor._id:void 0!==compra.proveedor&&null!==compra.proveedor&&(compra.proveedor=compra.proveedor._id),void 0!==this.condicionVenta?compra.condicionVenta=this.condicionVenta._id:void 0!==compra.condicionVenta&&null!==compra.condicionVenta&&(compra.condicionVenta=compra.condicionVenta._id),void 0!==this.caja?compra.caja=this.caja._id:void 0!==compra.caja&&null!==compra.caja&&(compra.caja=compra.caja._id),compra.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.comprobarComprobante=function(compra){0==compra.comprobante?$scope.comprobanteEditado=!0:(compra.estado="cerrado",$scope.update(compra),$scope.montoTotal())},$scope.find=function(){(function(item){void 0!==$scope.SEARCH&&($rootScope.compras=Compras.query({e:$scope.SEARCH.enterprise}));var deferred=$q.defer();return setTimeout(function(){void 0!==$rootScope.compras?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})().then(function(response){$scope.montoTotal()})},$scope.comprasFinalizadas=[],$scope.montoTotal=function(){$scope.totalPendientesPR=0,$scope.totalPendientesPago=0,$scope.totalPendientesRecepcion=0,$scope.totalFinalizadas=0,$scope.totalAnuladas=0;for(var i=0;i<$scope.compras.length;i++)"Pendiente de pago y recepcion"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalPendientesPR=$scope.totalPendientesPR+$scope.compras[i].total),"Pendiente de pago2"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalPendientesPago=$scope.totalPendientesPago+$scope.compras[i].total),"Pendiente de recepcion"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalPendientesRecepcion=$scope.totalPendientesRecepcion+$scope.compras[i].total),"Finalizada"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalFinalizadas=$scope.totalFinalizadas+$scope.compras[i].total),"Anulada"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalAnuladas=$scope.totalAnuladas+$scope.compras[i].total)},$scope.findOne=function(){Compras.get({compraId:$stateParams.compraId},function(res){$scope.compra=res,void 0!==$scope.compra.historial&&$http({method:"GET",url:"/api/users/byId",params:{userId:$scope.compra.historial.modificadoPor}}).then(function(response){$scope.usuarioDeHistorial=response.data},function(err){console.log("Error"+err)})}),$scope.historialCompra=Compras.get({compraId:$stateParams.compraId})},$scope.findTipoComprobante=function(){void 0!==$scope.SEARCH&&($scope.tipoComprobante=Comprobantes.query({e:$scope.SEARCH.enterprise}))},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/comprobantes/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){for(var i in $scope.comprobantesFiltro=response.data,$scope.comprobantes)"Pedido"===$scope.comprobantesFiltro[i].name&&$scope.comprobantesFiltro.splice(i,1);Modal.setComprobantes($scope.comprobantesFiltro)})},$scope.findCondicionesventas=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data,Modal.setCondicionesVentas($scope.condicionVentas)})},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findProductos=function(){void 0!==$scope.SEARCH&&($scope.products=Products.query({e:$scope.SEARCH.enterprise}).$promise.then(function(product){}))},$scope.findProveedores=function(){void 0!==$scope.SEARCH&&($scope.proveedores=Providers.query({e:$scope.SEARCH.enterprise}),Modal.setProveedores($scope.proveedores))},$scope.searchTextChange=function(text){angular.lowercase(text);return $filter("filter")($scope.proveedores,{name:text})},$scope.sendProvider=function($event,provider){13===$event.keyCode&&($event.preventDefault(),null===provider||void 0===provider?$scope.mensajeP="No seleccionaste un proveedor valido":$scope.proveedor=provider)},$scope.selectedItemChange=function(item){console.log("entre selected item change"),null!==item&&void 0!==item&&($scope.idProveedor=item._id),$scope.proveedor=item,$rootScope.provider=item,$scope.descProveedor(),$scope.tipeando=!1,null!==item&&Providers.get({providerId:item._id},function(prov){for(var i=0;i<$scope.condicionVentas.length;i++)$scope.condicionVentas[i]._id==prov.condicionPago._id&&($scope.condicionV=$scope.condicionVentas[i]);for(i=0;i<$scope.comprobantesFiltro.length;i++)$scope.comprobantesFiltro[i]._id==prov.comprobante._id&&($scope.tipoComprobante=$scope.comprobantesFiltro[i])})},$scope.searchTextChangeProduct=function(text){console.log($scope.idProveedor,"id prov compras"),$scope.tipeando=!0;angular.lowercase(text);return 0===$scope.idProveedor?$scope.filtrados=$filter("filter")($scope.products,function(item){return!0===item.esMateriaPrima||!0===item.esInsumo}):$scope.filtrados=$filter("filter")($scope.products,function(item){return(!0===item.esMateriaPrima||!0===item.esInsumo)&&item.provider._id===$scope.idProveedor}),$scope.filtrados=$filter("filter")($scope.filtrados,{name:text})},$scope.selectedItemChangeProduct=function(item){$scope.errorProd=void 0,$scope.producto=item,null!==$scope.producto&&document.getElementById("inputCantidad").focus(),null!==this.proveedor&&void 0!==this.proveedor||null!==$scope.producto&&void 0!==$scope.producto&&(this.proveedor=$scope.producto.provider)},$scope.searchTextChangeCode=function(text){angular.lowercase(text);return $filter("filter")($scope.products,{code:text})},$scope.selectedItemChangeCode=function(item){$scope.producto=item,console.log($scope.producto,"producto elegido")},$scope.showAdvanced=function(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/compras/views/modal.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.showAdvancedProvider=function(ev){$scope.minLenghtProv=1,$scope.textToSearch=void 0,$scope.findContacts(),$scope.findCategories(),$scope.findTaxConditions(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/compras/views/create.provider.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLenghtProv=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLenghtProv=0,$scope.status="You cancelled the dialog."})},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}),Modal.setContactos($scope.contacts))},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}),Modal.setCondiciones($scope.taxconditions))},$scope.minLenghtProd=0,$scope.minLenghtProv=0,$scope.showAdvancedProduct=function(ev){$scope.minLenghtProd=1,$scope.searchText=void 0,$scope.findProveedores(),$scope.findSubs(),$scope.findMetrics(),$scope.findSubcategories(),$scope.findCategories(),$scope.findTaxes(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/compras/views/create.product.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLenght=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLenght=0,$scope.status="You cancelled the dialog."})},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setCategorias($scope.categories))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}),Modal.setSubs($scope.subs))},$scope.findSubcategories=function(){void 0!==$scope.SEARCH&&($scope.subcategorias=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setSubcategorias($scope.subcategorias))},$scope.findTaxes=function(){void 0!==$scope.SEARCH&&($scope.taxes=[{value:1,name:"Iva incluido en el costo"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}],Modal.setTaxes($scope.taxes))},$scope.findMetrics=function(){void 0!==$scope.SEARCH&&($scope.metrics=Metrics.query(),Modal.setMetrics($scope.metrics))},$scope.extraerCompra=function(item){(function(item){var deferred=$q.defer();return $scope.compra=item,setTimeout(function(){void 0!==$scope.compra?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})(item).then(function(response){$scope.printIt()})},$scope.printIt=function(){var theUrl,xmlHttp,a=(theUrl="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css",xmlHttp=null,(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText),b=document.getElementById("printing-css-compra").value,c=document.getElementById("printing-data-compra").innerHTML;window.frames.print_frame_compra.document.title="IM - Compra",window.frames.print_frame_compra.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_compra.window.focus(),window.frames.print_frame_compra.window.print()}}]),angular.module("compras").controller("CreateCompraController",["$scope","$rootScope","$stateParams","$location","Authentication","Compras","Enterprises","$mdBottomSheet","$state","$mdDialog","$filter","compras","Products","Modal","Contacts","Taxconditions","Categories","Subs","Metrics","Providers","$http","Cajas","Impuestos","tipoCompra",function($scope,$rootScope,$stateParams,$location,Authentication,Compras,Enterprises,$mdBottomSheet,$state,$mdDialog,$filter,compras,Products,Modal,Contacts,Taxconditions,Categories,Subs,Metrics,Providers,$http,Cajas,Impuestos,tipoCompra){CrearController.$inject=["$scope","$mdDialog","Modal","Products","Contacts"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.tipoCompra=tipoCompra,$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findCajas(),$scope.findProveedores(),$scope.findProductos(),$scope.findComprobantes(),$scope.findCondicionesventas()}),$scope.$watchCollection("condicionV",function(){void 0!==$scope.condicionV&&$scope.verCondicionVenta($scope.condicionV)}),$scope.$watchCollection("compraVerificada",function(){}),$rootScope.$watchCollection("nuevoProveedor",function(){void 0!==$rootScope.nuevoProveedor?($scope.mostrar=!0,$scope.proveedor=$rootScope.nuevoProveedor,$scope.selectedItemChange($scope.proveedor),$rootScope.nuevoProveedor=void 0):$scope.mostrar=!1}),$rootScope.$watchCollection("nuevaMateriaPrima",function(){void 0!==$rootScope.nuevaMateriaPrima&&null!==$rootScope.nuevaMateriaPrima&&""!==$rootScope.nuevaMateriaPrima?($scope.mostrarMateria=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevaMateriaPrima._id,params:{}}).then(function(response){$scope.producto=response.data},function(response){console.log("error")}),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarMateria=!1}),$scope.selectedMode="md-scale",$scope.selectedDirection="up",$scope.mostrarCaja=!0,$scope.compras=compras,$scope.idProveedor=0,$scope.tipeando=!1,$scope.isFocus=!1,$scope.productoEditado=[],$scope.deshabilitarProveedor=!1,$scope.productoCompra={cantidad:void 0,descuento:void 0,observaciones:""},$rootScope.productosAgregados=[],$scope.selectedProduct=[],$scope.selectedItem=null,$scope.searchText=null,$scope.initproduct=[],$scope.minLenghtProd=0,$scope.minLenghtProv=0,$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.imp1=0,$scope.imp2=0,$scope.imp3=0,$scope.imp4=0,$scope.total=parseFloat(0),$scope.totalTax=0,$scope.totalImp=0,$scope.verCondicionVenta=function(c){$scope.errorCondicion=void 0,"Cuenta Corriente"==c.name?($scope.mostrarCaja=!1,$scope.caja=void 0):$scope.mostrarCaja=!0},$scope.descProveedor=function(){null!==$scope.proveedor&&void 0!==$scope.proveedor?($scope.idProveedor=$scope.proveedor._id,$scope.errorProv=void 0):$scope.idProveedor=0,void 0!==this.producto&&null!==this.producto&&!1===$scope.tipeando&&(this.producto=void 0,$scope.searchText=void 0)},$scope.initAutocomplete=function(){$scope.findProductos(),$scope.searchTextChangeProduct("")},$scope.searchTextChangeProduct=function(text){$scope.tipeando=!0;angular.lowercase(text);return 0===$scope.idProveedor?$scope.filtrados=$filter("filter")($scope.initproduct,function(item){return!0===item.esMateriaPrima||!0===item.esInsumo}):$scope.filtrados=$filter("filter")($scope.initproduct,function(item){return(!0===item.esMateriaPrima||!0===item.esInsumo)&&item.provider._id===$scope.idProveedor}),$scope.filtrados=$filter("filter")($scope.initproduct,{name:text})},$scope.searchTextChange=function(text){angular.lowercase(text);return $filter("filter")($scope.initprovider,{name:text})},$scope.selectedItemChangeProduct=function(item){if($scope.errorProd=void 0,$scope.producto=item,null!==$scope.producto&&document.getElementById("inputCantidad").focus(),null!==$scope.producto&&void 0!==$scope.producto){var id_array=[];if(console.log($scope.producto),$scope.producto.provider[0].id)for(var index=0;index<$scope.producto.provider.length;index++)id_array.push($scope.producto.provider[index].id);else{var id="";for(var item_provider in $scope.producto.provider[0])isNaN(item_provider)||(id+=$scope.producto.provider[0][item_provider]);id_array.push(id)}for($scope.initprovider=[],index=0;index<$scope.proveedores.length;index++)id_array.indexOf($scope.proveedores[index]._id)>-1&&$scope.initprovider.push($scope.proveedores[index])}else $scope.initprovider=$scope.proveedores},$scope.selectedItemChange=function(item){if(null!==item&&void 0!==item&&($scope.idProveedor=item._id),$scope.proveedor=item,$rootScope.provider=item,$scope.descProveedor(),$scope.tipeando=!1,null!==item){for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==item.condicionPago&&$scope.condicionVentas[i]._id==item.condicionPago&&($scope.condicionV=$scope.condicionVentas[i]);if(null!==item.comprobante&&void 0!==item.comprobante)for(i=0;i<$scope.comprobantesFiltro.length;i++)$scope.comprobantesFiltro[i]._id==item.comprobante&&($scope.tipoComprobante=$scope.comprobantesFiltro[i]);$scope.initproduct=[],console.log($scope.products);for(var index=0;index<$scope.products.length;index++)if(console.log($scope.products[index].provider),$scope.products[index].provider.length>0){if(!$scope.products[index].provider[0].id){var id="";for(var item_provider in $scope.products[index].provider[0])isNaN(item_provider)||(id+=$scope.products[index].provider[0][item_provider]);console.log(id),id==item._id&&$scope.initproduct.push($scope.products[index]);continue}for(var index_provider=0;index_provider<$scope.products[index].provider.length;index_provider++)if($scope.products[index].provider[index_provider].id&&$scope.products[index].provider[index_provider].id==item._id){$scope.initproduct.push($scope.products[index]);break}}}else $scope.initproduct=$scope.products},$scope.sendProduct=function($event,productoCompra,producto){$scope.mensajeP=void 0,13===$event.keyCode&&($event.preventDefault(),null===producto||void 0===producto?$scope.mensajeP="No seleccionaste un producto":($scope.mensajeP=void 0,void 0===productoCompra&&(productoCompra={cantidad:0}),null===productoCompra.cantidad||void 0===productoCompra.cantidad||0===productoCompra.cantidad?$scope.mensajeP="No seleccionaste una cantidad para el producto":($scope.mensajeP=void 0,$scope.producto=producto,$scope.agregarProducto(producto,productoCompra))))},$scope.sendProvider=function($event,provider){13===$event.keyCode&&($event.preventDefault(),null===provider||void 0===provider?$scope.mensajeP="No seleccionaste un proveedor valido":$scope.proveedor=provider)},$scope.agregarProducto=function(producto,productoCompra){$scope.clicked=!1,$scope.errorProd=void 0,$scope.mensajeP=void 0;var p={product:{},cantidad:void 0,descuento:void 0,total:void 0,subtotal:void 0,observaciones:void 0};if(void 0==producto)return 0;if(void 0==producto.total&&(producto.total=0),p.product=producto,producto.provider[0].id)for(var item in producto.provider)producto.provider[item].price&&(p.product.costPerUnit=producto.provider[item].price),producto.provider[item].tax&&(p.product.tax=producto.provider[item].tax);p.cantidad=productoCompra.cantidad,void 0==productoCompra.descuento?p.descuento=0:p.descuento=productoCompra.descuento,void 0==productoCompra.observaciones?p.observaciones="":p.observaciones=productoCompra.observaciones,p.total=0,p.subtotal=0;var subtotal=calcularSubtotal(p);p.total=p.total+subtotal,$scope.productosAgregados.splice(0,0,p),productoCompra=void 0,p=void 0,$scope.productoCompra={cantidad:void 0,descuento:void 0,observaciones:""},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.searchText="",$scope.deshabilitarProveedor=!0,document.getElementById("buscaP").focus()},$scope.reverse=function(array){return[].concat(array).reverse()};var calcularSubtotal=function(p){var total,descuentoPorcentaje=p.descuento,precio=parseFloat(p.product.costPerUnit),cant=parseFloat(p.cantidad),subtotal=parseFloat(precio*cant),descuentoValor=subtotal*descuentoPorcentaje/100;p.subtotal=subtotal,total=subtotal-descuentoValor,$scope.subtotal=$scope.subtotal+total,$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,0!==$scope.provider.impuesto1&&($scope.imp1=$scope.imp1+total*$scope.provider.impuesto1/100),0!==$scope.provider.impuesto2&&($scope.imp2=$scope.imp2+total*$scope.provider.impuesto2/100),0!==$scope.provider.impuesto3&&($scope.imp3=$scope.imp3+total*$scope.provider.impuesto3/100),0!==$scope.provider.impuesto4&&($scope.imp4=$scope.imp4+total*$scope.provider.impuesto4/100),10.5==p.product.tax&&($scope.tax1=$scope.tax1+10.5*total/100),21==p.product.tax&&($scope.tax2=$scope.tax2+21*total/100),27==p.product.tax&&($scope.tax3=$scope.tax3+27*total/100),$scope.total=Math.round(100*($scope.neto+$scope.tax1+$scope.tax2+$scope.tax3+$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4))/100,$scope.totalTax=$scope.tax1+$scope.tax2+$scope.tax3;var totalI=$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4;return $scope.totalImp=Math.round(100*totalI)/100,total};function CrearController($scope,$mdDialog,Modal,Products,Contacts){void 0!==$rootScope.provider&&null!==$rootScope.provider?$scope.provider=$rootScope.provider.name:$scope.provider=void 0,$scope.contacts=Modal.getContactos(),$scope.taxconditions=Modal.getCondiciones(),$scope.comprobantes=Modal.getComprobantes(),$scope.categories2=["Materia Prima","Insumo"],$scope.categories=Modal.getCategorias(),$scope.subcategorias=Modal.getSubcategorias(),$scope.subs=Modal.getSubs(),$scope.proveedores=Modal.getProveedores(),$scope.taxes=Modal.getTaxes(),$scope.metrics=Modal.getMetrics(),$scope.quantityPerUnit=0,$scope.unitsInStock=0,$scope.idealStock=0,$scope.criticalStock=0,$scope.unitPrice=0,$scope.costPerUnit=0,$scope.condicionPagos=Modal.getCondicionesVentas(),$scope.banco={name:void 0,account:void 0,cbu:void 0,identity:void 0},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.postalCode="1900",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.placeChangedContact=function(){$scope.placeContact=this.getPlace()},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function($event){void 0!==$event&&0==$event.keyCode&&$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.crearMateriaPrima=function($event){if(0==$event.keyCode){var esMp=!1,esI=!1;for(var i in $scope.categories)if($scope.categories[i].name===this.category1)var categoria=$scope.categories[i];for(var i in"Insumo"===categoria.name?esI=!0:esMp=!0,$scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;if(void 0===$rootScope.provider){for(var i in $scope.proveedores)if($scope.proveedores[i].name===this.provider)var idProveedorModal=$scope.proveedores[i]._id}else idProveedorModal=$rootScope.provider._id;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.tax)if(void 0!==categoria.name)if(void 0!==this.category2)if(void 0!==this.sub)if(void 0!==this.provider){var product=new Products({name:this.name,description:this.description?this.description:void 0,code:this.code,brandName:this.brandName?this.brandName:void 0,unitPrice:this.unitPrice,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:idProveedorModal,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esInsumo:esI,esMateriaPrima:esMp,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub._id,category1:categoria._id,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevaMateriaPrima=product},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorSub="Se debe especificar la UEN para el producto";else $scope.errorCategory="Se debe especificar la subcategoria para el producto";else $scope.errorCategory2="Indicar la categoria del producto";else $scope.errorTax="Se debe especificar el iva para el producto";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"}},$scope.borrarError=function(){$scope.errorCode=void 0,$scope.errorProv=void 0,$scope.errorName=void 0,$scope.errorNameProv=void 0,$scope.errorTax=void 0,$scope.errorSub=void 0,$scope.errorCategory=void 0,$scope.errorCategory2=void 0,$scope.errorCondicion=void 0,$scope.errorComprobante=void 0},$scope.crearProveedor=function($event){if(0==$event.keyCode){var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==this.address){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng();if(void 0!==this.category1)if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.comprobante){var provider=new Providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,comprobante:this.comprobante?this.comprobante._id:void 0,banco:this.banco,taxCondition:this.taxcondition?this.taxcondition._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter,paymentMethod:this.paymentMethod,contacts:this.contact?this.contact._id:void 0,country:this.country,city:this.city,region:this.region?this.region:void 0,postalCode:this.postalCode,address:this.address,phone:this.phone?this.phone:void 0,loc:[latitud,longitud],web:this.web?this.web:void 0,enterprise:empresa,category1:this.category1?this.category1._id:void 0});provider.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoProveedor=provider},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Indicar el tipo de comprobante";else $scope.errorCondicion="Indicar condicion de pago";else $scope.errorTax="Indicar la condicion de iva";else $scope.errorCategory="Indicar la categoria"}else $scope.errorDir="Indicar la direccion";else $scope.errorNameProv="Indicar la razón social"}}}$scope.cantProductos=function(){if($rootScope.productosAgregados.length>0)return!0},$scope.showAdvancedProduct=function(ev){$scope.minLenghtProd=1,$scope.searchText=void 0,$scope.findProveedores(),$scope.findSubs(),$scope.findMetrics(),$scope.findSubcategories(),$scope.findCategories(),$scope.findTaxes(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/compras/views/create.product.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLenght=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLenght=0,$scope.status="You cancelled the dialog."})},$scope.showAdvancedProvider=function(ev){$scope.minLenghtProv=1,$scope.textToSearch=void 0,$scope.findContacts(),$scope.findCategories(),$scope.findTaxConditions(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/compras/views/create.provider.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLenghtProv=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLenghtProv=0,$scope.status="You cancelled the dialog."})},$scope.editar=function(index){$scope.productoEditado[index]=!0},$scope.editarProducto=function(index,p){var subt=0,tax1=0,tax2=0,tax3=0,descuento=p.product.costPerUnit*p.descuento/100;p.subtotal=p.cantidad*p.product.costPerUnit,p.total=p.cantidad*(p.product.costPerUnit-descuento),$rootScope.productosAgregados[index]=p;for(var i=0;i<$rootScope.productosAgregados.length;i++){subt+=$rootScope.productosAgregados[i].total;var iva=$rootScope.productosAgregados[i].product.tax;10.5==iva&&(tax1+=10.5*$rootScope.productosAgregados[i].total/100),21==iva&&(tax2+=21*$rootScope.productosAgregados[i].total/100),27==iva&&(tax3+=27*$rootScope.productosAgregados[i].total/100)}$scope.descuentoValor=subt*$scope.descuentoPorcentaje/100,$scope.subtotal=subt,$scope.neto=subt-$scope.descuentoValor,0!==$scope.provider.impuesto1&&($scope.imp1=$scope.neto*$scope.provider.impuesto1/100),0!==$scope.provider.impuesto2&&($scope.imp2=$scope.neto*$scope.provider.impuesto2/100),0!==$scope.provider.impuesto3&&($scope.imp3=$scope.neto*$scope.provider.impuesto3/100),0!==$scope.provider.impuesto4&&($scope.imp4=$scope.neto*$scope.provider.impuesto4/100),$scope.tax1=tax1,$scope.tax2=tax2,$scope.tax3=tax3;var totalI=$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4;$scope.totalImp=Math.round(100*totalI)/100,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3+$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4,this.p=void 0,$scope.productoEditado[index]=!1},$scope.borrarProducto=function(producto){var subt,iva,descProd,descGen,totalIva,tax1=0,tax2=0,tax3=0,totalImpuesto=$scope.provider.impuesto1+$scope.provider.impuesto2+$scope.provider.impuesto3+$scope.provider.impuesto4,restoImpuesto=producto.total*totalImpuesto/100;descProd=parseFloat(producto.product.costPerUnit*producto.cantidad*producto.descuento/100),subt=parseFloat(producto.product.costPerUnit*producto.cantidad-descProd),descGen=parseFloat(subt*$scope.descuentoPorcentaje/100),10.5==(iva=producto.product.tax)&&(tax1=parseFloat(10.5*subt/100),$scope.tax1=parseFloat($scope.tax1-tax1)),21==iva&&(tax2=parseFloat(21*subt/100),$scope.tax2=parseFloat($scope.tax2-tax2)),27==iva&&(tax3=parseFloat(27*subt/100),$scope.tax3=parseFloat($scope.tax3-tax3)),$scope.neto=parseFloat($scope.neto-(subt-descGen)),0!==$scope.provider.impuesto1&&($scope.imp1=$scope.neto*$scope.provider.impuesto1/100),0!==$scope.provider.impuesto2&&($scope.imp2=$scope.neto*$scope.provider.impuesto2/100),0!==$scope.provider.impuesto3&&($scope.imp3=$scope.neto*$scope.provider.impuesto3/100),0!==$scope.provider.impuesto4&&($scope.imp4=$scope.neto*$scope.provider.impuesto4/100);var totalI=$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4;$scope.totalImp=Math.round(100*totalI)/100,$scope.subtotal=parseFloat($scope.subtotal-subt),totalIva=subt-descGen+tax1+tax2+tax3,$scope.descuentoValor=parseFloat($scope.descuentoValor-descGen);var restar=totalIva+restoImpuesto;$scope.total=$scope.total-restar,$scope.totalTax=$scope.totalTax-tax1-tax2-tax3,$scope.totalImp=totalI,$scope.remove(producto),0==$rootScope.productosAgregados.length&&($scope.deshabilitarProveedor=!1)},$scope.remove=function(producto){for(var i in $rootScope.productosAgregados)$rootScope.productosAgregados[i]===producto&&$rootScope.productosAgregados.splice(i,1)},$scope.clickSubmit=function(){if("compra"==$scope.tipoCompra)var estado="Finalizada";else if("pedido"==$scope.tipoCompra)estado="Pendiente de pago y recepcion";$scope.clicked=!0,$scope.create(estado)},$scope.create=function(e){if(void 0!=$scope.puesto){if("compra"==$scope.tipoCompra)var caja=$scope.caja,alta=this.created,recepcion=this.fechaRecepcion,pago=this.fechaPago,puesto=$scope.puesto._id;else if("pedido"==$scope.tipoCompra)caja=0,alta=void 0,recepcion=void 0,pago=void 0,puesto=$scope.puesto._id;if(this.condicionV&&"Cuenta Corriente"==this.condicionV.name&&(caja=0),console.log(this.condicionV),!0===$scope.clicked)if(void 0!==caja)if(0!==$scope.productosAgregados.length)if(void 0!==$scope.proveedor)if(void 0!==$scope.comprobante)if(void 0!==$scope.tipoComprobante)if(void 0!==$scope.caja||""!==$scope.caja)if(void 0!==this.condicionV){0==caja&&(caja=void 0),console.log(e);var compra=new Compras({estado:e,fechaAlta:alta,fechaPago:pago,fechaRecepcion:recepcion,caja:caja,comprobante:this.comprobante,tipoComprobante:this.tipoComprobante,products:$rootScope.productosAgregados,proveedor:$scope.proveedor,observaciones:this.observaciones,subtotal:$scope.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:$scope.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,totalImp:$scope.totalImp,total:$scope.total,condicionVenta:this.condicionV._id,category:this.category?this.category._id:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,puesto:puesto});console.log(compra),compra.$save(function(response){response._id&&($http.post("/api/impuestos/updateTotal",{month:(new Date).getMonth(),year:(new Date).getFullYear()}),$state.go("home.compras"),compra._id=response._id,$scope.compras.unshift(compra)),$scope.comprobante="",$scope.tipoComprobante="",$scope.observaciones="",$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.total=0,$scope.condicionVenta="",$scope.clicked=!1,$rootScope.nuevoProveedor="",$rootScope.nuevaMateriaPrima="",$scope.producto=""},function(errorResponse){console.log(errorResponse,"erropr")})}else $scope.errorCondicion="No elegiste una condicion de compra";else $scope.errorCondicion="No seleccionaste Caja para la venta";else $scope.errorTipoC="No elegiste un tipo de comprobante";else $scope.errorComprobante="Se debe especificar un numero de comprobante";else $scope.errorProv="No elegiste un proveedor";else $scope.errorProd="Tenes que elegir productos para la compra";else $scope.mensajeCaja="Seleccionar la caja"}else $scope.errorCondicion="Please assign puesto to user."},$scope.findProductos=function(){void 0!==$scope.SEARCH&&Products.query({e:$scope.SEARCH.enterprise}).$promise.then(function(product){$scope.products=product,$scope.initproduct=$scope.products})},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findProveedores=function(){void 0!==$scope.SEARCH&&Providers.query({e:$scope.SEARCH.enterprise}).$promise.then(function(provider){$scope.proveedores=provider,$scope.initprovider=$scope.proveedores,Modal.setProveedores($scope.proveedores)})},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}),Modal.setContactos($scope.contacts))},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}),Modal.setCondiciones($scope.taxconditions))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setCategorias($scope.categories))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}),Modal.setSubs($scope.subs))},$scope.findCajas=function(){void 0!==$scope.SEARCH&&($scope.cajas=[],Cajas.query({e:$scope.SEARCH.enterprise},function(foundCaja){foundCaja.forEach(function(entry){!1===entry.deleted&&$scope.cajas.push(entry),entry.user._id.toString()==user._id.toString()&&($scope.caja=entry)}),1===$scope.cajas.length&&($scope.caja=$scope.cajas[0])}))},$scope.findSubcategories=function(){void 0!==$scope.SEARCH&&($scope.subcategorias=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setSubcategorias($scope.subcategorias))},$scope.findTaxes=function(){void 0!==$scope.SEARCH&&($scope.taxes=[{value:1,name:"Iva incluido en el costo"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}],Modal.setTaxes($scope.taxes))},$scope.findMetrics=function(){void 0!==$scope.SEARCH&&($scope.metrics=Metrics.query(),Modal.setMetrics($scope.metrics))},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/comprobantes/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){for(var i in $scope.comprobantesFiltro=response.data,$scope.comprobantes)"Pedido"===$scope.comprobantesFiltro[i].name&&$scope.comprobantesFiltro.splice(i,1);Modal.setComprobantes($scope.comprobantesFiltro)})},$scope.findCondicionesventas=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data,Modal.setCondicionesVentas($scope.condicionVentas)})}}]),angular.module("compras").controller("ListComprasController",["$scope","$rootScope","$http","$stateParams","$location","user","Enterprises","$mdDialog","$q","$state","Compras","comprasPendientes","comprasPendientesRecepcion","comprasFinalizadas","comprasPendienteEvaluacion","comprasPendienteAprobacion","comprasAnuladas","Socket","$anchorScroll","BottomSheetService","ComprasExtra","Pedidos","PedidosExtra","$timeout",function($scope,$rootScope,$http,$stateParams,$location,user,Enterprises,$mdDialog,$q,$state,Compras,comprasPendientes,comprasPendientesRecepcion,comprasFinalizadas,comprasPendienteEvaluacion,comprasPendienteAprobacion,comprasAnuladas,Socket,$anchorScroll,BottomSheetService,ComprasExtra,Pedidos,PedidosExtra,$timeout){switch(DialogController.$inject=["$scope","$mdDialog","item","$rootScope","Socket","Cajas"],$scope.tabParams=$state.params.tab,$state.params.tab){case"pendiente_evaluacion":$scope.pendiente_evaluacion=!0;break;case"realizada":$scope.realizada=!0;break;case"recibidos":$scope.recibidos=!0;break;case"finalizada":$scope.finalizada=!0;break;case"anulada":$scope.anulada=!0;default:$scope.pendiente_evaluacion=!0}var cambio=this;function refresh(){cambio.comprasPendientes=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Pendiente de pago y recepcion",p:0,pcount:20}),cambio.comprasPendientesRecepcion=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Pendiente de recepcion",p:0,pcount:20}),cambio.comprasFinalizadas=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Finalizada",p:0,pcount:20}),cambio.comprasAnuladas=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Anulada",p:0,pcount:20}),cambio.comprasPendienteEvaluacion=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:"compra",estado:"pendiente evaluacion",p:0,pcount:20}),cambio.comprasPendienteAprobacion=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:"compra",estado:"pendiente aprobacion",p:0,pcount:20})}function showConfirm(ev,item){var confirm=$mdDialog.confirm().title("Anular Compra").content("¿Está seguro que desea anular esta compra?").ariaLabel("Lucky day").ok("Anular").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(angular.bind(this,function(){item.prevEstado=item.estado,item.estado="Anulada",cambio.update(item)}),function(){console.log("cancelaste anular")})}function borrarCompra(compra){if(console.log(compra),compra.$remove(),"Finalizada"==compra.estado)for(var i in comprasFinalizadas)comprasFinalizadas[i]===compra&&comprasFinalizadas.splice(i,1);else for(var i in comprasAnuladas)comprasAnuladas[i]===compra&&comprasAnuladas.splice(i,1)}function evaluarPendienteEvaluacion(item,n){var pedido=item;1==n&&(pedido.estado="aprobada"),2==n&&(pedido.estado="rechazada"),3==n&&(pedido.estado="pendiente evaluacion"),4==n&&(pedido.deleted="true"),5==n&&(pedido.estado="pendiente aprobacion"),6==n&&(pedido.estado="borrador"),void 0!==cambio.enterprise?pedido.enterprise=cambio.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==cambio.tipoComprobante?pedido.tipoComprobante=cambio.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==cambio.condicionVenta?pedido.condicionVenta=cambio.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),pedido.$update(function(){$state.go("home.viewPedido",{pedidoId:item._id})},function(errorResponse){console.log(errorResponse,"error repsonse")})}function showConfirmPendienteEvaluacion(ev,item,n){if(1==n){var confirm=$mdDialog.confirm().title("Aprobar Orden").content("¿Está seguro que desea aprobar esta orden?").ariaLabel("Lucky day").ok("Aprobar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){cambio.evaluarPendienteEvaluacion(item,n)},function(){$scope.status="Cancelaste aprobar"})}else if(2==n){confirm=$mdDialog.confirm().title("Rechazar Orden").content("¿Está seguro que desea rechazar esta orden?").ariaLabel("Lucky day").ok("Rechazar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){cambio.evaluarPendienteEvaluacion(item,n)},function(){$scope.status="Cancelaste rechazar"})}}function showAdvanced(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/compras/views/modal.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})}function showAdvancedRecibidos(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/compras/views/modalPagar.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$http.post("/api/impuestos/updateTotal",{month:(new Date).getMonth(),year:(new Date).getFullYear()}),$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})}function extraerCompra(item){(function(item){var deferred=$q.defer();return $scope.compra=item,setTimeout(function(){void 0!==$scope.compra?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})(item).then(function(response){printIt()})}function printIt(){var a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-compra").value,c=document.getElementById("printing-data-compra").innerHTML;window.frames.print_frame_compra.document.title="IM - Compra",window.frames.print_frame_compra.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_compra.window.focus(),window.frames.print_frame_compra.window.print()}function httpGet(theUrl){var xmlHttp=null;return(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText}function DialogController($scope,$mdDialog,item,$rootScope,Socket,Cajas){function updateCompra(compra,estado){compra.estado=estado,compra.enterprise=compra.enterprise._id,compra.tipoComprobante=compra.tipoComprobante._id,compra.proveedor=compra.proveedor._id,compra.condicionVenta=compra.condicionVenta._id,void 0!==compra.category&&(compra.category,compra.category._id),$mdDialog.hide(),console.log("Comprice"),console.log(compra),Socket.emit("compra.update",compra)}$scope.itemElegido=!1,$scope.habilitarFecha=!1,$scope.habilitarFechaPago=!1,$scope.item=item,$scope.error=void 0,$scope.errorCaja=void 0,$scope.elegido=function(n){$scope.error=void 0,$scope.itemElegido=!0,$scope.habilitarFecha=!0,$scope.habilitarFechaPago=2===n},$scope.hide=function(){$scope.itemElegido=!1,$mdDialog.hide()},$scope.cancel=function(){$scope.itemElegido=!1,$mdDialog.cancel()},$scope.findCajas=function(){$scope.cajas=Cajas.query({e:item.enterprise._id})},$scope.actualizarCompra=function(data){if(!0===$scope.itemElegido){var compra=$scope.item;if("pagado"===data){var estado="Pendiente de recepcion";void 0!==this.fechaRecepcion?($scope.error=void 0,compra.fechaRecepcion=this.fechaRecepcion,updateCompra(compra,estado)):$scope.error="Debe seleccionar la fecha de recepcion del pedido"}if("recibido2"===data)updateCompra(compra,estado="Pendiente de pago2");if("pYr2"===data)updateCompra(compra,estado="Finalizada");if("pYr"===data){estado="Finalizada";void 0!==this.fechaRecepcion?($scope.error=void 0,compra.fechaRecepcion=this.fechaRecepcion,void 0!==this.fechaPago?($scope.error=void 0,compra.fechaPago=this.fechaPago,"Cuenta Corriente"!==$scope.item.condicionVenta.name?void 0!==this.caja?(compra.caja=this.caja,updateCompra(compra,estado)):$scope.errorCaja="Debe seleccionar la caja":compra.caja=void 0):$scope.error="Debe seleccionar la fecha de pago del pedido"):$scope.error="Debe seleccionar la fecha de recepcion del pedido"}}},$scope.finalizarCompra=function(item){"Cuenta Corriente"!==$scope.item.condicionVenta.name?void 0!==this.caja?(item.created=new Date,item.caja=this.caja._id,updateCompra(item,"Finalizada")):$scope.errorCaja="Debe seleccionar la caja":(item.caja=void 0,updateCompra(item,"Finalizada"))},$scope.habilitarActualizar=function(){$scope.itemElegido=!0,$scope.errorFecha=void 0},$scope.actualizarCompraRecepcion=function(){if(!0===$scope.itemElegido){var compra=$scope.item;compra.estado="Finalizada",void 0!==this.recibida?compra.fechaRecepcion=this.recibida:$scope.errorFecha="Seleccionar la fecha de recibo de compra",compra.enterprise=compra.enterprise._id,compra.tipoComprobante=compra.tipoComprobante._id,compra.proveedor=compra.proveedor._id,compra.condicionVenta=compra.condicionVenta._id,compra.$update(function(){$mdDialog.hide(),location.reload(!0),$location.path("compras")},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorFecha="Seleccionar la fecha de recibo de compra"}}this.user=user,this.comprasPendientes=comprasPendientes,this.comprasPendientesRecepcion=comprasPendientesRecepcion,this.comprasPendienteEvaluacion=comprasPendienteEvaluacion,this.comprasPendienteAprobacion=comprasPendienteAprobacion,this.comprasFinalizadas=comprasFinalizadas,this.comprasAnuladas=comprasAnuladas,this.totalPendientesPR=0,this.totalPendientesPago=0,this.totalPendientesRecepcion=0,this.totalFinalizadas=0,this.totalAnuladas=0,this.totalPendienteEvaluacion=0,this.theDate=new Date,this.currentPage=0,this.update=function(item){var compra=item;void 0!==this.enterprise?compra.enterprise=this.enterprise._id:void 0!==compra.enterprise&&null!==compra.enterprise&&(compra.enterprise=compra.enterprise._id);void 0!==this.tipoComprobante?compra.tipoComprobante=this.tipoComprobante._id:void 0!==compra.tipoComprobante&&null!==compra.tipoComprobante&&(compra.tipoComprobante=compra.tipoComprobante._id);void 0!==$scope.proveedor?compra.proveedor=$scope.proveedor._id:void 0!==compra.proveedor&&null!==compra.proveedor&&(compra.proveedor=compra.proveedor._id);void 0!==this.condicionVenta?compra.condicionVenta=this.condicionVenta._id:void 0!==compra.condicionVenta&&null!==compra.condicionVenta&&(compra.condicionVenta=compra.condicionVenta._id);compra.$update(function(){console.log("Tenekj"),console.log(compra),Socket.emit("compra.update",compra)},function(errorResponse){})},this.evaluarPendienteEvaluacion=evaluarPendienteEvaluacion,this.montoTotal=function(comprasPendientes,comprasPendientesRecepcion,comprasFinalizadas,comprasAnuladas,comprasPendienteEvaluacion,comprasPendienteAprobacion){comprasPendientes.$promise.then(angular.bind(this,function(data){for(var i in this.totalPendientesPR=0,data)!1===data[i].deleted&&(this.totalPendientesPR=this.totalPendientesPR+data[i].total)})),comprasPendientesRecepcion.$promise.then(angular.bind(this,function(data){for(var i in this.totalPendientesRecepcion=0,data)!1===data[i].deleted&&(this.totalPendientesRecepcion=this.totalPendientesRecepcion+data[i].total)})),comprasFinalizadas.$promise.then(angular.bind(this,function(data){for(var i in this.totalFinalizadas=0,data)!1===data[i].deleted&&(this.totalFinalizadas=this.totalFinalizadas+data[i].total)})),comprasAnuladas.$promise.then(angular.bind(this,function(data){for(var i in this.totalAnuladas=0,data)!1===data[i].deleted&&(this.totalAnuladas=this.totalAnuladas+data[i].total)})),comprasPendienteEvaluacion.$promise.then(angular.bind(this,function(data){for(var i in this.totalPendienteEvaluacion=0,data)!1===data[i].deleted&&(this.totalPendienteEvaluacion=this.totalPendienteEvaluacion+data[i].total)})),comprasPendienteAprobacion.$promise.then(angular.bind(this,function(data){for(var i in data)!1===data[i].deleted&&(this.totalPendienteEvaluacion=this.totalPendienteEvaluacion+data[i].total)}))},this.showConfirm=showConfirm,this.showConfirmRecepcion=function(ev,item){var confirm=$mdDialog.confirm().title("Finalizar la compra").content("¿Finalizar la compra?").ariaLabel("Lucky day").ok("Aceptar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(angular.bind(this,function(){item.estado="Finalizada",cambio.update(item)}),function(){console.log("cancelaste cerrar")})},this.showAdvanced=showAdvanced,this.showAdvancedRecibidos=showAdvancedRecibidos,this.extraerCompra=extraerCompra,this.printIt=printIt,this.extraerListado=function(n){1===n&&(a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-listado").value,c=document.getElementById("printing-data-listado").innerHTML,window.frames.print_frame_listado.document.title="IM - Pedidos Realizados ",window.frames.print_frame_listado.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_listado.window.focus(),window.frames.print_frame_listado.window.print());var a,b,c;2===n&&function(){var a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-recibir").value,c=document.getElementById("printing-data-recibir").innerHTML;window.frames.print_frame_recibir.document.title="IM - Pedidos a Recibir ",window.frames.print_frame_recibir.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_recibir.window.focus(),window.frames.print_frame_recibir.window.print()}();3===n&&function(){var a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-pagar").value,c=document.getElementById("printing-data-pagar").innerHTML;window.frames.print_frame_pagar.document.title="IM - Pedidos a Pagar ",window.frames.print_frame_pagar.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_pagar.window.focus(),window.frames.print_frame_pagar.window.print()}();4===n&&function(){var a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-fin").value,c=document.getElementById("printing-data-fin").innerHTML;window.frames.print_frame_fin.document.title="IM - Pedidos Finalizados ",window.frames.print_frame_fin.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_fin.window.focus(),window.frames.print_frame_fin.window.print()}()},this.refresh=refresh,this.borrarCompra=borrarCompra,this.montoTotal(comprasPendientes,comprasPendientesRecepcion,comprasFinalizadas,comprasAnuladas,comprasPendienteEvaluacion,comprasPendienteAprobacion),this.showBottomSheetAnulada=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Eliminar",icon:"remove_circle"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"view":$state.go("home.viewCompra",{compraId:item._id});break;case"remove":borrarCompra(item);break;case"print":extraerCompra(item);break;default:console.log("something went wrong")}})},this.showBottomSheetFinalizada=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Eliminar",icon:"remove_circle"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"view":$state.go("home.viewCompra",{compraId:item._id});break;case"remove":borrarCompra(item);break;case"print":extraerCompra(item);break;default:console.log("something went wrong")}})},this.showBottomSheetRealizada=function($event,item){BottomSheetService.sheet($event,[{name:"edit",label:"Estado",icon:"call_made"},{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Anular",icon:"remove_circle"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"edit":showAdvanced($event,item);break;case"view":$state.go("home.viewCompra",{compraId:item._id});break;case"remove":showConfirm($event,item);break;case"print":extraerCompra(item);break;default:console.log("something went wrong")}})},this.showBottomSheetRecebidos=function($event,item){BottomSheetService.sheet($event,[{name:"finalize",label:"Finalizar",icon:"done"},{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Anular",icon:"close"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"finalize":showAdvancedRecibidos($event,item);break;case"view":$state.go("home.viewCompra",{compraId:item._id});break;case"remove":showConfirm($event,item);break;case"print":extraerCompra(item);break;default:console.log("something went wrong")}})},this.showBottomSheetPendienteEvaluacion=function($event,item){var buttons=[];"pendiente evaluacion"!=item.estado&&"compras"!=this.user.roles[0]&&(item.llamado?buttons.push({name:"state",icon:"phone",class:"anulado"}):buttons.push({name:"state",icon:"phone",class:"libre"}),buttons.push({name:"approve",label:"Aprobado",icon:"done"}));"pendiente evaluacion"==item.estado&&"compras"!=this.user.roles[0]?buttons.push({name:"view1",label:"Ver",icon:"visibility"}):buttons.push({name:"view2",label:"Ver",icon:"visibility"});"pendiente evaluacion"!=item.estado&&buttons.push({name:"clear",label:"Rechazar",icon:"delete"});"compras"!=cambio.user.roles[0]&&"venta"==cambio.tipoOrden&&buttons.push({name:"print",label:"Imprimir",icon:"print"});BottomSheetService.sheet($event,buttons,function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"state":item.llamado?$scope.sampleAction("ocupado",item):$scope.sampleAction("libre",item);break;case"approve":showConfirmPendienteEvaluacion($event,item,1);break;case"view1":evaluarPendienteEvaluacion(item,5);break;case"view2":$state.go("home.viewPedido",{pedidoId:item._id});break;case"clear":showConfirmPendienteEvaluacion($event,item,2);break;case"print":!function(item,n){asyncAsignarPedido(item).then(function(response){1==n?printIt():printItAprobado()})}(item,1);break;default:console.log("something went wrong")}})},this.finalTemp=[],this.finalCount=0,this.cancelTemp=[],this.cancelCount=0,this.receiptTemp=[],this.receiptCount=0,this.realTemp=[],this.realCount=0,cambio.realStart=null,cambio.receiptStart=null,cambio.finalStart=null,cambio.cancelStart=null,cambio.realStart1=null,cambio.realLimit1=null,cambio.realCount1=0,cambio.realTemp1=[],cambio.realStart2=null,cambio.realLimit2=null,cambio.realCount2=0,cambio.realTemp2=[],this.validate=function(item){return"user"!=user.roles[0]||user.centroDeCosto==item.user.centroDeCosto},cambio.loadmorePendienteEvaluacion=function(){""!=cambio.searchCompras&&void 0!=cambio.searchCompras||(cambio.loadingReal1=!0,cambio.realLimit1=cambio.comprasPendienteEvaluacion.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,"compra","pendiente evaluacion",cambio.realStart1,cambio.realLimit1).then(angular.bind(cambio,function(data){$timeout(function(){cambio.comprasPendienteEvaluacion&&(1===cambio.realCount1&&0!==cambio.realTemp1.length?cambio.comprasPendienteEvaluacion=cambio.realTemp1.slice():cambio.comprasPendienteEvaluacion=cambio.comprasPendienteEvaluacion.concat(cambio.realTemp1)),(0===data.data.length||0===cambio.realTemp1.length&&cambio.realCount1>2)&&(cambio.doneReal1=!0),cambio.realTemp1=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:"compra",estado:"pendiente evaluacion",p:cambio.realCount1,pcount:cambio.realLimit1}),cambio.realCount1++,cambio.loadingReal1=!1,cambio.realStart1=cambio.comprasPendienteEvaluacion.length?cambio.comprasPendienteEvaluacion[cambio.comprasPendienteEvaluacion.length-1].created:null},1e3)})))},cambio.loadmorePendienteAprobacion=function(){""!=cambio.searchCompras&&void 0!=cambio.searchCompras||(cambio.loadingReal2=!0,cambio.realLimit2=cambio.comprasPendienteAprobacion.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,"compra","pendiente aprobacion",cambio.realStart2,cambio.realLimit2).then(angular.bind(cambio,function(data){$timeout(function(){cambio.comprasPendienteAprobacion&&(1===cambio.realCount2&&0!==cambio.realTemp2.length?cambio.comprasPendienteAprobacion=cambio.realTemp2.slice():cambio.comprasPendienteAprobacion=cambio.comprasPendienteAprobacion.concat(cambio.realTemp1)),(0===data.data.length||0===cambio.realTemp2.length&&cambio.realCount2>2)&&(cambio.doneReal2=!0),cambio.realTemp2=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:"compra",estado:"pendiente aprobacion",p:cambio.realCount2,pcount:cambio.realLimit2}),cambio.realCount2++,cambio.loadingReal2=!1,cambio.realStart2=cambio.comprasPendienteAprobacion.length?cambio.comprasPendienteAprobacion[cambio.comprasPendienteAprobacion.length-1].created:null},1e3)})))},cambio.loadmoreReal=function(){""!=cambio.searchCompras&&void 0!=cambio.searchCompras||(cambio.loadingReal=!0,cambio.realLimit=cambio.comprasPendientes.length<40?40:20,ComprasExtra.loadMore(cambio.user.enterprise.enterprise,"Pendiente de pago y recepcion",cambio.comprasPendientes.length?cambio.comprasPendientes[cambio.comprasPendientes.length-1].created:null,cambio.realLimit).then(angular.bind(cambio,function(data){$timeout(function(){cambio.comprasPendientes&&(1===cambio.realCount&&0!=cambio.realTemp.length?cambio.comprasPendientes=cambio.realTemp.slice():cambio.comprasPendientes=cambio.comprasPendientes.concat(cambio.realTemp)),(0===data.data.length||0===cambio.realTemp.length&&cambio.realCount>2)&&(cambio.doneReal=!0),cambio.realTemp=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Pendiente de pago y recepcion",p:cambio.realCount,pcount:cambio.realLimit}),cambio.realCount++,cambio.realStart=cambio.loadingReal=!1},1e3)})))},cambio.loadmoreReceipt=function(){""!=cambio.searchCompras&&void 0!=cambio.searchCompras||(cambio.loadingReceipt=!0,cambio.receiptLimit=cambio.comprasPendientesRecepcion.length<40?40:20,ComprasExtra.loadMore(cambio.user.enterprise.enterprise,"Pendiente de recepcion",cambio.receiptStart,cambio.receiptLimit).then(angular.bind(cambio,function(data){$timeout(function(){cambio.comprasPendientesRecepcion&&(1===cambio.receiptCount&&0!=cambio.receiptTemp.length?cambio.comprasPendientesRecepcion=cambio.receiptTemp.slice():cambio.comprasPendientesRecepcion=cambio.comprasPendientesRecepcion.concat(cambio.receiptTemp)),(0===data.data.length||0===cambio.receiptTemp.length&&cambio.receiptCount>2)&&(cambio.doneReceipt=!0),cambio.receiptTemp=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Pendiente de recepcion",p:cambio.receiptCount,pcount:cambio.receiptLimit}),cambio.receiptCount++,cambio.receiptStart=cambio.comprasPendientesRecepcion.length?cambio.comprasPendientesRecepcion[cambio.comprasPendientesRecepcion.length-1].created:null,cambio.loadingReceipt=!1},1e3)})))},cambio.loadmoreFinal=function(){""!=cambio.searchCompras&&void 0!=cambio.searchCompras||(cambio.loadingFinal=!0,cambio.finalLimit=cambio.comprasFinalizadas.length<40?40:20,ComprasExtra.loadMore(cambio.user.enterprise.enterprise,"Finalizada",cambio.finalStart,cambio.finalLimit).then(angular.bind(cambio,function(data){$timeout(function(){cambio.comprasFinalizadas&&(1===cambio.finalCount&&0!=cambio.finalTemp.length?cambio.comprasFinalizadas=cambio.finalTemp.slice():cambio.comprasFinalizadas=cambio.comprasFinalizadas.concat(cambio.finalTemp)),(0===data.data.length||0===cambio.finalTemp.length&&cambio.finalCount>2)&&(cambio.doneFinal=!0),cambio.finalTemp=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Finalizada",p:cambio.finalCount,pcount:cambio.finalLimit}),cambio.finalCount++,cambio.finalStart=cambio.comprasFinalizadas.length?cambio.comprasFinalizadas[cambio.comprasFinalizadas.length-1].created:null,cambio.loadingFinal=!1},1e3)})))},cambio.loadmoreCancel=function(){""!=cambio.searchCompras&&void 0!=cambio.searchCompras||(cambio.loadingCancel=!0,cambio.cancelLimit=cambio.comprasAnuladas.length<40?40:20,ComprasExtra.loadMore(cambio.user.enterprise.enterprise,"Anulada",cambio.cancelStart,cambio.cancelLimit).then(angular.bind(cambio,function(data){$timeout(function(){cambio.comprasAnuladas&&(1===cambio.cancelCount&&0!=cambio.cancelTemp.length?cambio.comprasAnuladas=cambio.cancelTemp.slice():cambio.comprasAnuladas=cambio.comprasAnuladas.concat(cambio.cancelTemp)),(0===data.data.length||0===cambio.cancelTemp.length&&cambio.cancelCount>2)&&(cambio.doneCancel=!0),cambio.cancelTemp=Compras.query({e:cambio.user.enterprise.enterprise,estado:"Anulada",p:cambio.cancelCount,pcount:cambio.cancelLimit}),cambio.cancelCount++,cambio.cancelStart=cambio.comprasAnuladas.length?cambio.comprasAnuladas[cambio.comprasAnuladas.length-1].created:null,cambio.loadingCancel=!1},1e3)})))},cambio.searchComprasProcess=function(){if(""!=cambio.searchCompras)switch(cambio.selectedTab){case"real1":!function(){cambio.loadingReal1=!0;var searchString=cambio.searchCompras;PedidosExtra.search(cambio.user.enterprise.enterprise,"compra","pendiente evaluacion",searchString).then(angular.bind(cambio,function(data){setTimeout(function(){$scope.$apply(function(){cambio.comprasPendienteEvaluacion=data.data,cambio.loadingReal1=!1})},1e3)}))}(),function(){cambio.loadingReal2=!0;var searchString=cambio.searchCompras;PedidosExtra.search(cambio.user.enterprise.enterprise,"compra","pendiente aprobacion",searchString).then(angular.bind(cambio,function(data){setTimeout(function(){$scope.$apply(function(){cambio.comprasPendienteAprobacion=data.data,cambio.loadingReal2=!1})},1e3)}))}();break;case"real":!function(){cambio.loadingReal=!0;var searchString=cambio.searchCompras;ComprasExtra.search(cambio.user.enterprise.enterprise,"Pendiente de pago y recepcion",searchString).then(angular.bind(cambio,function(data){setTimeout(function(){$scope.$apply(function(){cambio.comprasPendientes=data.data,console.log(data.data),cambio.loadingReal=!1,console.log(cambio.loadingReal)})},1e3)}))}();break;case"reciept":!function(){cambio.loadingReceipt=!0;var searchString=cambio.searchCompras;ComprasExtra.search(cambio.user.enterprise.enterprise,"Pendiente de recepcion",searchString).then(angular.bind(cambio,function(data){setTimeout(function(){$scope.$apply(function(){console.log(data),cambio.comprasPendientesRecepcion=data.data,cambio.loadingReceipt=!1})},1e3)}))}();break;case"final":!function(){cambio.loadingFinal=!0;var searchString=cambio.searchCompras;ComprasExtra.search(cambio.user.enterprise.enterprise,"Finalizada",searchString).then(angular.bind(cambio,function(data){setTimeout(function(){$scope.$apply(function(){console.log(data),cambio.comprasFinalizadas=data.data,cambio.loadingFinal=!1})},1e3)}))}();break;case"cancel":!function(){cambio.loadingCancel=!0;var searchString=cambio.searchCompras;ComprasExtra.search(cambio.user.enterprise.enterprise,"Anulada",searchString).then(angular.bind(cambio,function(data){setTimeout(function(){$scope.$apply(function(){console.log(data),cambio.comprasAnuladas=data.data,cambio.loadingCancel=!1})},1e3)}))}()}else refresh()},cambio.searchComprasProcessDefault=function(){""==cambio.searchCompras&&refresh()},$scope.state_change=function(item){return console.log(item),item.llamado?$scope.sampleAction("ocupado",item):item.llamado||$scope.sampleAction("libre",item),!1},$scope.sampleAction=function(name,puesto){switch(name){case"libre":puesto.llamado=!0;break;case"ocupado":puesto.llamado=!1}cambio.update(puesto)},Socket.on("compras.update",angular.bind(this,function(message){message.enterprise===this.user.enterprise.enterprise&&this.refresh()})),Socket.on("pedido.update",angular.bind(this,function(message){message.enterprise===this.user.enterprise.enterprise&&this.refresh()})),$scope.scrollTo=function(id){console.log("scrolll"),$location.hash(id),$anchorScroll()}}]),angular.module("compras").controller("ViewCompraController",["$scope","$rootScope","$stateParams","$location","Authentication","Compras","Enterprises","Products","$mdBottomSheet","$state","$mdDialog","compras","compra","$q","HistorialCompras","$http","productos",function($scope,$rootScope,$stateParams,$location,Authentication,Compras,Enterprises,Products,$mdBottomSheet,$state,$mdDialog,compras,compra,$q,HistorialCompras,$http,productos){function modificarPrecioProducto(compra){for(var i in compra.products)for(var j in $scope.productos)if(compra.products[i].product._id==$scope.productos[j]._id&&compra.products[i].product.costPerUnit!=$scope.productos[j].costPerUnit){$scope.productos[j].costPerUnit=compra.products[i].product.costPerUnit;var product=$scope.productos[j];product.enterprise=product.enterprise._id,product.category2=product.category2._id,console.log(compra.proveedor),product.provider.map(function(value){value.id==compra.proveedor&&(value.price=product.costPerUnit)}),product.$update(function(response){actualizarReferencias()},function(errorResponse){console.log(errorResponse,"error"),$scope.error=errorResponse.data.message})}}function actualizarReferencias(){for(var i in $scope.productos)if(1==$scope.productos[i].esProducto&&0==$scope.productos[i].reseller&&0==$scope.productos[i].deleted&&$scope.productos[i].produccion.length>0){var product=$scope.productos[i];product.enterprise=product.enterprise._id,product.category2=product.category2._id,product.provider=product.provider._id,product.$update(function(data){console.log("update referencia ok")},function(errorResponse){console.log(errorResponse,"error"),this.error=errorResponse.data.message})}}function DialogController($scope,$mdDialog,item,Ventas,Cajas,Socket,$state){function updateCompra(compra,estado){compra.estado=estado,compra.enterprise=compra.enterprise._id,compra.tipoComprobante=compra.tipoComprobante._id,compra.proveedor=compra.proveedor._id,compra.condicionVenta=compra.condicionVenta._id,void 0!==compra.category&&(compra.category=compra.category._id),$mdDialog.hide(),console.log("Comprice2"),console.log(compra),Socket.emit("compra.update",compra),$state.go("home.compras")}$scope.itemElegido=!1,$scope.habilitarFecha=!1,$scope.item=item,$scope.findCajas=function(){$scope.cajas=Cajas.query({e:item.enterprise._id})},$scope.elegido=function(n){$scope.error=void 0,$scope.itemElegido=!0,$scope.habilitarFecha=!0,$scope.habilitarFechaPago=2===n},$scope.hide=function(){$scope.itemElegido=!1,$mdDialog.hide()},$scope.cancel=function(){$scope.itemElegido=!1,$mdDialog.cancel()},$scope.finalizarCompra=function(item){"Cuenta Corriente"!==$scope.item.condicionVenta.name?void 0!==this.caja?(item.caja=this.caja._id,updateCompra(item,"Finalizada")):$scope.errorCaja="Debe seleccionar la caja":(item.caja=void 0,updateCompra(item,"Finalizada"))},$scope.actualizarCompra=function(data){if(!0===$scope.itemElegido){var compra=$scope.item,estado="";"pagado"===data&&(estado="Pendiente de recepcion",void 0!==this.fechaRecepcion?($scope.error=void 0,compra.fechaRecepcion=this.fechaRecepcion,updateCompra(compra,estado)):$scope.error="Debe seleccionar la fecha de recepcion del pedido"),"pYr2"===data&&updateCompra(compra,estado="Finalizada"),"pYr"===data&&(estado="Finalizada",void 0!==this.fechaRecepcion?($scope.error=void 0,compra.fechaRecepcion=this.fechaRecepcion,void 0!==this.fechaPago?($scope.error=void 0,compra.fechaPago=this.fechaPago,"Cuenta Corriente"!==$scope.item.condicionVenta.name?void 0!==this.caja?(compra.caja=this.caja,updateCompra(compra,estado)):$scope.errorCaja="Debe seleccionar la caja":compra.caja=void 0):$scope.error="Debe seleccionar la fecha de pago del pedido"):$scope.error="Debe seleccionar la fecha de recepcion del pedido")}},$scope.habilitarActualizar=function(){$scope.itemElegido=!0,$scope.errorFecha=void 0},$scope.actualizarCompraRecepcion=function(){if(!0===$scope.itemElegido){var compra=$scope.item;compra.estado="Finalizada",void 0!==this.recibida?compra.fechaRecepcion=this.recibida:$scope.errorFecha="Seleccionar la fecha de recibo de compra",compra.enterprise=compra.enterprise._id,compra.tipoComprobante=compra.tipoComprobante._id,compra.proveedor=compra.proveedor._id,compra.condicionVenta=compra.condicionVenta._id,compra.$update(function(){$mdDialog.hide(),location.reload(!0),$location.path("compras")},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorFecha="Seleccionar la fecha de recibo de compra"}}DialogController.$inject=["$scope","$mdDialog","item","Ventas","Cajas","Socket","$state"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findOne()}),$rootScope.compras=compras,$scope.compra=compra,void 0==compra.historal&&($scope.historialCompra=compra),$scope.productos=productos,$scope.comprobanteEditado=!1,$scope.modoEdicion=!1,$scope.modoEdicion2=!1,$scope.selectedMode="md-scale",$scope.selectedDirection="left",$scope.activarEdicion=function(compra){if($scope.modoEdicion=!0,$scope.compraVerificada=angular.copy(compra),void 0!=$scope.compraVerificada.fechaRecepcion){var fechaRecepcionDate=new Date($scope.compraVerificada.fechaRecepcion);$scope.compraVerificada.fechaRecepcion=fechaRecepcionDate}$location.hash("verificacion")},$scope.activarNuevaEdicion=function(compra){$scope.compraVerificada=angular.copy(compra),$scope.modoEdicion2=!0},$scope.cerrarEdicion=function(compra){$scope.modoEdicion=!1,$scope.compraVerificada=void 0},$scope.cerrarNuevaEdicion=function(){$scope.modoEdicion2=!1,$scope.compraVerificada=void 0},$scope.updateCompra=function(){$scope.modoEdicion2=!1;var compra=$scope.compraVerificada;void 0!==compra.enterprise&&(compra.enterprise=compra.enterprise._id),void 0!==compra.tipoComprobante&&(compra.tipoComprobante=compra.tipoComprobante._id),void 0!==compra.proveedor&&(compra.proveedor=compra.proveedor._id),void 0!==compra.condicionVenta&&(compra.condicionVenta=compra.condicionVenta._id),modificarPrecioProducto(compra),compra.$update(function(){$scope.findOne(),$scope.compraVerificada=void 0},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.eliminarProducto=function(p){for(var i in $scope.compraVerificada.products)$scope.compraVerificada.products[i].product._id==p.product._id&&$scope.compraVerificada.products.splice(i,1);console.log($scope.compraVerificada,"compra"),$scope.calcularTotalesVerificacion()},$scope.sumarProductoCompra=function(producto,productoPedido){if(void 0!==producto)if(void 0!==productoPedido){void 0!==productoPedido.cantidad&&void 0==productoPedido.descuento&&(productoPedido.descuento=0);var p={product:{},cantidad:void 0,descuento:0,total:void 0,subtotal:void 0,observaciones:void 0},valorDescuento=producto.costPerUnit*productoPedido.descuento/100;p.product=producto,p.cantidad=productoPedido.cantidad,p.descuento=productoPedido.descuento,p.observaciones=productoPedido.observaciones,p.subtotal=producto.costPerUnit*productoPedido.cantidad,p.total=producto.costPerUnit*productoPedido.cantidad-valorDescuento,$scope.compraVerificada.products.push(p),$scope.calcularTotalesVerificacion(),$scope.producto=void 0,$scope.productoPedido.cantidad=void 0,$scope.productoPedido.descuento=void 0,$scope.productoPedido.observaciones=void 0}else $scope.errorCant="Se debe indicar una cantidad";else $scope.errorProd="Se debe seleccionar un producto"},$scope.showConfirm=function(ev,item,n){switch(n){case 1:var confirm=$mdDialog.confirm().title("Anular Compra").content("¿Está seguro que desea anular esta compra?").ariaLabel("Lucky day").ok("Anular").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){item.estado="Anulada",$scope.update(item),$scope.montoTotal()},function(){console.log("cancelaste anular")});break;case 2:confirm=$mdDialog.confirm().title("Finalizar Compra").content("¿Confirmar cierre de la compra?").ariaLabel("Lucky day").ok("Aceptar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item),$scope.montoTotal()},function(){console.log("cancelaste pagar")});break;case 3:confirm=$mdDialog.confirm().title("Guardar Cambios").content("¿Está seguro que ha terminado?").ariaLabel("Lucky day").ok("Guardar").cancel("Volver").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.historialDeCompra()},function(){console.log("cancelaste verificar")})}},$scope.showAdvanced=function(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/compras/views/modal.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.showAdvancedRecibidos=function(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/compras/views/modalPagar.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$http.post("/api/impuestos/updateTotal",{month:(new Date).getMonth(),year:(new Date).getFullYear()}),$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.update=function(item){var compra=item;void 0!==this.enterprise?compra.enterprise=this.enterprise._id:void 0!==compra.enterprise&&null!==compra.enterprise&&(compra.enterprise=compra.enterprise._id),void 0!==this.tipoComprobante?compra.tipoComprobante=this.tipoComprobante._id:void 0!==compra.tipoComprobante&&null!==compra.tipoComprobante&&(compra.tipoComprobante=compra.tipoComprobante._id),void 0!==this.proveedor?compra.proveedor=$scope.proveedor._id:void 0!==compra.proveedor&&null!==compra.proveedor&&(compra.proveedor=compra.proveedor._id),void 0!==this.condicionVenta?compra.condicionVenta=this.condicionVenta._id:void 0!==compra.condicionVenta&&null!==compra.condicionVenta&&(compra.condicionVenta=compra.condicionVenta._id),compra.$update(function(){$location.path("compras")},function(errorResponse){$scope.error=errorResponse.data.message,console.log($scope.error)})},$scope.montoTotal=function(){$scope.totalPendientesPR=0,$scope.totalPendientesPago=0,$scope.totalPendientesRecepcion=0,$scope.totalFinalizadas=0,$scope.totalAnuladas=0;for(var i=0;i<$scope.compras.length;i++)"Pendiente de pago y recepcion"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalPendientesPR=$scope.totalPendientesPR+$scope.compras[i].total),"Pendiente de pago2"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalPendientesPago=$scope.totalPendientesPago+$scope.compras[i].total),"Pendiente de recepcion"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalPendientesRecepcion=$scope.totalPendientesRecepcion+$scope.compras[i].total),"Finalizada"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalFinalizadas=$scope.totalFinalizadas+$scope.compras[i].total),"Anulada"===$scope.compras[i].estado&&!1===$scope.compras[i].deleted&&($scope.totalAnuladas=$scope.totalAnuladas+$scope.compras[i].total)},$scope.historialDeCompra=function(){new HistorialCompras({compra:$scope.historialCompra}).$save(function(response){$scope.modoEdicion=!1;var compra=$scope.compraVerificada;void 0==compra.historial&&(compra.historial=response),compra.estado="Pendiente de recepcion",void 0!==compra.enterprise&&(compra.enterprise=compra.enterprise._id),void 0!==compra.tipoComprobante&&(compra.tipoComprobante=compra.tipoComprobante._id),void 0!==compra.proveedor&&(compra.proveedor=compra.proveedor._id),void 0!==compra.condicionVenta&&(compra.condicionVenta=compra.condicionVenta._id),void 0!==compra.caja&&(compra.caja=compra.caja._id),void 0!==compra.category&&(compra.category=compra.category._id),modificarPrecioProducto(compra),compra.$update(function(){$scope.findOne()},function(errorResponse){$scope.error=errorResponse.data.message}),compra.historial=response,$scope.compraVerificada=null},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.findOne=function(){Compras.get({compraId:$stateParams.compraId},function(res){$scope.compra=res,void 0!==$scope.compra.historial&&$http({method:"GET",url:"/api/users/byId",params:{userId:$scope.compra.historial.modificadoPor}}).then(function(response){$scope.usuarioDeHistorial=response.data},function(err){console.log("Error"+err)})}),$scope.historialCompra=Compras.get({compraId:$stateParams.compraId})},$scope.modificoProducto=function(p){!function(p){for(var i=0;i<$scope.compraVerificada.products.length;i++)if($scope.compraVerificada.products[i]._id==p._id){console.log($scope.compraVerificada.products[i],"compra verificada");var total=0,desc=$scope.compraVerificada.products[i].descuento*$scope.compraVerificada.products[i].product.costPerUnit/100,descTotal=desc*$scope.compraVerificada.products[i].cantidad;total=$scope.compraVerificada.products[i].product.costPerUnit*$scope.compraVerificada.products[i].cantidad,$scope.compraVerificada.products[i].total=total-descTotal,$scope.compraVerificada.products[i].subtotal=total}}(p),$scope.calcularTotalesVerificacion()},$scope.calcularTotalesVerificacion=function(){var i,imp1=$scope.compraVerificada.proveedor.impuesto1,imp2=$scope.compraVerificada.proveedor.impuesto2,imp3=$scope.compraVerificada.proveedor.impuesto3,imp4=$scope.compraVerificada.proveedor.impuesto4,sub=0,totTax1=0,totTax2=0,totTax3=0,tax1=[],tax2=[],tax3=[];for(void 0!==$scope.compraVerificada.descuentoPorcentaje&&parseFloat($scope.compraVerificada.descuentoPorcentaje),i=0;i<$scope.compraVerificada.products.length;i++){void 0===$scope.compraVerificada.products[i].descuento&&($scope.compraVerificada.products[i].descuento=0),void 0!==$scope.compraVerificada.products[i].cantidad&&null!==$scope.compraVerificada.products[i].cantidad||($scope.compraVerificada.products[i].cantidad=0),void 0===$scope.compraVerificada.products[i].product.costPerUnit&&($scope.compraVerificada.products[i].product.costPerUnit=0);var desc=parseFloat($scope.compraVerificada.products[i].descuento)*$scope.compraVerificada.products[i].product.costPerUnit/100,finalPrice=parseFloat($scope.compraVerificada.products[i].product.costPerUnit)-desc,additionalIva=parseFloat($scope.compraVerificada.products[i].product.tax)*parseFloat(finalPrice)/100;10.5===parseFloat($scope.compraVerificada.products[i].product.tax)&&tax1.push(additionalIva*parseFloat($scope.compraVerificada.products[i].cantidad)),21===parseFloat($scope.compraVerificada.products[i].product.tax)&&tax2.push(additionalIva*parseFloat($scope.compraVerificada.products[i].cantidad)),27===parseFloat($scope.compraVerificada.products[i].product.tax)&&tax3.push(additionalIva*parseFloat($scope.compraVerificada.products[i].cantidad)),sub+=parseFloat($scope.compraVerificada.products[i].cantidad)*finalPrice}if(tax1.length>0)for(i=0;i<tax1.length;i++)totTax1+=parseFloat(tax1[i]);if(tax2.length>0)for(i=0;i<tax2.length;i++)totTax2+=parseFloat(tax2[i]);if(tax3.length>0)for(i=0;i<tax3.length;i++)totTax3+=parseFloat(tax3[i]);$scope.compraVerificada.subtotal=sub;var d=$scope.compraVerificada.descuentoPorcentaje*$scope.compraVerificada.subtotal/100;$scope.compraVerificada.descuentoValor=d,$scope.compraVerificada.neto=$scope.compraVerificada.subtotal-d;var total1=$scope.compraVerificada.neto*imp1/100,total2=$scope.compraVerificada.neto*imp2/100,total3=$scope.compraVerificada.neto*imp3/100,total4=$scope.compraVerificada.neto*imp4/100;$scope.compraVerificada.totalImp=Math.round(100*(total1+total2+total3+total4))/100,$scope.compraVerificada.tax1=totTax1,$scope.compraVerificada.tax2=totTax2,$scope.compraVerificada.tax3=totTax3,$scope.compraVerificada.totalTax=totTax1+totTax2+totTax3,$scope.compraVerificada.total=Math.round(100*($scope.compraVerificada.neto+totTax1+totTax2+totTax3+$scope.compraVerificada.totalImp))/100},$scope.findProductos=function(){void 0!==$scope.SEARCH&&($scope.products=Products.query({e:$scope.SEARCH.enterprise}))},$scope.extraerCompra=function(item){(function(item){var deferred=$q.defer();return $scope.compra=item,setTimeout(function(){void 0!==$scope.compra?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})(item).then(function(response){$scope.printIt()})},$scope.printIt=function(){var theUrl,xmlHttp,a=(theUrl="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css",xmlHttp=null,(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText),b=document.getElementById("printing-css-compra").value,c=document.getElementById("printing-data-compra").innerHTML;window.frames.print_frame_compra.document.title="IM - Compra",window.frames.print_frame_compra.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_compra.window.focus(),window.frames.print_frame_compra.window.print()}}]),angular.module("compras").factory("Compras",["$resource",function($resource){return $resource("api/compras/:compraId",{compraId:"@_id",e:"@enterprise",i:"@product",w:"@filterDate.week",y:"@filterDate.year",estado:"@estado",p:"@p",pcount:"@pcount"},{update:{method:"PUT"}})}]),angular.module("compras").factory("ComprasExtra",["$http",function($http){return{select:function(estado,enterprise){return $http({method:"get",url:"/api/compras/select",params:{e:enterprise,estado:estado}})},loadMore:function(enterprise,estado,last,limit){return $http({method:"get",url:"/api/compras/loadmore",params:{e:enterprise,last:last,limit:limit,estado:estado}})},loadMoreByCaja:function(enterprise,estado,last,pagina,limit,caja){return $http({method:"get",url:"/api/compras/loadmorebycaja",params:{e:enterprise,last:last,limit:limit,pagina:pagina,estado:estado,caja:caja}})},loadMoreByCajaDate:function(enterprise,estado,startdate,enddate,caja){return $http({method:"get",url:"/api/compras/loadmorebycaja_date",params:{e:enterprise,start:startdate,end:enddate,estado:estado,caja:caja}})},search:function(enterprise,estado,search){return $http({method:"get",url:"/api/compras/search",params:{e:enterprise,estado:estado,search:search}})},loadMoreImpuestos:function(impuesto,last,limit,year,month){return $http({method:"get",url:"/api/compras/loadmoreImpuestos",params:{impuesto:impuesto,last:last,limit:limit,year:year,month:month}})}}}]),angular.module("comprobantes").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Comprobantes",state:"comprobantes",type:"dropdown"}),Menus.addSubMenuItem("topbar","comprobantes",{title:"List Comprobantes",state:"comprobantes.list"}),Menus.addSubMenuItem("topbar","comprobantes",{title:"Create Comprobante",state:"comprobantes.create"})}]),angular.module("comprobantes").config(["$stateProvider",function($stateProvider){$stateProvider.state("__comprobantes",{abstract:!0,url:"/__comprobantes",template:"<ui-view/>"}).state("__comprobantes.list",{url:"",templateUrl:"modules/comprobantes/views/list-comprobantes.client.view.html"}).state("__comprobantes.create",{url:"/create",templateUrl:"modules/comprobantes/views/create-comprobante.client.view.html"}).state("__comprobantes.view",{url:"/:comprobanteId",templateUrl:"modules/comprobantes/views/view-comprobante.client.view.html"}).state("__comprobantes.edit",{url:"/:comprobanteId/edit",templateUrl:"modules/comprobantes/views/edit-comprobante.client.view.html"})}]),angular.module("comprobantes").controller("ComprobantesCreateController",["user","comprobante","enterprises","modosFacturacion","$state","comprobantes",function(user,comprobante,enterprises,modosFacturacion,$state,comprobantes){this.user=user,this.comprobante=comprobante,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.create=function(){new comprobantes({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.comprobantes")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("comprobantes").controller("ComprobantesEditController",["user","comprobante","enterprises","modosFacturacion","$location",function(user,comprobante,enterprises,modosFacturacion,$location){this.user=user,this.comprobante=comprobante,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.update=function(){var comprobante=this.comprobante;void 0!==this.enterprise?comprobante.enterprise=this.enterprise._id:comprobante.enterprise=comprobante.enterprise._id;void 0!==this.modoFacturacion?comprobante.modoFacturacion=this.modoFacturacion:comprobante.modoFacturacion=comprobante.modoFacturacion}}]),angular.module("comprobantes").controller("ComprobantesListController",["$location","user","comprobantes","enterprises","$mdDialog","modosFacturacion",function($location,user,comprobantes,enterprises,$mdDialog,modosFacturacion){function remove(comprobante){comprobante?comprobante.$remove():this.comprobante.$remove(function(){$location.path("comprobantes")})}this.user=user,this.comprobantes=comprobantes,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){remove(item)},function(){console.log("cancelaste borrar")})},this.remove=remove}]),angular.module("comprobantes").controller("ComprobantesViewController",["user","comprobante",function(user,comprobante){this.user=user,this.comprobante=comprobante}]),angular.module("comprobantes").controller("ComprobantesController",["$scope","$rootScope","$stateParams","$location","Authentication","Comprobantes","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Comprobantes,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var comprobante=new Comprobantes({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});comprobante.$save(function(response){response._id&&(comprobante._id=response._id,$rootScope.comprobantes.unshift(comprobante)),$scope.name="",$scope.letra="",$scope.puntoDeVenta="",$scope.modoFacturacion="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(comprobante){if(comprobante)for(var i in comprobante.$remove(),$scope.comprobantes)$scope.comprobantes[i]===comprobante&&$scope.comprobantes.splice(i,1);else $scope.comprobante.$remove(function(){$location.path("comprobantes")})},$scope.update=function(){var comprobante=$scope.comprobante;void 0!==this.enterprise?comprobante.enterprise=this.enterprise._id:comprobante.enterprise=comprobante.enterprise._id,comprobante.$update(function(){$location.path("comprobantes/view/"+comprobante._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.comprobantes=Comprobantes.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findModosF=function(){void 0!==$scope.SEARCH&&($scope.modosF=["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"])},$scope.findOne=function(){console.log($stateParams.comprobanteId,"comprobante id"),$scope.comprobante=Comprobantes.get({comprobanteId:$stateParams.comprobanteId}),console.log($scope.comprobante,"comprobante")}}]),angular.module("comprobantes").factory("Comprobantes",["$resource",function($resource){return $resource("api/comprobantes/:comprobanteId",{comprobanteId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("condicionventas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Condicionventas",state:"condicionventas",type:"dropdown"}),Menus.addSubMenuItem("topbar","condicionventas",{title:"List Condicionventas",state:"condicionventas.list"}),Menus.addSubMenuItem("topbar","condicionventas",{title:"Create Condicionventa",state:"condicionventas.create"})}]),angular.module("condicionventas").config(["$stateProvider",function($stateProvider){$stateProvider.state("condicionventas",{abstract:!0,url:"/condicionventas",template:"<ui-view/>"}).state("condicionventas.list",{url:"",templateUrl:"modules/condicionventas/views/list-condicionventas.client.view.html"}).state("condicionventas.create",{url:"/create",templateUrl:"modules/condicionventas/views/create-condicionventa.client.view.html"}).state("condicionventas.view",{url:"/:condicionventaId",templateUrl:"modules/condicionventas/views/view-condicionventa.client.view.html"}).state("condicionventas.edit",{url:"/:condicionventaId/edit",templateUrl:"modules/condicionventas/views/edit-condicionventa.client.view.html"})}]),angular.module("condicionventas").controller("CondicionventasCreateController",["user","condicionventa","enterprises","$state","condicionventas",function(user,condicionventa,enterprises,$state,condicionventas){this.user=user,this.condicionventa=condicionventa,this.enterprises=enterprises,this.create=function(){new condicionventas({name:this.name,description:this.description,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.condicionVentas")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("condicionventas").controller("CondicionventasEditController",["user","condicionventa","enterprises","$state",function(user,condicionventa,enterprises,$state){this.user=user,this.condicionventa=condicionventa,this.enterprises=enterprises,this.update=function(){var condicionventa=this.condicionventa;void 0!==this.enterprise?condicionventa.enterprise=this.enterprise._id:condicionventa.enterprise=condicionventa.enterprise._id;condicionventa.$update(function(){$state.go("home.condicionVentas")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("condicionventas").controller("CondicionventasListController",["$location","$state","$mdDialog","user","enterprises","condicionventas",function($location,$state,$mdDialog,user,enterprises,condicionventas){function remove(condicionventa){condicionventa?condicionventa.$remove():this.condicionventa.$remove(function(){})}this.user=user,this.enterprises=enterprises,this.condicionventas=condicionventas,this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar condicion de venta").content("¿Está seguro que desea eliminar esta condicion de venta?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){remove(item)},function(){console.log("cancelaste borrar")})},this.remove=remove}]),angular.module("condicionventas").controller("CondicionventasViewController",["user","condicionventa",function(user,condicionventa){this.user=user,this.condicionventa=condicionventa}]),angular.module("condicionventas").controller("CondicionventasController",["$scope","$rootScope","$stateParams","$location","Authentication","Condicionventas","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Condicionventas,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var condicionventa=new Condicionventas({name:this.name,description:this.description,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});console.log(condicionventa.enterprise,"empresa"),condicionventa.$save(function(response){response._id&&(condicionventa._id=response._id,$rootScope.condicionventas.unshift(condicionventa)),$scope.name="",$scope.description="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Condicion de pago").content("¿Está seguro que desea eliminar esta condicion de pago?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(condicionventa){if(condicionventa)for(var i in condicionventa.$remove(),$scope.condicionventas)$scope.condicionventas[i]===condicionventa&&$scope.condicionventas.splice(i,1),console.log($scope.condicionventas,"array luego de delete");else $scope.condicionventa.$remove(function(){$location.path("condicionventas")})},$scope.update=function(){var condicionventa=$scope.condicionventa;void 0!==this.enterprise?condicionventa.enterprise=this.enterprise._id:condicionventa.enterprise=condicionventa.enterprise._id,condicionventa.$update(function(){$location.path("condiciones-pago/view/"+condicionventa._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.condicionventas=Condicionventas.query({e:$scope.SEARCH.enterprise}))},$scope.findOne=function(){$scope.condicionventa=Condicionventas.get({condicionventaId:$stateParams.condicionventaId})},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()}}]),angular.module("condicionventas").factory("Condicionventas",["$resource",function($resource){return console.log("condicionventas service "),$resource("api/condicionventas/:condicionventaId",{condicionventaId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("condicionventas").factory("CondicionventasExtra",["$http",function($http){return{loadMore:function(enterprise,name){return $http({method:"get",url:"api/condicionventas/loadmore",params:{e:enterprise,name:name}})}}}]),angular.module("contacts").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Contacts",state:"contacts",type:"dropdown"}),Menus.addSubMenuItem("topbar","contacts",{title:"List Contacts",state:"contacts.list"}),Menus.addSubMenuItem("topbar","contacts",{title:"Create Contact",state:"contacts.create"})}]),angular.module("contacts").config(["$stateProvider",function($stateProvider){$stateProvider.state("contacts",{abstract:!0,url:"/contacts",template:"<ui-view/>"}).state("contacts.list",{url:"",templateUrl:"modules/contacts/views/list-contacts.client.view.html"}).state("contacts.create",{url:"/create",templateUrl:"modules/contacts/views/create-contact.client.view.html"}).state("contacts.view",{url:"/:contactId",templateUrl:"modules/contacts/views/view-contact.client.view.html"}).state("contacts.edit",{url:"/:contactId/edit",templateUrl:"modules/contacts/views/edit-contact.client.view.html"})}]),angular.module("contacts").controller("ContactsController",["$scope","$rootScope","$stateParams","$location","Authentication","Contacts","Enterprises","Subs","$mdBottomSheet","$mdDialog","$state",function($scope,$rootScope,$stateParams,$location,Authentication,Contacts,Enterprises,Subs,$mdBottomSheet,$mdDialog,$state){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Contacto").content("¿Está seguro que desea eliminar este contacto?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(contact){if(contact)for(var i in contact.$remove(),$scope.contacts)$scope.contacts[i]===contact&&$scope.contacts.splice(i,1);else $scope.contact.$remove(function(){$location.path("contacts")})}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.selectedMode="md-scale",$scope.selectedDirection="up",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.place=this.getPlace(),$scope.error=void 0},$scope.create=function(){if(void 0!==$scope.place){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),contact=new Contacts({firstName:this.firstName,lastName:this.lastName,email:this.email,observaciones:this.observaciones,address:this.address,city:this.city,region:this.region?this.region:void 0,country:this.country,phone:this.phone,loc:[latitud,longitud],web:this.web,status:"active",enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});contact.$save(function(response){response._id&&(contact._id=response._id,$rootScope.contacts.unshift(contact)),$state.go("home.contacts"),$scope.firstName="",$scope.lastName="",$scope.email="",$scope.address="",$scope.city="",$scope.region="",$scope.country="",$scope.phone="",$scope.fax="",$scope.web="",$scope.postalCode="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error='Tenes que igresar una ubicacion para el contacto.Ej:"La Plata" '},$scope.update=function(){var contact=$scope.contact;void 0!==this.enterprise?contact.enterprise=this.enterprise._id:void 0!==contact.enterprise&&null!==contact.enterprise&&(contact.enterprise=contact.enterprise._id),void 0!==this.sub?contact.sub=this.sub._id:void 0!==contact.sub&&null!==contact.sub&&(contact.sub=contact.sub._id),void 0!==this.city?contact.city=this.city:void 0!==contact.city&&null!==contact.city&&(contact.city=contact.city),void 0!==$scope.place?contact.loc=[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()]:void 0!==contact.loc&&null!==contact.loc&&(contact.loc=contact.loc),contact.$update(function(){$location.path("contactos")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findCitys=function(){void 0!==$scope.SEARCH&&($scope.citys=["Berisso","Ensenala","La Plata"])},$scope.findOne=function(){$scope.contact=Contacts.get({contactId:$stateParams.contactId})},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){console.log("por aqui ando")})}}]),angular.module("contacts").factory("Contacts",["$resource",function($resource){return $resource("api/contacts/:contactId",{contactId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider,$scope){$urlRouterProvider.when("/","/authentication/signin"),$urlRouterProvider.otherwise("/authentication/signin"),$stateProvider.state("home",{url:"/",abstract:!0,newButton:!1,templateUrl:"modules/core/views/home.client.view.html",prevState:"home.welcome"}).state("home.welcome",{url:"welcome",titulo:"Bienvenido",newButton:!1,templateUrl:"modules/core/views/welcome.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},controller:function(){}}).state("home.meetup",{url:"meetup",titulo:"#MEETUP",templateUrl:"modules/chat/views/chat.client.view.html",prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},controller:function(){}}).state("home.editProfile",{url:"editar-perfil",titulo:"Mi Perfil",newButton:!1,prevState:"home.welcome",templateUrl:"modules/users/views/settings/edit-profile.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.changeProfilePicture",{url:"cambiar-imagen-perfil",titulo:"Mi Perfil",newButton:!1,prevState:"home.welcome",templateUrl:"modules/users/views/settings/change-profile-picture.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.changePassword",{url:"cambiar-contraseña",titulo:"Mi Perfil",newButton:!1,prevState:"home.welcome",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("home.manageSocialAccounts",{url:"cuentas-sociales",titulo:"Mi Perfil",newButton:!1,prevState:"home.welcome",templateUrl:"modules/users/views/settings/manage-social-accounts.client.view.html"}).state("home.enterprises",{url:"empresas",titulo:"Empresas",newButton:!0,prevState:"home.welcome",templateUrl:"modules/enterprises/views/list-enterprises.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.viewEnterprise",{url:"empresas/view/:enterpriseId",titulo:"Empresas",newButton:!0,prevState:"home.enterprises",templateUrl:"modules/enterprises/views/view-enterprise.client.view.html"}).state("home.editEnterprise",{url:"empresas/:enterpriseId/edit",titulo:"Empresas",newButton:!0,prevState:"home.enterprises",templateUrl:"modules/enterprises/views/edit-enterprise.client.view.html"}).state("home.products",{url:"productos?tipo",titulo:"Productos",newButton:!0,prevState:"home.welcome",controller:"ProductsListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],products:["Authentication","Products",function(Authentication,Products){return Products.query({e:Authentication.user.enterprise.enterprise})}],clienteCategories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Cliente"})}],tipoProducto:["$stateParams",function($stateParams){return $stateParams.tipo}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/products/views/list-products.client.view.html"}).state("home.viewProduct",{url:"productos/view/:productId?back?tipo",titulo:"",newButton:!1,prevState:"home.products",controller:"ProductsViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],product:["$stateParams","Products",function($stateParams,Products){return Products.get({productId:$stateParams.productId})}],providers:["Authentication","Providers",function(Authentication,Providers){return Providers.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/products/views/view-product.client.view.html"}).state("home.editProduct",{url:"productos/:productId/edit?tipo",titulo:"",newButton:!1,prevState:"home.products",controller:"ProductosEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],product:["$stateParams","Products",function($stateParams,Products){return Products.get({productId:$stateParams.productId})}],productos:["Authentication","Products",function(Authentication,Products){return Products.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],clienteCategories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Cliente"})}],costCenters:["Authentication","Costcenters",function(Authentication,Costcenters){return Costcenters.query({e:Authentication.user.enterprise.enterprise})}],providers:["Authentication","Providers",function(Authentication,Providers){return Providers.query({e:Authentication.user.enterprise.enterprise})}],tipoProducto:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/products/views/edit-product.client.view.html"}).state("home.editValores",{url:"productos/editValores",titulo:"Editar Precios Productos",newButton:!1,prevState:"home.products",templateUrl:"modules/products/views/edit-valores.client.view.html"}).state("home.createProduct",{url:"productos/create?tipo",prevState:"home.products",titulo:"Nuevo",newButton:!1,controller:"ProductosCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],products:["Products",function(Products){return Products}],product:function(){return{}},productos:["Authentication","Products",function(Authentication,Products){return Products.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],clienteCategories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Cliente"})}],providers:["Authentication","Providers",function(Authentication,Providers){return Providers.query({e:Authentication.user.enterprise.enterprise})}],costCenters:["Authentication","Costcenters",function(Authentication,Costcenters){return Costcenters.query({e:Authentication.user.enterprise.enterprise})}],tipoProducto:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/products/views/create-product.client.view.html"}).state("home.categories",{url:"categorias",titulo:"Categorias",newButton:!0,prevState:"home.welcome",controller:"CategoriesListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],categoryTypes:function(){return["cliente","contacto","Insumo","Materia Prima","Producto","producto venta","proveedor","tipo producto","uen","venta","Remuneracione"]},serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/categories/views/list-categories.client.view.html"}).state("home.createCategory",{url:"categories/view/create",titulo:"Crear Categoria",prevState:"home.categories",newButton:!1,resolve:{user:["Authentication",function(Authentication){return Authentication.user}]},templateUrl:"modules/categories/views/create-category.client.view.html"}).state("home.viewCategory",{url:"categorias/view/:categoryId",titulo:"Categoria",newButton:!0,prevState:"home.categories",templateUrl:"modules/categories/views/view-category.client.view.html"}).state("home.editCategory",{url:"categorias/:categoryId/edit",titulo:"Categoria",newButton:!0,prevState:"home.categories",templateUrl:"modules/categories/views/edit-category.client.view.html"}).state("home.subs",{url:"UENs",titulo:"UENs",newButton:!0,prevState:"home.welcome",templateUrl:"modules/subs/views/list-subs.client.view.html"}).state("home.viewSub",{url:"UENs/view/:subId",titulo:"UEN",newButton:!0,prevState:"home.subs",templateUrl:"modules/subs/views/view-sub.client.view.html"}).state("home.editSub",{url:"UENs/:subId/edit",titulo:"UEN",newButton:!0,prevState:"home.subs",templateUrl:"modules/subs/views/edit-sub.client.view.html"}).state("home.clients",{url:"clientes",titulo:"Clientes",newButton:!0,prevState:"home.welcome",controller:"ClientsListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],clientes:["Authentication","Clients",function(Authentication,Clients){if(Authentication.user.enterprise.enterprise)return Clients.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/_clients/views/list-clients.client.view.html"}).state("home.viewClient",{url:"clientes/view/:clientId",titulo:"Cliente",newButton:!0,prevState:"home.clients",controller:"ClientsViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],client:["$stateParams","Clients",function($stateParams,Clients){return Clients.get({clientId:$stateParams.clientId})}],products:["Authentication","Products",function(Authentication,Products){return Products.query({e:Authentication.user.enterprise.enterprise})}],pedidos:["Authentication","Pedidos",function(Authentication,Pedidos){return Pedidos.query({e:Authentication.user.enterprise.enterprise})}],ventas:["Authentication","Ventas",function(Authentication,Ventas){return Ventas.query({e:Authentication.user.enterprise.enterprise,w:0,y:0})}]},templateUrl:"modules/_clients/views/view-client.client.view.html"}).state("home.editClient",{url:"clientes/:clientId/edit",titulo:"Cliente",newButton:!1,prevState:"home.clients",controller:"ClientsEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],clientes:["Clients",function(Clients){return Clients}],client:["$stateParams","Clients",function($stateParams,Clients){return Clients.get({clientId:$stateParams.clientId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],uens:["Authentication","Subs",function(Authentication,Subs){return Subs.query({e:Authentication.user.enterprise.enterprise})}],condicionventas:["Authentication","Condicionventas",function(Authentication,Condicionventas){return Condicionventas.query({e:Authentication.user.enterprise.enterprise})}],categorias:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],contactos:["Authentication","Contacts",function(Authentication,Contacts){return Contacts.query({e:Authentication.user.enterprise.enterprise})}],condicionesdeiva:["Authentication","Taxconditions",function(Authentication,Taxconditions){return Taxconditions.query({e:Authentication.user.enterprise.enterprise})}],comprobantes:["Authentication","Comprobantes",function(Authentication,Comprobantes){return Comprobantes.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/_clients/views/edit-client.client.view.html"}).state("home.createClient",{url:"_clients/view/create",titulo:"Nuevo Cliente",newButton:!1,prevState:"home.clients",controller:"ClientsCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],clientes:["Clients",function(Clients){return Clients}],users:["Users",function(Users){return Users}],client:function(){return{}},enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],uens:["Authentication","Subs",function(Authentication,Subs){return Subs.query({e:Authentication.user.enterprise.enterprise})}],condicionventas:["Authentication","Condicionventas",function(Authentication,Condicionventas){return Condicionventas.query({e:Authentication.user.enterprise.enterprise})}],categorias:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],contactos:["Authentication","Contacts",function(Authentication,Contacts){return Contacts.query({e:Authentication.user.enterprise.enterprise})}],condicionesdeiva:["Authentication","Taxconditions",function(Authentication,Taxconditions){return Taxconditions.query({e:Authentication.user.enterprise.enterprise})}],comprobantes:["Authentication","Comprobantes",function(Authentication,Comprobantes){return Comprobantes.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/_clients/views/create-client.client.view.html"}).state("home.providers",{url:"proveedores",titulo:"Proveedores",newButton:!0,prevState:"home.welcome",controller:"ProvidersListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],providers:["Authentication","Providers",function(Authentication,Providers){return Providers.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/providers/views/list-providers.client.view.html"}).state("home.viewProvider",{url:"proveedores/view/:providerId",titulo:"Proveedor",newButton:!0,prevState:"home.providers",controller:"ProvidersViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],provider:["$stateParams","Providers",function($stateParams,Providers){return Providers.get({providerId:$stateParams.providerId})}],products:["Authentication","Products",function(Authentication,Products){return Products.query({e:Authentication.user.enterprise.enterprise})}],pedidos:["Authentication","Pedidos",function(Authentication,Pedidos){return Pedidos.query({e:Authentication.user.enterprise.enterprise})}],compras:["Authentication","Compras",function(Authentication,Compras){return Compras.query({e:Authentication.user.enterprise.enterprise,w:0,y:0})}]},templateUrl:"modules/providers/views/view-provider.client.view.html"}).state("home.editProvider",{url:"proveedores/:providerId/edit",titulo:"Proveedor",newButton:!0,prevState:"home.providers",controller:"ProvidersEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],provider:["$stateParams","Providers",function($stateParams,Providers){return Providers.get({providerId:$stateParams.providerId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],contacts:["Authentication","Contacts",function(Authentication,Contacts){return Contacts.query({e:Authentication.user.enterprise.enterprise})}],taxconditions:["Authentication","Taxconditions",function(Authentication,Taxconditions){return Taxconditions.query({e:Authentication.user.enterprise.enterprise})}],condicionPagos:["Authentication","Condicionventas",function(Authentication,Condicionventas){return Condicionventas.query({e:Authentication.user.enterprise.enterprise})}],comprobantes:["Authentication","Comprobantes",function(Authentication,Comprobantes){return Comprobantes.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/providers/views/edit-provider.client.view.html"}).state("home.createProvider",{url:"providers/view/create",titulo:"Nuevo Proveedor",newButton:!1,prevState:"home.providers",controller:"ProvidersCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],provider:function(){return{}},providers:["Providers",function(Providers){return Providers}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}],contacts:["Authentication","Contacts",function(Authentication,Contacts){return Contacts.query({e:Authentication.user.enterprise.enterprise})}],taxconditions:["Authentication","Taxconditions",function(Authentication,Taxconditions){return Taxconditions.query({e:Authentication.user.enterprise.enterprise})}],condicionPagos:["Authentication","Condicionventas",function(Authentication,Condicionventas){return Condicionventas.query({e:Authentication.user.enterprise.enterprise})}],comprobantes:["Authentication","Comprobantes",function(Authentication,Comprobantes){return Comprobantes.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/providers/views/create-provider.client.view.html"}).state("home.contacts",{url:"contactos",titulo:"Contactos",newButton:!0,prevState:"home.welcome",templateUrl:"modules/contacts/views/list-contacts.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.createContact",{url:"contactos/view/create",titulo:"Contactos",newButton:!0,prevState:"home.contacts",templateUrl:"modules/contacts/views/create-contact.client.view.html"}).state("home.viewContact",{url:"contactos/view/:contactId",titulo:"Contactos",newButton:!1,prevState:"home.contacts",templateUrl:"modules/contacts/views/view-contact.client.view.html"}).state("home.editContact",{url:"contactos/:contactId/edit",titulo:"Contactos",newButton:!1,prevState:"home.contacts",templateUrl:"modules/contacts/views/edit-contact.client.view.html"}).state("home.taxConditions",{url:"condiciones-impuesto",titulo:"Condiciones de impuesto",newButton:!0,prevState:"home.welcome",templateUrl:"modules/taxconditions/views/list-taxconditions.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.viewTaxCondition",{url:"condiciones-impuesto/view/:taxconditionId",titulo:"Condicion de impuesto",newButton:!0,prevState:"home.taxConditions",templateUrl:"modules/taxconditions/views/view-taxcondition.client.view.html"}).state("home.editTaxCondition",{url:"condiciones-impuesto/:taxconditionId/edit",titulo:"Condicion de impuesto",newButton:!0,prevState:"home.taxConditions",templateUrl:"modules/taxconditions/views/edit-taxcondition.client.view.html"}).state("home.condicionVentas",{url:"condiciones-pago",titulo:"Condicion de pago",newButton:!0,prevState:"home.welcome",controller:"CondicionventasListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],condicionventas:["Authentication","Condicionventas",function(Authentication,Condicionventas){return Condicionventas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/condicionventas/views/list-condicionventas.client.view.html"}).state("home.createCondicionventa",{url:"condiciones-pago/create",titulo:"Crear Condicion de pago",prevState:"home.condicionVentas",newButton:!1,controller:"CondicionventasCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],condicionventa:function(){return{}},condicionventas:["Condicionventas",function(Condicionventas){return Condicionventas}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/condicionventas/views/create-condicionventa.client.view.html"}).state("home.viewCondicionVenta",{url:"condiciones-pago/view/:condicionventaId",newButton:!0,titulo:"Condicion de pago",prevState:"home.condicionVentas",controller:"CondicionventasViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],condicionventa:["$stateParams","Condicionventas",function($stateParams,Condicionventas){return Condicionventas.get({condicionventaId:$stateParams.condicionventaId})}]},templateUrl:"modules/condicionventas/views/view-condicionventa.client.view.html"}).state("home.editCondicionVenta",{url:"condiciones-pago/:condicionventaId/edit",titulo:"Condicion de pago",newButton:!0,prevState:"home.condicionVentas",controller:"CondicionventasEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],condicionventa:["$stateParams","Condicionventas",function($stateParams,Condicionventas){return Condicionventas.get({condicionventaId:$stateParams.condicionventaId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/condicionventas/views/edit-condicionventa.client.view.html"}).state("home.comprobantes",{url:"comprobantes",titulo:"Comprobantes",newButton:!0,prevState:"home.welcome",controller:"ComprobantesListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],comprobantes:["Authentication","Comprobantes",function(Authentication,Comprobantes){return Comprobantes.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],modosFacturacion:function(){return["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"]},serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/comprobantes/views/list-comprobantes.client.view.html"}).state("home.createComprobante",{url:"comprobantes/create",titulo:"Crear Comprobante",prevState:"home.comprobantes",newButton:!1,controller:"ComprobantesCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],comprobante:function(){return{}},comprobantes:["Comprobantes",function(Comprobantes){return Comprobantes}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],modosFacturacion:function(){return["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"]}},templateUrl:"modules/comprobantes/views/create-comprobante.client.view.html"}).state("home.viewComprobante",{url:"comprobantes/view/:comprobanteId",titulo:"Comprobante",newButton:!0,prevState:"home.comprobantes",controller:"ComprobantesViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],comprobante:["$stateParams","Comprobantes",function($stateParams,Comprobantes){return Comprobantes.get({comprobanteId:$stateParams.comprobanteId})}]},templateUrl:"modules/comprobantes/views/view-comprobante.client.view.html"}).state("home.editComprobante",{url:"comprobantes/:comprobanteId/edit",titulo:"Comprobante",newButton:!0,prevState:"home.comprobantes",controller:"ComprobantesEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],comprobante:["$stateParams","Comprobantes",function($stateParams,Comprobantes){return Comprobantes.get({comprobanteId:$stateParams.comprobanteId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],modosFacturacion:function(){return["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"]}},templateUrl:"modules/comprobantes/views/edit-comprobante.client.view.html"}).state("home.costcenters",{url:"centros-costo",titulo:"Centros de Costo",newButton:!0,prevState:"home.welcome",templateUrl:"modules/costcenters/views/list-costcenters.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.viewCostcenter",{url:"centros-costo/view/:costcenterId",titulo:"Centro de costo",newButton:!0,prevState:"home.costcenters",templateUrl:"modules/costcenters/views/view-costcenter.client.view.html"}).state("home.editCostcenter",{url:"centros-costo/:costcenterId/edit",titulo:"Centro de costo",newButton:!0,prevState:"home.costcenters",templateUrl:"modules/costcenters/views/edit-costcenter.client.view.html"}).state("home.tareas",{url:"tareas",titulo:"Tareas",newButton:!0,prevState:"home.welcome",templateUrl:"modules/tareas/views/list-tareas.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.viewTarea",{url:"tareas/view/:tareaId",titulo:"Tareas",newButton:!0,prevState:"home.tareas",templateUrl:"modules/tareas/views/view-tarea.client.view.html"}).state("home.editTarea",{url:"tarea/:tareaId/edit",titulo:"Tarea",newButton:!0,prevState:"home.tareas",templateUrl:"modules/tareas/views/edit-tarea.client.view.html"}).state("home.empleados",{url:"empleados",titulo:"Personal",newButton:!0,controller:"EmpleadosCentrodecostoListController",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/empleados/views/list-empleados-centrodecosto.client.view.html"}).state("home.listEmpleado",{url:"empleados/:costcenterId",newButton:!0,controller:"EmpleadosListController",titulo:"Personal",resolve:{user:["Authentication",function(Authentication){return Authentication.user}]},templateUrl:"modules/empleados/views/list-empleados.client.view.html"}).state("home.viewEmpleado",{url:"empleados/view/:empleadoId",titulo:"Detalle del Personal",newButton:!0,controller:"EmpleadosController",controllerAs:"vm",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],empleado:["$stateParams","Empleados",function($stateParams,Empleados){return Empleados.get({empleadoId:$stateParams.empleadoId})}],puestos:["Authentication","Puestos",function(Authentication,Puestos){return Puestos.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/empleados/views/view-empleado.client.view.html"}).state("home.editEmpleado",{url:"empleado/:empleadoId/edit",titulo:"Editar Personal",newButton:!1,controller:"EmpleadosController",controllerAs:"vm",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],empleado:["$stateParams","Empleados",function($stateParams,Empleados){return Empleados.get({empleadoId:$stateParams.empleadoId})}],puestos:["Authentication","Puestos",function(Authentication,Puestos){return Puestos.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/empleados/views/form-empleado.client.view.html"}).state("home.createEmpleado",{url:"personas/view/create",titulo:"Nuevo Personal",newButton:!1,prevState:"home.personal",templateUrl:"modules/personas/views/create-persona.client.view.html"}).state("home.ventas",{url:"ventas?tab",titulo:"Ventas",newButton:!0,prevState:"home.welcome",controller:"ListVentasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/ventas/views/list-ventas.client.view.html"}).state("home.createVenta",{url:"ventas/view/create",titulo:"Nueva Venta",newButton:!1,prevState:"home.ventas",templateUrl:"modules/ventas/views/create-venta.client.view.html",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]}}).state("home.viewVenta",{url:"ventas/view/:ventaId",titulo:"Venta",newButton:!0,prevState:"home.ventas",templateUrl:"modules/ventas/views/view-venta.client.view.html"}).state("home.editVenta",{url:"ventas/:ventaId/edit",titulo:"Venta",newButton:!0,prevState:"home.ventas",templateUrl:"modules/ventas/views/edit-venta.client.view.html"}).state("home.ventasMostrador",{url:"ventas/mostrador",titulo:"Venta por mostrador",newButton:!1,prevState:"home.welcome",controller:"VentasMostradorController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/ventas/views/ventas-mostrador.client.view.html"}).state("home.compras",{url:"compras",titulo:"Compras",newButton:!1,prevState:"home.welcome",controller:"ListComprasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],comprasPendientes:["Authentication","Compras","$stateParams",function(Authentication,Compras,$stateParams){return Compras.query({e:Authentication.user.enterprise.enterprise,estado:"Pendiente de pago y recepcion",p:0,pcount:20})}],comprasPendientesRecepcion:["Authentication","Compras","$stateParams",function(Authentication,Compras,$stateParams){return Compras.query({e:Authentication.user.enterprise.enterprise,estado:"Pendiente de recepcion",p:0,pcount:20})}],comprasFinalizadas:["Authentication","Compras","$stateParams",function(Authentication,Compras,$stateParams){return Compras.query({e:Authentication.user.enterprise.enterprise,estado:"Finalizada",p:0,pcount:20})}],comprasAnuladas:["Authentication","Compras","$stateParams",function(Authentication,Compras,$stateParams){return Compras.query({e:Authentication.user.enterprise.enterprise,estado:"Anulada",p:0,pcount:20})}],comprasPendienteEvaluacion:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:"compra",estado:"pendiente evaluacion",p:0,pcount:20})}],comprasPendienteAprobacion:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:"compra",estado:"pendiente aprobacion",p:0,pcount:20})}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/compras/views/list-compras.client.view.html"}).state("home.createCompra",{url:"compras/create?tipo",titulo:"Nueva Compra",newButton:!1,prevState:"home.compras",controller:"CreateCompraController",resolve:{compras:["Authentication","Compras",function(Authentication,Compras){return Compras.query({e:Authentication.user.enterprise.enterprise})}],tipoCompra:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/compras/views/create-compra.client.view.html"}).state("home.viewCompra",{url:"compras/view/:compraId",titulo:"View Compra",newButton:!1,prevState:"home.compras",controller:"ViewCompraController",resolve:{compras:["Authentication","Compras",function(Authentication,Compras){return Compras.query({e:Authentication.user.enterprise.enterprise})}],productos:["Authentication","Products",function(Authentication,Products){return Products.query({e:Authentication.user.enterprise.enterprise})}],compra:["$stateParams","Compras",function($stateParams,Compras){return Compras.get({compraId:$stateParams.compraId})}]},templateUrl:"modules/compras/views/view-compra.client.view.html"}).state("home.editCompra",{url:"compras/:compraId/edit",titulo:"Edit Compra",newButton:!0,prevState:"home.compras",templateUrl:"modules/compras/views/edit-compra.client.view.html"}).state("home.stock",{url:"stocks?tipo",titulo:"Stock",prevState:"home.welcome",templateUrl:"modules/stocks/views/list-stocks.client.view.html",controller:"StocksController",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}],costCenters:["Authentication","Costcenters",function(Authentication,Costcenters){return Costcenters.query({e:Authentication.user.enterprise.enterprise})}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise})}]}}).state("home.viewStock",{url:"stocks/view/:stockId",titulo:"Stock",prevState:"home.stocks",templateUrl:"modules/stocks/views/view-stock.client.view.html"}).state("home.editStock",{url:"stocks/:stockId/edit",titulo:"Stock",prevState:"home.stocks",templateUrl:"modules/stocks/views/edit-stock.client.view.html"}).state("home.pedidos",{url:"pedidos?tipo",titulo:"Pedidos Realizados",prevState:"home.welcome",newButton:!0,controller:"ListPedidosController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],pedidosEvaluacion:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:$stateParams.tipo,estado:"pendiente evaluacion",p:0,pcount:20})}],pedidosRealizados:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:$stateParams.tipo,estado:"pendiente aprobacion",p:0,pcount:20})}],pedidosAprobados:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:$stateParams.tipo,estado:"aprobada",p:0,pcount:20})}],pedidosRechazados:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:$stateParams.tipo,estado:"rechazada",p:0,pcount:20})}],pedidosBorrador:["Authentication","Pedidos","$stateParams",function(Authentication,Pedidos,$stateParams){return Pedidos.query({e:Authentication.user.enterprise.enterprise,tipoPedido:$stateParams.tipo,estado:"borrador",p:0,pcount:20})}],tipoOrden:["$stateParams",function($stateParams){return $stateParams.tipo}],tipoPedido:["$stateParams",function($stateParams){return $stateParams.tipo}],ventasPendientesEntrega:["Authentication","Ventas","$stateParams",function(Authentication,Ventas,$stateParams){return Ventas.query({e:Authentication.user.enterprise.enterprise,estado:"Pendiente de entrega",p:0,pcount:20})}],ventasFinalizadas:["Authentication","Ventas","$stateParams",function(Authentication,Ventas,$stateParams){return Ventas.query({e:Authentication.user.enterprise.enterprise,estado:"Finalizada",p:0,pcount:20})}],ventasPendientes:["Authentication","Ventas","$stateParams",function(Authentication,Ventas,$stateParams){return Ventas.query({e:Authentication.user.enterprise.enterprise,estado:"Pendiente de pago y entrega",p:0,pcount:20})}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/pedidos/views/list-pedidos.client.view.html"}).state("home.createPedido",{url:"pedidos/create?tipo",titulo:"Nueva Solicitud",prevState:"home.pedidos",newButton:!1,controller:"CreatePedidosController",resolve:{pedidos:["Authentication","Pedidos",function(Authentication,Pedidos){return Pedidos.query({e:Authentication.user.enterprise.enterprise})}],tipoOrden:["$stateParams",function($stateParams){return $stateParams.tipo}],tipoPedido:["$stateParams",function($stateParams){return $stateParams.tipo}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/pedidos/views/create-pedido.client.view.html"}).state("home.viewPedido",{url:"pedidos/view/:pedidoId",titulo:"Orden",prevState:"home.pedidos",newButton:!1,controller:"ViewPedidosController",resolve:{pedidos:["Authentication","Pedidos",function(Authentication,Pedidos){return Pedidos.query({e:Authentication.user.enterprise.enterprise})}],tipoOrden:["$stateParams",function($stateParams){return $stateParams.tipo}],tipoPedido:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/pedidos/views/view-pedido.client.view.html"}).state("home.editPedido",{url:"pedidos/:pedidoId/edit?tipo",titulo:"Orden",prevState:"home.pedidos",newButton:!0,controller:"PedidosController",resolve:{pedidos:["Authentication","Pedidos",function(Authentication,Pedidos){return Pedidos.query({e:Authentication.user.enterprise.enterprise})}],tipoOrden:["$stateParams",function($stateParams){return $stateParams.tipo}],tipoPedido:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/pedidos/views/edit-pedido.client.view.html"}).state("home.finanzas",{url:"finanzas?tipo",titulo:"Finanzas",prevState:"home.welcome",newButton:!1,controller:"ListFinanzasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],movimientos:["Authentication","Movimientos",function(Authentication,Movimientos){return Movimientos.query({e:Authentication.user.enterprise.enterprise})}],tipoFinanza:["$stateParams",function($stateParams){return console.log($stateParams.tipo,"state params"),$stateParams.tipo}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/finanzas/views/list-finanzas.client.view.html"}).state("home.createFinanza",{url:"finanzas/create?tipo",titulo:"Nueva Solicitud",prevState:"home.finanzas",newButton:!1,controller:"CreateFinanzasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],finanzas:["Authentication","Finanzas",function(Authentication,Finanzas){return Finanzas.query({e:Authentication.user.enterprise.enterprise})}],finanza:["$stateParams","Finanzas",function($stateParams,Finanzas){return Finanzas.get({finanzasId:$stateParams.finanzaId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],tipoFinanza:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/finanzas/views/create-finanza.client.view.html"}).state("home.viewFinanza",{url:"finanzas/view/:finanzaId?tipo",titulo:"Finanza",prevState:"home.finanzas",newButton:!1,controller:"FinanzasViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],finanzas:["Authentication","Finanzas",function(Authentication,Finanzas){return Finanzas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],finanza:["$stateParams","Finanzas",function($stateParams,Finanzas){return Finanzas.get({finanzaId:$stateParams.finanzaId})}],movimientos:["Authentication","Movimientos",function(Authentication,Movimientos){return Movimientos.query({e:Authentication.user.enterprise.enterprise})}],tipoFinanza:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/finanzas/views/view-finanza.client.view.html"}).state("home.editFinanza",{url:"finanzas/:finanzaId/edit?tipo",titulo:"Orden",prevState:"home.finanzas",newButton:!1,controller:"EditFinanzasController",controllerAs:"ctrl",resolve:{finanzas:["Authentication","Finanzas",function(Authentication,Finanzas){return Finanzas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],tipoFinanza:["$stateParams",function($stateParams){return $stateParams.tipo}]},templateUrl:"modules/finanzas/views/edit-finanza.client.view.html"}).state("home.resumenList",{url:"resumen",titulo:"Resumen económico",newButton:!1,controller:"ResumenListController",resolve:{costcenters:["Authentication","Costcenters",function(Authentication,Costcenters){return Costcenters.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/finanzas/views/resumen-list.client.view.html"}).state("home.resumen",{url:"resumen/:centroDeCosto",titulo:"Resumen económico",prevState:"home.resumenList",newButton:!1,controller:"ResumenController",resolve:{user:["Authentication",function(Authentication){return Authentication.user}]},templateUrl:"modules/finanzas/views/resumen.client.view.html"}).state("home.movimientos",{url:"movimientos",titulo:"Movimientos",prevState:"home.welcome",newButton:!0,controller:"ListMovimientosController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],movimientos:["Authentication","Movimientos",function(Authentication,Movimientos){return Movimientos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/movimientos/views/list-movimientos.client.view.html"}).state("home.createMovimientos",{url:"movimientos/create?tipo",titulo:"Nuevo Movimiento",prevState:"home.movimientos",newButton:!1,controller:"CreateMovimientosController",controllerAs:"ctrl",resolve:{movimientos:["Authentication","Movimientos",function(Authentication,Movimientos){return Movimientos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/movimientos/views/create-movimiento.client.view.html"}).state("home.viewMovimiento",{url:"movimientos/view/:movimientoId",titulo:"Orden",prevState:"home.movimientos",newButton:!1,controller:"ViewMovimientoController",controllerAs:"ctrl",resolve:{movimientos:["Authentication","Movimientos",function(Authentication,Movimientos){return Movimientos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/movimientos/views/view-movimiento.client.view.html"}).state("home.editMovimiento",{url:"movimientos/:movimientoId/edit",titulo:"Movimiento",prevState:"home.movimientos",newButton:!0,controller:"EditMovimientosController",controllerAs:"ctrl",resolve:{movimientos:["Authentication","Movimientos",function(Authentication,Movimientos){return Movimientos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/movimientos/views/edit-movimiento.client.view.html"}).state("home.sucursales",{url:"sucursales",titulo:"Tesorería",newButton:!1,prevState:"home.welcome",controller:"SucursalesListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],sucursales:["Authentication","Sucursales",function(Authentication,Sucursales){return Sucursales.query({e:Authentication.user.enterprise.enterprise})}],cajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/sucursales/views/list-sucursales.client.view.html"}).state("home.createSucursal",{url:"sucursales/view/create",titulo:"Crear Tesorería",prevState:"home.sucursales",newButton:!1,controller:"SucursalesCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],sucursal:function(){return{}},sucursales:["Sucursales",function(Sucursales){return Sucursales}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/sucursales/views/create-sucursal.client.view.html"}).state("home.viewSucursal",{url:"sucursales/view/:sucursalId",titulo:"Tesorería",newButton:!1,prevState:"home.sucursales",controller:"SucursalesViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],cajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],sucursal:["$stateParams","Sucursales",function($stateParams,Sucursales){return Sucursales.get({sucursalId:$stateParams.sucursalId})}]},templateUrl:"modules/sucursales/views/view-sucursal.client.view.html"}).state("home.editSucursal",{url:"sucursales/:sucursalId/edit",titulo:"Editar Tesorería",newButton:!1,prevState:"home.sucursales",controller:"SucursalesEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],sucursal:["$stateParams","Sucursales",function($stateParams,Sucursales){return Sucursales.get({sucursalId:$stateParams.sucursalId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/sucursales/views/edit-sucursal.client.view.html"}).state("home.cajas",{url:"cajas",titulo:"Cajas",newButton:!0,prevState:"home.welcome",controller:"CajasListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],cajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],puestos:["Authentication","Puestos",function(Authentication,Puestos){return Puestos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/cajas/views/list-cajas.client.view.html"}).state("home.createCaja",{url:"cajas/view/create",titulo:"Crear Caja",prevState:"home.cajas",newButton:!1,controller:"CajasCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],caja:function(){return{}},cajas:["Cajas",function(Cajas){return Cajas}],puestos:["Authentication","Puestos",function(Authentication,Puestos){return Puestos.query({e:Authentication.user.enterprise.enterprise})}],totalCajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/cajas/views/create-caja.client.view.html"}).state("home.viewCaja",{url:"cajas/view/:cajaId",titulo:"Caja",newButton:!1,prevState:!1,controller:"CajasViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],caja:["$stateParams","Cajas",function($stateParams,Cajas){return Cajas.get({cajaId:$stateParams.cajaId})}]},templateUrl:"modules/cajas/views/view-caja.client.view.html"}).state("home.editCaja",{url:"cajas/:cajaId/edit",titulo:"Caja",newButton:!1,prevState:"home.cajas",controller:"CajasEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],caja:["$stateParams","Cajas",function($stateParams,Cajas){return Cajas.get({cajaId:$stateParams.cajaId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/cajas/views/edit-caja.client.view.html"}).state("home.transferencias",{url:"transferencias",titulo:"Transferencias",prevState:"home.welcome",newButton:!0,controller:"ListTransferenciasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],transferencias:["Authentication","Transferencias",function(Authentication,Transferencias){return Transferencias.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/transferencias/views/list-transferencias.client.view.html"}).state("home.createTransferencias",{url:"transferencias/view/create",titulo:"Nueva Transferencia",prevState:"home.transferencias",newButton:!1,controller:"CreateTransferenciasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],transferencias:["Authentication","Transferencias",function(Authentication,Transferencias){return Transferencias.query({e:Authentication.user.enterprise.enterprise})}],transferencia:function(){return{}},enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/transferencias/views/create-transferencia.client.view.html"}).state("home.viewTransferencia",{url:"transferencias/view/:transferenciaId",titulo:"Orden",prevState:"home.transferencias",newButton:!1,controller:"ViewTransferenciaController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],transferencias:["Authentication","Transferencias",function(Authentication,Transferencias){return Transferencias.query({e:Authentication.user.enterprise.enterprise})}],transferencia:["$stateParams","Transferencias",function($stateParams,Transferencias){return Transferencias.get({transferenciaId:$stateParams.transferenciaId})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/transferencias/views/view-transferencia.client.view.html"}).state("home.editTransferencia",{url:"transferencias/:transferenciaId/edit",titulo:"Transferencia",prevState:"home.transferencias",newButton:!0,controller:"EditTransferenciasController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],transferencias:["Authentication","Transferencias",function(Authentication,Transferencias){return Transferencias.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/transferencias/views/edit-transferencia.client.view.html"}).state("home.arqueos",{url:"arqueos",titulo:"arqueos",prevState:"home.welcome",newButton:!0,controller:"ListArqueosController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],arqueos:["Authentication","Arqueos",function(Authentication,Arqueos){return Arqueos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/arqueos/views/list-arqueos.client.view.html"}).state("home.createArqueos",{url:"arqueos/view/create",titulo:"Nuevo Arqueo",prevState:"home.arqueos",newButton:!1,controller:"CreateArqueosController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],arqueos:["Authentication","Arqueos",function(Authentication,Arqueos){return Arqueos.query({e:Authentication.user.enterprise.enterprise})}],arqueo:function(){return{}},enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/arqueos/views/create-arqueo.client.view.html"}).state("home.viewArqueo",{url:"arqueos/view/:arqueoId",titulo:"Orden",prevState:"home.arqueos",newButton:!1,controller:"ViewArqueoController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],arqueos:["Authentication","Arqueos",function(Authentication,Arqueos){return Arqueos.query({e:Authentication.user.enterprise.enterprise})}],arqueo:["$stateParams","Arqueos",function($stateParams,Arqueos){return Arqueos.get({arqueo:$stateParams.arqueo})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/arqueos/views/view-arqueo.client.view.html"}).state("home.editArqueo",{url:"arqueos/:arqueoId/edit",titulo:"Arqueos",prevState:"home.arqueos",newButton:!0,controller:"EditArqueoController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],arqueos:["Authentication","Arqueos",function(Authentication,Arqueos){return Arqueos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/arqueos/views/edit-arqueo.client.view.html"}).state("home.procesos",{url:"procesos",titulo:"Procesos y Manuales",newButton:!0,prevState:"home.welcome",controller:"ProcesosListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],procesos:["Authentication","Procesos",function(Authentication,Procesos){return Procesos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Proceso"})}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/procesos/views/list-procesos.client.view.html"}).state("home.createProceso",{url:"procesos/view/create",titulo:"Nuevo Proceso",newButton:!1,prevState:"home.procesos",controller:"ProcesosCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Proceso"})}],proceso:function(){return{}},procesos:["Procesos",function(Procesos){return Procesos}],procedimientos:["Authentication","Procedimientos",function(Authentication,Procedimientos){return Procedimientos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/procesos/views/create-proceso.client.view.html"}).state("home.viewProceso",{url:"procesos/view/:procesoId",titulo:"Mis Procesos",newButton:!0,prevState:"home.procesos",controller:"ProcesosViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],proceso:["$stateParams","Procesos",function($stateParams,Procesos){return Procesos.get({procesoId:$stateParams.procesoId})}]},templateUrl:"modules/procesos/views/view-proceso.client.view.html"}).state("home.editProceso",{url:"procesos/:procesoId/edit",titulo:"Mis Procesos",newButton:!0,prevState:"home.procesos",controller:"ProcesosEditController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],proceso:["$stateParams","Procesos",function($stateParams,Procesos){return Procesos.get({procesoId:$stateParams.procesoId})}],procesos:["Authentication","Procesos",function(Authentication,Procesos){return Procesos.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],procedimientos:["Authentication","Procedimientos",function(Authentication,Procedimientos){return Procedimientos.query({e:Authentication.user.enterprise.enterprise})}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Proceso"})}]},templateUrl:"modules/procesos/views/edit-proceso.client.view.html"}).state("home.procedimientos",{url:"procedimientos",titulo:"Mis Procedimientos",newButton:!1,prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/procedimientos/views/list-procedimientos.client.view.html"}).state("home.viewProcedimiento",{url:"procedimientos/view/:procedimientoId",titulo:"Mis Procedimientos",newButton:!1,prevState:"home.procedimientos",templateUrl:"modules/procedimientos/views/view-procedimiento.client.view.html"}).state("home.editProcedimiento",{url:"procedimientos/:procedimientoId/edit",titulo:"Mis Procedimientos",newButton:!1,prevState:"home.procedimientos",templateUrl:"modules/procedimientos/views/edit-procedimiento.client.view.html"}).state("home.personal",{url:"personal",titulo:"Usuarios",newButton:!1,prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/personas/views/list-personas.client.view.html"}).state("home.editUser",{url:"editar-usuario/:personaId",titulo:"Personal",newButton:!0,prevState:"home.personal",templateUrl:"modules/users/views/settings/edit-user.client.view.html"}).state("home.createPersonal",{url:"personas/view/create",titulo:"Nuevo Empleado",newButton:!1,prevState:"home.personal",templateUrl:"modules/personas/views/create-persona.client.view.html"}).state("home.viewPersona",{url:"personas/view/{personaId}",params:{centroDeCosto:"",sueldo:""},titulo:"Personal",newButton:!0,prevState:"home.personal",templateUrl:"modules/personas/views/view-persona.client.view.html"}).state("home.editPersonal",{url:"editar-persona/:personaId",titulo:"Personal",newButton:!0,prevState:"home.personal",templateUrl:"modules/users/views/view-user.client.view.html"}).state("home.rrhh",{url:"rrhh",titulo:"Organigrama",newButton:!0,prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/rrhhs/views/list-rrhhs.client.view.html"}).state("home.viewRRHH",{url:"rrhh/view/:rrhhId",titulo:"RRHH",newButton:!0,prevState:"home.rrhh",templateUrl:"modules/rrhhs/views/view-rrhh.client.view.html"}).state("home.editRRHH",{url:"rrhh/:rrhhId/edit",titulo:"RRHH",newButton:!0,prevState:"home.rrhh",templateUrl:"modules/rrhhs/views/edit-rrhh.client.view.html"}).state("home.impuestos",{url:"impuestos",titulo:"Impuestos",prevState:"home.welcome",controller:"ImpuestosListController",controllerAs:"ctrl",resolve:{costcenters:["Authentication","Costcenters",function(Authentication,Costcenters){return Costcenters.query({e:Authentication.user.enterprise.enterprise})}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/impuestos/views/list-impuesto.client.view.html"}).state("home.viewImpuesto",{url:"impuestos/view/:centroDeCosto",titulo:"Impuestos",newButton:!1,prevState:"home.impuestos",controller:"ImpuestosViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],costcenters:["Authentication","Costcenters",function(Authentication,Costcenters){return Costcenters.query({e:Authentication.user.enterprise.enterprise})}]},templateUrl:"modules/impuestos/views/view-impuesto.client.view.html"}).state("home.detailsImpuesto",{url:"impuestos/details/{impuestosId}&{impuestosName}",titulo:"Detalle de Impuesto",prevState:"home.viewImpuesto",controller:"ImpuestosDetailsController",controllerAs:"ctrl",templateUrl:"modules/impuestos/views/details-impuesto.client.view.html"}).state("home.detailsPresentacion",{url:"impuestos/detailspresentacion/{impuestosId}",titulo:"Detalle de Presen",prevState:"home.viewImpuesto",controller:"ImpuestosPresentacionController",controllerAs:"ctrl",templateUrl:"modules/impuestos/views/presentacion-impuesto.client.view.html"}).state("home.detailsImpuestoAut",{url:"impuestos/details/{impuestosId}&{impuestosName}&{impuestosType}",titulo:"Detalle de Impuesto",prevState:"home.viewImpuesto",controller:"ImpuestosDetailsController",controllerAs:"ctrl",templateUrl:"modules/impuestos/views/details-impuesto.client.view.html"}).state("home.createImpuesto",{url:"impuestos/create/:centroDeCosto",titulo:"Crear Impuesto",prevState:"home.viewImpuesto",controller:"ImpuestosCreateController",controllerAs:"ctrl",templateUrl:"modules/impuestos/views/create-impuesto.client.view.html"}).state("home.area",{url:"areas",titulo:"Áreas",newButton:!0,prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/areas/views/list-areas.client.view.html"}).state("home.createArea",{url:"areas/view/create",titulo:"Nueva Área",newButton:!1,prevState:"home.area",templateUrl:"modules/areas/views/create-area.client.view.html"}).state("home.viewArea",{url:"areas/view/:areaId",titulo:"Áreas",newButton:!0,prevState:"home.area",templateUrl:"modules/areas/views/view-area.client.view.html"}).state("home.editArea",{url:"areas/:areaId/edit",titulo:"Áreas",newButton:!0,prevState:"home.area",templateUrl:"modules/areas/views/edit-area.client.view.html"}).state("home.puesto",{url:"puestos",titulo:"Puestos",newButton:!0,prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/puestos/views/list-puestos.client.view.html"}).state("home.createPuesto",{url:"puestos/view/create",titulo:"Nuevo Puesto De Trabajo",newButton:!1,prevState:"home.puesto",templateUrl:"modules/puestos/views/create-puesto.client.view.html"}).state("home.viewPuesto",{url:"puestos/view/{puestoId}",params:{personal:"false",centroDeCosto:""},titulo:"Puesto",newButton:!0,prevState:"home.puesto",templateUrl:"modules/puestos/views/view-puesto.client.view.html"}).state("home.editPuesto",{url:"puestos/:puestoId/edit",titulo:"Puesto",newButton:!0,prevState:"home.puesto",templateUrl:"modules/puestos/views/edit-puesto.client.view.html"}).state("home.entregas",{url:"entregas",titulo:"Entregas",newButton:!0,prevState:"home.welcome",resolve:{serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/entregas/views/list-entregas.client.view.html"}).state("home.viewEntrega",{url:"entregas/view/:entregaId",titulo:"Entrega",newButton:!0,prevState:"home.entregas",templateUrl:"modules/entregas/views/view-entrega.client.view.html"}).state("home.editEntrega",{url:"entregas/:entregaId/edit",titulo:"Entrega",newButton:!0,prevState:"home.entregas",templateUrl:"modules/entregas/views/edit-entrega.client.view.html"}).state("home.reportes",{url:"reportes?tipo",titulo:"Reportes",newButton:!1,controller:"ReportesController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],reportesVentas:["ReportesVentas",function(ReportesVentas){return ReportesVentas}],tipoReporte:["$stateParams",function($stateParams){return $stateParams.tipo}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/reportes/views/dashboard-reportes.client.view.html"}).state("home.costosIndirectos",{url:"costosIndirectos/:centroId",titulo:"Costos Indirectos",newButton:!1,prevState:"home.welcome",controller:"CostosindirectosListController",controllerAs:"ctrl",name:null,resolve:{user:["Authentication",function(Authentication){return Authentication.user}],costosindirectosService:["$stateParams","CostosindirectosService",function($stateParams,CostosindirectosService){localStorage.setItem("centroId",$stateParams.centroId);var filterData={};if(filterData.centroId=$stateParams.centroId,localStorage.search_postos){var data=JSON.parse(localStorage.search_postos);data.year&&(filterData.year=data.year),data.month&&(filterData.month=data.month)}return CostosindirectosService.query(filterData)}],cajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}],costosLastMonthTotal:["$stateParams","LastMonthTotal",function($stateParams,LastMonthTotal){return LastMonthTotal.costosLastMonthTotal($stateParams.centroId)}]},templateUrl:"modules/costosindirectos/views/list-costosindirectos.client.view.html"}).state("home.createCostosIndirectos",{url:"costosindirectos/view/create",titulo:"Crear costo indirecto",prevState:"home.costosIndirectos",newButton:!1,controller:"CostosIndirectosCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],costosindirectosService:["Authentication","CostosindirectosService",function(Authentication,CostosindirectosService){return CostosindirectosService.query({e:Authentication.user.enterprise.enterprise})}],cajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],enterprises:["Enterprises",function(Enterprises){return Enterprises.query()}]},templateUrl:"modules/costosindirectos/views/create-costosindirecto.client.view.html"}).state("home.viewCostosIndirectos",{url:"costosindirectos/view/:costosindirectoId",titulo:"Costos Indirectos",newButton:!1,prevState:"home.costosIndirectos",controller:"CostosIndirectosViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],serviciosService:["Authentication","ServiciosService",function(Authentication,ServiciosService){var filterData={};return filterData=localStorage.search_postos?JSON.parse(localStorage.search_postos):{e:Authentication.user.enterprise.enterprise},ServiciosService.query(filterData)}],cajas:["Authentication","Cajas",function(Authentication,Cajas){return Cajas.query({e:Authentication.user.enterprise.enterprise})}],costosindirectos:["$stateParams","CostosindirectosService",function($stateParams,CostosindirectosService){return CostosindirectosService.get({costosindirectoId:$stateParams.costosindirectoId})}],serviciosLastMonthTotal:["$stateParams","LastMonthTotal",function($stateParams,LastMonthTotal){return LastMonthTotal.serviciosLastMonthTotal()}]},templateUrl:"modules/costosindirectos/views/view-costosindirecto.client.view.html"}).state("home.serviceDetails",{url:"costosindirectos/view/",titulo:"Costos Indirectos",newButton:!1,prevState:!1,controller:"FinanzasController",controllerAs:"ctrl",resolve:{getServiceDetials:["Finanzas",function(Finanzas){return console.log($stateParams),Finanzas.query({serviceId:$stateParams.servicosId,type:"serviceDetials"})}]},templateUrl:"modules/finanzas/views/list-service-details.client.view.html"}).state("home.viewPago",{url:"pagos/view/{servicosId}&{impuestosId}&{empleadoId}",params:{displayName:"",centroDeCosto:""},titulo:"",newButton:!1,prevState:!1,controller:"PagosViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],pago:["$stateParams","PagosService",function($stateParams,PagosService){var toList;if($stateParams.servicosId&&""!==$stateParams.servicosId)(toList=$stateParams.servicosId.split("/"))[toList.length-1];if(toList)return localStorage.setItem("serviceName",toList[1]),PagosService.query({servicosId:toList[0],type:"serviceDetails"});var date=$stateParams.empleadoId?JSON.parse(localStorage.getItem("dateEmpleados")):JSON.parse(localStorage.getItem("dateImpuestos"));return localStorage.removeItem("serviceName"),date&&(date.month||date.year)?PagosService.query({servicosId:$stateParams.servicosId?toList[0]:void 0,impuestosId:$stateParams.impuestosId,empleadoId:$stateParams.empleadoId,month:null,year:date.year||null}):PagosService.query({servicosId:$stateParams.servicosId?toList[0]:void 0,impuestosId:$stateParams.impuestosId,empleadoId:$stateParams.empleadoId})}],servicios:["$stateParams","ServiciosService",function($stateParams,ServiciosService){if($stateParams.servicosId){var toList=$stateParams.servicosId.split("/");toList[toList.length-1]}return""!==$stateParams.servicosId?ServiciosService.get({servicioId:toList[0]}):[]}]},templateUrl:"modules/pagos/views/view-pago.client.view.html"}).state("home.viewSaldo",{url:"saldo/view/{servicosId}&{impuestosId}&{empleadoId}",params:{displayName:"",centroDeCosto:""},titulo:"",newButton:!1,prevState:!1,controller:"PagosViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],pago:["$stateParams","PagosService",function($stateParams,PagosService){var toList;if($stateParams.servicosId&&""!==$stateParams.servicosId)(toList=$stateParams.servicosId.split("/"))[toList.length-1];if(toList)return localStorage.setItem("serviceName",toList[1]),PagosService.query({servicosId:toList[0],type:"serviceDetails"});var date=$stateParams.empleadoId?JSON.parse(localStorage.getItem("dateEmpleados")):JSON.parse(localStorage.getItem("dateImpuestos"));return localStorage.removeItem("serviceName"),date&&(date.month||date.year)?PagosService.query({servicosId:$stateParams.servicosId?toList[0]:void 0,impuestosId:$stateParams.impuestosId,empleadoId:$stateParams.empleadoId,month:null,year:date.year||null}):PagosService.query({servicosId:$stateParams.servicosId?toList[0]:void 0,impuestosId:$stateParams.impuestosId,empleadoId:$stateParams.empleadoId})}],servicios:["$stateParams","ServiciosService",function($stateParams,ServiciosService){if($stateParams.servicosId){var toList=$stateParams.servicosId.split("/");toList[toList.length-1]}return""!==$stateParams.servicosId?ServiciosService.get({servicioId:toList[0]}):[]}]},templateUrl:"modules/pagos/views/view-saldo.client.view.html"}).state("home.listcentroDeCosto",{url:"costosindirectos/listcentroDeCosto/",titulo:"Costos Indirectos",newButton:!1,prevState:!1,controller:"CostocentersListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],centrodecosto:["Authentication","CustomServicios",function(Authentication,CustomServicios){localStorage.removeItem("centroId"),localStorage.removeItem("search_postos");var e=Authentication.user.enterprise.enterprise;return CustomServicios.getCentroByServicios(e)}]},templateUrl:"modules/costosindirectos/views/list-centrodecosto.client.view.html"}).state("home.remuneraciones",{url:"remuneraciones",titulo:"Remuneraciones",newButton:!0,prevState:!1,controller:"RemuneracioneListController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],remuneraciones:["Remuneraciones",function(Remuneraciones){return Remuneraciones.query({})}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/remuneraciones/views/list-remuneraciones.client.view.html"}).state("home.viewRemuneracione",{url:"remuneraciones/view/:remuneracioneId",titulo:"Remuneraciones",newButton:!1,prevState:"home.remuneraciones",controller:"RemuneracioneViewController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],remuneracione:["$stateParams","Remuneraciones",function($stateParams,Remuneraciones){return Remuneraciones.get({remuneracioneId:$stateParams.remuneracioneId})}]},templateUrl:"modules/remuneraciones/views/view-remuneracione.client.view.html"}).state("home.createRemuneracione",{url:"remuneraciones/create",titulo:"Crear Remuneración",newButton:!1,prevState:"home.remuneraciones",controller:"RemuneracioneCreateController",controllerAs:"ctrl",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Remuneracione"})}],serviceNav:["ServiceNavigation",function(ServiceNavigation){ServiceNavigation.navInit()}]},templateUrl:"modules/remuneraciones/views/create-remuneracione.client.view.html"}).state("home.editRemuneracione",{url:"remuneraciones/:remuneracioneId/edit",titulo:"Editar Remuneración",newButton:!1,prevState:"home.remuneraciones",controller:"RemuneracioneEditController",resolve:{user:["Authentication",function(Authentication){return Authentication.user}],remuneracione:["$stateParams","Remuneraciones",function($stateParams,Remuneraciones){return Remuneraciones.get({remuneracioneId:$stateParams.remuneracioneId})}],categories:["Authentication","Categories",function(Authentication,Categories){return Categories.query({e:Authentication.user.enterprise.enterprise,type1:"Remuneracione"})}]},templateUrl:"modules/remuneraciones/views/edit-remuneracione.client.view.html"}).state("home.actividades",{url:"actividades",params:{empleadoId:null,displayName:"",centroDeCosto:""},titulo:"Actividad",newButton:!1,prevState:!1,controller:"ActividadListController",templateUrl:"modules/actividades/views/list-actividades.client.view.html"}).state("home.liquidaciones",{url:"liquidaciones",params:{empleadoId:null,displayName:"",centroDeCosto:""},titulo:"Liquidaciones",newButton:!0,prevState:!1,controller:"LiquidacionListController",templateUrl:"modules/liquidaciones/views/list-liquidacion.client.view.html"}).state("home.createLiquidacion1",{url:"liquidaciones/create",params:{empleadoId:null,liquidacionId:null},titulo:"Crear Liquidación",newButton:!1,prevState:"home.liquidaciones",controller:"LiquidacionCreateController",resolve:{user:["Authentication",function(Authentication){return Authentication.user}]},templateUrl:"modules/pagos/views/create-liquidacion.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","$state","Authentication","Menus",function($scope,$state,Authentication,Menus){$scope.$state=$state,$scope.authentication=Authentication,$scope.menu=Menus.getMenu("topbar"),$scope.isCollapsed=!1,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","$rootScope","Authentication","$state","$mdBottomSheet","$mdSidenav","$mdUtil","Menu","FindUserById","Areas","$http","Puestos","$stateParams","ShowAreaInfo","$mdDialog","Tareas","Users","$filter","$timeout","Empleados","Actividades","ServiceNavigation",function($scope,$rootScope,Authentication,$state,$mdBottomSheet,$mdSidenav,$mdUtil,Menu,FindUserById,Areas,$http,Puestos,$stateParams,ShowAreaInfo,$mdDialog,Tareas,Users,$filter,$timeout,Empleados,Actividades,ServiceNavigation){AreaModalController.$inject=["$scope","$mdDialog","ShowAreaInfo"],DialogController.$inject=["$scope","$rootScope","$mdDialog","$timeout","item","SEARCH","Tareas","Users","Authentication"],ActividadDialogController.$inject=["$scope","$mdDialog","$state","item"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){void 0!==$scope.authentication.user&&($scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findTareas())}),$rootScope.$watchCollection("estadoActualParams",function(){void 0!==$rootScope.estadoActualParams&&($scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null})}),$scope.authentication.user||$state.transitionTo("authentication.signin");var navID,vm=this;function DialogController($scope,$rootScope,$mdDialog,$timeout,item,SEARCH,Tareas,Users,Authentication){$scope.prioridad=!1,$scope.findUsers=function(){void 0!==SEARCH&&($scope.usuarios=Users.query({e:SEARCH.enterprise}))},$scope.borrarError=function(){$scope.errorTarea=void 0},$scope.closeDialog=function(){$mdDialog.hide()},$scope.create=function($event){var autoAsignado=!1;if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!=$scope.descripcion&&null!=$scope.descripcion)if(void 0!=$scope.user&&null!=$scope.user){$scope.user._id===Authentication.user._id&&(autoAsignado=!0);var tarea=new Tareas({descripcion:$scope.descripcion,prioridad:$scope.prioridad,usuario:$scope.user._id,forMe:autoAsignado,enterprise:SEARCH.enterprise});tarea.usuario===Authentication.user._id?(tarea.user=$scope.user.displayName,$rootScope.arrayTareas.push(tarea),tarea.user=void 0):!1===tarea.forMe&&(tarea.usuario=$scope.user.displayName,$rootScope.arrayTareasAsignadas.push(tarea),tarea.usuario=$scope.user._id),tarea.$save(function(response){$scope.closeDialog()},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorTarea="Se debe indicar la persona a asignar la tarea";else $scope.errorTarea="Se debe indicar la descripcion de la tarea"}}function ActividadDialogController($scope,$mdDialog,$state,item){$scope.item=item,$scope.item.name=item.userLogin.displayName,$scope.closeDialog=function(){$mdDialog.hide()},$scope.createActividad=function($event,item){new Actividades({enterprise:item.enterprise,operacion:$scope.operacion,observaciones:$scope.observaciones,empleado:item._id}).$save(function(){$scope.closeDialog(),$state.go("home.welcome",{},{reload:!0})},function(errorResponse){$scope.error=errorResponse.data.message})}}function AreaModalController($scope,$mdDialog,ShowAreaInfo){var areaActive=ShowAreaInfo.getArea();$http({method:"GET",url:"/api/findAreaById",params:{areaId:areaActive}}).then(function(response){$scope.areaActive=response.data,$scope.parent=$scope.areaActive.parent,$http({method:"GET",url:"/api/puestoByAreaId",params:{areaId:$scope.areaActive._id}}).then(function(res){null==res.data[0]?$scope.puestosActive=null:$scope.puestosActive=res.data},function(response){console.log("error")})},function(response){console.log("error")}),$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)}}vm.isOpen=function(section){return Menu.isSectionSelected(section)},vm.toggleOpen=function(section){Menu.toggleSelectSection(section)},vm.autoFocusContent=!1,vm.menu=Menu,$rootScope.$on("nav change",function(val){$rootScope.titles=ServiceNavigation.getNav()}),$rootScope.$on("hide nav",function(val){$rootScope.titles=[]}),$rootScope.$broadcast("nav change",!0),vm.status={isFirstOpen:!0,isFirstDisabled:!1},$scope.toggle=(navID="left",$mdUtil.debounce(function(){$mdSidenav(navID).toggle().then(function(){console.log("toggle "+navID+" is done")})},300)),$scope.showBottomSheet=function($event){var template="";switch($rootScope.estadoActual){case"home.enterprises":template="modules/enterprises/views/create-enterprise.client.view.html";break;case"home.products":case"home.viewProduct":case"home.editProduct":$state.go("home.createProduct",$rootScope.estadoActualParams);break;case"home.editValores":$state.go("home.editValores",$rootScope.estadoActualParams);break;case"home.categories":case"home.viewCategory":case"home.editCategory":$state.go("home.createCategory");break;case"home.subs":case"home.viewSub":case"home.editSub":template="modules/subs/views/create-sub.client.view.html";break;case"home.tareas":case"home.viewTarea":case"home.editTarea":template="modules/tareas/views/create-tarea.client.view.html";break;case"home.finanzas":template="modules/finanzas/views/list-finanzas.client.view.html";break;case"home.viewFinanza":template="modules/finanzas/views/view-finanza.client.view.html";break;case"home.editComprobante":template="modules/finanzas/views/create-finanza.client.view.html";break;case"home.viewTarea":case"home.editTarea":template="modules/tareas/views/create-tarea.client.view.html";break;case"home.clients":case"home.viewClient":$state.go("home.createClient");break;case"home.editClient":template="modules/_clients/views/create-client.client.view.html";break;case"home.providers":case"home.viewProvider":case"home.editProvider":$state.go("home.createProvider");break;case"home.contacts":$state.go("home.createContact");break;case"home.viewContact":case"home.editContact":template="modules/contacts/views/create-contact.client.view.html";break;case"home.taxConditions":case"home.viewTaxCondition":case"home.editTaxCondition":template="modules/taxconditions/views/create-taxcondition.client.view.html";break;case"home.condicionVentas":$state.go("home.createCondicionventa");break;case"home.viewCondicionVenta":case"home.editCondicionVenta":template="modules/condicionventas/views/create-condicionventa.client.view.html";break;case"home.comprobantes":$state.go("home.createComprobante");break;case"home.viewComprobante":template="modules/comprobantes/views/create-comprobante.client.view.html";break;case"home.costcenters":case"home.viewCostcenter":case"home.editCostcenter":template="modules/costcenters/views/create-costcenter.client.view.html";break;case"home.createVenta":$state.go("home.createVenta");break;case"home.ventasMostrador":$state.go("home.ventasMostrador");break;case"home.compras":case"home.viewCompra":case"home.editCompra":$state.go("home.createCompra");break;case"home.ventas":case"home.viewVenta":case"home.editVenta":$state.go("home.createVenta");break;case"home.personal":case"home.viewPersona":case"home.editPersona":case"home.empleados":$state.go("home.createPersonal");break;case"home.pedidos":case"home.viewPedido":case"home.editPedido":$state.go("home.createPedido",$rootScope.estadoActualParams);break;case"home.finanzas":case"home.viewFinanza":$state.go("home.createFinanza",$rootScope.estadoActualParams);break;case"home.sucursales":$state.go("home.createSucursal");break;case"home.cajas":$state.go("home.createCaja");break;case"home.procesos":case"home.viewProceso":case"home.editProceso":$state.go("home.createProceso");break;case"home.procedimientos":case"home.viewProcedimiento":template="modules/procedimientos/views/create-procedimiento.client.view.html";break;case"home.editProcedimiento":template="modules/procedimientos/views/edit-procedimiento.client.view.html";break;case"home.rrhh":case"home.area":case"home.viewArea":case"home.editArea":$state.go("home.createArea");break;case"home.puesto":case"home.viewPuesto":case"home.editPuesto":$state.go("home.createPuesto");break;case"home.viewImpuesto":$state.go("home.createImpuesto");break;case"home.remuneraciones":case"home.viewRemuneracione":case"home.editRemuneracione":$state.go("home.createRemuneracione");break;case"home.listEmpleado":$state.go("home.createEmpleado");break;case"home.liquidaciones":$state.go("home.createLiquidacion",{empleadoId:$rootScope.empleadoId});break;case"home.actividades":$state.go("home.actividades");break;default:template=""}""===template||$mdBottomSheet.show({templateUrl:template,targetEvent:$event}).then(function(clickedItem){})},$scope.backButtom=function($event){if(void 0!==$stateParams.back&&void 0!==$stateParams.tipo)$rootScope.estadoActualParams.tipo=$stateParams.tipo,$state.go($stateParams.back,$rootScope.estadoActualParams);else{if("home.viewProduct"==$rootScope.estadoActual||"home.editProduct"==$rootScope.estadoActual)if(void 0!==$rootScope.tipoProducto)switch($rootScope.tipoProducto){case"p":$rootScope.estadoActualParams.tipo="p";break;case"m":$rootScope.estadoActualParams.tipo="m";break;case"i":$rootScope.estadoActualParams.tipo="i"}else console.log("[+] rootScope.tipoProducto es indefinido");else if("home.viewPedido"==$rootScope.estadoActual||"home.editPedido"==$rootScope.estadoActual){if(void 0!==$rootScope.tipoPedido)switch($rootScope.tipoPedido){case"venta":$rootScope.estadoActualParams.tipo="venta";break;case"compra":$rootScope.estadoActualParams.tipo="compra"}}else if(("home.viewFinanza"==$rootScope.estadoActual||"home.editFinanza"==$rootScope.estadoActual)&&void 0!==$rootScope.tipoFinanza)switch($rootScope.tipoFinanza){case"debe":$rootScope.estadoActualParams.tipo="debe";break;case"haber":$rootScope.estadoActualParams.tipo="haber"}$state.go($rootScope.prevState,$rootScope.estadoActualParams)}},$scope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){switch(to.name){case"home.createPedido":if($rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,void 0!==toParams.tipo){var tipo=toParams.tipo.charAt(0).toUpperCase()+toParams.tipo.slice(1);$rootScope.tituloActual=to.titulo+" De "+tipo}else $rootScope.tituloActual=to.titulo;"cliente"===$scope.authentication.user.roles[0]&&($rootScope.tituloActual="Nuevo Pedido"),$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.pedidos":if($rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,void 0!==toParams.tipo){tipo=toParams.tipo.charAt(0).toUpperCase()+toParams.tipo.slice(1);$rootScope.tituloActual="Compra"==tipo?"Compras":"Ventas","cliente"===$scope.authentication.user.roles[0]&&($rootScope.tituloActual="Pedidos")}else $rootScope.tituloActual=to.titulo;$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.finanzas":$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,void 0!==toParams.tipo?"debe"==toParams.tipo?$rootScope.tituloActual="Cuentas a pagar":$rootScope.tituloActual="Cuentas a cobrar":$rootScope.tituloActual=to.titulo,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.stock":$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,void 0!==toParams.tipo?"p"==toParams.tipo?$rootScope.tituloActual="Stock de Productos":$rootScope.tituloActual="Stock de Materias Primas":$rootScope.tituloActual=to.titulo,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton,console.log($rootScope.tituloActual);break;case"home.viewFinanza":"debe"==toParams.tipo?$rootScope.tituloActual="Cuentas a pagar":"haber"==toParams.tipo&&($rootScope.tituloActual="Cuentas a cobrar"),$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.products":"m"==toParams.tipo?$rootScope.tituloActual="Materia Prima":"i"==toParams.tipo?$rootScope.tituloActual="Insumos":"p"==toParams.tipo&&($rootScope.tituloActual="Productos"),$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.createProduct":"m"==toParams.tipo?$rootScope.tituloActual="Creacion De Materia Prima":"i"==toParams.tipo?$rootScope.tituloActual="Creacion De Insumo":"p"==toParams.tipo&&($rootScope.tituloActual="Creacion De Producto"),$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.viewProduct":"m"==toParams.tipo?$rootScope.tituloActual="Creacion De Materia Prima":"i"==toParams.tipo?$rootScope.tituloActual="Creacion De Insumo":"p"==toParams.tipo&&($rootScope.tituloActual="Producto"),$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;case"home.editProduct":"m"==fromParams.tipo?($rootScope.tituloActual="Editar Materia Prima",$rootScope.tipoProducto="m"):"i"==fromParams.tipo?($rootScope.tituloActual="Editar Insumo",$rootScope.tipoProducto="i"):"p"==fromParams.tipo&&($rootScope.tituloActual="Editar Producto",$rootScope.tipoProducto="p"),$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=fromParams,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton;break;default:$rootScope.tituloActual=to.titulo,$rootScope.estadoActual=to.name,$rootScope.estadoActualParams=toParams,$rootScope.prevState=to.prevState,$rootScope.newButton=to.newButton}}),$http({method:"GET",url:"/api/users/byId",params:{userId:$scope.authentication.user._id}}).then(function(response){null!==response.data.puesto&&void 0!==response.data.puesto&&Puestos.get({puestoId:response.data.puesto._id},function(res){$rootScope.puesto=res},function(err){})},function(response){console.log("error")}),$scope.showAdvancedArea=function(ev){ev.toElement.id;ShowAreaInfo.setArea($scope.puesto.area._id),$mdDialog.show({controller:AreaModalController,templateUrl:"/modules/areas/views/view-area.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.showDialog=function($event,item){angular.element(document.body);$mdDialog.show({parent:angular.element(document.body),targetEvent:$event,templateUrl:"modules/tareas/views/create-tarea.client.view.html",locals:{item:item,SEARCH:$scope.SEARCH},controller:DialogController}).then(function(answer){},function(){})},$scope.showDialogActividad=function($event){console.log($scope.authentication.user._id),$http.post("/api/empleados/user",{user:$scope.authentication.user._id}).then(function(empleado){$mdDialog.show({targetEvent:$event,templateUrl:"modules/actividades/views/create-actividad.client.view.html",locals:{item:empleado.data[0]},controller:ActividadDialogController})})},$rootScope.arrayTareas=[],$rootScope.arrayTareasAsignadas=[],$scope.findTareas=function(){$rootScope.arrayTareas=[],$rootScope.arrayTareasAsignadas=[],void 0!==$scope.SEARCH&&($scope.tareas=Tareas.query({e:$scope.SEARCH.enterprise}),$timeout(function(){$rootScope.arrayTareas=$filter("filter")($scope.tareas,function(item){return item.usuario._id===$scope.authentication.user._id&&!1===item.deleted}),$rootScope.arrayTareasAsignadas=$filter("filter")($scope.tareas,function(item){return item.user._id===$scope.authentication.user._id&&!1===item.deleted&&!1===item.forMe})},5e3))},$scope.findUsuarios=function(){void 0!==$scope.SEARCH&&($rootScope.usuarios=Users.query({e:$scope.SEARCH.enterprise}))},$scope.update=function(item){item.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.borrarRealizadas=function(n){if(1==n)for(var i in $rootScope.arrayTareas)1==$rootScope.arrayTareas[i].realizado&&($rootScope.arrayTareas[i].deleted=!0,$scope.update($rootScope.arrayTareas[i]),$rootScope.arrayTareas.splice(i,1));else for(var i in $rootScope.arrayTareasAsignadas)1==$rootScope.arrayTareasAsignadas[i].realizado&&($rootScope.arrayTareasAsignadas[i].deleted=!0,$scope.update($rootScope.arrayTareasAsignadas[i]),$rootScope.arrayTareasAsignadas.splice(i,1))}}]),angular.module("core").run(["$templateCache",function($templateCache){$templateCache.put("partials/menu-link.tmpl.html",'<md-button ui-sref-active="active" \n  ui-sref="{{section.state}}" ng-click="focusSection()">\n<ng-md-icon icon="{{section.icon}}" ng-if="section.icon"></ng-md-icon>\n  {{section | humanizeDoc}}\n  <span  class="md-visually-hidden "\n    ng-if="isSelected()">\n    current page\n  </span>\n</md-button>\n')}]),angular.module("core").directive("menuLink",[function(){return{scope:{section:"="},templateUrl:"partials/menu-link.tmpl.html",link:function($scope,$element){var controller=$element.parent().controller();$scope.focusSection=function(){controller.autoFocusContent=!0}}}}]),angular.module("core").run(["$templateCache",function($templateCache){$templateCache.put("partials/menu-toggle.tmpl.html",'<md-button class="md-button-toggle"\n  ng-click="toggle()"\n  aria-controls="docs-menu-{{section.name | nospace}}"\n  ng-class="{\'toggled\' : isOpen()}"\n  flex layout="row"\n  aria-expanded="{{isOpen()}}">\n  {{section.name}}\n  <ng-md-icon icon="keyboard_arrow_right" class=" pull-right md-toggle-icon"\n  ng-class="{\'toggled\' : isOpen()}"></ng-md-icon>\n</md-button>\n<ul ng-show="isOpen()" id="docs-menu-{{section.name | nospace}}" class="menu-toggle-list">\n  <li ng-repeat="page in section.pages">\n    <menu-link section="page"></menu-link>\n  </li>\n</ul>\n')}]),angular.module("core").directive("menuToggle",["$timeout",function($timeout){return{scope:{section:"="},templateUrl:"partials/menu-toggle.tmpl.html",link:function(scope,element){var controller=element.parent().controller();scope.isOpen=function(){return controller.isOpen(scope.section)},scope.toggle=function(){controller.toggleOpen(scope.section)};var parentNode=element[0].parentNode.parentNode.parentNode;if(parentNode.classList.contains("parent-list-item")){var heading=parentNode.querySelector("h2");console.log(element,"elemnt"),element[0].firstChild.setAttribute("aria-describedby",heading.id)}}}}]),angular.module("core").directive("panelWidget",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{title:"@",template:"@",options:"@"},template:'<section layout-margin class="md-whiteframe-5dp panel-widget">  <md-toolbar md-theme="custom" class="panel-widget-toolbar">    <div class="md-toolbar-tools">      <h3 class="panel-widget-tittle">{{title}}</h3>      <span flex></span>      <md-button ng-show="options" ng-click="$showOptions = !$showOptions" class="md-icon-button" aria-label="Show options">        <div style="padding-top:8px"><ng-md-icon icon="more_vert"></ng-md-icon></div>      </md-button>    </div>  </md-toolbar>  <div class="md-padding" ng-include="template"></div></section>',compile:function(element,attrs,linker){return function(scope,element){linker(scope,function(clone){element.append(clone)})}}}}),angular.module("core").filter("humanizeDoc",[function(){return function(doc){if(doc)return"directive"===doc.type?doc.name.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()}):doc.label||doc.name}}]),angular.module("core").filter("nospace",[function(){return function(value){return value?value.replace(/ /g,""):""}}]),angular.module("core").service("BottomSheetService",["$mdBottomSheet",function($mdBottomSheet){BottomSheetController.$inject=["$scope","buttons"];function BottomSheetController($scope,buttons){$scope.items=buttons,$scope.clickHandler=function(name){console.log("name"),console.log(name),$mdBottomSheet.hide(name)}}return{sheet:function($event,buttons,callback){!function($event,buttons,callback){$mdBottomSheet.show({controller:BottomSheetController,templateUrl:"/modules/core/views/dynamic-bottomsheet.html",targetEvent:$event,resolve:{buttons:function(){return buttons}}}).then(function(clickedItem){callback(null,clickedItem)},function(){console.log("rejected!!!"),callback("rejected")})}($event,buttons,callback)}}}]),angular.module("core").factory("Menu",["$location","$rootScope","Authentication","$timeout",function($location,$rootScope,Authentication,$timeout){var self,authentication=Authentication.user,sections=[],ventas_staff_menu={name:"Ventas",type:"toggle",state:"home.ventas",pages:[{name:"Venta por mostrador",state:"home.ventasMostrador",type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1},{name:"Nueva Venta",state:"home.createVenta",type:"link",icon:"add_circle_outline",adminOnly:!0,staffOnly:!1},{name:"Ventas",state:"home.ventas",type:"link",icon:"remove_red_eye",adminOnly:!0,staffOnly:!1},{name:"Nuevo Presupuesto",type:"link",state:'home.createPedido({ tipo: "venta" })',icon:"add"},{name:"Presupuestos",state:'home.pedidos({ tipo: "venta" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Productos",state:'home.products({tipo: "p"})',type:"link",icon:"store",adminOnly:!0,staffOnly:!1},{name:"Stock de Productos",state:'home.stock({tipo: "p"})',type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1},{name:"Clientes",state:"home.clients",type:"link",icon:"perm_contact_cal",adminOnly:!0,staffOnly:!1},{name:"Reportes",state:'home.reportes({ tipo: "venta"})',type:"link",icon:"insert_chart",adminOnly:!0,staffOnly:!1}]},compras_staff_menu={name:"Compras",type:"toggle",state:"home.compras",pages:[{name:"Nuevo Pedido",state:'home.createPedido({ tipo: "compra" })',type:"link",icon:"add",adminOnly:!0,staffOnly:!1},{name:"Nueva Compra",state:'home.createCompra({ tipo: "compra" })',type:"link",icon:"add_circle_outline",adminOnly:!0,staffOnly:!1},{name:"Solicitudes",state:'home.pedidos({ tipo: "compra" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Compras",state:"home.compras",type:"link",icon:"remove_red_eye",adminOnly:!0,staffOnly:!1},{name:"Proveedores",state:"home.providers",type:"link",icon:"local_shipping",adminOnly:!0,staffOnly:!1},{name:"Materia Prima",state:'home.products({tipo: "m"})',type:"link",icon:"grain",adminOnly:!0,staffOnly:!1},{name:"Insumos",state:'home.products({tipo: "i"})',type:"link",icon:"gesture",adminOnly:!0,staffOnly:!1},{name:"Reportes",state:'home.reportes({ tipo: "compra"})',type:"link",icon:"insert_chart",adminOnly:!0,staffOnly:!1}]},compras_user_menu={name:"Compras",type:"toggle",state:"home.compras",pages:[{name:"Nuevo Pedido",state:'home.createPedido({ tipo: "compra" })',type:"link",icon:"add",adminOnly:!0,staffOnly:!1},{name:"Nueva Compra",state:'home.createCompra({ tipo: "compra" })',type:"link",icon:"add_circle_outline",adminOnly:!0,staffOnly:!1},{name:"Solicitudes",state:'home.pedidos({ tipo: "compra" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Compras",state:"home.compras",type:"link",icon:"remove_red_eye",adminOnly:!0,staffOnly:!1},{name:"Proveedores",state:"home.providers",type:"link",icon:"local_shipping",adminOnly:!0,staffOnly:!1},{name:"Materia Prima",state:'home.products({tipo: "m"})',type:"link",icon:"grain",adminOnly:!0,staffOnly:!1},{name:"Insumos",state:'home.products({tipo: "i"})',type:"link",icon:"gesture",adminOnly:!0,staffOnly:!1},{name:"Stock de Materias Primas",state:'home.stock({tipo: "m"})',type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1}]},ventas_user_menu={name:"Ventas",type:"toggle",state:"home.ventas",pages:[{name:"Venta por mostrador",state:"home.ventasMostrador",type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1},{name:"Nueva Venta",state:"home.createVenta",type:"link",icon:"add_circle_outline",adminOnly:!0,staffOnly:!1},{name:"Nuevo Presupuesto",type:"link",state:'home.createPedido({ tipo: "venta" })',icon:"add"},{name:"Presupuestos",state:'home.pedidos({ tipo: "venta" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Ventas",state:"home.ventas",type:"link",icon:"remove_red_eye"},{name:"Consultar Stock",state:'home.stock({tipo: "p"})',type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1}]},produccion_menu={name:"Produccion",type:"toggle",state:"home.produccion",pages:[{name:"Nueva Solicitud",type:"link",state:'home.createPedido({ tipo: "compra" })',icon:"add"},{name:"Solicitudes",state:'home.pedidos({ tipo: "compra" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Stock de Materias Primas",state:'home.stock({tipo: "m"})',type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1},{name:"Productos y Fórmulas",state:'home.products({tipo: "p"})',type:"link",icon:"store",adminOnly:!0,staffOnly:!1},{name:"Costos Indirectos",state:"home.listcentroDeCosto",type:"link",icon:"select_all",adminOnly:!0,staffOnly:!1}]},produccion_user_menu={name:"Produccion",type:"toggle",state:"home.produccion",pages:[{name:"Nueva Solicitud",type:"link",state:'home.createPedido({ tipo: "compra" })',icon:"add"},{name:"Solicitudes",state:'home.pedidos({ tipo: "compra" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Stock de Materias Primas",state:'home.stock({tipo: "m"})',type:"link",icon:"dashboard",adminOnly:!0,staffOnly:!1}]},finanzas_menu={name:"Finanzas",state:"home.finanzas",type:"toggle",icon:"account_circle",adminOnly:!0,staffOnly:!1,pages:[{name:"Tesoreria",state:"home.sucursales",type:"link",icon:"account_balance",adminOnly:!0,staffOnly:!1},{name:"Cuentas a pagar",state:'home.finanzas({ tipo: "debe" })',type:"link",icon:"trending_down",adminOnly:!0,staffOnly:!1},{name:"Cuentas a cobrar",state:'home.finanzas({ tipo: "haber" })',type:"link",icon:"trending_up",adminOnly:!0,staffOnly:!1},{name:"Resumen económico",state:"home.resumenList",type:"link",icon:"dashboard"}]},finanzas_user_menu={name:"Finanzas",state:"home.finanzas",type:"toggle",icon:"account_circle",adminOnly:!0,staffOnly:!1,pages:[{name:"Tesoreria",state:"home.sucursales",type:"link",icon:"store",adminOnly:!0,staffOnly:!1},{name:"Cuentas a pagar",state:'home.finanzas({ tipo: "debe" })',type:"link",icon:"trending_down",adminOnly:!0,staffOnly:!1},{name:"Cuentas a cobrar",state:'home.finanzas({ tipo: "haber" })',type:"link",icon:"trending_up",adminOnly:!0,staffOnly:!1}]},rrhh_menu={name:"RRHH",state:"home.rrhh",type:"toggle",icon:"account_circle",adminOnly:!0,staffOnly:!1,pages:[{name:"Organigrama",type:"link",state:"home.rrhh",icon:"location_city",adminOnly:!0,staffOnly:!1},{name:"Areas",type:"link",state:"home.area",icon:"view_agenda",adminOnly:!0,staffOnly:!1},{name:"Puestos",type:"link",state:"home.puesto",icon:"recent_actors",adminOnly:!0,staffOnly:!1},{name:"Procesos y Manuales",state:"home.procesos",type:"link",icon:"settings"},{name:"Personal",type:"link",state:"home.empleados",icon:"people"},{name:"Remuneraciones",type:"link",state:"home.remuneraciones",icon:"folder_shared"}]},rrhh_user_menu={name:"RRHH",state:"home.rrhh",type:"toggle",icon:"account_circle",adminOnly:!0,staffOnly:!1,pages:[{name:"Organigrama",type:"link",state:"home.rrhh",icon:"location_city",adminOnly:!0,staffOnly:!1},{name:"Areas",type:"link",state:"home.area",icon:"view_agenda",adminOnly:!0,staffOnly:!1},{name:"Puestos",type:"link",state:"home.puesto",icon:"recent_actors",adminOnly:!0,staffOnly:!1},{name:"Procesos y Manuales",state:"home.procesos",type:"link",icon:"settings"}]},impuestos_menu={name:"Impuestos",state:"home.impuestos",type:"toggle",icon:"gavel",pages:[{name:"Impuestos",type:"link",state:"home.impuestos",icon:"local_atm",adminOnly:!1,staffOnly:!1}]},config_groso_staff_menu={name:"Torre de Control",type:"toggle",pages:[{name:"Mi Empresa",type:"link",state:"home.enterprises",icon:"business"},{name:"Usuarios",state:"home.personal",type:"link",icon:"group_add",adminOnly:!0,staffOnly:!1},{name:"Comprobantes",state:"home.comprobantes",type:"link",icon:"view_list"},{name:"Condiciones de IVA",state:"home.taxConditions",type:"link",icon:"view_list"},{name:"Condiciones de Pago",state:"home.condicionVentas",type:"link",icon:"receipt"},{name:"UENs",type:"link",state:"home.subs",icon:"panorama_fisheye",adminOnly:!0,staffOnly:!1},{name:"Categorías",state:"home.categories",type:"link",icon:"apps",adminOnly:!0,staffOnly:!1},{name:"Contactos",state:"home.contacts",type:"link",icon:"person",adminOnly:!0,staffOnly:!1},{name:"Centros de Costo",state:"home.costcenters",type:"link",icon:"view_list",adminOnly:!0,staffOnly:!1}]},config_admin_staff_menu={name:"Torre de Control",type:"toggle",pages:[{name:"Usuarios",state:"home.personal",type:"link",icon:"group_add",adminOnly:!0,staffOnly:!1},{name:"UENs",type:"link",state:"home.subs",icon:"panorama_fisheye",adminOnly:!0,staffOnly:!1},{name:"Categorías",state:"home.categories",type:"link",icon:"apps",adminOnly:!0,staffOnly:!1},{name:"Contactos",state:"home.contacts",type:"link",icon:"person",adminOnly:!0,staffOnly:!1},{name:"Centros de Costo",state:"home.costcenters",type:"link",icon:"view_list",adminOnly:!0,staffOnly:!1}]},cliente_user_menu={name:"Pedidos",type:"toggle",state:"home.pedidos",pages:[{name:"Nuevo Pedido",type:"link",state:'home.createPedido({ tipo: "venta" })',icon:"add"},{name:"Pedidos",state:'home.pedidos({ tipo: "venta" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1},{name:"Lista de Precios",state:'home.products({tipo: "p"})',type:"link",icon:"style",adminOnly:!0,staffOnly:!1}]},presupuestos_menu={name:"Ventas",type:"toggle",state:"home.ventas",pages:[{name:"Nuevo Presupuesto",type:"link",state:'home.createPedido({ tipo: "venta" })',icon:"add"},{name:"Presupuestos",state:'home.pedidos({ tipo: "venta" })',type:"link",icon:"assignment",adminOnly:!0,staffOnly:!1}]};return $timeout(function(){if(""!==authentication)switch(authentication.roles[0]){case"groso":sections.push(ventas_staff_menu),sections.push(compras_staff_menu),sections.push(produccion_menu),sections.push(rrhh_menu),sections.push(impuestos_menu),sections.push(finanzas_menu),sections.push(config_groso_staff_menu);break;case"admin":sections.push(ventas_staff_menu),sections.push(compras_staff_menu),sections.push(produccion_menu),sections.push(rrhh_menu),sections.push(impuestos_menu),sections.push(finanzas_menu),sections.push(config_admin_staff_menu);break;case"user":sections.push(ventas_user_menu),sections.push(compras_user_menu),sections.push(rrhh_user_menu),sections.push(impuestos_menu),sections.push(finanzas_user_menu);break;case"rrhh":sections.push(rrhh_menu);break;case"compras":sections.push(compras_user_menu);break;case"ventas":sections.push(ventas_user_menu);break;case"produccion":sections.push(presupuestos_menu),sections.push(produccion_user_menu);break;case"cliente":sections.push(cliente_user_menu)}},500),self={sections:sections,toggleSelectSection:function(section){self.openedSection=self.openedSection===section?null:section},isSectionSelected:function(section){return self.openedSection===section},sectionSelected:function(){return self.openedSection},selectPage:function(section,page){page&&page.url&&$location.path(page.url),self.currentSection=section,self.currentPage=page}}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,options){return options=options||{},this.menus[menuId]={isPublic:null===options.isPublic||void 0===options.isPublic||options.isPublic,roles:options.roles||this.defaultRoles,items:options.items||[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,options){if(options=options||{},this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:options.title||"",state:options.state||"",type:options.type||"item",class:options.class,isPublic:null===options.isPublic||void 0===options.isPublic?this.menus[menuId].isPublic:options.isPublic,roles:null===options.roles||void 0===options.roles?this.menus[menuId].roles:options.roles,position:options.position||0,items:[],shouldRender:shouldRender}),options.items)for(var i in options.items)this.addSubMenuItem(menuId,options.link,options.items[i]);return this.menus[menuId]},this.addSubMenuItem=function(menuId,parentItemState,options){for(var itemIndex in options=options||{},this.validateMenuExistance(menuId),this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===parentItemState&&this.menus[menuId].items[itemIndex].items.push({title:options.title||"",state:options.state||"",isPublic:null===options.isPublic||void 0===options.isPublic?this.menus[menuId].items[itemIndex].isPublic:options.isPublic,roles:null===options.roles||void 0===options.roles?this.menus[menuId].items[itemIndex].roles:options.roles,position:options.position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){for(var itemIndex in this.validateMenuExistance(menuId),this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){for(var itemIndex in this.validateMenuExistance(menuId),this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",{isPublic:!1})}]),angular.module("core").service("Socket",["Authentication","$state","$timeout",function(Authentication,$state,$timeout){Authentication.user?this.socket=io({transports:["websocket"]}):$state.go("home"),this.on=function(eventName,callback){this.socket&&this.socket.on(eventName,function(data){$timeout(function(){callback(data)})})},this.emit=function(eventName,data){this.socket&&this.socket.emit(eventName,data)},this.removeListener=function(eventName){this.socket&&this.socket.removeListener(eventName)}}]),angular.module("costcenters").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Costcenters",state:"costcenters",type:"dropdown"}),Menus.addSubMenuItem("topbar","costcenters",{title:"List Costcenters",state:"costcenters.list"}),Menus.addSubMenuItem("topbar","costcenters",{title:"Create Costcenter",state:"costcenters.create"})}]),angular.module("costcenters").config(["$stateProvider",function($stateProvider){$stateProvider.state("costcenters",{abstract:!0,url:"/costcenters",template:"<ui-view/>"}).state("costcenters.list",{url:"",templateUrl:"modules/costcenters/views/list-costcenters.client.view.html"}).state("costcenters.create",{url:"/create",templateUrl:"modules/costcenters/views/create-costcenter.client.view.html"}).state("costcenters.view",{url:"/:costcenterId",templateUrl:"modules/costcenters/views/view-costcenter.client.view.html"}).state("costcenters.edit",{url:"/:costcenterId/edit",templateUrl:"modules/costcenters/views/edit-costcenter.client.view.html"})}]),angular.module("costcenters").controller("CostcentersController",["$scope","$rootScope","$stateParams","$location","Authentication","Costcenters","Enterprises","$mdBottomSheet","$mdDialog","Categories","$filter","Impuestos",function($scope,$rootScope,$stateParams,$location,Authentication,Costcenters,Enterprises,$mdBottomSheet,$mdDialog,Categories,$filter,Impuestos){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var costcenter=new Costcenters({name:this.name,description:this.description,category1:this.category1.id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});costcenter.$save(function(response){if(response._id){var impuestoCompras=new Impuestos({name:"IVA Compras",type:"Default",total:0,centroDeCosto:response._id,month:(new Date).getMonth(),year:(new Date).getFullYear()}),impuestoVentas=new Impuestos({name:"IVA Ventas",type:"Default",total:0,centroDeCosto:response._id,month:(new Date).getMonth(),year:(new Date).getFullYear()});impuestoCompras.$save(function(response){console.log("Compras"),console.log(response)},function(errorResponse){$scope.error=errorResponse.data.message}),impuestoVentas.$save(function(response){console.log("Ventas"),console.log(response)},function(errorResponse){$scope.error=errorResponse.data.message}),costcenter._id=response._id,$rootScope.costcenters.unshift(costcenter)}$scope.name="",$scope.description="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Centro de Costo").content("¿Está seguro que desea eliminar este centro de costo?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(costcenter){if(costcenter)for(var i in costcenter.$remove(),$scope.costcenters)$scope.costcenters[i]===costcenter&&$scope.costcenters.splice(i,1);else $scope.costcenter.$remove(function(){$location.path("costcenters")})},$scope.update=function(){var costcenter=$scope.costcenter;void 0!==this.enterprise?costcenter.enterprise=this.enterprise._id:costcenter.enterprise=costcenter.enterprise._id,void 0!==this.category?costcenter.category=this.category.value:void 0!==costcenter.category&&null!==costcenter.category&&(costcenter.category=costcenter.category),void 0!==this.category1?costcenter.category1=this.category1.id:void 0!==costcenter.category1&&null!==costcenter.category1&&(costcenter.category1=costcenter.category1),costcenter.$update(function(){$location.path("centros-costo")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.costcenters=Costcenters.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=[{name:"Activo",value:"activo"},{name:"Pasivo",value:"pasivo"},{name:"Patrimonio Neto",value:"patrimonio neto"},{name:"Negativo",value:"negativo"},{name:"Ganancia",value:"ganancia"}])},$scope.findCategories2=function(){Categories.query({e:$scope.SEARCH.enterprise},function(data){$scope.categories2=$filter("filter")(data,function(item){return"Centro de Costo"===item.type1})})},$scope.findOne=function(){$scope.costcenter=Costcenters.get({costcenterId:$stateParams.costcenterId}),Categories.query({},function(data){$scope.relatedCategory=$filter("filter")(data,function(item){return item.id===$scope.costcenter.category1})[0]})}}]),angular.module("costcenters").factory("Costcenters",["$resource",function($resource){return $resource("api/costcenters/:costcenterId",{costcenterId:"@_id"},{update:{method:"PUT"}})}]),angular.module("costosindirectos").config(["$stateProvider",function($stateProvider){$stateProvider.state("costosindirectos",{abstract:!0,url:"/costosindirectos",template:"<ui-view/>"}).state("costosindirectos.list",{url:"",templateUrl:"modules/costosindirectos/client/views/list-costosindirectos.client.view.html"}).state("costosindirectos.create",{url:"/create",templateUrl:"modules/costosindirectos/client/views/form-costosindirecto.client.view.html"}).state("costosindirectos.view",{url:"/:costosindirectoId",templateUrl:"modules/costosindirectos/client/views/view-costosindirecto.client.view.html"}).state("costosindirectos.edit",{url:"/:costosindirectoId/edit",templateUrl:"modules/costosindirectos/client/views/form-costosindirecto.client.view.html"})}]),angular.module("costosindirectos").controller("CostocentersListController",["$rootScope","$location","user","$scope","centrodecosto","PagosService","ServiceNavigation","FacturaService",function($rootScope,$location,user,$scope,centrodecosto,PagosService,ServiceNavigation,FacturaService){var pickedMonth,pickedYear;this.user=user,this.searchCostosIndirectos=function(){var pos=JSON.parse(localStorage.getItem("month"))?$scope.monthList.map(function(x){return x.name}).indexOf(JSON.parse(localStorage.getItem("month")).monthName):null;if(pickedMonth=-1!==pos&&null!==pos?$scope.monthList[pos].id:(new Date).getMonth(),pickedYear=JSON.parse(localStorage.getItem("year"))?JSON.parse(localStorage.getItem("year")).yearName:(new Date).getFullYear(),$scope.year=pickedYear,$scope.month=pickedMonth,""!=$scope.year||""!=$scope.month){var data=PagosService.query({year:$scope.year,month:$scope.month,e:user.enterprise._id});window.localStorage.setItem("search_postos",JSON.stringify({year:$scope.year,month:$scope.month.toString()})),$scope.centrodecosto=data}},ServiceNavigation.navInit(),$scope.getName=function(name,id){ServiceNavigation.addNav({name:name,id:id}),$rootScope.$broadcast("nav change",!0),localStorage.setItem("centrodecosto",JSON.stringify({costoName:name,costosId:id}))},$scope.$watchCollection("year",function(newVal,oldval){localStorage.setItem("year",JSON.stringify({yearName:newVal}))}),$scope.$watchCollection("month",function(newVal,oldval){var elemPos=$scope.monthList.map(function(x){return x.id}).indexOf(newVal);localStorage.setItem("month",JSON.stringify({monthName:$scope.monthList[elemPos].name,monthId:$scope.monthList[elemPos].id}))}),$scope.monthList=[{id:"all",name:"Ninguno"},{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}];var currYear=(new Date).getFullYear();this.searchCostosIndirectos(),$scope.yearList=["2016","2017",currYear]}]),angular.module("costosindirectos").controller("CostosIndirectosCreateController",["$location","user","$mdDialog","CostosindirectosService","$state",function($location,user,$mdDialog,costosindirectosService,$state){var centroId=localStorage.getItem("centroId");console.log(centroId),this.user=user,this.create=function(){new costosindirectosService({name:this.name,descripcion:this.descripcion?this.descripcion:void 0,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id,costcenters:centroId}).$save(function(response){response._id&&$state.go("home.costosIndirectos",{centroId:centroId})},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("costosindirectos").controller("CostosIndirectosViewController",["$rootScope","user","$mdDialog","Socket","ServiciosService","PagosService","costosindirectos","serviciosService","cajas","serviciosLastMonthTotal","ServiceNavigation","$location",function($rootScope,user,$mdDialog,Socket,ServiciosService,PagosService,costosindirectos,serviciosService,cajas,serviciosLastMonthTotal,ServiceNavigation,$location){DialogController.$inject=["$scope","$mdDialog","item","user","PagosService","Arqueos","$filter","$location","Socket","ServiciosService","Costcenters","Cajas","CostosindirectosService"],this.user=user,this.costo=!0,this.showDialog=showDialog,this.costosindirectos=costosindirectos,this.serviciosService=serviciosService,this.serviciosLastMonthTotal=serviciosLastMonthTotal,this.openMenu=function($mdOpenMenu,ev){ev,$mdOpenMenu(ev)},this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Â¿Eliminar la servicios?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){item?(item.deleted=!0,PagosService.query({servicosId:item._id},function(pagos){for(var i in pagos)pagos[i].deleted=!0,pagos[i].$update()}),item.$update(function(){for(var i in serviciosService)serviciosService[i]===item&&(serviciosService[i].deleted=!0)},function(errorResponse){console.log("error")})):serviciosService.$remove(function(){})}(item)},function(){})},this.serviciosIDArray=[],this.cajas=cajas,this.editing=!1,this.editingServicios=function(item){this.editing=item},this.editServicios=function(item){for(var i in this.editing=!1,item.enterprise=item.enterprise._id,item.puestos)item.puestos[i]=item.puestos[i]._id;console.log(item),item.$update(function(){console.log("todo ok")},function(errorResponse){console.log("error")})},this.selectedMode="md-scale",this.selectedDirection="up",this.showDialog=showDialog,this.showDialogPago=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/create-pago.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.findCostosIndirectos=function(serviciosService){"admin"!==this.user.roles[0]&&"groso"!==this.user.roles[0]?ServiciosService.$promise.then(angular.bind(this,function(data){for(var i in data)this.serviciosIDArray.push(data[i])})):(console.log(serviciosService),this.serviciosIDArray=serviciosService)},this.showDialogFactura=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/costosindirectos/views/create-factura.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.findFromArray=function(array,object){if(!array)return!1;if(!object)return!1;var checker=!1;return array.forEach(function(entry){entry._id===object._id&&(checker=!0)}),checker},void 0!==localStorage.getItem("centroId")&&(this.centroId=localStorage.getItem("centroId")),this.findCostosIndirectos(serviciosService),$rootScope.$broadcast("nav change",!0),this.removeSubNav=function(){ServiceNavigation.back(),$rootScope.$broadcast("nav change",!0)};var getMonth=JSON.parse(localStorage.getItem("month")),getYear=JSON.parse(localStorage.getItem("year"));function showDialog($event,item){var parentEl=angular.element(document.body);$mdDialog.show({parent:parentEl,targetEvent:$event,templateUrl:"modules/servicios/views/create-servicio.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})}function DialogController($scope,$mdDialog,item,user,PagosService,Arqueos,$filter,$location,Socket,ServiciosService,Costcenters,Cajas,CostosindirectosService){$scope.apagarBoton=!1,$scope.$watchCollection("ServiciosService",function(){$scope.findServicios(),$scope.findServiciosTotal(),$scope.findPago()}),$scope.$watchCollection("Cajas",function(){$scope.findCajas()});var facturaDate,facturaMonth,facturaYear,pagoDate,pagoMonth,pagoYear,subNav=ServiceNavigation.getNav();subNav&&($scope.costosName=subNav.length>0?subNav[subNav.length-1].name:"Factura"),$scope.facturaDate=new Date,$scope.pagoDate=new Date,$scope.mostrar=!0,$scope.$watchCollection("facturaDate",function(newVal,oldVal){newVal?(facturaDate=new Date($scope.facturaDate),facturaMonth=facturaDate.getMonth(),facturaYear=facturaDate.getFullYear()):(facturaDate=new Date($scope.facturaDate),facturaMonth=getMonth.monthId,facturaYear=getYear.yearName)}),$scope.$watchCollection("pagoDate",function(newVal,oldVal){newVal?(pagoDate=new Date($scope.pagoDate),pagoMonth=pagoDate.getMonth(),pagoYear=pagoDate.getFullYear()):(pagoDate=new Date($scope.pagoDate),pagoMonth=getMonth.monthId,pagoYear=getYear.yearName)}),$scope.item=item,$scope.costCenterAgregados=[],$scope.montoE=0,$scope.montoC=0,$scope.pagosAcumulados=item.pagosAcumulados,$scope.errorCaja=void 0,$scope.findCajas=function(){Cajas.query({e:user.enterprise._id},function(data){$scope.cajas=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.findCostCenter=function(){Costcenters.query({e:user.enterprise._id},function(data){if($scope.costcenters=data,JSON.parse(localStorage.getItem("centrodecosto"))){var costName=JSON.parse(localStorage.getItem("centrodecosto")).costoName,elemPos=$scope.costcenters.map(function(x){return x.name}).indexOf(costName);-1!==elemPos&&$scope.agregarCostCenter($scope.costcenters[elemPos])}})},$scope.findCostCenter(),$scope.closeDialog=function(){$mdDialog.hide()},$scope.findServicios=function(){ServiciosService.query({e:user.enterprise._id},function(data){$scope.servicios=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.serviciosIDArray=[],$scope.findServiciosTotal=function(){$scope.serviciosTotal=ServiciosService.query({e:user.enterprise._id})},$scope.findPago=function(){$scope.pagos=PagosService.query({e:user.enterprise._id})},$scope.createServicio=function($event){$scope.apagarBoton=!0;$scope.serviciosTotal.length;var servicios={name:this.name,descripcion:this.descripcion,costcenters:$scope.costCenterAgregados,costosindirectos:$scope.item._id,enterprise:user.enterprise._id},costosindirectosService=$scope.item;costosindirectosService.enterprise=costosindirectosService.enterprise._id,Socket.emit("servicios.create",servicios),$mdDialog.hide(),ServiciosService.query({e:user.enterprise._id},function(data){for(var i in data)data[i].costosindirectos==$scope.item._id&&0==data[i].deleted&&$scope.serviciosIDArray.push(data[i]._id);costosindirectosService.servicio=$scope.serviciosIDArray,costosindirectosService.$update(function(){console.log("costos indirectos ok")},function(errorResponse){console.log("costos indirectos error")})})},$scope.agregarCostCenter=function(puesto){var ok=!1;if(void 0!==puesto&&null!==puesto){for(var i in $scope.costCenterAgregados)if($scope.costCenterAgregados[i]._id===puesto._id)ok=!0;ok||$scope.costCenterAgregados.push(puesto)}},$scope.createFactura=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode){var navList=ServiceNavigation.getNav(),t1=navList[0]?navList[0].name:localStorage.getItem("p2storage")[0].name,t2=navList[1]?navList[1].name:localStorage.getItem("p2storage")[1].name,t2Id=navList[1]?navList[1].id:localStorage.getItem("p2storage")[1].id,centroId=JSON.parse(localStorage.getItem("centrodecosto")).costosId;facturaDate=new Date($scope.facturaDate),facturaMonth=facturaDate.getMonth(),facturaYear=facturaDate.getFullYear();var actualBill,factura={title1:t1,title2:t2,title2Id:t2Id,numero:$scope.numero,centroId:centroId,servicios:item._id,serviceName:item.name,montoE:$scope.montoE,facturaDate:facturaDate,month:facturaMonth,year:facturaYear,observaciones:$scope.observaciones,enterprise:user.enterprise._id,type:"costosIndirectos"};CostosindirectosService.get({costosindirectoId:item.costosindirectos},function(costo){actualBill=$scope.montoE,item.facturado||(item.facturado=0);var yeartype="number"==typeof getYear.yearName?facturaYear:facturaYear.toString();getMonth.monthId===facturaMonth&&getYear.yearName===yeartype&&(item.facturado+=actualBill),factura._id=item.costosindirectos,factura.isFactura=!0,factura.total=item.facturado,console.log(factura),CostosindirectosService.update(factura,function(){console.log("costo ok")},function(errorResponse){console.log("costo error")})}),$mdDialog.hide()}},$scope.createPago=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){$scope.apagarBoton=!0;var yeartype="number"==typeof getYear.yearName?pagoYear:pagoYear.toString();getMonth.monthId===pagoMonth&&getYear.yearName===yeartype&&($scope.caja.total-($scope.montoE+$scope.montoC),item.facturado-$scope.montoE,item.pagoAcumulados+=$scope.montoE);var numero=$scope.pagos.length+1;pagoDate=new Date($scope.pagoDate),pagoMonth=pagoDate.getMonth(),pagoYear=pagoDate.getFullYear();var pago={numero:numero,servicios:item._id,cajaD:$scope.caja._id,montoE:$scope.montoE,montoC:$scope.montoC,pagoDate:pagoDate,month:pagoMonth,year:pagoYear,saldo:null,observaciones:$scope.observaciones,enterprise:user.enterprise._id,facturado:item.facturado,type:"costosIndirectos"};Socket.emit("pago.create",pago);var total=0;CostosindirectosService.get({costosindirectoId:item.costosindirectos},function(costo){total=costo.total+$scope.montoE+$scope.montoC,CostosindirectosService.update({_id:item.costosindirectos,total:total},function(){console.log("costo ok")},function(errorResponse){console.log("costo error")})}),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja origin"},$scope.pagosAcumulados=item.pagoAcumulados,$scope.addPagoAcumulados=function(value){$scope.errorCaja=!1,console.log($scope.caja),$scope.caja?$scope.caja.efectivo>=value?($scope.montoE=value,$scope.pagosAcumulados=item.pagoAcumulados+$scope.montoC+$scope.montoE):$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"},$scope.addCheque=function(value){$scope.errorCaja=!1,$scope.caja?$scope.caja.cheques>=value?($scope.montoC=value,$scope.pagosAcumulados=item.pagoAcumulados+$scope.montoC+$scope.montoE):$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"}}$rootScope.getPeriod=getMonth.monthName+", "+getYear.yearName,2===ServiceNavigation.getNav().length&&localStorage.setItem("p2storage",ServiceNavigation.getNav()),Socket.on("costosindirecto.update",angular.bind(this,function(message){message.enterprise===this.user.enterprise.enterprise&&(this.serviciosService=ServiciosService.query({e:this.user.enterprise.enterprise}).$promise.then(angular.bind(this,function(data){this.findCostosIndirectos(data)})))}))}]),angular.module("costosindirectos").controller("CostosindirectosListController",["$location","user","$mdDialog","costosindirectosService","$state","enterprises","$scope","PagosService","CostosindirectosService","costosLastMonthTotal","ServiciosService","ServiceNavigation","$rootScope",function($location,user,$mdDialog,costosindirectosService,$state,enterprises,$scope,PagosService,CostosindirectosService,costosLastMonthTotal,ServiciosService,ServiceNavigation,$rootScope){this.user=user,$scope.costosindirectosService=costosindirectosService,this.enterprises=enterprises,this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la Costos Indirectos?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){if(item){for(var i in item.deleted=!0,(item=new CostosindirectosService(item)).isCostosUpdate=!0,item.$update(),$scope.costosindirectosService)$scope.costosindirectosService[i]._id===item._id&&($scope.costosindirectosService[i].deleted=!0);ServiciosService.query({},function(servicios){for(var i in servicios)servicios[i].costosindirectos==item._id&&(servicios[i].deleted=!0,servicios[i].$update(),PagosService.query({servicosId:servicios[i]._id},function(pagos){for(var j in pagos)pagos[j].deleted=!0,pagos[j].$update()}))})}else $scope.costosindirectosService.$remove(function(){})}(item)},function(){})},this.editingCaja=function(item){this.editing=item},this.lastMonthTotal=costosLastMonthTotal,this.editCostosindirectos=function(item){this.editing=!1,(item=new CostosindirectosService(item)).enterprise=item.enterprise._id,item.$update(function(){console.log("todo ok")},function(errorResponse){console.log("error")})},this.getName=function(name,id){ServiceNavigation.addNav({name:name,id:id}),$rootScope.$broadcast("nav change",!0)},this.removeSubNav=function(){ServiceNavigation.back(),$rootScope.$broadcast("nav change",!0)},this.getServiceId=function(id,name){$rootScope.serviceInfo={id:id,name:name}};var getMonth=JSON.parse(localStorage.getItem("month")),getYear=JSON.parse(localStorage.getItem("year"));$rootScope.getPeriod=getMonth.monthName+", "+getYear.yearName}]),function(){function CostosindirectosController($scope,$state,$window,Authentication,costosindirecto){var vm=this;vm.authentication=Authentication,vm.costosindirecto=costosindirecto,vm.error=null,vm.form={},vm.remove=function(){$window.confirm("Are you sure you want to delete?")&&vm.costosindirecto.$remove($state.go("costosindirectos.list"))},vm.save=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","vm.form.costosindirectoForm"),!1;vm.costosindirecto._id?vm.costosindirecto.$update(successCallback,errorCallback):vm.costosindirecto.$save(successCallback,errorCallback);function successCallback(res){$state.go("costosindirectos.view",{costosindirectoId:res._id})}function errorCallback(res){vm.error=res.data.message}}}angular.module("costosindirectos").controller("CostosindirectosController",CostosindirectosController),CostosindirectosController.$inject=["$scope","$state","$window","Authentication","costosindirectoResolve"]}(),angular.module("costosindirectos").factory("CostosindirectosService",["$resource",function($resource){return $resource("api/costosindirectos/:costosindirectoId",{costosindirectoId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]).factory("ServiceNavigation",["$location",function($location){var inneNavList=[];return{addNav:function(navObj){inneNavList.length>0?-1===inneNavList.map(function(x){return x.name}).indexOf(navObj.name)&&inneNavList.push(navObj):inneNavList.push(navObj),window.localStorage.setItem("subNav",JSON.stringify(inneNavList))},getNav:function(){return inneNavList.length>0?inneNavList:JSON.parse(window.localStorage.getItem("subNav"))},navInit:function(val){inneNavList.splice(0),window.localStorage.removeItem("subNav")},back:function(){window.localStorage.getItem("subNav")&&(inneNavList=JSON.parse(window.localStorage.getItem("subNav")),window.localStorage.removeItem("subNav")),inneNavList.splice(inneNavList.length-1,1),window.localStorage.setItem("subNav",JSON.stringify(inneNavList))}}}]).factory("FacturaService",["$resource",function($resource){return $resource("api/factura/:costosindirectoId")}]),function(){function routeConfig($stateProvider){$stateProvider.state("empleados",{abstract:!0,url:"/empleados",template:"<ui-view/>"}).state("empleados.create",{url:"/create",templateUrl:"modules/empleados/client/views/form-empleado.client.view.html",controller:"EmpleadosController",controllerAs:"vm",resolve:{empleadoResolve:newEmpleado},data:{roles:["user","admin"],pageTitle:"Empleados Create"}}).state("empleados.edit",{url:"/:empleadoId/edit",templateUrl:"modules/empleados/client/views/form-empleado.client.view.html",controller:"EmpleadosController",controllerAs:"vm",resolve:{empleadoResolve:getEmpleado},data:{roles:["user","admin"],pageTitle:"Edit Empleado {{ empleadoResolve.name }}"}}).state("empleados.view",{url:"/:empleadoId",templateUrl:"modules/empleados/client/views/view-empleado.client.view.html",controller:"EmpleadosController",controllerAs:"vm",resolve:{empleadoResolve:getEmpleado},data:{pageTitle:"Empleado {{ articleResolve.name }}"}})}function getEmpleado($stateParams,EmpleadosService){return EmpleadosService.get({empleadoId:$stateParams.empleadoId}).$promise}function newEmpleado(EmpleadosService){return new EmpleadosService}angular.module("empleados").config(routeConfig),routeConfig.$inject=["$stateProvider"],getEmpleado.$inject=["$stateParams","EmpleadosService"],newEmpleado.$inject=["EmpleadosService"]}(),function(){function EmpleadosController($scope,$state,Authentication,empleado,user,puestos,ServiceNavigation){var vm=this;vm.authentication=Authentication,vm.empleado=empleado,vm.puestos=puestos,vm.error=null,vm.update=function(){if(confirm("are you sure to change? changing the puesto will change the puesto for other personell with same puesto")){vm.empleado.puesto=vm.nuevoPuesto,vm.empleado.userLogin.roles[0]=vm.rol,vm.empleado.enterprise=vm.empleado.enterprise._id,vm.empleado.$update(function(res){$state.go("home.viewEmpleado",{empleadoId:res._id})},function(res){console.log("error"),vm.error=res.data.message})}},vm.roles=$scope.roles=["user","admin","rrhh","compras","ventas","produccion","cliente"]}angular.module("empleados").controller("EmpleadosController",EmpleadosController),EmpleadosController.$inject=["$scope","$state","Authentication","empleado","user","puestos","ServiceNavigation"]}(),function(){function EmpleadosListCentrodecostoController(Costcenters,user,$scope,$rootScope,$http,PagosService,ServiceNavigation){if(localStorage.getItem("dateEmpleados")){var date=JSON.parse(localStorage.getItem("dateEmpleados"));$scope.year=0!==Object.keys(date).length?date.year:(new Date).getFullYear(),$scope.month=0!==Object.keys(date).length?date.month:(new Date).getMonth()}else $scope.year=(new Date).getFullYear(),$scope.month=(new Date).getMonth();ServiceNavigation.navInit(),$scope.getName=function(name){ServiceNavigation.addNav({name:name}),$rootScope.$broadcast("nav change",!0)},$scope.$watchCollection("year",function(newVal,oldval){localStorage.setItem("year",JSON.stringify({yearName:newVal}))}),$scope.$watchCollection("month",function(newVal,oldval){var elemPos=$scope.monthList.map(function(x){return x.id}).indexOf(newVal);localStorage.setItem("month",JSON.stringify({monthName:$scope.monthList[elemPos].name}))}),$scope.monthList=[{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],$scope.yearList=[];for(var endYear=(new Date).getFullYear(),startYear=2016;startYear<=endYear;startYear++)$scope.yearList.push(String(startYear));var getEmpleados=function(index,costcenter){$http.put("/api/empleados",{enterprise:user.enterprise._id,centrodecosto:costcenter._id}).success(function(response){var empleados=response;costcenter.activo=empleados.length;for(var j=0;j<empleados.length;j++)$scope.countActividades(index,empleados[j]),$scope.summLiquidaciones(index,empleados[j]),$scope.summPagos(index,empleados[j])}).error(function(err){console.log("Error: "+err)})};$scope.findEmpleados=function(){localStorage.setItem("dateEmpleados",JSON.stringify({year:$scope.year,month:$scope.month})),Costcenters.query({e:user.enterprise.enterprise},function(costcenters){$scope.costcenters=costcenters;for(var i=0;i<costcenters.length;i++)$scope.costcenters[i].hasOwnProperty("activo")||($scope.costcenters[i].activo=0),getEmpleados(i,$scope.costcenters[i])})},$scope.findEmpleados(),$scope.countActividades=function(index,empleado){var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/actividades",{empleadoId:empleado._id,month:date.month||null,year:date.year||null}).success(function(response){$scope.costcenters[index].hasOwnProperty("faltas")||($scope.costcenters[index].faltas=0);for(var i=0;i<response.length;i++)new Date(response[i].created).getHours()-Number(empleado.puesto.horarioE.split(":")[0]),new Date(response[i].created).getMinutes()-Number(empleado.puesto.horarioE.split(":")[1]),"Falta"==response[i].operacion&&($scope.costcenters[index].faltas+=1)}):$http.put("/api/actividades",{empleadoId:empleado._id}).success(function(response){$scope.costcenters[index].hasOwnProperty("faltas")||($scope.costcenters[index].faltas=0);for(var i=0;i<response.length;i++)new Date(response[i].created).getHours()-Number(empleado.puesto.horarioE.split(":")[0]),new Date(response[i].created).getMinutes()-Number(empleado.puesto.horarioE.split(":")[1]),"Falta"==response[i].operacion&&($scope.costcenters[index].faltas+=1)})},$scope.summLiquidaciones=function(index,empleado){var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/liquidaciones",{empleadoId:empleado._id,impuestosId:"",year:date.year||null}).success(function(response){$scope.costcenters[index].hasOwnProperty("liquidacion")||($scope.costcenters[index].liquidacion=0),$scope.costcenters[index].hasOwnProperty("liquidacionAcumulada")||($scope.costcenters[index].liquidacionAcumulada=0),console.log(date.month);for(var i=0;i<response.length;i++){var fechaDeLiquidacion2=new Date(response[i].fechaDeLiquidacion2);fechaDeLiquidacion2.getFullYear()==date.year&&fechaDeLiquidacion2.getMonth()==date.month&&($scope.costcenters[index].liquidacion+=response[i].total),$scope.costcenters[index].liquidacionAcumulada+=response[i].total}}):$http.put("/api/liquidaciones",{empleadoId:empleado._id}).success(function(response){$scope.costcenters[index].hasOwnProperty("liquidacion")||($scope.costcenters[index].liquidacion=0);for(var i=0;i<response.length;i++)$scope.costcenters[index].liquidacion+=response[i].total})},$scope.summPagos=function(index,empleado){var date=JSON.parse(localStorage.getItem("dateEmpleados"));$scope.costcenters[index].hasOwnProperty("pago")||($scope.costcenters[index].pago=0),$scope.costcenters[index].hasOwnProperty("pagoAcumulado")||($scope.costcenters[index].pagoAcumulado=0),date&&(date.month||date.year)?PagosService.query({empleadoId:empleado._id,impuestosId:"",year:date.year||null},function(response){for(var i=0;i<response.length;i++){var pagoDate=new Date(response[i].pagoDate);pagoDate.getFullYear()==date.year&&pagoDate.getMonth()+1==date.month&&($scope.costcenters[index].pago+=response[i].montoE+response[i].montoC),$scope.costcenters[index].pagoAcumulado+=response[i].montoE+response[i].montoC}}):PagosService.query({empleadoId:empleado._id},function(response){for(var i=0;i<response.length;i++)$scope.costcenters[index].pago+=response[i].montoE+response[i].montoC})}}angular.module("empleados").controller("EmpleadosCentrodecostoListController",EmpleadosListCentrodecostoController),EmpleadosListCentrodecostoController.$inject=["Costcenters","user","$scope","$rootScope","$http","PagosService","ServiceNavigation"]}(),function(){function EmpleadosListController($http,$stateParams,user,$scope,$mdDialog,$rootScope,PagosService,ServiceNavigation,Authentication){DialogController1.$inject=["user","$state","$filter","$scope","$http","$stateParams","Empleados","Authentication","Liquidaciones"],DialogController.$inject=["$scope","$mdDialog","$state","item","user","PagosService","$filter","Socket","Cajas","Authentication"],$scope.empleados=[],$scope.concepto="",$scope.centroDeCosto=$stateParams.costcenterId,$http.put("/api/empleados",{enterprise:user.enterprise._id,centrodecosto:$scope.centroDeCosto}).success(function(response){$scope.empleados=response;for(var i=0;i<$scope.empleados.length;i++)$scope.countActividades(i),$scope.summLiquidaciones(i),$scope.summPagos(i)}).error(function(err){console.log("Error: "+err)}),$scope.getName=function(name){ServiceNavigation.addNav({name:name})},$rootScope.$broadcast("nav change",!0);var getMonth=JSON.parse(localStorage.getItem("month")),getYear=JSON.parse(localStorage.getItem("year"));function DialogController($scope,$mdDialog,$state,item,user,PagosService,$filter,Socket,Cajas,Authentication){$scope.apagarBoton=!1,$scope.$watchCollection("ServiciosService",function(){$scope.findPago()}),$scope.$watchCollection("Cajas",function(){$scope.findCajas()}),$scope.item=item,$scope.item.name=item.userLogin.displayName,$scope.item.personal=!0,$scope.montoE=0,$scope.montoC=0,$scope.errorCaja=void 0,$scope.assignConcepto=function(concepto){$scope.concepto=concepto},$scope.findCajas=function(){Cajas.query({e:user.enterprise._id},function(data){$scope.cajas=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.closeDialog=function(){$mdDialog.hide()},$scope.findPago=function(){$scope.pagos=PagosService.query({e:user.enterprise._id})},$scope.createPago=function($event,item){if(console.log($scope.concepto),13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){$scope.apagarBoton=!0;var pago={numero:$scope.pagos.length+1,personal:item._id,cajaD:$scope.caja._id,montoE:$scope.montoE,montoC:$scope.montoC,pagoDate:$scope.pagoDate,concepto:$scope.concepto,saldo:$scope.caja.total-($scope.montoE+$scope.montoC),observaciones:$scope.observaciones,enterprise:user.enterprise._id,user:item.userLogin._id,type:"personal",userLogin:item.userLogin.displayName};Socket.emit("pago.create",pago),$state.go("home.viewSaldo",{empleadoId:item._id,displayName:item.userLogin.displayName},{reload:!0}),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja origin"}}function DialogController1(user,$state,$filter,$scope,$http,$stateParams,Empleados,Authentication,Liquidaciones){$scope.authentication=Authentication,$scope.minLengthPersonal=0,$scope.remuneraciones=[],$scope.modoEditar=[],$scope.addedConceptos=[],$scope.totalLiqudacion=0,$scope.fechaDeLiquidacion=new Date,$scope.fechaDeLiquidacion2=new Date,$scope.rrhh=void 0,$scope.editing=!1,$scope.fromPersonal=!1,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findPersonal(),$stateParams.empleadoId&&($scope.fromPersonal=!0),$stateParams.liquidacionId&&($scope.editing=!0,$scope.findOne())}),$scope.closeDialog=function(){$mdDialog.hide()},$scope.searchTextChangePersonal=function(text){return $filter("filter")($scope.personal,{deleted:!1,$:text})},$scope.searchTextChangeConcepto=function(text){return $filter("filter")($scope.remuneraciones,{$:text})},$scope.selectedItemChange=function(item){$scope.rrhh=item,$scope.ii=0,$scope.remuneraciones=item&&item.userLogin&&item.userLogin.remuneraciones||[];for(var i=0;i<$scope.remuneraciones.length;i++)$http.post("/api/remuneraciones/"+$scope.remuneraciones[i]._id).success(function(res){return res.deleted&&($scope.remuneraciones.splice(i-$scope.ii,1),$scope.ii+=1),console.log($scope.remuneraciones),!res.deleted||($scope.remuneraciones.deleted=!0,!1)}).error(function(err){console.log(err)})},$scope.selectedItemChangeConcepto=function(item){$scope.concepto=item},$scope.findOne=function(){$http({method:"GET",url:"/api/liquidaciones/"+$stateParams.liquidacionId}).then(function(res){$scope.liquidacion=res.data,$scope.findPersonal($scope.liquidacion.empleado._id),$scope.observaciones=$scope.liquidacion.observaciones,$scope.fechaDeLiquidacion=new Date($scope.liquidacion.fechaDeLiquidacion),$scope.fechaDeLiquidacion2=new Date($scope.liquidacion.fechaDeLiquidacion2),$scope.totalLiqudacion=$scope.liquidacion.total,$scope.addedConceptos=$scope.liquidacion.remuneraciones,$scope.modoEditar=new Array($scope.addedConceptos.length).fill(!1);for(var i=0;i<$scope.addedConceptos.length;i++)$scope.addedConceptos[i].totalAll=$scope.addedConceptos[i].cantidad*$scope.addedConceptos[i].total},function(err){console.log("Error"+err)})},$scope.findPersonal=function(empleadoId){var empleado=empleadoId||null;void 0!==$scope.SEARCH?Empleados.query({e:$scope.SEARCH.enterprise},function(response){if($scope.personal=response,$stateParams.empleadoId||empleado)for(var i=0;i<$scope.personal.length;i++)$scope.personal[i]._id!=$stateParams.empleadoId&&$scope.personal[i]._id!=empleado||($scope.rrhh=$scope.personal[i])}):Empleados.query({},function(response){if($scope.personal=response,$stateParams.empleadoId||empleado)for(var i=0;i<$scope.personal.length;i++)$scope.personal[i]._id!=$stateParams.empleadoId&&$scope.personal[i]._id!=empleado||($scope.rrhh=$scope.personal[i])})},$scope.sendRRHH=function($event,rrhh){13===$event.keyCode&&($event.preventDefault(),null===rrhh||void 0===rrhh?$scope.mensajePer="No seleccionaste un personal valido":$scope.rrhh=personal)},$scope.addConcepto=function(concepto){concepto.totalAll=concepto.total*concepto.cantidad,$scope.modoEditar.push(!1),checkIfAlreadyIn(concepto)?$scope.error="The concepto is already in the list":($scope.addedConceptos.push(concepto),$scope.totalLiqudacion+=concepto.totalAll,$scope.button_disabled=!0)};var checkIfAlreadyIn=function(concepto){for(var i=0;i<$scope.addedConceptos.length;i++)if($scope.addedConceptos[i]._id==concepto._id)return!0;return!1};$scope.editTrue=function(index){$scope.modoEditar[index]=!0},$scope.updateP=function(index,p){$scope.addedConceptos[index].cantidad=p.cantidad,$scope.totalLiqudacion-=$scope.addedConceptos[index].totalAll,$scope.addedConceptos[index].totalAll=$scope.addedConceptos[index].total*p.cantidad,$scope.totalLiqudacion+=$scope.addedConceptos[index].totalAll,$scope.modoEditar[index]=!1},$scope.eliminarProducto=function(index){$scope.totalLiqudacion-=$scope.addedConceptos[index].totalAll,$scope.addedConceptos.splice(index,1),$scope.button_disabled=!1},$scope.showAdvancedRRHH=function(){$state.go("home.createPersonal")},$scope.showAdvancedConcepto=function(){$state.go("home.viewPersona",{personaId:$scope.rrhh._id})},$scope.clickSubmit=function(){if(void 0!==$scope.rrhh)if(0!==$scope.totalLiqudacion)if($scope.fechaDeLiquidacion<=$scope.fechaDeLiquidacion2){console.log($scope.rrhh);var liquidacion=new Liquidaciones({empleado:$scope.rrhh,enterprise:user.enterprise._id,created:new Date,fechaDeLiquidacion:$scope.fechaDeLiquidacion,fechaDeLiquidacion2:$scope.fechaDeLiquidacion2,total:$scope.totalLiqudacion,remuneraciones:$scope.addedConceptos,observaciones:$scope.observaciones,user:user._id,displayName:user.displayName});console.log(user),liquidacion.$save(function(response){response._id&&($mdDialog.hide(),$state.go("home.viewSaldo",{empleadoId:$scope.rrhh._id,displayName:$scope.rrhh.userLogin.displayName,centroDeCosto:$scope.rrhh.userLogin.centroDeCosto},{reload:!0}))},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error="La primer fecha no puede ser mayor que la segunda";else $scope.error="Por favor agregar las liquidaciones";else $scope.error="Por favor seleccione personal"},$scope.clickUpdate=function(){if(void 0!==$scope.rrhh)if(0!==$scope.totalLiqudacion)if($scope.fechaDeLiquidacion<=$scope.fechaDeLiquidacion2){var liquidacion=$scope.liquidacion;liquidacion.empleado=$scope.rrhh,liquidacion.enterprise=$scope.rrhh.enterprise,liquidacion.created=new Date,liquidacion.fechaDeLiquidacion=$scope.fechaDeLiquidacion,liquidacion.fechaDeLiquidacion2=$scope.fechaDeLiquidacion2,liquidacion.total=$scope.totalLiqudacion,liquidacion.remuneraciones=$scope.addedConceptos,liquidacion.observaciones=$scope.observaciones,$http.put("/api/liquidaciones/"+liquidacion._id,liquidacion).then(function(response){$state.go("home.liquidaciones",{empleadoId:$scope.rrhh._id,displayName:$scope.rrhh.userLogin.displayName,centroDeCosto:$scope.rrhh.userLogin.centroDeCosto})}).catch(function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error="La primer fecha no puede ser mayor que la segunda";else $scope.error="Por favor agregar las liquidaciones";else $scope.error="Por favor seleccione personal"}}$rootScope.getPeriod=getMonth.monthName+", "+getYear.yearName,$scope.countActividades=function(index){var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/actividades",{empleadoId:$scope.empleados[index]._id,month:date.month||null,year:date.year||null}).success(function(response){var hourDiff,minuteDiff;$scope.empleados[index].hasOwnProperty("faltas")||($scope.empleados[index].faltas=0),$scope.empleados[index].hasOwnProperty("llegasTardes")||($scope.empleados[index].llegasTardes=0);for(var i=0;i<response.length;i++)hourDiff=Number(response[i].created.split("T")[1].split(":")[0])-Number($scope.empleados[index].puesto.horarioE.split(":")[0])-3,minuteDiff=Number(response[i].created.split("T")[1].split(":")[1])-Number($scope.empleados[index].puesto.horarioE.split(":")[1]),"Falta"==response[i].operacion?$scope.empleados[index].faltas+=1:"Hola"==response[i].operacion&&(hourDiff<-2||hourDiff>0||0==hourDiff&&minuteDiff>15)&&($scope.empleados[index].llegasTardes+=1)}):$http.put("/api/actividades",{empleadoId:$scope.empleados[index]._id}).success(function(response){var hourDiff,minuteDiff;$scope.empleados[index].hasOwnProperty("faltas")||($scope.empleados[index].faltas=0),$scope.empleados[index].hasOwnProperty("llegasTardes")||($scope.empleados[index].llegasTardes=0);for(var i=0;i<response.length;i++)hourDiff=Number(response[i].created.split("T")[1].split(":")[0])-Number($scope.empleados[index].puesto.horarioE.split(":")[0])-3,minuteDiff=Number(response[i].created.split("T")[1].split(":")[1])-Number($scope.empleados[index].puesto.horarioE.split(":")[1]),"Falta"==response[i].operacion?$scope.empleados[index].faltas+=1:"Hola"==response[i].operacion&&(hourDiff<-2||hourDiff>0||0==hourDiff&&minuteDiff>15)&&($scope.empleados[index].llegasTardes+=1)})},$scope.summLiquidaciones=function(index){var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/liquidaciones",{empleadoId:$scope.empleados[index]._id,impuestosId:"",year:date.year||null}).success(function(response){$scope.empleados[index].hasOwnProperty("liquidacion")||($scope.empleados[index].liquidacion=0),$scope.empleados[index].hasOwnProperty("liquidacionAcumulada")||($scope.empleados[index].liquidacionAcumulada=0);for(var i=0;i<response.length;i++){var fechaDeLiquidacion2=new Date(response[i].fechaDeLiquidacion2);fechaDeLiquidacion2.getFullYear()==date.year&&fechaDeLiquidacion2.getMonth()==date.month&&($scope.empleados[index].liquidacion+=response[i].total),$scope.empleados[index].liquidacionAcumulada+=response[i].total}}):$http.put("/api/liquidaciones",{empleadoId:$scope.empleados[index]._id}).success(function(response){$scope.empleados[index].hasOwnProperty("liquidacion")||($scope.empleados[index].liquidacion=0);for(var i=0;i<response.length;i++)$scope.empleados[index].liquidacion+=response[i].total})},$scope.summPagos=function(index){var date=JSON.parse(localStorage.getItem("dateEmpleados"));$scope.empleados[index].hasOwnProperty("pago")||($scope.empleados[index].pago=0),$scope.empleados[index].hasOwnProperty("pagoAcumulado")||($scope.empleados[index].pagoAcumulado=0),date&&(date.month||date.year)?PagosService.query({empleadoId:$scope.empleados[index]._id,impuestosId:"",year:date.year||null},function(response){for(var i=0;i<response.length;i++){var pagoDate=new Date(response[i].pagoDate);pagoDate.getFullYear()==date.year&&pagoDate.getMonth()==date.month&&($scope.empleados[index].pago+=response[i].montoE+response[i].montoC),$scope.empleados[index].pagoAcumulado+=response[i].montoE+response[i].montoC}}):PagosService.query({empleadoId:$scope.empleados[index]._id},function(response){for(var i=0;i<response.length;i++)$scope.empleados[index].pago+=response[i].montoE+response[i].montoC})},$rootScope.$$listenerCount.callAddPago||$rootScope.$on("callAddPago",function(event,data){$scope.showDialogPago(data.event,data.item)}),$rootScope.$$listenerCount.callAddLiquidencion||$rootScope.$on("callAddLiquidencion",function(event,data){$scope.showDialogLiquidencion(data.event,data.item)}),$scope.showDialogLiquidencion=function($event,item){$mdDialog.cancel(),$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/create-liquidacion.client.view.html",locals:{item:item,user:user},controller:DialogController1})},$scope.showDialogPago=function($event,item){$mdDialog.cancel(),$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/create-pago.client.view.html",locals:{item:item,user:user},controller:DialogController})}}angular.module("empleados").controller("EmpleadosListController",EmpleadosListController),EmpleadosListController.$inject=["$http","$stateParams","user","$scope","$mdDialog","$rootScope","PagosService","ServiceNavigation","Liquidaciones","Authentication"]}(),function(){function Empleados($resource){return $resource("api/empleados/:empleadoId",{empleadoId:"@_id"},{update:{method:"PUT"}})}angular.module("empleados").factory("Empleados",Empleados),Empleados.$inject=["$resource"]}(),angular.module("enterprises").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Enterprises",state:"enterprises",type:"dropdown"}),Menus.addSubMenuItem("topbar","enterprises",{title:"List Enterprises",state:"enterprises.list"}),Menus.addSubMenuItem("topbar","enterprises",{title:"Create Enterprise",state:"enterprises.create"})}]),angular.module("enterprises").config(["$stateProvider",function($stateProvider){$stateProvider.state("enterprises",{abstract:!0,url:"/enterprises",template:"<ui-view/>"}).state("enterprises.list",{url:"",templateUrl:"modules/enterprises/views/list-enterprises.client.view.html"}).state("enterprises.create",{url:"/create",templateUrl:"modules/enterprises/views/create-enterprise.client.view.html"}).state("enterprises.view",{url:"/:enterpriseId",templateUrl:"modules/enterprises/views/view-enterprise.client.view.html"}).state("enterprises.edit",{url:"/:enterpriseId/edit",templateUrl:"modules/enterprises/views/edit-enterprise.client.view.html"})}]),angular.module("enterprises").controller("EnterprisesController",["$scope","$rootScope","$stateParams","$location","Authentication","Enterprises","$mdBottomSheet","$mdDialog","Comprobantes","Categories","Condicionventas","Taxconditions","Clients","$q","Areas",function($scope,$rootScope,$stateParams,$location,Authentication,Enterprises,$mdBottomSheet,$mdDialog,Comprobantes,Categories,Condicionventas,Taxconditions,Clients,$q,Areas){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.place=this.getPlace()},$scope.create=function(){var enterprise=new Enterprises({name:this.name,description:this.description,email:this.email,fiscalNumber:this.fiscalNumber,taxCondition:this.taxCondition,region:this.region,postalCode:this.postalCode,address:this.address,loc:[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()],phone:this.phone,fax:this.fax,web:this.web});enterprise.$save(function(response){response._id&&(enterprise._id=response._id,$rootScope.enterprises.unshift(enterprise)),new Areas({name:"Directorio",nivel:0,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Factura A",letra:"A",puntoDeVenta:"1",modoFacturacion:"Talonario fiscal manual o pre-impreso",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message});var facturaB=new Comprobantes({name:"Factura B",letra:"B",puntoDeVenta:"1",modoFacturacion:"Talonario fiscal manual o pre-impreso",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id});new Comprobantes({name:"Factura C",letra:"C",puntoDeVenta:"1",modoFacturacion:"Talonario fiscal manual o pre-impreso",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Orden De Pago",letra:"O",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Nota De Credito",letra:"NC",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Nota De Debito",letra:"ND",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Remito De Devolucion",letra:"RD",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Pedido",letra:"P",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Presupuesto",letra:"X1",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Recibo De Pago",letra:"X2",puntoDeVenta:"",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Comprobantes({name:"Remito",letra:"R",puntoDeVenta:"1",modoFacturacion:"Comprobante interno",movimientoStock:!1,movimientoCC:!1,movimientoOperacionInversa:!1,funcionalidadSituacion:!1,autoAprobar:!1,enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Categories({name:"Materia Prima",description:"MP para lavar y cortar",type1:"Materia Prima",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Categories({name:"Insumo",description:"Insumo para desarrollo de actividades",type1:"Insumo",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Categories({name:"Productos Terminados",description:"Productos Elaborados",type1:"Producto",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Condicionventas({name:"Cuenta Corriente",description:"",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Condicionventas({name:"Cheque",description:"",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message});var efectivo=new Condicionventas({name:"Efectivo",description:"",enterprise:enterprise._id});new Condicionventas({name:"Transferencia",description:"",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Condicionventas({name:"Tarjeta De Credito",description:"",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Condicionventas({name:"Tarjeta De Debito",description:"",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Taxconditions({name:"Responsable Inscripto",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message}),new Taxconditions({name:"Monotributo",enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message});var consumidorFinal=new Taxconditions({name:"Consumidor Final",enterprise:enterprise._id});var deferred,promiseFacturaB=(deferred=$q.defer(),facturaB.$save(function(response){response._id&&(facturaB._id=response._id)},function(errorResponse){$scope.error=errorResponse.data.message}),setTimeout(function(){void 0!==facturaB?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise),promiseEfectivo=function(){var deferred=$q.defer();return efectivo.$save(function(response){response._id&&(efectivo._id=response._id)},function(errorResponse){$scope.error=errorResponse.data.message}),setTimeout(function(){void 0!==efectivo?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise}(),promiseConsumidorFinal=function(){var deferred=$q.defer();return consumidorFinal.$save(function(response){response._id&&(consumidorFinal._id=response._id)},function(errorResponse){$scope.error=errorResponse.data.message}),setTimeout(function(){void 0!==consumidorFinal?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise}();promiseFacturaB.then(function(response){promiseEfectivo.then(function(response){promiseConsumidorFinal.then(function(response){new Clients({name:"Consumidor Final",taxCondition:consumidorFinal._id,condicionPago:efectivo._id,comprobante:facturaB._id,loc:[-34.9204948,-57.95356570000001],enterprise:enterprise._id}).$save(function(response){},function(errorResponse){$scope.error=errorResponse.data.message})})})}),$scope.name="",$scope.description="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Empresa").content("¿Está seguro que desea eliminar esta empresa?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(enterprise){if(enterprise)for(var i in enterprise.$remove(),$scope.enterprises)$scope.enterprises[i]===enterprise&&$scope.enterprises.splice(i,1);else $scope.enterprise.$remove(function(){$location.path("enterprises")})},$scope.update=function(){var enterprise=$scope.enterprise;void 0!==$scope.place?enterprise.loc=[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()]:enterprise.loc=enterprise.loc,enterprise.$update(function(){$location.path("empresas")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.enterprises=Enterprises.query())},$scope.findOne=function(){$scope.enterprise=Enterprises.get({enterpriseId:$stateParams.enterpriseId})}}]),angular.module("enterprises").factory("Enterprises",["$resource",function($resource){return $resource("api/enterprises/:enterpriseId",{enterpriseId:"@_id"},{update:{method:"PUT"}})}]),angular.module("entregas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Entregas",state:"entregas",type:"dropdown"}),Menus.addSubMenuItem("topbar","entregas",{title:"List Entregas",state:"entregas.list"}),Menus.addSubMenuItem("topbar","entregas",{title:"Create Entrega",state:"entregas.create"})}]),angular.module("entregas").config(["$stateProvider",function($stateProvider){$stateProvider.state("entregas",{abstract:!0,url:"/entregas",template:"<ui-view/>"}).state("entregas.list",{url:"",templateUrl:"modules/entregas/views/list-entregas.client.view.html"}).state("entregas.create",{url:"/create",templateUrl:"modules/entregas/views/create-entrega.client.view.html"}).state("entregas.view",{url:"/:entregaId",templateUrl:"modules/entregas/views/view-entrega.client.view.html"}).state("entregas.edit",{url:"/:entregaId/edit",templateUrl:"modules/entregas/views/edit-entrega.client.view.html"})}]),angular.module("entregas").controller("EntregasController",["$scope","$rootScope","$stateParams","$location","Authentication","Entregas","ClientsLocation",function($scope,$rootScope,$stateParams,$location,Authentication,Entregas,ClientsLocation){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findClients()}),$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.place=this.getPlace()},$scope.create=function(){new Entregas({name:this.name}).$save(function(response){$location.path("entregas/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(entrega){if(entrega)for(var i in entrega.$remove(),$scope.entregas)$scope.entregas[i]===entrega&&$scope.entregas.splice(i,1);else $scope.entrega.$remove(function(){$location.path("entregas")})},$scope.update=function(){var entrega=$scope.entrega;entrega.$update(function(){$location.path("entregas/"+entrega._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.entregas=Entregas.query({e:$scope.SEARCH.enterprise}))},$scope.findOne=function(){$scope.entrega=Entregas.get({entregaId:$stateParams.entregaId})},$scope.findClients=function(product){void 0!==$scope.SEARCH&&(console.log("<<<<< ",$scope.authentication),ClientsLocation.getClientsByLocation($scope.authentication.user.enterprise.loc,$scope.SEARCH.enterprise).success(function(data){$scope.clients=data}).error(function(error){console.error("Fuck!!! -> ",error)}),console.log("clients: ",$scope.clients))}}]),angular.module("entregas").factory("Entregas",["$resource",function($resource){return $resource("api/entregas/:entregaId",{entregaId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("entregas").factory("ClientsLocation",["$http",function($http){return{getClientsByLocation:function(location,enterpriseID){return location&&enterpriseID?null!==location||void 0!==location?$http({url:"/api/clients/bylocation",method:"GET",params:{e:enterpriseID,p:location},headers:{},data:{}}).success(function(data){}).error(function(data){}):void 0:[]}}}]),angular.module("finanzas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Finanzas",state:"finanzas",type:"dropdown"}),Menus.addSubMenuItem("topbar","finanzas",{title:"List Finanzas",state:"finanzas.list"}),Menus.addSubMenuItem("topbar","finanzas",{title:"Create Finanza",state:"finanzas.create"})}]),angular.module("finanzas").config(["$stateProvider",function($stateProvider){$stateProvider.state("finanzas",{abstract:!0,url:"/finanzas",template:"<ui-view/>"}).state("finanzas.list",{url:"",templateUrl:"modules/finanzas/views/list-finanzas.client.view.html"}).state("finanzas.create",{url:"/create",templateUrl:"modules/finanzas/views/create-finanza.client.view.html"}).state("finanzas.view",{url:"/:finanzaId",templateUrl:"modules/finanzas/views/view-finanza.client.view.html"}).state("finanzas.edit",{url:"/:finanzaId/edit",templateUrl:"modules/finanzas/views/edit-finanza.client.view.html"})}]),angular.module("finanzas").controller("FinanzasCreateController",["user","finanza","enterprises","$state","finanzas",function(user,finanza,enterprises,$state,finanzas){this.user=user,this.finanza=finanza,this.enterprises=enterprises,this.create=function(){new finanzas({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.finanzas")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("finanzas").controller("FinanzasEditController",["user","finanza","enterprises","modosFacturacion","$location",function(user,finanza,enterprises,modosFacturacion,$location){this.user=user,this.finanza=finanza,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.update=function(){var finanza=this.finanza;void 0!==this.enterprise?finanza.enterprise=this.enterprise._id:finanza.enterprise=finanza.enterprise._id;void 0!==this.modoFacturacion?finanza.modoFacturacion=this.modoFacturacion:finanza.modoFacturacion=finanza.modoFacturacion;finanza.$update(function(){$location.path("finanzas/view/"+finanza._id)},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("finanzas").controller("ListFinanzasController",["$location","user","enterprises","movimientos","tipoFinanza","$rootScope","Finanzas","$state",function($location,user,enterprises,movimientos,tipoFinanza,$rootScope,Finanzas,$state){var self=this;this.user=user,this.finanzas=[],this.costosIndirectos=[],this.enterprises=enterprises,this.movimientos=movimientos,this.tipoFinanza=tipoFinanza,this.daFilter=void 0,this.loading=!1,this.finished=!1,this.loadCompras=function(){user&&user.enterprise&&user.enterprise.enterprise&&(self.loading=!0,Finanzas.query({e:user.enterprise.enterprise,last:self.finanzas.length?{created:self.finanzas[self.finanzas.length-1].created,saldo:self.finanzas[self.finanzas.length-1].saldo}:null,type:"debe"===self.tipoFinanza?"debe":"haber"},function(data){self.loading=!1,self.finanzas=self.finanzas.concat(data),0===data.length&&(self.finished=!0)})),this.loadmore=function(){},$rootScope.tipoFinanza=tipoFinanza,this.remove=function(finanza){finanza?finanza.$remove():this.finanza.$remove(function(){$location.path("finanzas")})},this.getIntoFinanzaDetail=function(item){$state.go("home.viewFinanza",{finanzaId:item._id})},this.getIntoServicioDetail=function(item){$state.go("home.viewPago",{servicosId:item._id+"/"+item.name+"/serviceDetails"})}},this.loadCostIndirecto=function(){self.costosIndirectos.length<=0&&(self.loading=!0,Finanzas.query({enterprise:user.enterprise._id,type:"facturas"},function(data){self.loading=!1,self.costosIndirectos=self.costosIndirectos.concat(data),console.log(self.costosIndirectos),console.log(data),0===data.length&&(self.finished=!0)})),this.loadmoreFactura=function(){}}}]),angular.module("finanzas").controller("FinanzasViewController",["user","finanza","$mdDialog","Movimientos","movimientos","tipoFinanza","$rootScope","$state",function(user,finanza,$mdDialog,Movimientos,movimientos,tipoFinanza,$rootScope,$state){function DialogController($scope,$mdDialog,item,user,Comprobantes,Movimientos,movimientos,Cajas,Condicionventas,$filter){$scope.item=item,$scope.arrayMovs=movimientos,$scope.botonApagado=!1,$scope.closeDialog=function(){$mdDialog.hide()},$scope.findComprobantes=function(){$scope.comprobantes=Comprobantes.query({e:$scope.item.enterprise._id})},$scope.findCajas=function(){$scope.cajas=Cajas.query({e:$scope.item.enterprise._id})},$scope.findCondiciones=function(){$scope.condiciones=Condicionventas.query({e:$scope.item.enterprise._id}),$scope.filtrados=$filter("filter")($scope.condiciones,function(item){return"Cuenta Corriente"!==item.nombre})},$scope.add=function(saldo,monto){$scope.newSaldoDebe=saldo-monto,$scope.newSaldoHaber=saldo-monto},$scope.createAsiento=function($event){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.monto&&null!==$scope.monto&&0!==$scope.monto)if(void 0!==$scope.caja&&null!==$scope.caja)if(void 0!==$scope.condicionVenta&&null!==$scope.condicionVenta)if(void 0!==$scope.comprobante&&null!==$scope.comprobante){void 0!=$scope.numComprobante&&null!=$scope.numComprobante||($scope.numComprobante=0),$scope.botonApagado=!0;var nuevoSaldo=$scope.item.saldo-$scope.monto;if("debe"==$scope.item.tipoFinanza){var nuevoSaldoCaja=$scope.caja.total-$scope.monto,movimiento=new Movimientos({provider:$scope.item.provider._id,comprobante:$scope.comprobante,numero:$scope.numComprobante,estado:"haber",finanza:$scope.item._id,monto:$scope.monto,saldo:nuevoSaldo,saldoCaja:nuevoSaldoCaja,caja:$scope.caja._id,condicion:$scope.condicionVenta._id,enterprise:user.enterprise._id});$scope.item.saldo=nuevoSaldo,(finanza=$scope.item).enterprise=finanza.enterprise._id,finanza.provider=finanza.provider._id,movimiento.$save(function(response){response._id&&(movimientos.push(movimiento),$mdDialog.hide(),finanza.$update(function(){console.log("saldo finanza ok")},function(errorResponse){console.log("saldo finanza error")}))},function(errorResponse){console.log(errorResponse)})}else{var finanza;nuevoSaldoCaja=$scope.caja.total+$scope.monto,movimiento=new Movimientos({client:$scope.item.client._id,comprobante:$scope.comprobante,numero:$scope.numComprobante,estado:"debe",finanza:$scope.item._id,monto:$scope.monto,saldo:nuevoSaldo,saldoCaja:nuevoSaldoCaja,caja:$scope.caja._id,condicion:$scope.condicionVenta._id,enterprise:user.enterprise._id});$scope.item.saldo=nuevoSaldo,(finanza=$scope.item).enterprise=finanza.enterprise._id,finanza.client=finanza.client._id,movimiento.$save(function(response){response._id&&(movimientos.push(movimiento),$mdDialog.hide(),finanza.$update(function(){console.log("saldo finanza ok")},function(errorResponse){console.log("saldo finanza error")}))},function(errorResponse){console.log(errorResponse)})}}else $scope.errorPago="Debe indicar el tipo de comprobante";else $scope.errorPago="Debe indicar la condicion de pago";else $scope.errorPago="Debe indicar la caja a utilizar";else $scope.errorPago="Debe indicar un monto valido"}}DialogController.$inject=["$scope","$mdDialog","item","user","Comprobantes","Movimientos","movimientos","Cajas","Condicionventas","$filter"],this.user=user,this.finanza=finanza,this.tipoFinanza=tipoFinanza,this.movimientos=Movimientos.query({e:this.user.enterprise.enterprise}),this.showDialog=function($event,item,movimientos){$mdDialog.show({targetEvent:$event,templateUrl:"modules/finanzas/views/add-asiento.client.view.html",locals:{movimientosD:this.movimientosDebe,movimientosH:this.movimientosHaber,movimientos:this.movimientos,item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.rutaVolver=function(){"debe"==finanza.tipoFinanza?($rootScope.estadoActualParams.tipo="debe",$state.go("home.finanzas",$rootScope.estadoActualParams)):"haber"==finanza.tipoFinanza&&($rootScope.estadoActualParams.tipo="haber",$state.go("home.finanzas",$rootScope.estadoActualParams))},this.selectedMode="md-scale",this.selectedDirection="up"}]),angular.module("finanzas").controller("FinanzasController",["$scope","$rootScope","$stateParams","$location","Authentication","Comprobantes","$mdBottomSheet","Enterprises","$mdDialog","getServiceDetials",function($scope,$rootScope,$stateParams,$location,Authentication,Comprobantes,$mdBottomSheet,Enterprises,$mdDialog,getServiceDetials){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()});$rootScope.tipoFinanza=$stateParams.tipo,$scope.create=function(){var comprobante=new Comprobantes({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});comprobante.$save(function(response){response._id&&(comprobante._id=response._id,$rootScope.comprobantes.unshift(comprobante)),$scope.name="",$scope.letra="",$scope.puntoDeVenta="",$scope.modoFacturacion="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(comprobante){if(comprobante)for(var i in comprobante.$remove(),$scope.comprobantes)$scope.comprobantes[i]===comprobante&&$scope.comprobantes.splice(i,1);else $scope.comprobante.$remove(function(){$location.path("comprobantes")})},$scope.update=function(){var comprobante=$scope.comprobante;void 0!==this.enterprise?comprobante.enterprise=this.enterprise._id:comprobante.enterprise=comprobante.enterprise._id,comprobante.$update(function(){$location.path("comprobantes/view/"+comprobante._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.comprobantes=Comprobantes.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findModosF=function(){void 0!==$scope.SEARCH&&($scope.modosF=["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"])},$scope.findOne=function(){Finanzas.get({finanzaId:$stateParams.finanzaId},function(res){$scope.finanza=res,$rootScope.tipoFinanza=$scope.finanza.tipoFinanza})}}]),angular.module("finanzas").controller("ResumenListController",["$scope","$http","costcenters","Impuestos","PagosService","ServiceNavigation","$rootScope",function($scope,$http,costcenters,Impuestos,PagosService,ServiceNavigation,$rootScope){if($scope.costcenters=costcenters,costcenters.length>0&&localStorage.setItem("holdCostcenters",JSON.stringify(costcenters)),localStorage.getItem("dateResumen")){var date=JSON.parse(localStorage.getItem("dateResumen"));$scope.year=0!==Object.keys(date).length?date.year:(new Date).getFullYear(),$scope.month=0!==Object.keys(date).length?date.month:(new Date).getMonth()}else $scope.year=(new Date).getFullYear(),$scope.month=(new Date).getMonth();ServiceNavigation.navInit(),$scope.getName=function(name){ServiceNavigation.addNav({name:name}),$rootScope.$broadcast("nav change",!0)},$scope.monthList=[{id:"all",name:"Ninguno"},{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],$scope.yearList=[],$scope.ventasTotal={},$scope.otrosIngresosTotal={},$scope.comprasTotal={},$scope.costosIndirectosTotal={},$scope.rrhhTotal={},$scope.impuestosTotal={},$scope.ventasTotales={},$scope.totalResumen={},$scope.totalRatioResumen={};for(var endYear=(new Date).getFullYear(),startYear=2016;startYear<=endYear;startYear++)$scope.yearList.push(String(startYear));$scope.isMonthLoading=!1,$scope.monthInput=new Date(JSON.parse(localStorage.getItem("rawDate")))||new Date,console.log(JSON.parse(localStorage.getItem("rawDate"))),$scope.monthSelected=function(){$scope.monthInput&&(localStorage.setItem("rawDate",JSON.stringify($scope.monthInput)),$scope.monthValue=function(date){var month=date.getMonth(),year=date.getFullYear();localStorage.setItem("dateResumen",JSON.stringify({year:year,month:month}));var elemPos=$scope.monthList.map(function(x){return x.id}).indexOf(month);return localStorage.setItem("month",JSON.stringify({monthName:$scope.monthList[elemPos].name})),year+"-"+month}($scope.monthInput),console.log($scope.monthInput))},$scope.findResumen=function(){localStorage.setItem("dateResumen",JSON.stringify({year:$scope.year,month:$scope.month})),0===costcenters.length&&(costcenters=JSON.parse(localStorage.getItem("holdCostcenters"))||[{}]),costcenters.forEach(function(costcenter){var centroId,centroDeCosto;costcenter.deleted||($scope.ventasTotal[costcenter._id]=0,$scope.otrosIngresosTotal[costcenter._id]=0,$scope.comprasTotal[costcenter._id]=0,$scope.costosIndirectosTotal[costcenter._id]=0,$scope.rrhhTotal[costcenter._id]=0,$scope.impuestosTotal[costcenter._id]=0,$scope.ventasTotales[costcenter._id]=0,$scope.totalResumen[costcenter._id]=0,$scope.totalRatioResumen[costcenter._id]=0,centroDeCosto=costcenter._id,$http.put("/api/ventas",{year:$scope.year,month:$scope.month,enterprise:user.enterprise._id,centroDeCosto:centroDeCosto}).success(function(ventas){ventas.forEach(function(venta){!venta.tipoComprobante||"Factura A"!==venta.tipoComprobante.name&&"Factura B"!==venta.tipoComprobante.name&&"Factura C"!==venta.tipoComprobante.name?$scope.otrosIngresosTotal[centroDeCosto]+=venta.total:$scope.ventasTotal[centroDeCosto]+=venta.total}),$scope.ventasTotales[centroDeCosto]=$scope.ventasTotal[centroDeCosto]+$scope.otrosIngresosTotal[centroDeCosto],$scope.ventasTotales[centroDeCosto]?$scope.totalRatioResumen[centroDeCosto]=Math.round($scope.totalResumen[centroDeCosto]/$scope.ventasTotales[centroDeCosto]*1e4)/100:$scope.totalRatioResumen[centroDeCosto]=0}),function(centroDeCosto){var period=$scope.year+"-"+$scope.month;$http.put("/api/compras",{year:$scope.year,month:$scope.month,period:period,enterprise:user.enterprise._id,centroDeCosto:centroDeCosto}).success(function(compras){compras.forEach(function(compra){$scope.comprasTotal[centroDeCosto]+=compra.total})})}(costcenter._id),function(centroDeCosto){if(""!=$scope.year||""!=$scope.month)return PagosService.query({isResumen:!0,year:$scope.year,month:$scope.month,e:user.enterprise._id,centroId:centroDeCosto},function(pagos){pagos.forEach(function(pago){$scope.costosIndirectosTotal[centroDeCosto]+=pago.total}),$scope.totalResumen[centroDeCosto]=$scope.ventasTotales[centroDeCosto]-($scope.comprasTotal[centroDeCosto]+$scope.costosIndirectosTotal[centroDeCosto]+$scope.rrhhTotal[centroDeCosto]+$scope.impuestosTotal[centroDeCosto]),$scope.ventasTotales[centroDeCosto]?$scope.totalRatioResumen[centroDeCosto]=Math.round($scope.totalResumen[centroDeCosto]/$scope.ventasTotales[centroDeCosto]*1e4)/100:$scope.totalRatioResumen[centroDeCosto]=0})}(costcenter._id).$promise,centroId=costcenter._id,$http.put("/api/empleados",{enterprise:user.enterprise._id,centrodecosto:centroId}).success(function(response){var empleados=response;$http.patch("/api/liquidaciones",{month:$scope.month,year:$scope.year,empList:empleados}).success(function(res){$scope.rrhhTotal[centroId]+=res.total,$scope.totalResumen[centroId]=$scope.ventasTotales[centroId]-($scope.comprasTotal[centroId]+$scope.costosIndirectosTotal[centroId]+$scope.rrhhTotal[centroId]+$scope.impuestosTotal[centroId]),$scope.ventasTotales[centroId]?$scope.totalRatioResumen[centroId]=Math.round($scope.totalResumen[centroId]/$scope.ventasTotales[centroId]*1e4)/100:$scope.totalRatioResumen[centroId]=0})}).error(function(err){console.log("Error: "+err)}),function(centroId){Impuestos.query({centroDeCosto:centroId},function(impuestos){impuestos.forEach(function(impuesto){"IVA Compras"===impuesto.name?$scope.impuestosTotal[centroId]-=impuesto.total:$scope.impuestosTotal[centroId]+=impuesto.total}),$scope.totalResumen[centroId]=$scope.ventasTotales[centroId]-($scope.comprasTotal[centroId]+$scope.costosIndirectosTotal[centroId]+$scope.rrhhTotal[centroId]+$scope.impuestosTotal[centroId]),$scope.ventasTotales[centroId]?$scope.totalRatioResumen[centroId]=Math.round($scope.totalResumen[centroId]/$scope.ventasTotales[centroId]*1e4)/100:$scope.totalRatioResumen[centroId]=0})}(costcenter._id))})}}]),angular.module("finanzas").controller("ResumenController",["$scope","$stateParams","$state","$http","user","PagosService","Impuestos","ServiceNavigation","$rootScope",function($scope,$stateParams,$state,$http,user,PagosService,Impuestos,ServiceNavigation,$rootScope){if($scope.ventasTotal=0,$scope.otrosIngresosTotal=0,$scope.comprasTotal=0,$scope.costosIndirectosTotal=0,$scope.rrhhTotal=0,$scope.impuestosTotal=0,$scope.ventasTotales=0,$scope.resultadoBruto=0,$scope.resultadoNeto=0,$scope.ventasRatio=0,$scope.otrosIngresosRatio=0,$scope.comprasRatio=0,$scope.costosIndirectosRatio=0,$scope.rrhhRatio=0,$scope.impuestosRatio=0,$scope.resultadoRatio=0,$scope.loader={},localStorage.getItem("dateResumen")){var date=JSON.parse(localStorage.getItem("dateResumen"));year=0!==Object.keys(date).length?date.year:(new Date).getFullYear(),month=0!==Object.keys(date).length?date.month:(new Date).getMonth()}else var year=(new Date).getFullYear(),month=(new Date).getMonth();var getMonth=JSON.parse(localStorage.getItem("month"));$rootScope.getPeriod=getMonth.monthName+", "+year,console.log(getMonth),$scope.$watchCollection("authentication",function(){sessionStorage.getItem("centroDeCosto")?""!==$stateParams.centroDeCosto&&$stateParams.centroDeCosto!==sessionStorage.getItem("centroDeCosto")&&sessionStorage.setItem("centroDeCosto",$stateParams.centroDeCosto):sessionStorage.setItem("centroDeCosto",$stateParams.centroDeCosto),$scope.centroDeCosto=sessionStorage.getItem("centroDeCosto"),$scope.loader.isImpuestos=!0,Impuestos.query({centroDeCosto:$scope.centroDeCosto,month:month,year:year},function(impuestos){$scope.loader.isImpuestos=!1,impuestos.forEach(function(impuesto){"IVA Compras"===impuesto.name?$scope.impuestosTotal-=impuesto.total:$scope.impuestosTotal+=impuesto.total}),$scope.ventasTotales=$scope.ventasTotal+$scope.otrosIngresosTotal,$scope.resultadoBruto=$scope.ventasTotales-($scope.comprasTotal+$scope.costosIndirectosTotal+$scope.rrhhTotal),$scope.resultadoNeto=$scope.resultadoBruto-$scope.impuestosTotal,$scope.ventasTotales&&($scope.ventasRatio=$scope.ventasTotales&&Math.round($scope.ventasTotal/$scope.ventasTotales*1e4)/100,$scope.otrosIngresosRatio=Math.round($scope.otrosIngresosTotal/$scope.ventasTotales*1e4)/100,$scope.comprasRatio=Math.round($scope.comprasTotal/$scope.ventasTotales*1e4)/100,$scope.costosIndirectosRatio=Math.round($scope.costosIndirectosTotal/$scope.ventasTotales*1e4)/100,$scope.rrhhRatio=Math.round($scope.rrhhTotal/$scope.ventasTotales*1e4)/100,$scope.impuestosRatio=Math.round($scope.impuestosTotal/$scope.ventasTotales*1e4)/100,$scope.resultadoRatio=Math.round($scope.resultadoNeto/$scope.ventasTotales*1e4)/100)}),$scope.loader.isVentas=!0,$http.put("/api/ventas",{year:year,month:month,enterprise:user.enterprise._id,centroDeCosto:$scope.centroDeCosto}).success(function(ventas){$scope.loader.isVentas=!1,ventas.forEach(function(venta){!venta.tipoComprobante||"Factura A"!==venta.tipoComprobante.name&&"Factura B"!==venta.tipoComprobante.name&&"Factura C"!==venta.tipoComprobante.name?$scope.otrosIngresosTotal+=venta.total:$scope.ventasTotal+=venta.total}),$scope.ventasTotales=$scope.ventasTotal+$scope.otrosIngresosTotal,$scope.resultadoBruto=$scope.ventasTotales-($scope.comprasTotal+$scope.costosIndirectosTotal+$scope.rrhhTotal),$scope.resultadoNeto=$scope.resultadoBruto-$scope.impuestosTotal,$scope.ventasTotales&&($scope.ventasRatio=$scope.ventasTotales&&Math.round($scope.ventasTotal/$scope.ventasTotales*1e4)/100,$scope.otrosIngresosRatio=Math.round($scope.otrosIngresosTotal/$scope.ventasTotales*1e4)/100,$scope.comprasRatio=Math.round($scope.comprasTotal/$scope.ventasTotales*1e4)/100,$scope.costosIndirectosRatio=Math.round($scope.costosIndirectosTotal/$scope.ventasTotales*1e4)/100,$scope.rrhhRatio=Math.round($scope.rrhhTotal/$scope.ventasTotales*1e4)/100,$scope.impuestosRatio=Math.round($scope.impuestosTotal/$scope.ventasTotales*1e4)/100,$scope.resultadoRatio=Math.round($scope.resultadoNeto/$scope.ventasTotales*1e4)/100)}),function(){$scope.loader.isCompras=!0;var period=year+"-"+month;$http.put("/api/compras",{year:year,month:month,period:period,enterprise:user.enterprise._id,centroDeCosto:$scope.centroDeCosto}).success(function(compras){$scope.loader.isCompras=!1,console.log(compras),compras.forEach(function(compra){$scope.comprasTotal+=compra.total}),$scope.ventasTotales=$scope.ventasTotal+$scope.otrosIngresosTotal,$scope.resultadoBruto=$scope.ventasTotales-($scope.comprasTotal+$scope.costosIndirectosTotal+$scope.rrhhTotal),$scope.resultadoNeto=$scope.resultadoBruto-$scope.impuestosTotal,$scope.ventasTotales&&($scope.ventasRatio=$scope.ventasTotales&&Math.round($scope.ventasTotal/$scope.ventasTotales*1e4)/100,$scope.otrosIngresosRatio=Math.round($scope.otrosIngresosTotal/$scope.ventasTotales*1e4)/100,$scope.comprasRatio=Math.round($scope.comprasTotal/$scope.ventasTotales*1e4)/100,$scope.costosIndirectosRatio=Math.round($scope.costosIndirectosTotal/$scope.ventasTotales*1e4)/100,$scope.rrhhRatio=Math.round($scope.rrhhTotal/$scope.ventasTotales*1e4)/100,$scope.impuestosRatio=Math.round($scope.impuestosTotal/$scope.ventasTotales*1e4)/100,$scope.resultadoRatio=Math.round($scope.resultadoNeto/$scope.ventasTotales*1e4)/100)})}(),$scope.loader.isRRHH=!0,$http.put("/api/empleados",{enterprise:user.enterprise._id,centrodecosto:$scope.centroDeCosto}).success(function(response){var empleados=response;$http.patch("/api/liquidaciones",{month:month,year:year,empList:empleados}).success(function(response){$scope.loader.isRRHH=!1,$scope.rrhhTotal+=response.total,$scope.ventasTotales=$scope.ventasTotal+$scope.otrosIngresosTotal,$scope.resultadoBruto=$scope.ventasTotales-($scope.comprasTotal+$scope.costosIndirectosTotal+$scope.rrhhTotal),$scope.resultadoNeto=$scope.resultadoBruto-$scope.impuestosTotal,$scope.ventasTotales&&($scope.ventasRatio=$scope.ventasTotales&&Math.round($scope.ventasTotal/$scope.ventasTotales*1e4)/100,$scope.otrosIngresosRatio=Math.round($scope.otrosIngresosTotal/$scope.ventasTotales*1e4)/100,$scope.comprasRatio=Math.round($scope.comprasTotal/$scope.ventasTotales*1e4)/100,$scope.costosIndirectosRatio=Math.round($scope.costosIndirectosTotal/$scope.ventasTotales*1e4)/100,$scope.rrhhRatio=Math.round($scope.rrhhTotal/$scope.ventasTotales*1e4)/100,$scope.impuestosRatio=Math.round($scope.impuestosTotal/$scope.ventasTotales*1e4)/100,$scope.resultadoRatio=Math.round($scope.resultadoNeto/$scope.ventasTotales*1e4)/100)})}).error(function(err){console.log("Error: "+err)}),function(){$scope.loader.isCostIndirectos=!0;var navList=ServiceNavigation.getNav();if(""!=year||""!=month)return PagosService.query({isResumen:!0,year:year,month:month,e:user.enterprise._id,centroId:$scope.centroDeCosto,centroName:navList[navList.length-1].name},function(list){$scope.loader.isCostIndirectos=!1,list.forEach(function(item){$scope.costosIndirectosTotal+=item.total}),$scope.ventasTotales=$scope.ventasTotal+$scope.otrosIngresosTotal,$scope.resultadoBruto=$scope.ventasTotales-($scope.comprasTotal+$scope.costosIndirectosTotal+$scope.rrhhTotal),$scope.resultadoNeto=$scope.resultadoBruto-$scope.impuestosTotal,$scope.ventasTotales&&($scope.ventasRatio=$scope.ventasTotales&&Math.round($scope.ventasTotal/$scope.ventasTotales*1e4)/100,$scope.otrosIngresosRatio=Math.round($scope.otrosIngresosTotal/$scope.ventasTotales*1e4)/100,$scope.comprasRatio=Math.round($scope.comprasTotal/$scope.ventasTotales*1e4)/100,$scope.costosIndirectosRatio=Math.round($scope.costosIndirectosTotal/$scope.ventasTotales*1e4)/100,$scope.rrhhRatio=Math.round($scope.rrhhTotal/$scope.ventasTotales*1e4)/100,$scope.impuestosRatio=Math.round($scope.impuestosTotal/$scope.ventasTotales*1e4)/100,$scope.resultadoRatio=Math.round($scope.resultadoNeto/$scope.ventasTotales*1e4)/100)})}().$promise})}]),angular.module("finanzas").factory("Finanzas",["$resource",function($resource){return $resource("api/finanzas/:finanzaId",{finanzaId:"@_id",e:"@enterprise",last:"@last",limit:"@limit",type:"@type"},{update:{method:"PUT"}})}]).factory("ServiceNavigation",["$location",function($location){var inneNavList=[];return{addNav:function(navObj){inneNavList.length>0?-1===inneNavList.map(function(x){return x.name}).indexOf(navObj.name)&&inneNavList.push(navObj):inneNavList.push(navObj);window.localStorage.setItem("subNav",JSON.stringify(inneNavList))},getNav:function(){return inneNavList.length>0?inneNavList:JSON.parse(window.localStorage.getItem("subNav"))},navInit:function(val){inneNavList.splice(0),window.localStorage.removeItem("subNav")},back:function(){window.localStorage.getItem("subNav")&&(inneNavList=JSON.parse(window.localStorage.getItem("subNav")),window.localStorage.removeItem("subNav")),inneNavList.splice(inneNavList.length-1,1),window.localStorage.setItem("subNav",JSON.stringify(inneNavList))}}}]),angular.module("historialCompras").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Historial Compras",state:"historialCompras",type:"dropdown"}),Menus.addSubMenuItem("topbar","historialCompras",{title:"List Historial Compras",state:"historialCompras.list"}),Menus.addSubMenuItem("topbar","historialCompras",{title:"Create Historial Compra",state:"historialCompras.create"})}]),angular.module("historialCompras").config(["$stateProvider",function($stateProvider){$stateProvider.state("historialCompras",{abstract:!0,url:"/historialCompras",template:"<ui-view/>"}).state("historialCompras.list",{url:"",templateUrl:"modules/historialCompras/client/views/list-historialCompras.client.view.html"})}]),angular.module("historialCompras").controller("HistorialComprasController",["$scope",function($scope){}]),angular.module("historialCompras").factory("HistorialCompras",["$resource",function($resource){return $resource("api/historialCompras",{},{update:{method:"PUT"}})}]),angular.module("impuestos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Impuestos",state:"impuestos",type:"dropdown"}),Menus.addSubMenuItem("topbar","impuestos",{title:"List Impuestos",state:"impuestos.list"}),Menus.addSubMenuItem("topbar","impuestos",{title:"Create Impuesto",state:"impuestos.create"})}]),angular.module("impuestos").config(["$stateProvider",function($stateProvider){$stateProvider.state("impuestos",{abstract:!0,url:"/impuestos",template:"<ui-view/>"}).state("impuestos.list",{url:"",templateUrl:"modules/impuestos/views/list-impuestos.client.view.html"}).state("impuestos.create",{url:"/create",templateUrl:"modules/impuestos/views/create-impuesto.client.view.html"}).state("impuestos.view",{url:"/:impuestoId",templateUrl:"modules/impuestos/views/view-impuesto.client.view.html"})}]),angular.module("impuestos").controller("ImpuestosCreateController",["$state","$scope","$stateParams","Impuestos","$rootScope",function($state,$scope,$stateParams,Impuestos,$rootScope){$scope.resetCoefficient=function(){$scope.type||($scope.coefficient=void 0,$scope.automaticoType=void 0)};for(var getMonth=JSON.parse(localStorage.getItem("month")),year=JSON.parse(localStorage.getItem("year")).yearName,month=0,monthList=[{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],idx=0;idx<monthList.length;idx++)if(monthList[idx].name==getMonth.monthName){month=idx;break}$scope.create=function(){if($scope.type){for(var i=0;i<$rootScope.costCenters.length;i++){new Impuestos({name:$scope.name,descripcion:$scope.descripcion?$scope.descripcion:void 0,total:0,coefficient:$scope.coefficient,type:$scope.type,automaticoType:$scope.automaticoType,centroDeCosto:$stateParams.centroDeCosto,month:month,year:year,costcenters:$rootScope.costCenters[i]}).$save(function(response){console.log(response._id),response._id},function(errorResponse){$scope.error=errorResponse.data.message})}$state.go("home.viewImpuesto",{centroDeCosto:$stateParams.centroDeCosto})}else{new Impuestos({name:$scope.name,descripcion:$scope.descripcion?$scope.descripcion:void 0,total:0,coefficient:$scope.coefficient,type:$scope.type,automaticoType:$scope.automaticoType,centroDeCosto:$stateParams.centroDeCosto,month:month,year:year,costcenters:null}).$save(function(response){console.log(response._id),response._id&&$state.go("home.viewImpuesto",{centroDeCosto:$stateParams.centroDeCosto})},function(errorResponse){$scope.error=errorResponse.data.message})}}}]),angular.module("impuestos").controller("ImpuestosDetailsController",["$state","$scope","$rootScope","$filter","$http","$mdDialog","$stateParams","VentasExtra","ComprasExtra","ImpuestosTax",function($state,$scope,$rootScope,$filter,$http,$mdDialog,$stateParams,VentasExtra,ComprasExtra,ImpuestosTax){for(var getMonth=JSON.parse(localStorage.getItem("month")),year=JSON.parse(localStorage.getItem("year")).yearName,month=0,monthList=[{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],idx=0;idx<monthList.length;idx++)if(monthList[idx].name==getMonth.monthName){month=idx;break}if(localStorage.getItem("dateImpuestos")){var date=JSON.parse(localStorage.getItem("dateImpuestos"));year=0!==Object.keys(date).length?date.year:(new Date).getFullYear(),month=0!==Object.keys(date).length?date.month:(new Date).getMonth()}$scope.impuestosName=$stateParams.impuestosName,$scope.impuestosType=$stateParams.impuestosType,$scope.start=!0,$scope.impuestos=[],$scope.ajustars=[],$scope.showAlert=function(ev,obs){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(obs).ariaLabel("Alert Dialog Demo").targetEvent(ev).ok("Cerrar"))},$scope.loadmore=function(){$scope.loading=!0,$scope.start=!1;var last=$scope.impuestos.length?$scope.impuestos[$scope.impuestos.length-1].created:null,limit=$scope.impuestos.length<40?40:20;if("IVA Ventas"==$scope.impuestosName)ImpuestosTax.loadMoreImpuestos($stateParams.impuestosId,last,limit,year,month).then(function(data){console.log("HEEEREEE",data),$scope.impuestos=$scope.impuestos.concat(data.data),$scope.loading=!1,$scope.start=!1,0===data.data.length?$scope.done=!0:$http.get("/api/impuestos/ajustar",{params:{impuestoId:$stateParams.impuestosId,year:year,month:month,last:data.data[data.data.length-1].created}}).then(function(data){$scope.impuestos=$scope.impuestos.concat(data.data)})});else if("IVA Compras"==$scope.impuestosName)ImpuestosTax.loadMoreImpuestos($stateParams.impuestosId,last,limit,year,month).then(function(data){console.log("HEEEREEE",data),$scope.impuestos=$scope.impuestos.concat(data.data),$scope.loading=!1,$scope.start=!1,0===data.data.length?$scope.done=!0:$http.get("/api/impuestos/ajustar",{params:{impuestoId:$stateParams.impuestosId,year:year,month:month,last:data.data[data.data.length-1].created}}).then(function(data){$scope.impuestos=$scope.impuestos.concat(data.data)})});else if("IVA"==$scope.impuestosName){var iva=JSON.parse(localStorage.getItem("ivaType")),costCenter=sessionStorage.getItem("centroDeCosto");costCenter=localStorage.getItem("centroDeCosto");$scope.isIVA=!0,$http.get("/api/impuestos/ajustar",{params:{impuestoId:$stateParams.impuestosId,year:year,month:month,costCenter:costCenter,IVA:$scope.impuestosName,ivaVentas:iva["IVA Ventas"],ivaCompras:iva["IVA Compras"]}}).then(function(data){!function(arr){for(var i=0;i<arr.length;i++)arr[i].totalTax?arr[i].filter_date=arr[i].fechaRecepcion:arr[i].costCenter?arr[i].filter_date=arr[i].presentacionDate:arr[i].montoE?arr[i].filter_date=arr[i].pagoDate:arr[i].filter_date=arr[i].created;var nextItem,newArr=$filter("orderBy")(arr,"-filter_date");for(i=newArr.length-1;i>=0;i--)nextItem=newArr[i+1],newArr[i].saldo=nextItem?newArr[i].montoE?nextItem.saldo-newArr[i].montoE:newArr[i].costCenter?nextItem.saldo+newArr[i].ivaTotal:"IVA Compras"==newArr[i].adjType?nextItem.saldo-newArr[i].price:"IVA Ventas"==newArr[i].adjType?nextItem.saldo+newArr[i].price:newArr[i].totalTax?nextItem.saldo-newArr[i].totalTax:nextItem.saldo:newArr[i].montoE?-newArr[i].montoE:newArr[i].costCenter?newArr[i].ivaTotal:"IVA Compras"==newArr[i].adjType?-newArr[i].price:"IVA Ventas"==newArr[i].adjType?newArr[i].price:newArr[i].totalTax?newArr[i].totalTax:0;$scope.impuestos=newArr}(data.data)})}else ImpuestosTax.loadMoreImpuestos($stateParams.impuestosId,last,limit,year,month).then(function(data){console.log("HEEEREEE",data),$scope.impuestos=$scope.impuestos.concat(data.data),$scope.loading=!1,$scope.start=!1,0===data.data.length?$scope.done=!0:$http.get("/api/impuestos/ajustar",{params:{impuestoId:$stateParams.impuestosId,year:year,month:month,last:data.data[data.data.length-1].created}}).then(function(data){$scope.impuestos=$scope.impuestos.concat(data.data)})})}}]),angular.module("impuestos").controller("ImpuestosListController",["$scope","$http","$mdDialog","costcenters","Impuestos","Presentacion","ServiceNavigation","$rootScope",function($scope,$http,$mdDialog,costcenters,Impuestos,Presentacion,ServiceNavigation,$rootScope){if(DialogControllerNewPre.$inject=["$scope","$mdDialog","$http","item"],this.costcenters=costcenters,localStorage.getItem("dateImpuestos")){var date=JSON.parse(localStorage.getItem("dateImpuestos"));$scope.year=0!==Object.keys(date).length?date.year:(new Date).getFullYear(),$scope.month=0!==Object.keys(date).length?date.month:(new Date).getMonth()}else $scope.year=(new Date).getFullYear(),$scope.month=(new Date).getMonth();$scope.getName=function(name){ServiceNavigation.addNav({name:name}),$rootScope.$broadcast("nav change",!0)},$scope.$watchCollection("year",function(newVal,oldval){localStorage.setItem("year",JSON.stringify({yearName:newVal}))}),$scope.$watchCollection("month",function(newVal,oldval){var elemPos=$scope.monthList.map(function(x){return x.id}).indexOf(newVal);localStorage.setItem("month",JSON.stringify({monthName:$scope.monthList[elemPos].name}))}),$scope.monthList=[{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],$scope.yearList=[],$scope.totalImpuestos={};for(var endYear=(new Date).getFullYear(),startYear=2016;startYear<=endYear;startYear++)$scope.yearList.push(String(startYear));function DialogControllerNewPre($scope,$mdDialog,$http,item){$scope.item=item,$scope.apagarBoton=!1,$scope.present={},$scope.present.ventas=0,$scope.present.iva=0,$scope.present.netas=0,$scope.closeDialog=function(){$mdDialog.hide()},$scope.calc_netas=function(){$scope.present.netas=$scope.present.ventas-$scope.present.iva},$scope.addPresent=function($event,item){13!==$event.keyCode&&0!==$event.keyCode&&void 0!==$event.keyCode||(void 0!==$scope.present.date&&null!==$scope.present.date&&void 0!==$scope.present.cant&&null!==$scope.present.cant&&void 0!==$scope.present.ult&&null!==$scope.present.ult&&void 0!==$scope.present.nro&&null!==$scope.present.nro&&void 0!==$scope.present.ventas&&null!==$scope.present.ventas&&void 0!==$scope.present.iva&&null!==$scope.present.iva&&void 0!==$scope.present.netas&&null!==$scope.present.netas?(new Presentacion({presentacionDate:$scope.present.date,cantComprobantes:$scope.present.cant,ultComprobante:$scope.present.ult,nroCierre:$scope.present.nro,ventasTotal:$scope.present.ventas,ivaTotal:$scope.present.iva,ventasNetas:$scope.present.netas,costCenter:localStorage.getItem("centroDeCosto"),month:new Date($scope.present.date).getMonth(),year:new Date($scope.present.date).getFullYear()}).$save(function(response){response._id&&(console.log(response._id),$rootScope.findImpuestos())},function(errorResponse){console.log("this is error"),$scope.error=errorResponse.data.message}),$mdDialog.hide()):alert("Please complete the fields"))}}$rootScope.findImpuestos=function(){function calcCosto(impuestos,costcenter){$scope.totalImpuestos[costcenter.id]||($scope.totalImpuestos[costcenter.id]=0),impuestos.forEach(function(impuesto){if(costcenter._id===impuesto.centroDeCosto)"IVA Compras"==impuesto.name?$scope.totalImpuestos[costcenter.id]-=impuesto.total:$scope.totalImpuestos[costcenter.id]+=impuesto.total;else if("Default"==impuesto.type){console.log(impuesto.name,"--impusto =>",impuesto.centroDeCosto,impuesto,"--costcenter =>",costcenter.name,costcenter._id);var elem=costcenters.map(function(x){return x._id}).indexOf(impuesto.centroDeCosto);if(-1!==elem){var found=costcenters[elem]._id;"IVA Compras"==impuesto.name?$scope.totalImpuestos[found]?$scope.totalImpuestos[found]-=impuesto.total:$scope.totalImpuestos[found]=0-impuesto.total:$scope.totalImpuestos[found]?$scope.totalImpuestos[found]+=impuesto.total:$scope.totalImpuestos[found]=impuesto.total}}}),$scope.totalImpuestos[costcenter.id]=Math.round(100*$scope.totalImpuestos[costcenter.id])/100}$scope.totalImpuestos={},Impuestos.query({centroDeCosto:null,month:$scope.month,year:$scope.year},function(impuestos){for(var i=0;i<costcenters.length;i++)calcCosto(impuestos,costcenters[i])})},$scope.openMenu=function($mdOpenMenu,ev){sessionStorage.setItem("centroDeCosto",this.item._id),localStorage.setItem("centroDeCosto",this.item._id),ev,$mdOpenMenu(ev)},$scope.showDialogNewPresentation=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/impuestos/views/nueva-presentacion.client.view.html",locals:{item:item},controller:DialogControllerNewPre})},$rootScope.findImpuestos()}]),angular.module("impuestos").controller("ImpuestosPresentacionController",["$state","$scope","$rootScope","$filter","$http","$mdDialog","$stateParams","$timeout","VentasExtra","ComprasExtra","Presentacion","Excel",function($state,$scope,$rootScope,$filter,$http,$mdDialog,$stateParams,$timeout,VentasExtra,ComprasExtra,Presentacion,Excel){DialogControllerNewPre.$inject=["$scope","$mdDialog","$http","item"],$scope.$watchCollection("authentication",function(){$scope.findImpuestos()}),$scope.editing=!1;var getMonth=JSON.parse(localStorage.getItem("month")),getYear=JSON.parse(localStorage.getItem("year"));$rootScope.getPeriod=getMonth.monthName+", "+getYear.yearName;for(var costCenter=sessionStorage.getItem("centroDeCosto"),year=(costCenter=localStorage.getItem("centroDeCosto"),getYear.yearName),month=0,monthList=[{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],idx=0;idx<monthList.length;idx++)if(monthList[idx].name==getMonth.monthName){month=idx;break}function DialogControllerNewPre($scope,$mdDialog,$http,item){$scope.item=item,$scope.apagarBoton=!1,$scope.present={},$scope.present.ventas=0,$scope.present.iva=0,$scope.present.netas=0,$scope.closeDialog=function(){$mdDialog.hide()},$scope.calc_netas=function(){$scope.present.netas=$scope.present.ventas-$scope.present.iva},$scope.addPresent=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.present.date&&null!==$scope.present.date&&void 0!==$scope.present.cant&&null!==$scope.present.cant&&void 0!==$scope.present.ult&&null!==$scope.present.ult&&void 0!==$scope.present.nro&&null!==$scope.present.nro&&void 0!==$scope.present.ventas&&null!==$scope.present.ventas&&void 0!==$scope.present.iva&&null!==$scope.present.iva&&void 0!==$scope.present.netas&&null!==$scope.present.netas){var presentacion=new Presentacion({presentacionDate:$scope.present.date,cantComprobantes:$scope.present.cant,ultComprobante:$scope.present.ult,nroCierre:$scope.present.nro,ventasTotal:$scope.present.ventas,ivaTotal:$scope.present.iva,ventasNetas:$scope.present.netas,costCenter:localStorage.getItem("centroDeCosto"),month:new Date($scope.present.date).getMonth(),year:new Date($scope.present.date).getFullYear()});console.log(presentacion),presentacion.$save(function(response){response._id&&console.log(response._id),alert("ppppppp"),$state.go("home.detailsPresentacion",{impuestosId:localStorage.getItem("centroDeCosto")},{reload:!0})},function(errorResponse){console.log("this is error"),$scope.error=errorResponse.data.message}),$mdDialog.hide()}else alert("Please complete the fields")}}$scope.findImpuestos=function(){Presentacion.query({costCenter:costCenter,month:month,year:year},function(res){console.log(res);for(var newArray=[],i=0;i<res.length;i++)newArray.push(res[i]);$scope.impuestos=newArray})},$scope.impuestosName=$stateParams.impuestosName,$scope.impuestosType=$stateParams.impuestosType,$scope.start=!0,$scope.impuestos=[],$scope.ajustars=[],$scope.loadmore=function(){$scope.loading=!0,$scope.start=!1;$scope.impuestos.length&&$scope.impuestos[$scope.impuestos.length-1].created,$scope.impuestos.length},$scope.deletePresentacion=function(ev,item){console.log(item);var confirm=$mdDialog.confirm().title("¿Eliminar la impuesto?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){item&&(item.$remove(),$state.go("home.detailsPresentacion",{impuestosId:item.costCenter},{reload:!0}))}(item)},function(){})},$scope.change_calc_netas=function(){$scope.editing.ventasNetas=$scope.editing.ventasTotal-$scope.editing.ivaTotal},$scope.editPresentacion=function(item){$scope.editing=item},$scope.updatePresentacion=function(item){console.log(item),$scope.editing=!1,item.user=item.user._id,item.$update(function(){console.log("todo ok")},function(errorResponse){console.log("error")})},$scope.showDialogNewPresentation=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/impuestos/views/nueva-presentacion.client.view.html",locals:{item:item},controller:DialogControllerNewPre})},$scope.exportToExcel=function(tableId){if(!tableId.nodeType)var table=document.getElementById(tableId);var c,ctx={worksheet:"name",table:table.innerHTML};window.location.href="data:application/vnd.ms-excel;base64,"+function(s){return window.btoa(unescape(encodeURIComponent(s)))}((c=ctx,'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(m,p){return c[p]})))}}]),angular.module("impuestos").controller("ImpuestosViewController",["$rootScope","$state","$scope","$http","$stateParams","$mdDialog","user","Impuestos","costcenters",function($rootScope,$state,$scope,$http,$stateParams,$mdDialog,user,Impuestos,costcenters){DialogControllerAjustar.$inject=["$scope","$mdDialog","$http","item"],DialogController.$inject=["$scope","$mdDialog","item","user","PagosService","$filter","Socket","Cajas"],$scope.editing=!1,$scope.coefficient=0,$scope.ajustarPrice=0,$scope.$watchCollection("authentication",function(){localStorage.getItem("centroDeCosto")?""!==$stateParams.centroDeCosto&&$stateParams.centroDeCosto!==localStorage.getItem("centroDeCosto")&&localStorage.setItem("centroDeCosto",$stateParams.centroDeCosto):localStorage.setItem("centroDeCosto",$stateParams.centroDeCosto),$scope.findImpuestos()});var getMonth=JSON.parse(localStorage.getItem("month")),getYear=JSON.parse(localStorage.getItem("year"));$rootScope.getPeriod=getMonth.monthName+", "+getYear.yearName,$scope.total=0,$scope.pagado=0;for(var year=getYear.yearName,month=0,monthList=[{id:0,name:"enero"},{id:1,name:"febrero"},{id:2,name:"marzo"},{id:3,name:"abril"},{id:4,name:"mayo"},{id:5,name:"junio"},{id:6,name:"julio"},{id:7,name:"agosto"},{id:8,name:"septiembre"},{id:9,name:"octubre"},{id:10,name:"noviembre"},{id:11,name:"diciembre"}],idx=0;idx<monthList.length;idx++)if(monthList[idx].name==getMonth.monthName){month=idx.toString();break}year=getYear.yearName||(new Date).getFullYear();function calcTotal(arr){for(var total=0,pagado=0,i=0;i<arr.length;i++)arr[i].costCenter&&(total+=arr[i].ivaTotal),"IVA Compras"==arr[i].adjType&&(total-=arr[i].price),"IVA Ventas"==arr[i].adjType&&(total+=arr[i].price),arr[i].totalTax&&(total-=arr[i].totalTax),arr[i].montoE&&(pagado-=arr[i].montoE);$scope.total=total,$scope.pagado=-pagado}$rootScope.getPeriod=getMonth.monthName+", "+getYear.yearName;var tax={};function DialogControllerAjustar($scope,$mdDialog,$http,item){$scope.item=item,$scope.apagarBoton=!1,$scope.adjust={},$scope.ivaType=function(iva,item){"IVA Ventas"==iva?$scope.iva=iva:"IVA Compras"==iva&&($scope.iva=iva)},$scope.closeDialog=function(){$mdDialog.hide()},$scope.addAjustar=function($event,item){13!==$event.keyCode&&0!==$event.keyCode&&void 0!==$event.keyCode||(void 0!==$scope.adjust.ajustarPrice&&null!==$scope.adjust.ajustarPrice?(console.log($scope.adjust.date),console.log($scope.adjust.date.getMonth()),console.log(year),$http.put("/api/impuestos/ajustar",{impuestoId:"Automatico"!==item.type?$rootScope.ivaFilter[$scope.iva]:item._id,month:$scope.adjust.date.getMonth(),year:year,created:$scope.adjust.date,price:$scope.adjust.ajustarPrice,observacion:$scope.adjust.observaciones,costcenter:item.centroDeCosto,ivaType:$scope.iva}).success(function(response){$state.go("home.viewImpuesto",{centroDeCosto:item.centroDeCosto},{reload:!0})}).error(function(err){console.log("Error: "+err)}),$scope.apagarBoton=!0):alert("Please complete the fields"),$mdDialog.hide())}}function DialogController($scope,$mdDialog,item,user,PagosService,$filter,Socket,Cajas){$scope.apagarBoton=!1,$scope.$watchCollection("ServiciosService",function(){$scope.findPago()}),$scope.$watchCollection("Cajas",function(){$scope.findCajas()}),$scope.item=item,$scope.montoE=0,$scope.montoC=0,$scope.errorCaja=void 0,$scope.findCajas=function(){Cajas.query({e:user.enterprise._id},function(data){$scope.cajas=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.closeDialog=function(){$mdDialog.hide()},$scope.findPago=function(){$scope.pagos=PagosService.query({e:user.enterprise._id})},$scope.createPrecentacion=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode){$scope.apagarBoton=!0;($scope.numero||0).length;if($scope.pagoDate)year=new Date($scope.pagoDate).getFullYear(),month=new Date($scope.pagoDate).getMonth();else{var period=(new Date).setMonth(month);$scope.pagoDate=new Date(period),year=new Date($scope.pagoDate).getFullYear(),month=new Date($scope.pagoDate).getMonth()}localStorage.getItem("centroDeCosto");var sendObj={enterprise:user.enterprise._id,created:new Date,month:month,year:year,ventasTotal:$scope.montoE,costCenter:item._id,presentacionDate:$scope.pagoDate};$http.post("/api/presentacion",sendObj).then(function(res){console.log(res);var total=0;Impuestos.get({impuestoId:item._id},function(impuesto){"Default"!==impuesto.type&&"IVA Compras"!==impuesto.name?(total=impuesto.total+$scope.montoE,Impuestos.update({_id:item._id,total:total,price:$scope.montoE,observaciones:$scope.observaciones,type:"Manual",date:$scope.pagoDate},function(){$state.go("home.viewImpuesto",{centroDeCosto:item.centroDeCosto},{reload:!0})},function(errorResponse){console.log("costo error")})):item.total+=$scope.montoE})},function(err){console.log(err)}),$mdDialog.hide()}},$scope.createPago=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){$scope.apagarBoton=!0;var numero=$scope.pagos.length+1;if($scope.pagoDate)year=new Date($scope.pagoDate).getFullYear(),month=new Date($scope.pagoDate).getMonth();else{var period=(new Date).setMonth(month);$scope.pagoDate=new Date(period),year=new Date($scope.pagoDate).getFullYear(),month=new Date($scope.pagoDate).getMonth()}var costCenterpago=localStorage.getItem("centroDeCosto"),pago={numero:numero,impuestos:item._id,cajaD:$scope.caja._id,costCenterpago:costCenterpago,montoE:$scope.montoE,montoC:$scope.montoC,created:$scope.pagoDate,pagoDate:$scope.pagoDate,saldo:$scope.caja.total-($scope.montoE+$scope.montoC),observaciones:$scope.observaciones,enterprise:user.enterprise._id,year:year,month:month,type:"impuesto"};Socket.emit("pago.create",pago);var total=0;Impuestos.get({impuestoId:item._id},function(impuesto){"Default"!==impuesto.type&&"IVA Compras"!==impuesto.name?(total=impuesto.total+$scope.montoE+$scope.montoC,Impuestos.update({_id:item._id,total:total},function(){$state.go("home.viewImpuesto",{centroDeCosto:item.centroDeCosto},{reload:!0})},function(errorResponse){console.log("costo error")})):item.pagado+=$scope.montoE}),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja origin"},$scope.addCheque=function(value){$scope.errorCaja=!1,$scope.caja?$scope.caja.cheques>=value?$scope.montoC=value:$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"}}tax.total=0,$rootScope.ivaFilter={},$scope.findImpuestos=function(){Impuestos.query({centroDeCosto:localStorage.getItem("centroDeCosto"),month:month,year:year},function(res){console.log(res);for(var newArray=[],i=0;i<res.length;i++)if("IVA Ventas"==res[i].name||"IVA Compras"==res[i].name&&Object.keys($rootScope.ivaFilter).length<=2){if(res[i]&&($rootScope.ivaFilter[res[i].name]=res[i]._id,tax.total="IVA Ventas"==res[i].name?tax.total+res[i].total:tax.total-res[i].total,2==Object.keys($rootScope.ivaFilter).length)){localStorage.setItem("ivaType",JSON.stringify($rootScope.ivaFilter));var ivaType=JSON.parse(localStorage.getItem("ivaType")),costCenter=localStorage.getItem("centroDeCosto");$scope.isIVA=!0,$http.get("/api/impuestos/ajustar",{params:{impuestoId:ivaType["IVA Ventas"],year:year,month:month,costCenter:costCenter,IVA:"IVA",ivaVentas:ivaType["IVA Ventas"],ivaCompras:ivaType["IVA Compras"]}}).then(function(data){calcTotal(data.data)});var iva={_id:res[i]._id,name:"IVA",created:res[i].created,centroDeCosto:res[i].centroDeCosto,month:res[i].month,year:res[i].year,type:"Default"};newArray.unshift(iva)}}else newArray.push(res[i]);$scope.impuestos=newArray})},$scope.openMenu=function($mdOpenMenu,ev){ev,$mdOpenMenu(ev)},$scope.deleteImpuesto=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la impuesto?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){item&&(item.$remove(),$state.go("home.viewImpuesto",{centroDeCosto:item.centroDeCosto},{reload:!0}))}(item)},function(){})},$scope.editImpuesto=function(item){$scope.coefficient=item.coefficient,$scope.editing=item},$scope.updateImpuesto=function(item){console.log(item),$scope.editing=!1,item.total=item.total/$scope.coefficient*item.coefficient,item.$update(function(){console.log("todo ok")},function(errorResponse){console.log("error")})},$scope.createNewImpuesto=function(){$rootScope.costCenters=costcenters,$state.go("home.createImpuesto",{centroDeCosto:localStorage.getItem("centroDeCosto")})},$scope.showDialogAjustar=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/impuestos/views/ajustar-impuesto.client.view.html",locals:{item:item},controller:DialogControllerAjustar})},$scope.showDialogPago=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/create-presentacion.client.view.html",locals:{item:item,user:user},controller:DialogController})}}]),angular.module("impuestos").factory("Impuestos",["$resource","$http",function($resource,$http){return $resource("api/impuestos/:impuestoId",{impuestoId:"@_id"},{update:{method:"PUT"}})}]).factory("Presentacion",["$resource","$http",function($resource,$http){return $resource("api/presentacion/:presentacionId",{presentacionId:"@_id"},{update:{method:"PUT"}})}]).factory("ImpuestosTax",["$http",function($http){return{loadMoreImpuestos:function(impuesto,last,limit,year,month,iva,ivaVentas,ivaCompras){return $http({method:"get",url:"/api/impuestos/ajustar",params:{impuestoId:impuesto,last:last,limit:limit,year:year,month:month,IVA:iva,ivaVentas:ivaVentas,ivaCompras:ivaCompras}})}}}]).factory("ServiceNavigation",["$location",function($location){var inneNavList=[];return{addNav:function(navObj){inneNavList.length>0?-1===inneNavList.map(function(x){return x.name}).indexOf(navObj.name)&&inneNavList.push(navObj):inneNavList.push(navObj);window.localStorage.setItem("subNav",JSON.stringify(inneNavList))},getNav:function(){return inneNavList.length>0?inneNavList:JSON.parse(window.localStorage.getItem("subNav"))},navInit:function(val){inneNavList.splice(0),window.localStorage.removeItem("subNav")},back:function(){window.localStorage.getItem("subNav")&&(inneNavList=JSON.parse(window.localStorage.getItem("subNav")),window.localStorage.removeItem("subNav")),inneNavList.splice(inneNavList.length-1,1),window.localStorage.setItem("subNav",JSON.stringify(inneNavList))}}}]).factory("Excel",["$window",function($window){return{tableToExcel:function(tableId,worksheetName){var c,ctx={worksheet:worksheetName,table:$(tableId).html()};return"data:application/vnd.ms-excel;base64,"+function(s){return $window.btoa(unescape(encodeURIComponent(s)))}((c=ctx,'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(m,p){return c[p]})))}}}]),angular.module("liquidaciones").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"liquidaciones",state:"liquidaciones",type:"dropdown"}),Menus.addSubMenuItem("topbar","liquidaciones",{title:"List liquidaciones",state:"liquidaciones.list"}),Menus.addSubMenuItem("topbar","liquidaciones",{title:"Create Liquidacion",state:"liquidaciones.create"})}]),angular.module("liquidaciones").config(["$stateProvider",function($stateProvider){$stateProvider.state("liquidaciones",{abstract:!0,url:"/liquidaciones",template:"<ui-view/>"}).state("liquidaciones.list",{url:"",templateUrl:"modules/liquidaciones/views/list-liquidaciones.client.view.html"}).state("liquidaciones.create",{url:"/create",templateUrl:"modules/liquidaciones/views/create-liquidacion.client.view.html"}).state("liquidaciones.view",{url:"/:liquidacionId",templateUrl:"modules/liquidaciones/views/view-liquidacion.client.view.html"}).state("liquidaciones.edit",{url:"/:liquidacionId/edit",templateUrl:"modules/liquidaciones/views/edit-liquidacion.client.view.html"})}]),angular.module("liquidaciones").controller("LiquidacionCreateController",["user","$state","$filter","$scope","$http","$stateParams","Empleados","Authentication","Liquidaciones",function(user,$state,$filter,$scope,$http,$stateParams,Empleados,Authentication,Liquidaciones){$scope.authentication=Authentication,$scope.minLengthPersonal=0,$scope.remuneraciones=[],$scope.modoEditar=[],$scope.addedConceptos=[],$scope.totalLiqudacion=0,$scope.fechaDeLiquidacion=new Date,$scope.fechaDeLiquidacion2=new Date,$scope.rrhh=void 0,$scope.editing=!1,$scope.fromPersonal=!1,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findPersonal(),$stateParams.empleadoId&&($scope.fromPersonal=!0),$stateParams.liquidacionId&&($scope.editing=!0,$scope.findOne())}),$scope.searchTextChangePersonal=function(text){return $filter("filter")($scope.personal,{deleted:!1,$:text})},$scope.searchTextChangeConcepto=function(text){return $filter("filter")($scope.remuneraciones,{$:text})},$scope.selectedItemChange=function(item){$scope.rrhh=item,$scope.remuneraciones=item&&item.userLogin&&item.userLogin.remuneraciones||[]},$scope.selectedItemChangeConcepto=function(item){$scope.concepto=item},$scope.findOne=function(){$http({method:"GET",url:"/api/liquidaciones/"+$stateParams.liquidacionId}).then(function(res){$scope.liquidacion=res.data,$scope.findPersonal($scope.liquidacion.empleado._id),$scope.observaciones=$scope.liquidacion.observaciones,$scope.fechaDeLiquidacion=new Date($scope.liquidacion.fechaDeLiquidacion),$scope.fechaDeLiquidacion2=new Date($scope.liquidacion.fechaDeLiquidacion2),$scope.totalLiqudacion=$scope.liquidacion.total,$scope.addedConceptos=$scope.liquidacion.remuneraciones,$scope.modoEditar=new Array($scope.addedConceptos.length).fill(!1);for(var i=0;i<$scope.addedConceptos.length;i++)$scope.addedConceptos[i].totalAll=$scope.addedConceptos[i].cantidad*$scope.addedConceptos[i].total},function(err){console.log("Error"+err)})},$scope.findPersonal=function(empleadoId){var empleado=empleadoId||null;void 0!==$scope.SEARCH?Empleados.query({e:$scope.SEARCH.enterprise},function(response){if($scope.personal=response,$stateParams.empleadoId||empleado)for(var i=0;i<$scope.personal.length;i++)$scope.personal[i]._id!=$stateParams.empleadoId&&$scope.personal[i]._id!=empleado||($scope.rrhh=$scope.personal[i])}):Empleados.query({},function(response){if($scope.personal=response,$stateParams.empleadoId||empleado)for(var i=0;i<$scope.personal.length;i++)$scope.personal[i]._id!=$stateParams.empleadoId&&$scope.personal[i]._id!=empleado||($scope.rrhh=$scope.personal[i])})},$scope.sendRRHH=function($event,rrhh){13===$event.keyCode&&($event.preventDefault(),null===rrhh||void 0===rrhh?$scope.mensajePer="No seleccionaste un personal valido":$scope.rrhh=personal)},$scope.addConcepto=function(concepto){concepto.totalAll=concepto.total*concepto.cantidad,$scope.modoEditar.push(!1),checkIfAlreadyIn(concepto)?$scope.error="The concepto is already in the list":($scope.addedConceptos.push(concepto),$scope.totalLiqudacion+=concepto.totalAll)};var checkIfAlreadyIn=function(concepto){for(var i=0;i<$scope.addedConceptos.length;i++)if($scope.addedConceptos[i]._id==concepto._id)return!0;return!1};$scope.editTrue=function(index){$scope.modoEditar[index]=!0},$scope.updateP=function(index,p){$scope.addedConceptos[index].cantidad=p.cantidad,$scope.totalLiqudacion-=$scope.addedConceptos[index].totalAll,$scope.addedConceptos[index].totalAll=$scope.addedConceptos[index].total*p.cantidad,$scope.totalLiqudacion+=$scope.addedConceptos[index].totalAll,$scope.modoEditar[index]=!1},$scope.eliminarProducto=function(index){$scope.totalLiqudacion-=$scope.addedConceptos[index].totalAll,$scope.addedConceptos.splice(index,1)},$scope.showAdvancedRRHH=function(){$state.go("home.createPersonal")},$scope.showAdvancedConcepto=function(){$state.go("home.viewPersona",{personaId:$scope.rrhh._id})},$scope.clickSubmit=function(){void 0!==$scope.rrhh?0!==$scope.totalLiqudacion?$scope.fechaDeLiquidacion<=$scope.fechaDeLiquidacion2?new Liquidaciones({empleado:$scope.rrhh,enterprise:$scope.rrhh.enterprise,created:new Date,fechaDeLiquidacion:$scope.fechaDeLiquidacion,fechaDeLiquidacion2:$scope.fechaDeLiquidacion2,total:$scope.totalLiqudacion,remuneraciones:$scope.addedConceptos,observaciones:$scope.observaciones}).$save(function(response){response._id&&$state.go("home.liquidaciones",{empleadoId:$scope.rrhh._id,displayName:$scope.rrhh.userLogin.displayName,centroDeCosto:$scope.rrhh.userLogin.centroDeCosto})},function(errorResponse){$scope.error=errorResponse.data.message}):$scope.error="La primer fecha no puede ser mayor que la segunda":$scope.error="Por favor agregar las liquidaciones":$scope.error="Por favor seleccione personal"},$scope.clickUpdate=function(){if(void 0!==$scope.rrhh)if(0!==$scope.totalLiqudacion)if($scope.fechaDeLiquidacion<=$scope.fechaDeLiquidacion2){var liquidacion=$scope.liquidacion;liquidacion.empleado=$scope.rrhh,liquidacion.enterprise=$scope.rrhh.enterprise,liquidacion.created=new Date,liquidacion.fechaDeLiquidacion=$scope.fechaDeLiquidacion,liquidacion.fechaDeLiquidacion2=$scope.fechaDeLiquidacion2,liquidacion.total=$scope.totalLiqudacion,liquidacion.remuneraciones=$scope.addedConceptos,liquidacion.observaciones=$scope.observaciones,$http.put("/api/liquidaciones/"+liquidacion._id,liquidacion).then(function(response){$state.go("home.liquidaciones",{empleadoId:$scope.rrhh._id,displayName:$scope.rrhh.userLogin.displayName,centroDeCosto:$scope.rrhh.userLogin.centroDeCosto})}).catch(function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error="La primer fecha no puede ser mayor que la segunda";else $scope.error="Por favor agregar las liquidaciones";else $scope.error="Por favor seleccione personal"}}]),angular.module("liquidaciones").controller("LiquidacionListController",["$scope","$http","$stateParams","$rootScope","$mdDialog","$state",function($scope,$http,$stateParams,$rootScope,$mdDialog,$state){$scope.centroDeCosto=$stateParams.centroDeCosto,$rootScope.empleadoId=$stateParams.empleadoId,$scope.findLiquidaciones=function(){var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/liquidaciones",{empleadoId:$stateParams.empleadoId,month:date.month,year:date.year}).success(function(response){$scope.liquidaciones=response,$scope.name=$stateParams.displayName}):$http.put("/api/liquidaciones",{empleadoId:$stateParams.empleadoId}).success(function(response){$scope.liquidaciones=response,$scope.name=$stateParams.displayName})},$scope.findLiquidaciones(),$scope.showAlert=function(ev,obs){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(obs).ariaLabel("Alert Dialog Demo").targetEvent(ev).ok("Cerrar"))},$scope.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev)},$scope.removeLiquidacion=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la liquidacion?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){$http.delete("/api/liquidaciones/"+item._id).then(function(res){$state.go("home.liquidaciones",{empleadoId:$stateParams.empleadoId,displayName:$stateParams.displayName,centroDeCosto:$stateParams.centroDeCosto})}).catch(function(err){console.log(err)})},function(){console.log("Error in the liquidacion deletion")})}}]),angular.module("liquidaciones").factory("Liquidaciones",["$resource",function($resource){return $resource("api/liquidaciones/:liquidacionId",{liquidacionId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("movimientos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Movimiento",state:"movimiento",type:"dropdown"}),Menus.addSubMenuItem("topbar","movimientos",{title:"List movimientos",state:"movimientos.list"}),Menus.addSubMenuItem("topbar","movimientos",{title:"Create Movimiento",state:"movimientos.create"})}]),angular.module("movimientos").config(["$stateProvider",function($stateProvider){$stateProvider.state("movimientos",{abstract:!0,url:"/movimientos",template:"<ui-view/>"}).state("movimientos.list",{url:"",templateUrl:"modules/movimientos/views/list-movimientos.client.view.html"}).state("movimiento.create",{url:"/create",templateUrl:"modules/movimientos/views/create-movimiento.client.view.html"}).state("movimientos.view",{url:"/:movimientoId",templateUrl:"modules/movimientos/views/view-movimiento.client.view.html"}).state("movimientos.edit",{url:"/:movimientoId/edit",templateUrl:"modules/movimientos/views/edit-movimiento.client.view.html"})}]),angular.module("movimientos").controller("MovimientosController",["$scope","$rootScope","$stateParams","$location","Authentication","Comprobantes","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Comprobantes,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var comprobante=new Comprobantes({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});comprobante.$save(function(response){response._id&&(comprobante._id=response._id,$rootScope.comprobantes.unshift(comprobante)),$scope.name="",$scope.letra="",$scope.puntoDeVenta="",$scope.modoFacturacion="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(comprobante){if(comprobante)for(var i in comprobante.$remove(),$scope.comprobantes)$scope.comprobantes[i]===comprobante&&$scope.comprobantes.splice(i,1);else $scope.comprobante.$remove(function(){$location.path("comprobantes")})},$scope.update=function(){var comprobante=$scope.comprobante;void 0!==this.enterprise?comprobante.enterprise=this.enterprise._id:comprobante.enterprise=comprobante.enterprise._id,comprobante.$update(function(){$location.path("comprobantes/view/"+comprobante._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.comprobantes=Comprobantes.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findModosF=function(){void 0!==$scope.SEARCH&&($scope.modosF=["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"])},$scope.findOne=function(){console.log($stateParams.comprobanteId,"comprobante id"),$scope.comprobante=Comprobantes.get({comprobanteId:$stateParams.comprobanteId}),console.log($scope.comprobante,"comprobante")}}]),angular.module("movimientos").controller("MovimientosCreateController",["user","movimiento","enterprises","modosFacturacion","$state","movimientos",function(user,movimiento,enterprises,modosFacturacion,$state,movimientos){this.user=user,this.movimiento=movimiento,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.create=function(){new movimientos({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.movimientos")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("movimientos").controller("MovimientoEditController",["user","movimiento","enterprises","modosFacturacion","$location",function(user,movimiento,enterprises,modosFacturacion,$location){this.user=user,this.movimiento=movimiento,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.update=function(){var movimiento=this.movimiento;void 0!==this.enterprise?movimiento.enterprise=this.enterprise._id:movimiento.enterprise=movimiento.enterprise._id;void 0!==this.modoFacturacion?movimiento.modoFacturacion=this.modoFacturacion:movimiento.modoFacturacion=movimiento.modoFacturacion;movimiento.$update(function(){$location.path("movimientos/view/"+movimiento._id)},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("movimientos").controller("ListMovimientosController",["$location","user","movimientos","enterprises",function($location,user,movimientos,enterprises){this.user=user,this.movimientos=movimientos,this.enterprises=enterprises,this.remove=function(movimiento){movimiento?movimiento.$remove():this.movimiento.$remove(function(){$location.path("movimientos")})}}]),angular.module("movimientos").controller("MovimientosViewController",["user","movimiento",function(user,movimiento){this.user=user,this.movimiento=movimiento}]),angular.module("movimientos").factory("Movimientos",["$resource",function($resource){return $resource("api/movimientos/:movimientoId",{movimientoId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("movimientos").factory("MovimientosExtra",["$http",function($http){return{loadMore:function(enterprise,estado,cajaId,last,limit){return $http({method:"get",url:"/api/movimientos/loadmore",params:{e:enterprise,cajaid:cajaId,estado:estado,p:last,limit:limit}})},loadMoreByDate:function(enterprise,estado,cajaId,startdate,enddate){return $http({method:"get",url:"/api/movimientos/loadmorebydate",params:{e:enterprise,cajaid:cajaId,estado:estado,start:startdate,end:enddate}})}}}]),function(){function routeConfig($stateProvider){$stateProvider.state("pagos",{abstract:!0,url:"/pagos",template:"<ui-view/>"}).state("pagos.list",{url:"",templateUrl:"modules/pagos/client/views/list-pagos.client.view.html",controller:"PagosListController",controllerAs:"vm",data:{pageTitle:"Pagos List"}}).state("pagos.create",{url:"/create",templateUrl:"modules/pagos/client/views/form-pago.client.view.html",controller:"PagosController",controllerAs:"vm",resolve:{pagoResolve:newPago},data:{roles:["user","admin"],pageTitle:"Pagos Create"}}).state("pagos.edit",{url:"/:pagoId/edit",templateUrl:"modules/pagos/client/views/form-pago.client.view.html",controller:"PagosController",controllerAs:"vm",resolve:{pagoResolve:getPago},data:{roles:["user","admin"],pageTitle:"Edit Pago {{ pagoResolve.name }}"}}).state("pagos.view",{url:"/:pagoId",templateUrl:"modules/pagos/client/views/view-pago.client.view.html",controller:"PagosController",controllerAs:"vm",resolve:{pagoResolve:getPago},data:{pageTitle:"Pago {{ pagoResolve.name }}"}}).state("pagos.saldo",{url:"/:saldoId",templateUrl:"modules/pagos/client/views/view-saldo.client.view.html",controller:"PagosController",controllerAs:"vm",resolve:{pagoResolve:getPago},data:{pageTitle:"Saldo {{ pagoResolve.name }}"}})}function getPago($stateParams,PagosService){return PagosService.get({pagoId:$stateParams.pagoId}).$promise}function newPago(PagosService){return new PagosService}angular.module("pagos").config(routeConfig),routeConfig.$inject=["$stateProvider"],getPago.$inject=["$stateParams","PagosService"],newPago.$inject=["PagosService"]}(),angular.module("pagos").controller("LiquidacionCreateController",["user","$state","$filter","$scope","$http","$stateParams","Empleados","Authentication","Liquidaciones",function(user,$state,$filter,$scope,$http,$stateParams,Empleados,Authentication,Liquidaciones){$scope.authentication=Authentication,$scope.minLengthPersonal=0,$scope.remuneraciones=[],$scope.modoEditar=[],$scope.addedConceptos=[],$scope.totalLiqudacion=0,$scope.fechaDeLiquidacion=new Date,$scope.fechaDeLiquidacion2=new Date,$scope.rrhh=void 0,$scope.editing=!1,$scope.fromPersonal=!1,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findPersonal(),$stateParams.empleadoId&&($scope.fromPersonal=!0),$stateParams.liquidacionId&&($scope.editing=!0,$scope.findOne())}),$scope.searchTextChangePersonal=function(text){return $filter("filter")($scope.personal,{deleted:!1,$:text})},$scope.searchTextChangeConcepto=function(text){return $filter("filter")($scope.remuneraciones,{$:text})},$scope.selectedItemChange=function(item){$scope.rrhh=item,$scope.remuneraciones=item&&item.userLogin&&item.userLogin.remuneraciones||[]},$scope.selectedItemChangeConcepto=function(item){$scope.concepto=item},$scope.findOne=function(){$http({method:"GET",url:"/api/liquidaciones/"+$stateParams.liquidacionId}).then(function(res){$scope.liquidacion=res.data,$scope.findPersonal($scope.liquidacion.empleado._id),$scope.observaciones=$scope.liquidacion.observaciones,$scope.fechaDeLiquidacion=new Date($scope.liquidacion.fechaDeLiquidacion),$scope.fechaDeLiquidacion2=new Date($scope.liquidacion.fechaDeLiquidacion2),$scope.totalLiqudacion=$scope.liquidacion.total,$scope.addedConceptos=$scope.liquidacion.remuneraciones,$scope.modoEditar=new Array($scope.addedConceptos.length).fill(!1);for(var i=0;i<$scope.addedConceptos.length;i++)$scope.addedConceptos[i].totalAll=$scope.addedConceptos[i].cantidad*$scope.addedConceptos[i].total},function(err){console.log("Error"+err)})},$scope.findPersonal=function(empleadoId){var empleado=empleadoId||null;void 0!==$scope.SEARCH?Empleados.query({e:$scope.SEARCH.enterprise},function(response){if($scope.personal=response,$stateParams.empleadoId||empleado)for(var i=0;i<$scope.personal.length;i++)$scope.personal[i]._id!=$stateParams.empleadoId&&$scope.personal[i]._id!=empleado||($scope.rrhh=$scope.personal[i])}):Empleados.query({},function(response){if($scope.personal=response,$stateParams.empleadoId||empleado)for(var i=0;i<$scope.personal.length;i++)$scope.personal[i]._id!=$stateParams.empleadoId&&$scope.personal[i]._id!=empleado||($scope.rrhh=$scope.personal[i])})},$scope.sendRRHH=function($event,rrhh){13===$event.keyCode&&($event.preventDefault(),null===rrhh||void 0===rrhh?$scope.mensajePer="No seleccionaste un personal valido":$scope.rrhh=personal)},$scope.addConcepto=function(concepto){concepto.totalAll=concepto.total*concepto.cantidad,$scope.modoEditar.push(!1),checkIfAlreadyIn(concepto)?$scope.error="The concepto is already in the list":($scope.addedConceptos.push(concepto),$scope.totalLiqudacion+=concepto.totalAll)};var checkIfAlreadyIn=function(concepto){for(var i=0;i<$scope.addedConceptos.length;i++)if($scope.addedConceptos[i]._id==concepto._id)return!0;return!1};$scope.editTrue=function(index){$scope.modoEditar[index]=!0},$scope.updateP=function(index,p){$scope.addedConceptos[index].cantidad=p.cantidad,$scope.totalLiqudacion-=$scope.addedConceptos[index].totalAll,$scope.addedConceptos[index].totalAll=$scope.addedConceptos[index].total*p.cantidad,$scope.totalLiqudacion+=$scope.addedConceptos[index].totalAll,$scope.modoEditar[index]=!1},$scope.eliminarProducto=function(index){$scope.totalLiqudacion-=$scope.addedConceptos[index].totalAll,$scope.addedConceptos.splice(index,1)},$scope.showAdvancedRRHH=function(){$state.go("home.createPersonal")},$scope.showAdvancedConcepto=function(){$state.go("home.viewPersona",{personaId:$scope.rrhh._id})},$scope.clickSubmit=function(){if(void 0!==$scope.rrhh)if(0!==$scope.totalLiqudacion)if(console.log(user),$scope.fechaDeLiquidacion<=$scope.fechaDeLiquidacion2){var liquidacion=new Liquidaciones({empleado:$scope.rrhh,enterprise:user.enterprise._id,created:new Date,fechaDeLiquidacion:$scope.fechaDeLiquidacion,fechaDeLiquidacion2:$scope.fechaDeLiquidacion2,total:$scope.totalLiqudacion,remuneraciones:$scope.addedConceptos,observaciones:$scope.observaciones});console.log(liquidacion),liquidacion.$save(function(response){response._id&&$state.go("home.liquidaciones",{empleadoId:$scope.rrhh._id,displayName:$scope.rrhh.userLogin.displayName,centroDeCosto:$scope.rrhh.userLogin.centroDeCosto})},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error="La primer fecha no puede ser mayor que la segunda";else $scope.error="Por favor agregar las liquidaciones";else $scope.error="Por favor seleccione personal"},$scope.clickUpdate=function(){if(void 0!==$scope.rrhh)if(0!==$scope.totalLiqudacion)if($scope.fechaDeLiquidacion<=$scope.fechaDeLiquidacion2){var liquidacion=$scope.liquidacion;liquidacion.empleado=$scope.rrhh,liquidacion.enterprise=$scope.rrhh.enterprise,liquidacion.created=new Date,liquidacion.fechaDeLiquidacion=$scope.fechaDeLiquidacion,liquidacion.fechaDeLiquidacion2=$scope.fechaDeLiquidacion2,liquidacion.total=$scope.totalLiqudacion,liquidacion.remuneraciones=$scope.addedConceptos,liquidacion.observaciones=$scope.observaciones,$http.put("/api/liquidaciones/"+liquidacion._id,liquidacion).then(function(response){$state.go("home.liquidaciones",{empleadoId:$scope.rrhh._id,displayName:$scope.rrhh.userLogin.displayName,centroDeCosto:$scope.rrhh.userLogin.centroDeCosto})}).catch(function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.error="La primer fecha no puede ser mayor que la segunda";else $scope.error="Por favor agregar las liquidaciones";else $scope.error="Por favor seleccione personal"}}]),function(){function HistoryController($scope,$state,$window,Authentication,pago){var vm=this;vm.authentication=Authentication,vm.pago=pago,vm.error=null,vm.form={},vm.remove=function(){$window.confirm("Are you sure you want to delete?")&&vm.pago.$remove($state.go("pagos.list"))},vm.save=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","vm.form.pagoForm"),!1;vm.pago._id?vm.pago.$update(successCallback,errorCallback):vm.pago.$save(successCallback,errorCallback);function successCallback(res){$state.go("pagos.view",{pagoId:res._id})}function errorCallback(res){vm.error=res.data.message}}}angular.module("pagos").controller("HistoryController",HistoryController),HistoryController.$inject=["$scope","$state","$window","Authentication","pagoResolve"]}(),function(){function PagosListController(PagosService){this.pagos=PagosService.query()}angular.module("pagos").controller("PagosListController",PagosListController),PagosListController.$inject=["PagosService"]}(),function(){function PagosController($scope,$state,$window,Authentication,pago){var vm=this;vm.authentication=Authentication,vm.pago=pago,vm.error=null,vm.form={},vm.remove=function(){$window.confirm("Are you sure you want to delete?")&&vm.pago.$remove($state.go("pagos.list"))},vm.save=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","vm.form.pagoForm"),!1;vm.pago._id?vm.pago.$update(successCallback,errorCallback):vm.pago.$save(successCallback,errorCallback);function successCallback(res){$state.go("pagos.view",{pagoId:res._id})}function errorCallback(res){vm.error=res.data.message}}}angular.module("pagos").controller("PagosController",PagosController),PagosController.$inject=["$scope","$state","$window","Authentication","pagoResolve"]}(),angular.module("pagos").controller("HistoryViewController",["$stateParams","$state","user","Authentication","$mdDialog","$scope","pago","servicios","Cajas","CostosindirectosService","Empleados","Impuestos","$rootScope","ServiceNavigation","PagosService",function($stateParams,$state,user,authentication,$mdDialog,$scope,pago,servicios,Cajas,CostosindirectosService,Empleados,Impuestos,$rootScope,ServiceNavigation,PagosService){DialogController.$inject=["$scope","$mdDialog","item","user","PagosService","$filter","ServiciosService","Cajas","CostosindirectosService"];var global=this;this.user=user,this.pago=pago,this.servicios=servicios,this.waiting=!1,this.movimientos=[],this.movimientosList=[],this.pagoType=null,this.openMenu=function($mdOpenMenu,ev){ev,$mdOpenMenu(ev)},this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la pago?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){item&&(item.deleted=!0,item.$update(function(){var total=0;Cajas.get({cajaId:item.cajaD},function(caja){caja.total=caja.total+item.montoE+item.montoC,caja.cheques=caja.cheques+item.montoC,caja.efectivo=caja.efectivo+item.montoE,caja.enterprise=caja.enterprise._id,item.cajaD=caja,caja.$update(function(){""!==$stateParams.impuestosId?Impuestos.get({impuestoId:item.impuestos._id},function(impuesto){impuesto.total=impuesto.total-(item.montoE+item.montoC),impuesto.$update(function(){$state.go("home.viewImpuesto",{centroDeCosto:item.impuestos.centroDeCosto})},function(errorResponse){console.log("costo error")})}):""!==$stateParams.empleadoId?console.log("liquid"):(servicios.pagoAcumulados=servicios.pagoAcumulados-(item.montoC+item.montoE),servicios.$update(function(){CostosindirectosService.get({costosindirectoId:servicios.costosindirectos},function(costo){total=costo.total-(item.montoC+item.montoE),costo.total=total,costo.enterprise=costo.enterprise.id,costo.$update(function(){$state.go("home.viewPago",{servicosId:$stateParams.servicosId})},function(errorResponse){console.log(errorResponse)})})},function(errorResponse){console.log("servicios error")}))},function(errorResponse){console.log("caja error")})})},function(errorResponse){console.log("pago error")}))}(item)},function(){})},this.findMovimientos=function(pago){this.waiting=!0,this.movimientosList=pago,this.waiting=!1},this.showAlert=function(ev,obs){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(obs).ariaLabel("Alert Dialog Demo").targetEvent(ev).ok("Cerrar"))},this.showDialogPago=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/edit-pago.client.view.html",locals:{item:item,user:global.user},controller:DialogController}).then(function(answer){},function(){})},this.findMovimientos(pago),""!==$stateParams.servicosId?this.pagoType="costosIndirectos":""!==$stateParams.impuestosId?this.pagoType="impuestos":""!==$stateParams.empleadoId&&(this.pagoType="personal",this.displayName=$stateParams.displayName,this.centroDeCosto=$stateParams.centroDeCosto,Empleados.get({empleadoId:$stateParams.empleadoId},function(response){$scope.empleado=response})),console.log(pago),this.serviceDetailList=pago,this.serviceName=localStorage.getItem("serviceName"),this.showComfirmServiceDetail=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la pago?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){var strToArr=$stateParams.servicosId.split("/");PagosService.query({e:user.enterprise._id,type:"deleteService",id:item.id,serviceId:strToArr[0]},function(data){console.log(data),self.serviceDetailList=data})}(item)},function(){})};var self=this;function DialogController($scope,$mdDialog,item,user,PagosService,$filter,ServiciosService,Cajas,CostosindirectosService){$scope.apagarBoton=!1,$scope.$watchCollection("ServiciosService",function(){$scope.findPago()}),$scope.$watchCollection("Cajas",function(){$scope.findCajas()}),$scope.mostrar=!0,$scope.item=item,$scope.caja=item.cajaD,$scope.costCenterAgregados=[],$scope.montoE=item.montoE,$scope.montoC=item.montoC,$scope.observaciones=item.observaciones,$scope.pagoDate=new Date(item.pagoDate),$scope.errorCaja=void 0,$scope.findCajas=function(){Cajas.query({e:user.enterprise._id},function(data){$scope.cajas=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.closeDialog=function(){$mdDialog.hide()},$scope.serviciosIDArray=[],$scope.findPago=function(){$scope.pagos=PagosService.query({e:user.enterprise._id})},$scope.editFactura=function($event,item){13!==$event.keyCode&&0!==$event.keyCode&&void 0!==$event.keyCode||CostosindirectosService.get({costosindirectoId:servicios.costosindirectos},function(costo){costo.facturaEdit=item,costo.$update(function(data){console.log(data),self.serviceDetailList=costo.operacion,console.log("costo updated")},function(errorResponse){console.log(errorResponse)})})},$scope.editPago=function($event,values){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){$scope.apagarBoton=!0;var diffMontoE=$scope.montoE-item.montoE,diffMontoC=$scope.montoC-item.montoC;item.montoE=0!=diffMontoE?item.montoE+diffMontoE:item.montoE,item.montoC=0!=diffMontoC?item.montoC+diffMontoC:item.montoC,item.saldo=0!=diffMontoE?item.saldo-diffMontoE:item.saldo,item.saldo=0!=diffMontoC?item.saldo-diffMontoC:item.saldo,item.pagoDate=$scope.pagoDate,item.observaciones=$scope.observaciones,item.$update(function(){Cajas.get({cajaId:item.cajaD},function(caja){caja.total=0!=diffMontoE?caja.total-diffMontoE:caja.total,caja.total=0!=diffMontoC?caja.total-diffMontoC:caja.total,caja.cheques=0!=diffMontoC?caja.cheques-diffMontoC:caja.cheques,caja.efectivo=0!=diffMontoE?caja.efectivo-diffMontoE:caja.efectivo,caja.enterprise=caja.enterprise.id,item.cajaD=caja,caja.$update(function(){console.log("caja updated"),""!==$stateParams.impuestosId?Impuestos.get({impuestoId:item.impuestos._id},function(impuesto){impuesto.total=impuesto.total+(diffMontoE||0)+(diffMontoC||0),impuesto.$update(function(){$state.go("home.viewImpuesto",{centroDeCosto:item.impuestos.centroDeCosto})},function(errorResponse){console.log("costo error")})}):(servicios.pagoAcumulados=0!=diffMontoE?servicios.pagoAcumulados+diffMontoE:servicios.pagoAcumulados,servicios.pagoAcumulados=0!=diffMontoC?servicios.pagoAcumulados+diffMontoC:servicios.pagoAcumulados,servicios.$update(function(){CostosindirectosService.get({costosindirectoId:servicios.costosindirectos},function(costo){costo.total=0!=diffMontoE?costo.total+diffMontoE:costo.total,costo.total=0!=diffMontoC?costo.total+diffMontoC:costo.total,costo.enterprise=costo.enterprise.id,costo.$update(function(){console.log("costo updated"),$state.go("home.viewPago",{servicosId:$stateParams.servicosId})},function(errorResponse){console.log(errorResponse)})})},function(errorResponse){console.log("servicios error")}))},function(errorResponse){console.log("caja error")})})},function(error){console.log(error)}),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja origin"},$scope.pagosAcumulados=item.pagoAcumulados,$scope.addPagoAcumulados=function(value){$scope.errorCaja=!1,$scope.caja?$scope.caja.efectivo+item.montoE>=value?($scope.montoE=value,$scope.pagosAcumulados=item.pagoAcumulados+$scope.montoC+$scope.montoE):$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"},$scope.addCheque=function(value){$scope.errorCaja=!1,$scope.caja?$scope.caja.cheques>=value?($scope.montoC=value,$scope.pagosAcumulados=item.pagoAcumulados+$scope.montoC+$scope.montoE):$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"}}$rootScope.$broadcast("hide nav",!0),$scope.rutaVolver=function(){history.back()},$scope.callAddPago=function($event,item){$rootScope.$emit("callAddPago",{event:$event,item:item})}}]),angular.module("pagos").controller("PagosViewController",["$stateParams","$state","$http","user","Authentication","$mdDialog","$scope","pago","servicios","Cajas","CostosindirectosService","Empleados","Impuestos","$rootScope","ServiceNavigation","PagosService","Liquidaciones",function($stateParams,$state,$http,user,authentication,$mdDialog,$scope,pago,servicios,Cajas,CostosindirectosService,Empleados,Impuestos,$rootScope,ServiceNavigation,PagosService,Liquidaciones){DialogController.$inject=["$scope","$mdDialog","item","user","global","PagosService","$filter","ServiciosService","Cajas","CostosindirectosService","Liquidaciones"];var global=this;this.user=user,this.pago=pago,this.fromDate="All",this.servicios=servicios,this.waiting=!1,this.movimientos=[],this.movimientosList=[],this.pagoType=null,this.openMenu=function($mdOpenMenu,ev){ev,$mdOpenMenu(ev)},this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la pago?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){console.log(self),item.deleted=!0,item.$update(function(){console.log("updated")})}(item)},function(){})},this.showAlertLiquidacion=function($event,item){$mdDialog.show({targetEvent:$event,template:'<md-dialog aria-label="List dialog">  <md-dialog-content>    <md-list>      <md-list-item >         <h2>{{observaciones}}</h2>      </md-list-item>       <br>        <md-list-item >        <h2 style = \'font-weight:bold;\'>{{concepto}}&nbsp&nbsp</h2>        <h2 style = \'font-style:italic;\'>{{period}}</h2>    </md-list-item></md-list>  </md-dialog-content>  <md-dialog-actions>    <md-button ng-click="closeDialog()" class="md-primary">      Cerrar    </md-button>  </md-dialog-actions></md-dialog>',locals:{item:item,user:global.user,global:global},controller:DialogController}).then(function(answer){},function(){})},this.findLiquidaciones=function(){var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/liquidaciones",{empleadoId:$stateParams.empleadoId,month:date.month,year:date.year}).success(function(response){$scope.liquidaciones=response,$scope.name=$stateParams.displayName}):$http.put("/api/liquidaciones",{empleadoId:$stateParams.empleadoId}).success(function(response){$scope.liquidaciones=response,$scope.name=$stateParams.displayName})},this.findLiquidaciones(),this.findMovimientos=function(pago){this.waiting=!0,this.movimientosList=pago,this.waiting=!1,$scope.movimientosList=pago;var date=JSON.parse(localStorage.getItem("dateEmpleados"));date&&(date.month||date.year)?$http.put("/api/liquidaciones",{empleadoId:$stateParams.empleadoId,month:"",year:date.year}).success(function(response){$scope.liquidaciones=response,$scope.name=$stateParams.displayName,global.saldos=sort($scope.movimientosList,$scope.liquidaciones)}):$http.put("/api/liquidaciones",{empleadoId:$stateParams.empleadoId}).success(function(response){$scope.liquidaciones=response,$scope.name=$stateParams.displayName,global.saldos=sort($scope.movimientosList,$scope.liquidaciones)})},this.showAlert=function(ev,obs){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(obs).ariaLabel("Alert Dialog Demo").targetEvent(ev).ok("Cerrar"))},this.showDialogPago=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/edit-pago.client.view.html",locals:{item:item,user:global.user,global:global},controller:DialogController}).then(function(answer){},function(){})},this.showDialogSaldo=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/pagos/views/edit-saldo.client.view.html",locals:{item:item,user:global.user,global:global},controller:DialogController}).then(function(answer){},function(){})},this.findMovimientos(pago),""!==$stateParams.servicosId?this.pagoType="costosIndirectos":""!==$stateParams.impuestosId?this.pagoType="impuestos":""!==$stateParams.empleadoId&&(this.pagoType="personal",this.displayName=$stateParams.displayName,this.centroDeCosto=$stateParams.centroDeCosto,Empleados.get({empleadoId:$stateParams.empleadoId},function(response){$scope.empleado=response})),this.serviceDetailList=pago,this.saldos=pago,this.serviceName=localStorage.getItem("serviceName"),this.showComfirmServiceDetail=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la factura?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){var strToArr=$stateParams.servicosId.split("/"),month=getMonth.monthId,year=getYear.yearName;PagosService.query({e:user.enterprise._id,type:"deleteService",id:item.id,serviceId:strToArr[0],month:month,year:year},function(data){self.serviceDetailList=data})}(item)},function(){})},this.removeSaldo=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la liquidacion?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){"pago"==item.type?(console.log(self),item.deleted=!0,item.$update(function(){var total_saldo=0;for(var i in self.saldos)self.saldos[i].deleted||(self.saldos[i].remuneraciones?(total_saldo+=self.saldos[i].remuneraciones[0].total*self.saldos[i].remuneraciones[0].cantidad,self.saldos[i].saldo=total_saldo):(total_saldo-=self.saldos[i].montoE+self.saldos[i].montoC,self.saldos[i].saldo=total_saldo))})):$http.delete("/api/liquidaciones/"+item._id).then(function(res){item.deleted=!0,console.log(self);var total_saldo=0;for(var i in self.saldos)self.saldos[i].deleted||(self.saldos[i].remuneraciones?(total_saldo+=self.saldos[i].remuneraciones[0].total*self.saldos[i].remuneraciones[0].cantidad,self.saldos[i].saldo=total_saldo):(total_saldo-=self.saldos[i].montoE+self.saldos[i].montoC,self.saldos[i].saldo=total_saldo))}).catch(function(err){console.log(err)})},function(){console.log("Error in the liquidacion deletion")})};var getMonth=JSON.parse(localStorage.getItem("month")),getYear=JSON.parse(localStorage.getItem("year")),self=this;function sort(pagos,liquidaciones){var saldos=self.saldos.concat(liquidaciones);if(liquidaciones.length>0){saldos.sort(function(a,b){if(a.created&&b.created){var nameA=a.created.toUpperCase(),nameB=b.created.toUpperCase();if(nameA<nameB)return-1;if(nameA>nameB)return 1}return 0});var total_saldo=0;for(var i in saldos)saldos[i].remuneraciones?(saldos[i].type="Liquidacion",total_saldo+=saldos[i].remuneraciones[0].total*saldos[i].remuneraciones[0].cantidad,saldos[i].saldo=total_saldo):(saldos[i].type="pago",total_saldo-=saldos[i].montoE+saldos[i].montoC,saldos[i].saldo=total_saldo)}return saldos}function DialogController($scope,$mdDialog,item,user,global,PagosService,$filter,ServiciosService,Cajas,CostosindirectosService,Liquidaciones){if($scope.apagarBoton=!1,$scope.obs=item.observaciones,"Liquidacion"==item.type){$scope.concepto=item.remuneraciones[0].name,$scope.period=item.fechaDeLiquidacion+" ~ "+item.fechaDeLiquidacion2;var month=new Array;month[0]="Jan",month[1]="Feb",month[2]="Mar",month[3]="Apr",month[4]="May",month[5]="June",month[6]="July",month[7]="Aug",month[8]="Sep",month[9]="Oct",month[10]="Nov",month[11]="Dec";var start_date=new Date(item.fechaDeLiquidacion),end_date=new Date(item.fechaDeLiquidacion2),dd1=start_date.getDate(),mm1=month[start_date.getMonth()],yyyy1=start_date.getFullYear(),dd2=end_date.getDate(),mm2=month[end_date.getMonth()],yyyy2=end_date.getFullYear();$scope.period=dd1+" "+mm1+" "+yyyy1+"~"+dd2+" "+mm2+" "+yyyy2}$scope.$watchCollection("ServiciosService",function(){$scope.findPago()}),$scope.$watchCollection("Cajas",function(){$scope.findCajas()}),$scope.mostrar=!0,$scope.item=item,$scope.caja=item.cajaD,$scope.costCenterAgregados=[],$scope.montoE=item.montoE,$scope.montoC=item.montoC,$scope.observaciones=item.observaciones,$scope.pagoDate=new Date(item.pagoDate),$scope.errorCaja=void 0,$scope.findCajas=function(){Cajas.query({e:user.enterprise._id},function(data){$scope.cajas=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.closeDialog=function(){$mdDialog.hide()},$scope.serviciosIDArray=[],$scope.findPago=function(){$scope.pagos=PagosService.query({e:user.enterprise._id})},$scope.editLiquidacion=function($event,item){13!==$event.keyCode&&0!==$event.keyCode&&void 0!==$event.keyCode||(Liquidaciones.get({liquidacionId:item._id},function(liquidacione){item.newVal;item.remuneraciones[0].total=item.newVal,liquidacione.remuneraciones[0].total=item.newVal,liquidacione.observaciones=item.observaciones,console.log(liquidacione),liquidacione.$update(function(){},function(errorResponse){console.log("pago error")})}),$mdDialog.hide())},$scope.editFactura=function($event,item){13!==$event.keyCode&&0!==$event.keyCode&&void 0!==$event.keyCode||CostosindirectosService.get({costosindirectoId:servicios.costosindirectos},function(costo){costo.facturaEdit=item,costo.$update(function(data){self.serviceDetailList=costo.operacion,console.log("costo updated"),$mdDialog.hide()},function(errorResponse){console.log(errorResponse)})})},$scope.editSaldo=function($event,item,global){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode){if("pago"==item.type){item.newPago,item.montoE,$scope.montoC,item.montoC;var newPago=item.newPago;item.montoE=item.newPago;"string"==typeof item.cajaD?item.cajaD:item.cajaD._id;console.log($scope);var date=new Date($scope.item.pagoDate);console.log(date),date&&"Invalid Date"!=date&&(item.created=date,item.updated=date),PagosService.get({pagoId:item._id},function(pago){pago.montoE=newPago,pago.observaciones=item.observaciones,pago.created=date,pago.$update(function(){console.log("pago updated");var total_saldo=0;for(var i in self.saldos)self.saldos[i].remuneraciones?(self.saldos[i].type="Liquidacion",total_saldo+=self.saldos[i].remuneraciones[0].total*self.saldos[i].remuneraciones[0].cantidad,self.saldos[i].saldo=total_saldo):(self.saldos[i].type="pago",total_saldo-=self.saldos[i].montoE+self.saldos[i].montoC,self.saldos[i].saldo=total_saldo)},function(errorResponse){console.log("pago error")})})}else{console.log("liquedence"),console.log($scope.item);date=new Date($scope.item.facturaDate);console.log(date),item.remuneraciones[0].total=item.newVal/item.remuneraciones[0].cantidad,item.total=item.newVal/item.remuneraciones[0].cantidad,date&&"Invalid Date"!=date&&(item.created=date,item.fechaDeLiquidacion2=date);var liquidacion=item,total_saldo=0;$http.put("/api/liquidaciones/"+liquidacion._id,liquidacion).then(function(response){for(var i in item.remuneraciones[0].total=item.newVal/item.remuneraciones[0].cantidad,self.saldos)"Liquidacion"==self.saldos[i].type?(total_saldo+=self.saldos[i].remuneraciones[0].total*self.saldos[i].remuneraciones[0].cantidad,self.saldos[i].saldo=total_saldo):(total_saldo-=self.saldos[i].montoE+self.saldos[i].montoC,self.saldos[i].saldo=total_saldo)}).catch(function(errorResponse){$scope.error=errorResponse.data.message})}$mdDialog.hide()}},$scope.editPago=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){var diffMontoE=item.newPago-item.montoE,diffMontoC=$scope.montoC-item.montoC,cajaD="string"==typeof item.cajaD?item.cajaD:item.cajaD._id;Cajas.get({cajaId:cajaD},function(caja){caja.total=0!=diffMontoE?caja.total-diffMontoE:caja.total,caja.total=0!=diffMontoC?caja.total-diffMontoC:caja.total,caja.cheques=0!=diffMontoC?caja.cheques-diffMontoC:caja.cheques,caja.efectivo=0!=diffMontoE?caja.efectivo-diffMontoE:caja.efectivo,caja.enterprise=caja.enterprise.id,item.cajaD=caja,console.log(caja),caja.$update(function(){console.log("caja updated"),""!==$stateParams.impuestosId?Impuestos.get({impuestoId:item.impuestos._id},function(impuesto){impuesto.total=impuesto.total+(diffMontoE||0)+(diffMontoC||0),impuesto.$update(function(){$state.go("home.viewImpuesto",{centroDeCosto:item.impuestos.centroDeCosto})},function(errorResponse){console.log("costo error")})}):CostosindirectosService.get({costosindirectoId:servicios.costosindirectos},function(costo){costo.total=0!=diffMontoE?costo.total+diffMontoE:costo.total,costo.total=0!=diffMontoC?costo.total+diffMontoC:costo.total,costo.enterprise=costo.enterprise.id,costo.pagoEdit=item,costo.oldVal=$scope.oldVal,costo.$update(function(){console.log("costo updated"),console.log(costo),console.log(costo.operacion),self.serviceDetailList=costo.operacion},function(errorResponse){console.log(errorResponse)})})},function(errorResponse){console.log(errorResponse),console.log("caja error")})}),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja origin"},$scope.editPago1=function($event,values){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){if($scope.apagarBoton=!0,item.type){diffMontoE=values.newVal-item.montoE,diffMontoC=values.newMontoC-item.montoC;$scope.oldVal=values.montoE,item.montoE=values.newVal,item.pagoDate=values.pagoDate,item.observaciones=values.newObservaciones,item.pagoDate=$scope.pagoDate}else{var diffMontoE=item.newVal-item.montoE,diffMontoC=$scope.montoC-item.montoC;item.montoE=0!=diffMontoE?item.montoE+diffMontoE:item.montoE,item.montoC=0!=diffMontoC?item.montoC+diffMontoC:item.montoC,item.saldo=0!=diffMontoE?item.saldo-diffMontoE:item.saldo,item.saldo=0!=diffMontoC?item.saldo-diffMontoC:item.saldo,item.pagoDate=$scope.pagoDate,item.observaciones=$scope.observaciones}item.$update(function(){Cajas.get({cajaId:item.cajaD},function(caja){caja.total=0!=diffMontoE?caja.total-diffMontoE:caja.total,caja.total=0!=diffMontoC?caja.total-diffMontoC:caja.total,caja.cheques=0!=diffMontoC?caja.cheques-diffMontoC:caja.cheques,caja.efectivo=0!=diffMontoE?caja.efectivo-diffMontoE:caja.efectivo,caja.enterprise=caja.enterprise.id,item.cajaD=caja,caja.$update(function(){console.log("caja updated"),""!==$stateParams.impuestosId?Impuestos.get({impuestoId:item.impuestos._id},function(impuesto){impuesto.total=impuesto.total+(diffMontoE||0)+(diffMontoC||0),impuesto.$update(function(){$state.go("home.viewImpuesto",{centroDeCosto:item.impuestos.centroDeCosto})},function(errorResponse){console.log("costo error")})}):(servicios.pagoAcumulados=0!=diffMontoE?servicios.pagoAcumulados+diffMontoE:servicios.pagoAcumulados,servicios.pagoAcumulados=0!=diffMontoC?servicios.pagoAcumulados+diffMontoC:servicios.pagoAcumulados,servicios.$update(function(){CostosindirectosService.get({costosindirectoId:servicios.costosindirectos},function(costo){costo.total=0!=diffMontoE?costo.total+diffMontoE:costo.total,costo.total=0!=diffMontoC?costo.total+diffMontoC:costo.total,costo.enterprise=costo.enterprise.id,costo.pagoEdit=item,costo.oldVal=$scope.oldVal,costo.$update(function(){console.log("costo updated"),console.log(costo),$state.go("home.viewPago",{servicosId:$stateParams.servicosId})},function(errorResponse){console.log(errorResponse)})})},function(errorResponse){console.log("servicios error")}))},function(errorResponse){console.log("caja error")})})},function(error){console.log(error)}),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja origin"},$scope.pagosAcumulados=item.pagoAcumulados,$scope.addPagoAcumulados=function(value){$scope.errorCaja=!1,$scope.caja?$scope.caja.efectivo+item.montoE>=value?($scope.montoE=value,$scope.pagosAcumulados=item.pagoAcumulados+$scope.montoC+$scope.montoE):$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"},$scope.addCheque=function(value){$scope.errorCaja=!1,$scope.caja?$scope.caja.cheques>=value?($scope.montoC=value,$scope.pagosAcumulados=item.pagoAcumulados+$scope.montoC+$scope.montoE):$scope.errorCaja="amount is not available in selected caja":$scope.errorCaja="Se debe seleccionar la caja origin"}}$rootScope.$broadcast("hide nav",!0),$scope.rutaVolver=function(){history.back()},$scope.callAddPago=function($event,item){$rootScope.$emit("callAddPago",{event:$event,item:item})},$scope.callAddLiquidencion=function($event,item){$rootScope.$emit("callAddLiquidencion",{event:$event,item:item})}}]),function(){function PagosService($resource){return $resource("api/pagos/:pagoId",{pagoId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}angular.module("pagos").factory("PagosService",PagosService),PagosService.$inject=["$resource"]}(),angular.module("pagos").factory("LastMonthTotal",["$http",function($http){return{costosLastMonthTotal:function(controId){return console.log("costor id "+controId),$http({method:"get",url:"api/pagos/getCostoLastMonthTotal",params:{controId:controId}})},serviciosLastMonthTotal:function(){return $http({method:"get",url:"api/pagos/getServiciosLastMonthTotal"})}}}]).factory("ServiceNavigation",["$location",function($location){var inneNavList=[];return{addNav:function(navObj){inneNavList.length>0?-1===inneNavList.map(function(x){return x.name}).indexOf(navObj.name)&&inneNavList.push(navObj):inneNavList.push(navObj);window.localStorage.setItem("subNav",JSON.stringify(inneNavList))},getNav:function(){return inneNavList.length>0?inneNavList:JSON.parse(window.localStorage.getItem("subNav"))},navInit:function(val){inneNavList.splice(0),window.localStorage.removeItem("subNav")},back:function(){window.localStorage.getItem("subNav")&&(inneNavList=JSON.parse(window.localStorage.getItem("subNav")),window.localStorage.removeItem("subNav")),inneNavList.splice(inneNavList.length-1,1),window.localStorage.setItem("subNav",JSON.stringify(inneNavList))}}}]).factory("PagosExtra",["$http",function($http){return{loadMoreByCaja:function(enterprise,last,pagina,limit,cajaId){return $http({method:"get",url:"/api/pagos/loadmorebycaja",params:{e:enterprise,caja:cajaId,p:last,limit:limit,pagina:pagina}})},loadMoreByCajaDate:function(enterprise,startdate,enddate,cajaId){return $http({method:"get",url:"/api/pagos/loadmorebycaja_date",params:{e:enterprise,caja:cajaId,start:startdate,end:enddate}})}}}]),angular.module("pedidos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Pedidos",state:"pedidos",type:"dropdown"}),Menus.addSubMenuItem("topbar","pedidos",{title:"List Pedidos",state:"pedidos.list"}),Menus.addSubMenuItem("topbar","pedidos",{title:"Create Pedido",state:"pedidos.create"})}]),angular.module("pedidos").config(["$stateProvider",function($stateProvider){$stateProvider.state("pedidos",{abstract:!0,url:"/pedidos",template:"<ui-view/>"}).state("pedidos.list",{url:"",templateUrl:"modules/pedidos/views/list-pedidos.client.view.html"}).state("pedidos.create",{url:"/create",templateUrl:"modules/pedidos/views/create-pedido.client.view.html"}).state("pedidos.view",{url:"/:pedidoId",templateUrl:"modules/pedidos/views/view-pedido.client.view.html"}).state("pedidos.edit",{url:"/:pedidoId/edit",templateUrl:"modules/pedidos/views/edit-pedido.client.view.html"})}]),angular.module("pedidos").controller("CreatePedidosController",["$scope","$rootScope","$stateParams","$location","Authentication","Pedidos","Enterprises","$mdBottomSheet","$state","$mdDialog","pedidos","tipoOrden","tipoPedido","Comprobantes","Clients","Providers","Condicionventas","Products","Modal","Contacts","Taxconditions","Categories","Subs","Metrics","Cajas","$filter","$http",function($scope,$rootScope,$stateParams,$location,Authentication,Pedidos,Enterprises,$mdBottomSheet,$state,$mdDialog,pedidos,tipoOrden,tipoPedido,Comprobantes,Clients,Providers,Condicionventas,Products,Modal,Contacts,Taxconditions,Categories,Subs,Metrics,Cajas,$filter,$http){CrearController.$inject=["$scope","$mdDialog","Modal","Providers","Clients","Products"],$scope.authentication=Authentication,$scope.impuesto=!1,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findComprobantes(),$scope.findProveedores(),$scope.findClientes(),$scope.findProductos(),$scope.findCondicionVenta(),function(){if(void 0!==$rootScope.productosAPedir){void 0!==$rootScope.providerStock&&($scope.provider=$rootScope.providerStock),$rootScope.productosAgregados=$rootScope.productosAPedir;for(var total=0,i=$rootScope.productosAgregados.length-1;i>=0;i--){var resultado=calcularSubtotal($rootScope.productosAgregados[i],"compra");total+=resultado}$scope.total=parseFloat(total)+$scope.totalTax,$scope.selectedItemChange($rootScope.providerStock)}else $rootScope.productosAgregados=[],$scope.total=parseFloat(0)}(),"cliente"==$scope.authentication.user.roles[0]&&$http({method:"GET",url:"/api/clients/",params:{}}).then(function(response){var clientes=response.data;$scope.clienteUsuario=$filter("filter")(clientes,function(item){return item.userLogin===$scope.authentication.user._id}),function(){if($scope.descuentoPorcentaje=$scope.clienteUsuario[0].discountRate,0==$scope.subtotal)return 0;$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3}()},function(response){console.log("error")})}),$rootScope.$watchCollection("nuevoProveedor",function(){void 0!==$rootScope.nuevoProveedor?($scope.mostrar=!0,$scope.proveedor=$rootScope.nuevoProveedor,$scope.selectedItemChange($scope.proveedor),$rootScope.nuevoProveedor=void 0):$scope.mostrar=!1}),$rootScope.$watchCollection("nuevoCliente",function(){void 0!==$rootScope.nuevoCliente?($scope.mostrar=!0,$scope.cliente=$rootScope.nuevoCliente,$scope.selectedItemChangeClient($scope.cliente)):$scope.mostrar=!1,$rootScope.nuevoCliente=void 0}),$rootScope.$watchCollection("nuevaMateriaPrima",function(){void 0!==$rootScope.nuevaMateriaPrima?($scope.mostrarMateria=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevaMateriaPrima._id,params:{}}).then(function(response){console.log(response.data),$scope.producto=response.data},function(response){console.log("error")}),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarMateria=!1}),$rootScope.$watchCollection("nuevoProducto",function(){void 0!==$rootScope.nuevoProducto?($scope.producto=$rootScope.nuevoProducto,$scope.mostrarProd=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevoProducto._id,params:{}}).then(function(response){console.log(response.data),$scope.producto=response.data},function(response){console.log("error")}),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarProd=!1}),$rootScope.pedidos=pedidos,$scope.tipoOrden=tipoOrden,$scope.tipoPedido=tipoPedido;$location.$$url;$scope.idProveedor=0,$scope.isFocused=!1;var created=new Date;function n_with_zeroes(number,length){for(var my_string=""+number;my_string.length<length;)my_string="0"+my_string;return my_string}$scope.created=new Date(created.setTime(created.getTime()+108e5)),$scope.buscaP=!0,$scope.myDate=new Date,$scope.tipoComprobante="Pedido",$scope.productoPedido={cantidad:void 0,descuento:void 0,observaciones:""},$scope.deshabilitarProveedor=!1,$scope.fromProveedor=!1,$scope.productoEditado=[],$scope.todosPedidos=[],$scope.initproduct=[],$scope.initprovider=[],$scope.minLengthProv=0,$scope.tipeando=!1,$scope.verAprobadas=0,$scope.verRechazadas=0,$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.imp1=0,$scope.imp2=0,$scope.imp3=0,$scope.imp4=0,$scope.totalImp=0,$scope.totalTax=0,$scope.selectedMode="md-scale",$scope.selectedDirection="left",$scope.rutaVolver=function(){$state.go("home.pedidos",{tipo:$scope.tipoPedido})},$scope.initAutocomplete=function(){$scope.findProductos()},$scope.actualizarN=function(){$scope.numero=parseInt($scope.tipoComprobante.ultimoNumero)+1;var comprobante=$scope.tipoComprobante.name;$scope.impuesto="Factura A"==comprobante||"Factura B"==comprobante||"Factura C"==comprobante},$scope.descProveedor=function(){null!==$scope.proveedor&&void 0!==$scope.proveedor?($scope.idProveedor=$scope.proveedor._id,$scope.errorProv=void 0):$scope.idProveedor=0,void 0!==this.producto&&null!==this.producto&&!1===$scope.tipeando&&(this.producto=void 0,$scope.textToSearch2=void 0)},$scope.descCliente=function(){if($scope.errorCliente=void 0,$scope.mostrarForm=!0,$scope.mostrarProductosC=!1,$scope.mostrarProductosP=!1,$scope.mostrarProductosC=!(0==$scope.cliente.productosAsociados.length),$scope.descuentoPorcentaje=$scope.cliente.discountRate,0==$scope.subtotal)return 0;$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3,$scope.totalTax=$scope.tax1+$scope.tax2+$scope.tax3},$scope.agregar=function(item){$scope.producto=item,item=void 0},$scope.searchTextChangeProduct=function(text){angular.lowercase(text);$scope.productosNombre=$filter("filter")($scope.initproduct,{name:text})},$scope.searchTextChangeProduct2=function(text){$scope.tipeando=!0;angular.lowercase(text);return 0===$scope.idProveedor?$scope.filtrados=$filter("filter")($scope.initproduct,function(item){return!0===item.esMateriaPrima||!0===item.esInsumo}):void 0!==$scope.initproduct&&null!==$scope.initproduct?$scope.filtrados=$filter("filter")($scope.initproduct,function(item){return(!0===item.esMateriaPrima||!0===item.esInsumo)&&item.provider._id===$scope.idProveedor}):console.log("[+] no hay lista de productos para filtrar!!!",$scope.products),$scope.filtroProductos=$filter("filter")($scope.initproduct,{name:text})},$scope.selectedItemChangeProduct=function(item){if($scope.errorProd=void 0,$scope.mensajeP=void 0,$scope.producto=item,null!==$scope.producto&&document.getElementById("cantProd").focus(),"compra"===$scope.tipoPedido)if(null===this.proveedor||void 0===this.proveedor){if(null!==$scope.producto&&void 0!==$scope.producto){var id_array=[];if($scope.producto.provider[0].id)for(var index=0;index<$scope.producto.provider.length;index++)id_array.push($scope.producto.provider[index].id);else{var id="";for(var item_provider in $scope.producto.provider[0])isNaN(item_provider)||(id+=$scope.producto.provider[0][item_provider]);id_array.push(id)}$scope.initprovider=[];for(index=0;index<$scope.proveedores.length;index++)id_array.indexOf($scope.proveedores[index]._id)>-1&&$scope.initprovider.push($scope.proveedores[index])}}else $scope.initprovider=$scope.proveedores},$scope.sendProduct=function($event,productoPedido,producto){13!==$event.keyCode&&"click"!==$event.type||($event.preventDefault(),$scope.isFocused=!1,null===producto||void 0===producto?$scope.mensajeP="No seleccionaste un producto valido":"venta"===$scope.tipoPedido?null===productoPedido.cantidad||void 0===productoPedido.cantidad||producto.unitsInStock<=0?producto.unitsInStock<=0?($scope.mensajeP="Â¡Atencion! El stock disponible es "+producto.unitsInStock,$scope.agregarProducto(producto,productoPedido)):null!==productoPedido.cantidad&&void 0!==productoPedido.cantidad||($scope.mensajeP="No seleccionaste una cantidad para el producto"):($scope.controlStock(producto),1==$scope.stockD?$scope.agregarProducto(producto,productoPedido):($scope.stockD=!1,$scope.mensajeP=void 0,$scope.producto=producto,$scope.agregarProducto(producto,productoPedido))):($scope.mensajeP=void 0,void 0===productoPedido&&(productoPedido={cantidad:0}),null===productoPedido.cantidad||void 0===productoPedido.cantidad||0===productoPedido.cantidad?$scope.mensajeP="No seleccionaste una cantidad para el producto":($scope.mensajeP=void 0,$scope.agregarProducto(producto,productoPedido))))},$scope.controlStock=function(p){$scope.mensajeP=void 0,$scope.productoPedido.cantidad>p.unitsInStock?($scope.stockD=!0,$scope.productoPedido.cantidad=p.unitsInStock):$scope.stockD=!1},$scope.agregarProducto=function(producto,productoPedido){$scope.deshabilitarProveedor=!0,$scope.deshabilitarCliente=!0,$scope.clicked=!1,$scope.errorProd=void 0;var tipoPedido=this.tipoPedido,p={product:{},cantidad:void 0,descuento:void 0,total:void 0,subtotal:void 0,observaciones:void 0};if(void 0==producto)return 0;if(producto.price=0,"compra"!=tipoPedido)for(var i=0;i<producto.catPrice.length;i++)producto.catPrice[i].category==$scope.cliente.category1.category&&(producto.price=producto.catPrice[i].price);if(void 0==producto.total&&(producto.total=0),p.product=producto,console.log($scope.proveedor._id),$scope.proveedor&&producto.provider[0].id)for(var item in producto.provider)if(producto.provider[item].id==$scope.proveedor._id){p.product.costPerUnit=producto.provider[item].price,p.product.tax=producto.provider[item].tax;break}console.log(p),p.cantidad=productoPedido.cantidad,void 0==productoPedido.descuento?p.descuento=0:p.descuento=productoPedido.descuento,void 0==productoPedido.observaciones?p.observaciones="":p.observaciones=productoPedido.observaciones,p.total=0,p.subtotal=0;var resultado=calcularSubtotal(p,tipoPedido);p.total=p.total+resultado,console.log($rootScope.productosAgregados),$rootScope.productosAgregados.push(p),console.log($rootScope.productosAgregados),this.producto=void 0,$scope.producto=void 0,productoPedido=void 0,p=void 0,$scope.productoPedido={cantidad:void 0,descuento:void 0,observaciones:""},this.productoCompra.cantidad=void 0,this.productoCompra.descuento=void 0,this.productoCompra.observaciones=void 0,$scope.selectedProduct=[],$scope.selectedItem=null,$scope.textToSearch2="",$scope.stockD=!1,$scope.providerdisabled=!0,document.getElementById("buscaP").focus(),document.getElementById("buscaP").value=""},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.textToSearch2=null;var calcularSubtotal=function(p,pedido){if("compra"==pedido)if(void 0!==$scope.provider){var prov=$scope.provider;$scope.fromProveedor=!0}else prov=$rootScope.nuevoProveedor;var total,descuentoPorcentaje=p.descuento;if("compra"==pedido)var precio=parseFloat(p.product.costPerUnit);else precio=parseFloat(p.product.price);var cant=parseFloat(p.cantidad),subtotal=parseFloat(precio*cant),descuentoValor=subtotal*descuentoPorcentaje/100;if(p.subtotal=subtotal,total=subtotal-descuentoValor,$scope.subtotal=$scope.subtotal+total,$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,10.5==p.product.tax&&($scope.tax1=$scope.tax1+10.5*total/100),21==p.product.tax&&($scope.tax2=$scope.tax2+21*total/100),27==p.product.tax&&($scope.tax3=$scope.tax3+27*total/100),"compra"==pedido){0!==prov.impuesto1&&($scope.imp1=$scope.imp1+total*prov.impuesto1/100),0!==prov.impuesto2&&($scope.imp2=$scope.imp2+total*prov.impuesto2/100),0!==prov.impuesto3&&($scope.imp3=$scope.imp3+total*prov.impuesto3/100),0!==prov.impuesto4&&($scope.imp4=$scope.imp4+total*prov.impuesto4/100);var totalI=$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4;$scope.totalImp=Math.round(100*totalI)/100}return $scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3+$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4,$scope.totalTax=$scope.tax1+$scope.tax2+$scope.tax3,total};function CrearController($scope,$mdDialog,Modal,Providers,Clients,Products){"compra"==Modal.getTipo()?($scope.tipo="Proveedor",void 0!==$rootScope.provider&&null!==$rootScope.provider&&($scope.provider=$rootScope.provider.name),$scope.categories2=["Materia Prima","Insumo"]):($scope.tipo="Cliente",$scope.categories2=["Productos Terminados"]),$scope.contacts=Modal.getContactos(),$scope.categories=Modal.getCategorias(),$scope.subcategorias=Modal.getSubcategorias(),$scope.taxconditions=Modal.getCondiciones(),$scope.comprobantes=Modal.getComprobantes(),$scope.subs=Modal.getSubs(),$scope.proveedores=Modal.getProveedores(),$scope.taxes=Modal.getTaxes(),$scope.metrics=Modal.getMetrics(),$scope.condicionPagos=Modal.getCondicionesVentas(),$scope.taxconditions2=["Consumidor Final","Responsable Inscripto"],$scope.banco={name:void 0,account:void 0,cbu:void 0,identity:void 0},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.postalCode="1900",$scope.quantityPerUnit=0,$scope.unitsInStock=0,$scope.idealStock=0,$scope.criticalStock=0,$scope.unitPrice=0,$scope.costPerUnit=0,$scope.condicionPago="Efectivo",$scope.taxcondition="Consumidor Final",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged2=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.mostrarFormResponsable=function(){$scope.errorName=void 0,$scope.formResponsableInscripto=!1,$scope.formResponsableInscripto="Responsable Inscripto"===this.taxcondition},$scope.crearProveedor=function(){console.log(this.taxconditionProv,"tax"),console.log(this.condicionPagoProv,"condicion");var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==this.address){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng();if(void 0!==this.category1)if(void 0!==this.taxconditionProv)if(void 0!==this.condicionPagoProv)if(void 0!==this.comprobante){var provider=new Providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPagoProv?this.condicionPagoProv._id:void 0,comprobante:this.comprobante?this.comprobante._id:void 0,banco:this.banco,taxCondition:this.taxconditionProv?this.taxconditionProv._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter?this.costCenter:void 0,paymentMethod:this.paymentMethod?this.paymentMethod:void 0,contacts:this.contact?this.contact._id:void 0,country:this.country,city:this.city,region:this.region?this.region:void 0,postalCode:this.postalCode,address:this.address,phone:this.phone?this.phone:void 0,loc:[latitud,longitud],web:this.web?this.web:0,enterprise:empresa,category1:this.category1?this.category1._id:void 0});provider.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoProveedor=provider,console.log($rootScope.nuevoProveedor)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Indicar el tipo de comprobante";else $scope.errorCondicion="Indicar condicion de pago";else $scope.errorTax="Indicar la condicion de iva";else $scope.errorCategory="Indicar la categoria"}else $scope.errorDir="Indicar la direccion";else $scope.errorNameProv="Indicar la razÃ³n social"},$scope.crearCliente=function(){for(var i in $scope.taxconditions)if($scope.taxconditions[i].name===this.taxcondition)var condicionIva=$scope.taxconditions[i];var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==$scope.place){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),client=new Clients({name:this.name?this.name:this.razonSocial,apellido:this.apellido?this.apellido:void 0,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,taxCondition:condicionIva?condicionIva._id:void 0,discountRate:this.discountRate?this.discountRate:0,loc:[latitud,longitud],paymentMethod:this.paymentMethod?this.paymentMethod:0,contacts:this.contact?[this.contact._id]:[],country:this.country,city:this.city,region:this.region?this.region:void 0,turno:this.turno?this.turno:void 0,postalCode:this.postalCode?this.postalCode:0,address:this.address,phone:this.phone,web:this.web?this.web:void 0,category1:this.category?this.category._id:void 0,enterprise:empresa,productosAsociados:[]});client.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoCliente=client,console.log("nuevoCliente: ",$rootScope.nuevoCliente)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorDir="Se debe indicar una direccion";else!0===$scope.formResponsableInscripto?$scope.errorName="Se debe indicar la Razon Social":$scope.errorName="Se debe indicar un nombre"},$scope.eliminarMensajeError=function(){$scope.errorName=void 0,$scope.errorDir=void 0,$scope.errorNameProv=void 0,$scope.errorComprobante=void 0,$scope.errorCondicion=void 0,$scope.errorTax=void 0,$scope.errorCategory=void 0},$scope.crearMateriaPrima=function(){var esMp=!1,esI=!1;for(var i in $scope.categories)if($scope.categories[i].name===this.category1)var categoria=$scope.categories[i];for(var i in"Insumo"===categoria.name?esI=!0:esMp=!0,$scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;if(void 0===$rootScope.provider){for(var i in $scope.proveedores)if($scope.proveedores[i].name===this.provider)var idProveedorModal=$scope.proveedores[i]._id}else idProveedorModal=$rootScope.provider._id;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.costPerUnit)if(void 0!==this.tax)if(void 0!==this.sub)if(void 0!==categoria.name)if(void 0!==this.category2)if(void 0!==idProveedorModal){var product=new Products({name:this.name,description:this.description,code:this.code,brandName:this.brandName?this.brandName:void 0,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:idProveedorModal,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esInsumo:esI,esMateriaPrima:esMp,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub?this.sub._id:void 0,category1:categoria._id,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevaMateriaPrima=product,console.log($rootScope.nuevaMateriaPrima)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorCategory="Se debe indicar la subcategoria del producto";else $scope.errorCategoria="Indicar la categoria";else $scope.errorSub="Indicar UEN";else $scope.errorIva="Se debe indicar el iva";else $scope.errorCost="Se debe indicar el costo";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"},$scope.borrarErrores=function(){$scope.errorCode=void 0,$scope.errorName=void 0,$scope.errorCost=void 0,$scope.errorIva=void 0,$scope.errorSub=void 0,$scope.errorCategoria=void 0,$scope.errorCategory=void 0,$scope.errorProv=void 0},$scope.crearProducto=function(){var esProd=!1;for(var i in $scope.categories)if($scope.categories[i].name===this.category1)var categoria=$scope.categories[i];for(var i in"Productos Terminados"===categoria.name&&(esProd=!0),$scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.costPerUnit)if(void 0!==this.tax)if(void 0!==this.sub)if(void 0!==categoria.name)if(void 0!==this.category2)if(void 0!==this.provider){var product=new Products({name:this.name,description:this.description,code:this.code,brandName:this.brandName?this.brandName:0,unitPrice:this.unitPrice,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:this.provider._id,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esProducto:esProd,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub._id,category1:categoria._id,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevoProducto=product,console.log($rootScope.nuevoProducto)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorCategory="Se debe indicar la subcategoria del producto";else $scope.errorCategoria="Indicar la categoria";else $scope.errorSub="Indicar UEN";else $scope.errorIva="Se debe indicar el iva";else $scope.errorCost="Se debe indicar el costo";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"}}$scope.cantProductos=function(){if($rootScope.productosAgregados.length>0)return!0},$scope.clickSubmit=function(n){$scope.clicked=!0,$scope.create(n)},$scope.create=function(n){if(!0===$scope.clicked)if(void 0!==$scope.numero&&""!==$scope.numero)if(void 0!==$scope.tipoComprobante&&""!==$scope.tipoComprobante)if(void 0!==$scope.tipoPedido&&""!==$scope.tipoPedido){if("compra"===$scope.tipoPedido)if(0!==$scope.productosAgregados.length)if(void 0!==$scope.proveedor||void 0!=this.proveedor||void 0!==$rootScope.nuevoProveedor)if(void 0!==$scope.condicionVenta&&""!==$scope.condicionVenta){if(!$scope.proveedor||void 0!=this.proveedor||void 0!==$rootScope.nuevoProveedor){if(void 0!==this.proveedor)var proveedor=this.proveedor;else proveedor=$rootScope.nuevoProveedor;if(1===n)var state="borrador";else state="pendiente evaluacion";var pedido=new Pedidos({numero:this.numero,tipoPedido:this.tipoPedido,tipoComprobante:$scope.tipoComprobante,estado:state,puesto:$scope.authentication.user.puesto?$scope.authentication.user.puesto:void 0,products:$rootScope.productosAgregados,category1:$scope.category1?$scope.category1._id:void 0,proveedor:proveedor._id,observaciones:this.observaciones,subtotal:this.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:this.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,totalImp:this.totalImp,total:this.total,myDate:this.myDate,created:$scope.created,condicionVenta:this.condicionVenta._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});$scope.numero=void 0,$scope.tipoComprobante=void 0,$scope.productosAgregados=void 0,$scope.condicionVenta=void 0}}else $scope.errorCondicion="Se debe seleccionar una condicion de compra";else $scope.errorProveedor="Se debe seleccionar un proveedor";else $scope.errorProd="Se deben seleccionar productos para la orden de compra";else if(0!==$scope.productosAgregados.length)if(void 0!==$scope.cliente&&null!==$scope.cliente)if(void 0!==$scope.condicionVenta&&""!==$scope.condicionVenta){if(1===n)state="borrador";else state="pendiente evaluacion";$scope.created=new Date($scope.created.setTime($scope.created.getTime()+108e5));pedido=new Pedidos({numero:parseInt(this.numero),tipoPedido:this.tipoPedido,tipoComprobante:this.tipoComprobante,estado:state,category1:this.category1?this.category1._id:void 0,puesto:$scope.authentication.user.puesto,impuesto:$scope.impuesto,products:$rootScope.productosAgregados,cliente:$scope.cliente._id,delivery:this.delivery,observaciones:this.observaciones,subtotal:this.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:this.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,total:this.total,myDate:this.myDate,created:$scope.created,condicionVenta:this.condicionVenta._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});$scope.numero=void 0,$scope.tipoComprobante=void 0,$scope.productosAgregados=void 0,$scope.cliente=void 0,$scope.condicionVenta=void 0}else $scope.errorCondicion="Se debe seleccionar una condicion de venta";else $scope.errorCliente="Se debe seleccionar un cliente";else $scope.errorProd="Se deben seleccionar productos para la orden de venta";void 0!==pedido&&pedido.$save(function(response){response._id&&(pedido._id=response._id,$rootScope.pedidos.unshift(pedido)),$state.go("home.pedidos",{tipo:$scope.tipoPedido}),$scope.numero=0,$scope.tipoPedido="",$scope.tipoComprobante="",$scope.observaciones="",$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.total=0,$scope.condicionVenta="",$rootScope.nuevoProveedor=void 0,$rootScope.nuevoCliente=void 0,$rootScope.nuevaMateriaPrima=void 0,$rootScope.nuevoProducto=void 0,$rootScope.provider=void 0},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorPedido="Se debe seleccionar un tipo de orden";else $scope.errorTipoComprobante="Se debe seleccionar un tipo de Comprobante";else $scope.errorNumero="Se debe indicar un numero para la orden"},$scope.crearPedidoCliente=function(){var clienteUsuario=$scope.clienteUsuario[0];$scope.created=new Date($scope.created.setTime($scope.created.getTime()+108e5));var pedido=new Pedidos({tipoPedido:"venta",tipoComprobante:clienteUsuario.comprobante._id,estado:"pendiente evaluacion",impuesto:$scope.impuesto,category1:clienteUsuario.category1._id,products:$rootScope.productosAgregados,cliente:clienteUsuario._id,delivery:!1,observaciones:this.observaciones,subtotal:this.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:this.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,total:this.total,myDate:this.myDate,created:$scope.created,condicionVenta:clienteUsuario.condicionPago._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});pedido.$save(function(response){response._id&&(pedido._id=response._id,$rootScope.pedidos.unshift(pedido)),$state.go("home.pedidos",{tipo:$scope.tipoPedido}),$scope.numero=0,$scope.tipoPedido="",$scope.tipoComprobante="",$scope.observaciones="",$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.total=0,$scope.condicionVenta="",$rootScope.nuevoProveedor=void 0,$rootScope.nuevoCliente=void 0,$rootScope.nuevaMateriaPrima=void 0,$rootScope.nuevoProducto=void 0,$rootScope.provider=void 0},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.apagarAvisos=function(){$scope.errorPedido=void 0,$scope.errorCliente=void 0,$scope.errorProveedor=void 0,$scope.errorProd=void 0,$scope.errorCondicion=void 0},$scope.editar=function(index){$scope.productoEditado[index]=!0},$scope.editarProducto=function(index,p){if("compra"==tipoPedido)if(void 0!==$scope.proveedor)var prov=$scope.proveedor;else prov=$rootScope.nuevoProveedor;var tipoPedido=this.tipoPedido,subt=0,tax1=0,tax2=0,tax3=0;if("venta"==tipoPedido){var descuento=p.product.price*p.descuento/100;p.subtotal=p.cantidad*p.product.price,p.total=p.cantidad*(p.product.price-descuento)}if("compra"==tipoPedido){descuento=p.product.costPerUnit*p.descuento/100;p.subtotal=p.cantidad*p.product.costPerUnit,p.total=p.cantidad*(p.product.costPerUnit-descuento)}$rootScope.productosAgregados[index]=p;for(var i=0;i<$rootScope.productosAgregados.length;i++){subt+=$rootScope.productosAgregados[i].total;var iva=$rootScope.productosAgregados[i].product.tax;10.5==iva&&(tax1+=10.5*$rootScope.productosAgregados[i].total/100),21==iva&&(tax2+=21*$rootScope.productosAgregados[i].total/100),27==iva&&(tax3+=27*$rootScope.productosAgregados[i].total/100)}$scope.descuentoValor=subt*$scope.descuentoPorcentaje/100,$scope.subtotal=subt,$scope.neto=subt-$scope.descuentoValor,$scope.tax1=tax1,$scope.tax2=tax2,$scope.tax3=tax3;prov=$scope.proveedor;if("compra"==tipoPedido){0!==prov.impuesto1&&($scope.imp1=$scope.neto*prov.impuesto1/100),0!==prov.impuesto2&&($scope.imp2=$scope.neto*prov.impuesto2/100),0!==prov.impuesto3&&($scope.imp3=$scope.neto*prov.impuesto3/100),0!==prov.impuesto4&&($scope.imp4=$scope.neto*prov.impuesto4/100);var totalI=$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4;$scope.totalImp=Math.round(100*totalI)/100}$scope.totalTax=tax1+tax2+tax3,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3+$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4,this.p=void 0,$scope.productoEditado[index]=!1},$scope.borrarProducto=function(producto){if("compra"==$scope.tipoPedido){if(void 0!==$scope.proveedor)var prov=$scope.proveedor;else prov=$rootScope.nuevoProveedor;if(prov)var totalImpuesto=prov.impuesto1+prov.impuesto2+prov.impuesto3+prov.impuesto4,restoImpuesto=producto.total*totalImpuesto/100}else restoImpuesto=0;this.tipoPedido;var iva,descGen,totalIva,totalI,subt=0,descProd=0,tax1=0,tax2=0,tax3=0;"compra"==$scope.tipoPedido&&(descProd=parseFloat(producto.product.costPerUnit*producto.cantidad*producto.descuento/100),subt=parseFloat(producto.product.costPerUnit*producto.cantidad-descProd)),"venta"==$scope.tipoPedido&&(descProd=parseFloat(producto.product.price*producto.cantidad*producto.descuento/100),subt=parseFloat(producto.product.price*producto.cantidad-descProd)),descGen=parseFloat(subt*$scope.descuentoPorcentaje/100),10.5==(iva=producto.product.tax)&&(tax1=parseFloat(10.5*subt/100),$scope.tax1=parseFloat($scope.tax1-tax1)),21==iva&&(tax2=parseFloat(21*subt/100),$scope.tax2=parseFloat($scope.tax2-tax2)),27==iva&&(tax3=parseFloat(27*subt/100),$scope.tax3=parseFloat($scope.tax3-tax3)),$scope.neto=Number(parseFloat($scope.neto-(subt-descGen)).toFixed(4)),$scope.subtotal=parseFloat($scope.subtotal-subt),totalIva=subt-descGen+tax1+tax2+tax3,$scope.descuentoValor=parseFloat($scope.descuentoValor-descGen),"compra"==$scope.tipoPedido&&prov?(0!==prov.impuesto1&&($scope.imp1=$scope.neto*prov.impuesto1/100),0!==prov.impuesto2&&($scope.imp2=$scope.neto*prov.impuesto2/100),0!==prov.impuesto3&&($scope.imp3=$scope.neto*prov.impuesto3/100),0!==prov.impuesto4&&($scope.imp4=$scope.neto*prov.impuesto4/100),totalI=$scope.imp1+$scope.imp2+$scope.imp3+$scope.imp4):totalI=0;var restar=totalIva+restoImpuesto;$scope.total=$scope.total-restar,$scope.totalTax=$scope.totalTax-tax1-tax2-tax3,$scope.totalImp=Math.round(100*totalI)/100,$scope.remove(producto),0==$rootScope.productosAgregados.length&&($scope.deshabilitarProveedor=!1,$scope.deshabilitarCliente=!1)},$scope.remove=function(producto){for(var i in $rootScope.productosAgregados)$rootScope.productosAgregados[i]===producto&&$rootScope.productosAgregados.splice(i,1)},$scope.searchTextChange=function(text){angular.lowercase(text);return $filter("filter")($scope.initprovider,{name:text})},$scope.sendProvider=function($event,provider){13===$event.keyCode&&($event.preventDefault(),null===provider||void 0===provider?$scope.mensajeP="No seleccionaste un proveedor valido":$scope.proveedor=provider)},$scope.selectedItemChange=function(item){if(null!==item&&void 0!==item&&($scope.idProveedor=item._id),$scope.proveedor=item,$rootScope.provider=item,$scope.descProveedor(),$scope.tipeando=!1,void 0!==$scope.proveedor&&null!==$scope.proveedor){if(void 0!==$scope.proveedor.condicionPago&&null!==$scope.proveedor.condicionPago)$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data;for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==$scope.proveedor.condicionPago._id&&null!==$scope.proveedor.condicionPago._id&&$scope.condicionVentas[i]._id==$scope.proveedor.condicionPago._id?$scope.condicionVenta=$scope.condicionVentas[i]:$scope.condicionVentas[i]._id==$scope.proveedor.condicionPago&&($scope.condicionVenta=$scope.condicionVentas[i])});$scope.initproduct=[];for(var index=0;index<$scope.products.length;index++)if($scope.products[index].provider.length>0&&!$scope.products[index].provider[0].id){var id="";for(var item_provider in $scope.products[index].provider[0])isNaN(item_provider)||(id+=$scope.products[index].provider[0][item_provider]);id==item._id&&$scope.initproduct.push($scope.products[index])}else for(var index_provider=0;index_provider<$scope.products[index].provider.length;index_provider++)if($scope.products[index].provider[index_provider].id&&$scope.products[index].provider[index_provider].id==item._id){$scope.initproduct.push($scope.products[index]);break}}else $scope.initproduct=$scope.products,$scope.condicionVenta=void 0},$scope.searchTextChangeClient=function(text){angular.lowercase(text);return $filter("filter")($scope.clientes,{name:text})},$scope.sendClient=function($event,client){13===$event.keyCode&&($event.preventDefault(),null===client||void 0===client?$scope.mensajeP="No seleccionaste un cliente valido":$scope.cliente=client)},$scope.selectedItemChangeClient=function(item){if($scope.cliente=item,void 0!==$scope.cliente&&null!==$scope.cliente){if($rootScope.productosAgregados=[],$scope.total=parseFloat(0),void 0!==$scope.cliente.condicionPago)$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data;for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==$scope.cliente.condicionPago&&null!==$scope.cliente.condicionPago?$scope.condicionVentas[i]._id==$scope.cliente.condicionPago._id&&($scope.condicionVenta=$scope.condicionVentas[i]):$scope.condicionVentas[i]._id==$scope.cliente.condicionPago&&($scope.condicionVenta=$scope.condicionVentas[i])});$scope.findProductos(),$scope.descCliente()}},$scope.minLengthProv=0,$scope.showAdvanced=function(ev){$scope.minLengthProv=1,$scope.textToSearch=void 0,Modal.setTipo($scope.tipoPedido),$scope.findContacts(),$scope.findCategories(),$scope.findTaxConditions(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/pedidos/views/create.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLengthProv=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLengthProv=0,$scope.status="You cancelled the dialog."})},$scope.minLengthProv=0,$scope.showAdvancedProduct=function(ev){$scope.minLengthProd=1,$scope.textToSearch2=void 0,Modal.setTipo($scope.tipoPedido),$scope.findProveedores(),$scope.findCategories(),$scope.findSubs(),$scope.findMetrics(),$scope.findSubcategories(),$scope.findTaxes(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/pedidos/views/create.product.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLengthProd=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLengthProd=0,$scope.status="You cancelled the dialog."})},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findTipoComprobante=function(){void 0!==$scope.SEARCH&&($scope.tipoComprobante=Comprobantes.query({e:$scope.SEARCH.enterprise}))},$scope.findClientes=function(){void 0!==$scope.SEARCH&&($scope.clientes=Clients.query({e:$scope.SEARCH.enterprise}))},$scope.findCondicionVenta=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data,Modal.setCondicionesVentas($scope.condicionVentas)})},$scope.findProductos=function(){"compra"===$scope.tipoPedido?void 0!==$scope.SEARCH&&(Products.query({e:$scope.SEARCH.enterprise}).$promise.then(function(product){$scope.products=product,$scope.initproduct=$scope.products}),$scope.productosNombre=$scope.products):$scope.cliente&&void 0!==$scope.SEARCH&&($scope.products=Products.query({e:$scope.SEARCH.enterprise,c:$scope.cliente.category1.category}),$scope.productosNombre=$scope.products)},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/comprobantes/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){for(var i in $scope.comprobantes=response.data,$scope.comprobantes)if("Pedido"===$scope.comprobantes[i].name){$scope.tipoComprobante=$scope.comprobantes[i],$scope.numero=n_with_zeroes(parseInt($scope.tipoComprobante.ultimoNumero)+1,8);var pedido=new Pedidos({numero:$scope.numero,tipoComprobante:$scope.tipoComprobante,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});pedido.$save(function(response){response._id&&(pedido._id=response._id,$rootScope.pedidos.unshift(pedido))},function(errorResponse){$scope.error=errorResponse.data.message})}Modal.setComprobantes($scope.comprobantes)})},$scope.findCajas=function(){void 0!==$scope.SEARCH&&($scope.cajas=Cajas.query({e:$scope.SEARCH.enterprise}))},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}),Modal.setContactos($scope.contacts))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setCategorias($scope.categories))},$scope.findCategoriesVenta=function(){void 0!==$scope.SEARCH&&Categories.query({e:$scope.SEARCH.enterprise},function(data){$scope.categories=$filter("filter")(data,function(item){return"Centro de Costo"===item.type1}),Modal.setCategorias($scope.categories)})},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}),Modal.setCondiciones($scope.taxconditions))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}),Modal.setSubs($scope.subs))},$scope.findSubcategories=function(){void 0!==$scope.SEARCH&&($scope.subcategorias=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setSubcategorias($scope.subcategorias))},$scope.findProveedores=function(){void 0!==$scope.SEARCH&&Providers.query({e:$scope.SEARCH.enterprise}).$promise.then(function(provider){$scope.proveedores=provider,$scope.initprovider=$scope.proveedores,Modal.setProveedores($scope.proveedores)})},$scope.findTaxes=function(){void 0!==$scope.SEARCH&&($scope.taxes=[{value:1,name:"Iva incluido en el costo"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}],Modal.setTaxes($scope.taxes))},$scope.findMetrics=function(){void 0!==$scope.SEARCH&&($scope.metrics=Metrics.query(),Modal.setMetrics($scope.metrics))}}]),angular.module("pedidos").controller("ListPedidosController",["$scope","$rootScope","$stateParams","$location","user","Enterprises","$mdBottomSheet","$state","$mdDialog","pedidosRealizados","pedidosBorrador","pedidosAprobados","pedidosRechazados","pedidosEvaluacion","tipoOrden","tipoPedido","$q","Pedidos","Socket","ventasPendientesEntrega","ventasFinalizadas","ventasPendientes","BottomSheetService","PedidosExtra",function($scope,$rootScope,$stateParams,$location,user,Enterprises,$mdBottomSheet,$state,$mdDialog,pedidosRealizados,pedidosBorrador,pedidosAprobados,pedidosRechazados,pedidosEvaluacion,tipoOrden,tipoPedido,$q,Pedidos,Socket,ventasPendientesEntrega,ventasFinalizadas,ventasPendientes,BottomSheetService,PedidosExtra){switch(DialogController.$inject=["$scope","$mdDialog","item","$rootScope","Socket","Cajas"],$scope.tabParams=$state.params.tab,$state.params.tab){case"realizada":$scope.realizada=!0;break;case"aprobadas":$scope.aprobadas=!0;break;case"borrador":$scope.borrador=!0;break;case"rechazadas":$scope.rechazadas=!0;default:$scope.realizada=!0}var cambio=this;function evaluar(item){var pedido=item;pedido.estado="pendiente aprobacion",void 0!==cambio.enterprise?pedido.enterprise=cambio.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==cambio.tipoComprobante?pedido.tipoComprobante=cambio.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==cambio.condicionVenta?pedido.condicionVenta=cambio.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),pedido.$update(function(){$state.go("home.viewPedido",{pedidoId:item._id})},function(errorResponse){console.log(errorResponse,"error repsonse")})}function showConfirm(ev,item,n){if(1==n){var confirm=$mdDialog.confirm().title("Aprobar Orden").content("¿Está seguro que desea aprobar esta orden?").ariaLabel("Lucky day").ok("Aprobar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){cambio.update(item,n)},function(){$scope.status="Cancelaste aprobar"})}else if(2==n){confirm=$mdDialog.confirm().title("Rechazar Orden").content("¿Está seguro que desea rechazar esta orden?").ariaLabel("Lucky day").ok("Rechazar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){cambio.update(item,n)},function(){$scope.status="Cancelaste rechazar"})}}function showAdvancedRecibidos(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/pedidos/views/modalAprobar.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})}function montoTotal(pedidosEvaluacion,pedidosRealizados,pedidosAprobados,pedidosBorrador,pedidosRechazados){void 0!==pedidosEvaluacion&&pedidosEvaluacion.$promise.then(angular.bind(this,function(data){for(var i in this.totalPendienteECompra=0,this.totalPendienteEVenta=0,data)"pendiente evaluacion"===data[i].estado&&"compra"===data[i].tipoPedido&&(this.totalPendienteECompra=this.totalPendienteECompra+data[i].total),"pendiente evaluacion"===data[i].estado&&"venta"===data[i].tipoPedido&&(this.totalPendienteEVenta=this.totalPendienteEVenta+data[i].total);this.totalPendientesCompra=this.totalPendienteECompra+this.totalPendienteACompra,this.totalPendientesVenta=this.totalPendienteEVenta+this.totalPendienteAVenta})),void 0!==pedidosRealizados&&pedidosRealizados.$promise.then(angular.bind(this,function(data){for(var i in this.totalPendienteACompra=0,this.totalPendienteAVenta=0,data)"pendiente aprobacion"===data[i].estado&&"compra"===data[i].tipoPedido&&(this.totalPendienteACompra=this.totalPendienteACompra+data[i].total),"pendiente aprobacion"===data[i].estado&&"venta"===data[i].tipoPedido&&(this.totalPendienteAVenta=this.totalPendienteAVenta+data[i].total);this.totalPendientesCompra=this.totalPendienteECompra+this.totalPendienteACompra,this.totalPendientesVenta=this.totalPendienteEVenta+this.totalPendienteAVenta})),void 0!==pedidosAprobados&&pedidosAprobados.$promise.then(angular.bind(this,function(data){for(var i in this.totalAprobadasCompra=0,this.totalAprobadasVenta=0,data)"aprobada"===data[i].estado&&"compra"===data[i].tipoPedido&&(this.totalAprobadasCompra=this.totalAprobadasCompra+data[i].total),"aprobada"===data[i].estado&&"venta"===data[i].tipoPedido&&(this.totalAprobadasVenta=this.totalAprobadasVenta+data[i].total)})),void 0!==pedidosBorrador&&pedidosBorrador.$promise.then(angular.bind(this,function(data){for(var i in this.totalBorradorVenta=0,this.totalBorradorCompra=0,data)"borrador"===data[i].estado&&"compra"===data[i].tipoPedido&&!1===data[i].deleted&&(this.totalBorradorCompra=this.totalBorradorCompra+data[i].total),"borrador"===data[i].estado&&"venta"===data[i].tipoPedido&&!1===data[i].deleted&&(this.totalBorradorVenta=this.totalBorradorVenta+data[i].total)})),void 0!==pedidosRechazados&&pedidosRechazados.$promise.then(angular.bind(this,function(data){for(var i in this.totalRechazadasCompra=0,this.totalRechazadasVenta=0,data)"rechazada"===data[i].estado&&"compra"===data[i].tipoPedido&&(this.totalRechazadasCompra=this.totalRechazadasCompra+data[i].total),"rechazada"===data[i].estado&&"venta"===data[i].tipoPedido&&(this.totalRechazadasVenta=this.totalRechazadasVenta+data[i].total)}))}function borrarPedido(pedido){if(pedido.$remove(),"aprobada"==pedido.estado)for(var i in pedidosAprobados)pedidosAprobados[i]===pedido&&pedidosAprobados.splice(i,1);else if("rechazada"==pedido.estado)for(var i in pedidosRechazados)pedidosRechazados[i]===pedido&&pedidosRechazados.splice(i,1);else if("borrador"==pedido.estado)for(var i in pedidosBorrador)pedidosBorrador[i]===pedido&&pedidosBorrador.splice(i,1)}function extraerPedido(item,n){(function(item){var deferred=$q.defer();return $scope.pedido=item,setTimeout(function(){void 0!==$scope.pedido?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})(item).then(function(response){var a,b,c;1==n?(a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-pedido").value,c=document.getElementById("printing-data-pedido").innerHTML,window.frames.print_frame_pedido.document.title="IM - Pedido",window.frames.print_frame_pedido.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_pedido.window.focus(),window.frames.print_frame_pedido.window.print()):function(){var a=httpGet("http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"),b=document.getElementById("printing-css-pedidoAprobado").value,c=document.getElementById("printing-data-pedidoAprobado").innerHTML;window.frames.print_frame_pedidoAprobado.document.title="IM - Pedidos Aprobados",window.frames.print_frame_pedidoAprobado.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_pedidoAprobado.window.focus(),window.frames.print_frame_pedidoAprobado.window.print()}()})}function httpGet(theUrl){var xmlHttp=null;return(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText}function DialogController($scope,$mdDialog,item,$rootScope,Socket,Cajas){$scope.item=item,$scope.errorCaja=void 0,$scope.cancel=function(){$mdDialog.cancel()},$scope.findCajas=function(){$scope.cajas=Cajas.query({e:item.enterprise._id})},$scope.finalizarPedido=function(item,fechaE){void 0!==fechaE&&(item.myDate=fechaE,item.myDateChanged=!0);!function(pedido,estado){pedido.estado=estado,pedido.enterprise&&pedido.enterprise._id&&(pedido.enterprise=pedido.enterprise._id);pedido.tipoComprobante&&pedido.tipoComprobante._id&&(pedido.tipoComprobante=pedido.tipoComprobante._id);pedido.cliente&&pedido.cliente._id&&(pedido.cliente=pedido.cliente._id);pedido.proveedor&&pedido.proveedor._id&&(pedido.proveedor=pedido.proveedor._id);pedido.category1&&pedido.category1._id&&(pedido.category1=pedido.category1._id);pedido.condicionVenta=pedido.condicionVenta._id,pedido.caja&&pedido.caja._id&&(pedido.caja=pedido.caja._id);$mdDialog.hide(),Socket.emit("pedido.update",pedido)}(item,"aprobada")}}this.user=user,this.pedidosRealizados=pedidosRealizados,this.pedidosBorrador=pedidosBorrador,this.pedidosAprobados=pedidosAprobados,this.pedidosRechazados=pedidosRechazados,this.pedidosEvaluacion=pedidosEvaluacion,this.ventasPendientes=ventasPendientes,this.ventasPendientesEntrega=ventasPendientesEntrega,this.ventasFinalizadas=ventasFinalizadas,this.tipoOrden=tipoOrden,this.tipoPedido=tipoPedido,this.totalBorradorVenta=0,this.totalBorradorCompra=0,this.totalAprobadasCompra=0,this.totalAprobadasVenta=0,this.totalRechazadasCompra=0,this.totalRechazadasVenta=0,this.totalPendienteACompra=0,this.totalPendienteAVenta=0,this.totalPendienteECompra=0,this.totalPendienteEVenta=0,this.currentPage=0,this.theDate=new Date,this.evaluar=evaluar,this.montoTotal=montoTotal,this.showConfirm=showConfirm,this.showAdvancedRecibidos=showAdvancedRecibidos,this.update=function(item,n){console.log(angular.copy(item));var pedido=item;1==n&&(pedido.estado="aprobada");2==n&&(pedido.estado="rechazada");3==n&&(pedido.estado="pendiente evaluacion");4==n&&(pedido.deleted="true");5==n&&(pedido.estado="pendiente aprobacion");6==n&&(pedido.estado="borrador");void 0!==this.enterprise?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id);void 0!==this.tipoComprobante?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id);"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id);void 0!==this.condicionVenta?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id);void 0!==this.caja?pedido.caja=this.caja._id:void 0!==pedido.caja&&null!==pedido.caja&&(pedido.caja=pedido.caja._id);$scope.tipoPedido=$stateParams.tipo,void 0===$scope.tipoPedido&&($scope.tipoPedido=pedido.tipoPedido);pedido.$update(function(){cambio.refresh(),cambio.montoTotal(cambio.pedidosRealizados,cambio.pedidosAprobados,cambio.pedidosBorrador,cambio.pedidosRechazados),$state.go("home.pedidos",{tipo:$scope.tipoPedido})},function(errorResponse){})},this.soloDomingos=function(date){return 4===date.getDay()},this.extraerPedido=extraerPedido,this.setNewData=function(date){var today=this.theDate,first=new Date(today.getFullYear(),0,1),year=(Math.round((today-first)/1e3/60/60/24+.5,0),today.getFullYear()),target=today,dayNr=(today.getDay()+6)%7;target.setDate(target.getDate()-dayNr+3);var jan4=new Date(target.getFullYear(),0,4),dayDiff=(target-jan4)/864e5,weekNr=1+Math.ceil(dayDiff/7);this.pedidos=Pedidos.query({e:this.user.enterprise.enterprise,w:weekNr,y:year},angular.bind(this,function(data){this.montoTotal(data)}))},this.refresh=function(){this.pedidosEvaluacion=Pedidos.query({e:this.user.enterprise.enterprise,tipoPedido:this.tipoPedido,estado:"pendiente evaluacion",p:0,pcount:20}),this.pedidosRealizados=Pedidos.query({e:this.user.enterprise.enterprise,tipoPedido:this.tipoPedido,estado:"pendiente aprobacion",p:0,pcount:20}),this.pedidosAprobados=Pedidos.query({e:this.user.enterprise.enterprise,tipoPedido:this.tipoPedido,estado:"aprobada",p:0,pcount:20}),this.pedidosRechazados=Pedidos.query({e:this.user.enterprise.enterprise,tipoPedido:this.tipoPedido,estado:"rechazada",p:0,pcount:20}),this.pedidosBorrador=Pedidos.query({e:this.user.enterprise.enterprise,tipoPedido:this.tipoPedido,estado:"borrador",p:0,pcount:20})},this.borrarPedido=borrarPedido,this.showBottomSheetBorador=function($event,item){var buttons=[];"compras"!==this.user.roles[0]&&"ventas"!==this.user.roles[0]&&("user"!==this.user.roles[0]&&"compra"==item.tipoPedido||"venta"==item.tipoPedido)&&(buttons.push({name:"discard",label:"Descartar",icon:"close"}),buttons.push({name:"evaluate",label:"Evaluar",icon:"call_made"}));buttons.push({name:"view",label:"Ver",icon:"visibility"}),buttons.push({name:"remove",label:"Anular",icon:"delete"}),BottomSheetService.sheet($event,buttons,function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"evaluate":showConfirm($event,item,n=3);break;case"discard":showConfirm($event,item,n=4);break;case"view":$state.go("home.viewPedido",{pedidoId:item._id});break;case"remove":borrarPedido(item);break;default:console.log("something went wrong")}})},this.showBottomSheetAprobadas=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Anular",icon:"remove_circle"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"view":$state.go("home.viewPedido",{pedidoId:item._id});break;case"remove":borrarPedido(item);break;case"print":extraerPedido(item,n=2);break;default:console.log("something went wrong")}})},this.showBottomSheetRechazados=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Anular",icon:"remove_circle"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"view":$state.go("home.viewPedido",{pedidoId:item._id});break;case"remove":borrarPedido(item);break;default:console.log("something went wrong")}})},this.showBottomSheetRealizadosCompra=function($event,item){var buttons=[],buttons=[];"pendiente evaluacion"!=item.estado&&"compras"!=this.user.roles[0]&&(item.llamado?buttons.push({name:"state",icon:"phone",class:"anulado"}):buttons.push({name:"state",icon:"phone",class:"libre"}),buttons.push({name:"approve",label:"Aprobado",icon:"done"}));"pendiente evaluacion"==item.estado&&"compras"!=this.user.roles[0]?buttons.push({name:"view1",label:"Ver",icon:"visibility"}):buttons.push({name:"view2",label:"Ver",icon:"visibility"});"pendiente evaluacion"!=item.estado&&buttons.push({name:"clear",label:"Rechazar",icon:"delete"});"compras"!=cambio.user.roles[0]&&"venta"==cambio.tipoOrden&&buttons.push({name:"print",label:"Imprimir",icon:"print"});BottomSheetService.sheet($event,buttons,function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"state":item.llamado?$scope.sampleAction("ocupado",item):$scope.sampleAction("libre",item);break;case"approve":showConfirm($event,item,1);break;case"view1":evaluar(item);break;case"view2":$state.go("home.viewPedido",{pedidoId:item._id});break;case"clear":showConfirm($event,item,2);break;case"print":extraerPedido(item,1);break;default:console.log("something went wrong")}})},this.showBottomSheetRealizadosVenta=function($event,item){var buttons=[];"pendiente evaluacion"!=item.estado&&"compras"!=this.user.roles[0]&&buttons.push({name:"approve",label:"Aprobado",icon:"done"});"pendiente evaluacion"==item.estado&&"compras"!=this.user.roles[0]?buttons.push({name:"view1",label:"Ver",icon:"visibility"}):buttons.push({name:"view2",label:"Ver",icon:"visibility"});"pendiente evaluacion"!=item.estado&&buttons.push({name:"clear",label:"Rechazar",icon:"delete"});"compras"!=cambio.user.roles[0]&&"venta"==cambio.tipoOrden&&buttons.push({name:"print",label:"Imprimir",icon:"print"});BottomSheetService.sheet($event,buttons,function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"approve":showAdvancedRecibidos($event,item);break;case"view1":evaluar(item);break;case"view2":$state.go("home.viewPedido",{pedidoId:item._id});break;case"clear":showConfirm($event,item,2);break;case"print":extraerPedido(item,1);break;default:console.log("something went wrong")}})},this.montoTotal(pedidosEvaluacion,pedidosRealizados,pedidosAprobados,pedidosBorrador,pedidosRechazados),cambio.draftTemp=[],cambio.draftCount=0,cambio.approvedTemp=[],cambio.approvedCount=0,cambio.rejectedTemp=[],cambio.rejectedCount=0,cambio.realTemp1=[],cambio.realCount1=0,cambio.realTemp2=[],cambio.realCount2=0,cambio.realStart1=null,cambio.realStart2=null,cambio.approvedStart=null,cambio.draftStart=null,cambio.approvedStart=null,cambio.rejectedStart=null,this.validate=function(item){return"user"!=user.roles[0]||user.centroDeCosto==item.user.centroDeCosto},cambio.loadmoreReal1=function(){cambio.loadingReal1=!0,cambio.realLimit1=cambio.pedidosEvaluacion.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,cambio.tipoPedido,"pendiente evaluacion",cambio.realStart1,cambio.realLimit1).then(angular.bind(cambio,function(data){setTimeout(function(){cambio.pedidosEvaluacion&&(1===cambio.realCount1&&0!==cambio.realTemp1.length?cambio.pedidosEvaluacion=cambio.realTemp1.slice():cambio.pedidosEvaluacion=cambio.pedidosEvaluacion.concat(cambio.realTemp1)),(0===data.data.length||0===cambio.realTemp1.length&&cambio.realCount1>2)&&(cambio.doneReal1=!0),cambio.realTemp1=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:cambio.tipoPedido,estado:"pendiente evaluacion",p:cambio.realCount1,pcount:cambio.realLimit1}),cambio.realCount1++,cambio.loadingReal1=!1,cambio.realStart1=cambio.pedidosEvaluacion.length?cambio.pedidosEvaluacion[cambio.pedidosEvaluacion.length-1].created:null},1e3)}))},cambio.loadmoreReal2=function(){cambio.loadingReal2=!0,cambio.realLimit2=cambio.pedidosRealizados.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,cambio.tipoPedido,"pendiente aprobacion",cambio.realStart2,cambio.realLimit2).then(angular.bind(cambio,function(data){setTimeout(function(){cambio.pedidosRealizados&&(1===cambio.realCount2&&0!==cambio.realTemp2.length?cambio.pedidosRealizados=cambio.realTemp2.slice():cambio.pedidosRealizados=cambio.pedidosRealizados.concat(cambio.realTemp2)),(0===data.data.length||0===cambio.realTemp2.length&&cambio.realCount2>2)&&(cambio.doneReal2=!0),cambio.realTemp2=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:cambio.tipoPedido,estado:"pendiente aprobacion",p:cambio.realCount2,pcount:cambio.realLimit2}),cambio.realCount2++,cambio.realStart2=cambio.pedidosRealizados.length?cambio.pedidosRealizados[cambio.pedidosRealizados.length-1].created:null,cambio.loadingReal2=!1},1e3)}))},cambio.loadmoreApproved=function(){cambio.loadingApproved=!0,cambio.approvedLimit=cambio.pedidosAprobados.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,cambio.tipoPedido,"aprobada",cambio.approvedStart,cambio.approvedLimit).then(angular.bind(cambio,function(data){setTimeout(function(){cambio.pedidosAprobados&&(1===cambio.approvedCount&&0!==cambio.approvedTemp.length?cambio.pedidosAprobados=cambio.approvedTemp.slice():cambio.pedidosAprobados=cambio.pedidosAprobados.concat(cambio.approvedTemp)),(0===data.data.length||0===cambio.approvedTemp.length&&cambio.approvedCount>2)&&(cambio.doneApproved=!0),cambio.approvedTemp=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:cambio.tipoPedido,estado:"aprobada",p:cambio.approvedCount,pcount:cambio.approvedLimit}),cambio.approvedCount++,cambio.approvedStart=cambio.pedidosAprobados.length?cambio.pedidosAprobados[cambio.pedidosAprobados.length-1].created:null,cambio.loadingApproved=!1},1e3)}))},cambio.loadmoreDraft=function(){cambio.loadingDraft=!0,cambio.draftLimit=cambio.pedidosBorrador.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,cambio.tipoPedido,"borrador",cambio.draftStart,cambio.draftLimit).then(angular.bind(cambio,function(data){setTimeout(function(){cambio.pedidosBorradors&&(1===cambio.draftCount&&0!==cambio.draftTemp.length?cambio.pedidosBorradors=cambio.draftTemp.slice():cambio.pedidosBorradors=cambio.pedidosBorradors.concat(cambio.draftTemp)),(0===data.data.length||0===cambio.draftTemp.length&&cambio.draftCount>2)&&(cambio.doneDraft=!0),cambio.draftTemp=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:cambio.tipoPedido,estado:"borrador",p:cambio.draftCount,pcount:cambio.draftLimit}),cambio.draftCount++,cambio.draftStart=cambio.pedidosBorrador.length?cambio.pedidosBorrador[cambio.pedidosBorrador.length-1].created:null,cambio.loadingDraft=!1},1e3)}))},cambio.loadmoreRejected=function(){cambio.loadingRejected=!0,cambio.rejectedLimit=cambio.pedidosRechazados.length<40?40:20,PedidosExtra.loadMore(cambio.user.enterprise.enterprise,cambio.tipoPedido,"rechazada",cambio.rejectedStart,cambio.rejectedLimit).then(angular.bind(cambio,function(data){setTimeout(function(){cambio.pedidosRechazados&&(1===cambio.rejectedCount&&0!==cambio.rejectedTemp.length?cambio.pedidosRechazados=cambio.rejectedTemp.slice():cambio.pedidosRechazados=cambio.pedidosRechazados.concat(cambio.rejectedTemp)),(0===data.data.length||0===cambio.rejectedTemp.length&&cambio.rejectedCount>2)&&(cambio.doneRejected=!0),cambio.rejectedTemp=Pedidos.query({e:cambio.user.enterprise.enterprise,tipoPedido:cambio.tipoPedido,estado:"rechazada",p:cambio.rejectedCount,pcount:cambio.rejectedLimit}),cambio.rejectedCount++,cambio.rejectedStart=cambio.pedidosRechazados.length?cambio.pedidosRechazados[cambio.pedidosRechazados.length-1].created:null,cambio.loadingRejected=!1},1e3)}))},$scope.sampleAction=function(name,pedido){switch(name){case"libre":pedido.llamado=!0;break;case"ocupado":pedido.llamado=!1}cambio.update(pedido,null)},Socket.on("pedido.update",angular.bind(this,function(message){message.enterprise===this.user.enterprise.enterprise&&(this.refresh(),montoTotal(this.pedidosRealizados,this.pedidosAprobados,this.pedidosBorrador,this.pedidosRechazados))}))}]),angular.module("pedidos").controller("PedidosController",["$scope","$rootScope","$stateParams","$location","Authentication","Pedidos","Enterprises","Comprobantes","Condicionventas","Products","Providers","Clients","$mdBottomSheet","$state","$mdDialog","$timeout","$http","$filter","Modal","Contacts","Taxconditions","Categories","Subs","Metrics","$q","pedidos","tipoOrden","tipoPedido",function($scope,$rootScope,$stateParams,$location,Authentication,Pedidos,Enterprises,Comprobantes,Condicionventas,Products,Providers,Clients,$mdBottomSheet,$state,$mdDialog,$timeout,$http,$filter,Modal,Contacts,Taxconditions,Categories,Subs,Metrics,$q,pedidos,tipoOrden,tipoPedido){CrearController.$inject=["$scope","$mdDialog","Modal","Providers","Clients","Products"],$scope.authentication=Authentication,$rootScope.pedidos=pedidos,$scope.tipoOrden=tipoOrden,$scope.tipoPedido=tipoPedido;$location.$$url;$scope.idProveedor=0,$scope.isFocused=!1;var created=new Date;$scope.created=new Date(created.setTime(created.getTime()+108e5)),$scope.buscaP=!0,$scope.cambioPrecio=!1,$scope.initAutocomplete=function(){$scope.findProductos()},$scope.nuevoProveedor=Modal.getProveedor(),$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findComprobantes(),$scope.findAll(),$scope.findProveedores(),$scope.findClientes(),$scope.findProductos(),$scope.findCondicionVenta(),function(){if(void 0!==$rootScope.productosAPedir){$rootScope.productosAgregados=$rootScope.productosAPedir;for(var total=0,i=$rootScope.productosAgregados.length-1;i>=0;i--){var resultado=calcularSubtotal($rootScope.productosAgregados[i],"compra");console.log(resultado),total+=resultado}$scope.total=parseFloat(total)+$scope.totalTax,$scope.selectedItemChange($rootScope.providerStock)}else $rootScope.productosAgregados=[],$scope.total=parseFloat(0)}()}),$rootScope.$watchCollection("nuevoProveedor",function(){void 0!==$rootScope.nuevoProveedor?($scope.mostrar=!0,$scope.proveedor=$rootScope.nuevoProveedor,$scope.selectedItemChange($scope.proveedor),$rootScope.nuevoProveedor=void 0):$scope.mostrar=!1}),$rootScope.$watchCollection("nuevoCliente",function(){void 0!==$rootScope.nuevoCliente?($scope.mostrar=!0,$scope.cliente=$rootScope.nuevoCliente,$scope.selectedItemChangeClient($scope.cliente)):$scope.mostrar=!1}),$rootScope.$watchCollection("nuevaMateriaPrima",function(){void 0!==$rootScope.nuevaMateriaPrima?($scope.mostrarMateria=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevaMateriaPrima._id,params:{}}).then(function(response){console.log(response.data),$scope.producto=response.data},function(response){console.log("error")}),console.log($scope.producto),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarMateria=!1}),$rootScope.$watchCollection("nuevoProducto",function(){console.log("watch de nuevo producto: ",$rootScope.nuevoProducto),void 0!==$rootScope.nuevoProducto?($scope.producto=$rootScope.nuevoProducto,$scope.mostrarProd=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevoProducto._id,params:{}}).then(function(response){console.log(response.data),$scope.producto=response.data},function(response){console.log("error")}),console.log($scope.producto),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarProd=!1}),$scope.myDate=new Date,$scope.tipoComprobante="Pedido",$scope.mostrarForm=!1,$scope.verForm=!1,$scope.verEdicion=[],$scope.productoPedido={cantidad:void 0,descuento:void 0,observaciones:""},$scope.mostrarForm=!1,$scope.deshabilitarProveedor=!1,$scope.deshabilitarCliente=!1,$scope.idProveedor=0,$scope.productoEditado=[],$scope.todosPedidos=[],$scope.tipeando=!1,$scope.mostrarProductosP=!1,$scope.mostrarProductosC=!1,$scope.verAprobadas=0,$scope.verRechazadas=0,$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.totalTax=0,$scope.actualizarN=function(){$scope.numero=parseInt($scope.tipoComprobante.ultimoNumero)+1},$scope.showConfirm2=function(ev,item,pedido){var confirm=$mdDialog.confirm().title("Eliminar productos").content("¿Está seguro que desea eliminar este producto de la orden?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.quitarProducto(item,pedido)},function(){console.log("cancelaste eliminar")})},$scope.quitarProducto=function(p,pedido){var iva,descGen,totalIva,tipoPedido=pedido.tipoPedido,subt=0,descProd=0,tax1=0,tax2=0,tax3=0;"compra"==tipoPedido&&(descProd=parseFloat(p.product.costPerUnit*p.cantidad*p.descuento/100),subt=parseFloat(p.product.costPerUnit*p.cantidad-descProd)),"venta"==tipoPedido&&(descProd=parseFloat(p.product.unitPrice*p.cantidad*p.descuento/100),subt=parseFloat(p.product.unitPrice*p.cantidad-descProd)),descGen=parseFloat(subt*pedido.descuentoPorcentaje/100),10.5==(iva=p.product.tax)&&(tax1=parseFloat(10.5*subt/100),pedido.tax1=parseFloat(pedido.tax1-tax1)),21==iva&&(tax2=parseFloat(21*subt/100),pedido.tax2=parseFloat(pedido.tax2-tax2)),27==iva&&(tax3=parseFloat(27*subt/100),pedido.tax3=parseFloat(pedido.tax3-tax3)),pedido.neto=parseFloat(pedido.neto-(subt-descGen)),pedido.subtotal=parseFloat(pedido.subtotal-subt),totalIva=subt-descGen+tax1+tax2+tax3,pedido.descuentoValor=parseFloat(pedido.descuentoValor-descGen),pedido.total=pedido.total-totalIva,pedido.totalTax=pedido.totalTax-tax1-tax2-tax3;for(var i=0;i<pedido.products.length;i++)pedido.products[i]._id===p._id&&pedido.products.splice(i,1);$scope.updateOrden(pedido)},$scope.updateOrden=function(pedido){pedido.enterprise,pedido.enterprise=pedido.enterprise._id,void 0!==pedido.tipoComprobante?pedido.tipoComprobante=pedido.tipoComprobante._id:void 0!==pedido.tipoComprobante&&null!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==pedido.tipoPedido?void 0!==pedido.proveedor?pedido.proveedor=pedido.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==pedido.cliente?pedido.cliente=pedido.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==pedido.condicionVenta?pedido.condicionVenta=pedido.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),void 0!==pedido.category1?pedido.category1=pedido.category1._id:void 0!==pedido.category1&&null!==pedido.category1&&(pedido.category1=pedido.category1._id),pedido.$update(function(){$location.path("pedidos/view/"+pedido._id)},function(errorResponse){$scope.error=errorResponse.data.message}),$scope.verForm=!1},$scope.habilitarForm=function(pedido){$scope.verForm=!0,"compra"===pedido.tipoPedido&&($scope.provId=pedido.proveedor._id)},$scope.habilitarEdicion=function(index){$scope.verEdicion[index]=!0},$scope.cancelarEdiciones=function(){$scope.verForm=!1,$scope.verEdicion=!1},$scope.cambiarPrecio=function(){$scope.cambioPrecio=!0},$scope.editProducto=function(p,pedido,index){console.log(p.product.provider.impuesto1);var subtotal=0,iva=0;$scope.verEdicion=!1,p.subtotal=p.cantidad*p.product.costPerUnit;var descuento=p.subtotal*p.descuento/100;for(var i in p.total=p.subtotal-descuento,pedido.products)subtotal+=pedido.products[i].total,1!=pedido.products[i].product.tax&&(iva+=pedido.products[i].subtotal*pedido.products[i].product.tax/100);if(pedido.subtotal=subtotal,pedido.descuentoValor=subtotal*pedido.descuentoPorcentaje/100,pedido.neto=subtotal-pedido.descuentoValor,pedido.totalTax=iva,pedido.total=pedido.neto+pedido.totalTax,"pendiente evaluacion"==pedido.estado)var n=3;if("pendiente aprobacion"==pedido.estado)n=5;if("borrador"==pedido.estado)n=6;$scope.verEdicion=[],$scope.updatePedido(pedido,n,p)},$scope.modificarPrecioProducto=function(p){for(var i in $scope.products)if($scope.products[i]._id===p._id){var cost=p.costPerUnit;p=$scope.products[i];var product=new Products({_id:p._id,name:p.name,description:p.description,code:p.code,brandName:p.brandName,unitPrice:cost,costPerUnit:cost,discontinued:p.discontinued,provider:p.provider._id,quantityPerUnit:p.quantityPerUnit,unitsInStock:p.unitsInStock,idealStock:p.idealStock,criticalStock:p.criticalStock,unitsOnOrder:p.unitsOnOrder,storedIn:p.storedIn,metric:p.metric,reseller:p.reseller,visible:p.visible,esProducto:p.esProducto,esMateriaPrima:p.esMateriaPrima,esInsumo:p.esInsumo,tax:p.tax,enterprise:p.enterprise,sub:p.sub._id,category1:p.category1,category2:p.category2});product.enterprise=product.enterprise._id,void 0!==product.sub&&null!==product.sub&&(product.sub=product.sub._id),void 0!==product.category1&&null!==product.category1&&(product.category1=product.category1._id),void 0!==product.category2&&null!==product.category2&&(product.category2=product.category2?product.category2._id:void 0),void 0!==product.provider&&null!==product.provider&&(product.provider=product.provider._id),product.$update(function(response){console.log("actualice bien")},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.updatePedido=function(item,n,p){!0===$scope.cambioPrecio&&($scope.modificarPrecioProducto(p.product),$scope.cambioPrecio=!1);var pedido=item;1==n&&(pedido.estado="aprobada"),2==n&&(pedido.estado="rechazada"),3==n&&(pedido.estado="pendiente evaluacion"),4==n&&(pedido.deleted="true"),5==n&&(pedido.estado="pendiente aprobacion"),6==n&&(pedido.estado="borrador"),this.enterprise&&this.enterprise._id?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),this.tipoComprobante&&this.tipoComprobante._id?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?$scope.proveedor&&$scope.proveedor._id?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):$scope.cliente&&$scope.cliente._id?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),this.condicionVenta&&this.condicionVenta._id?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),this.category1&&this.category1._id?pedido.category1=this.category1._id:void 0!==pedido.category1&&null!==pedido.category1&&(pedido.category1=pedido.category1._id),$scope.tipoPedido=$stateParams.tipo,pedido.$update(function(){},function(errorResponse){})},$scope.sumarProducto=function(producto,productoPedido,pedido){$scope.clicked=!1,$scope.errorProd=void 0;var tipoPedido=pedido.tipoPedido,p={product:{},cantidad:void 0,descuento:void 0,total:void 0,subtotal:void 0,observaciones:void 0};if(void 0==producto)return 0;void 0==producto.total&&(producto.total=0),p.product=producto,p.cantidad=productoPedido.cantidad,void 0==productoPedido.descuento?p.descuento=0:p.descuento=productoPedido.descuento,void 0==productoPedido.observaciones?p.observaciones="":p.observaciones=productoPedido.observaciones,p.total=0,p.subtotal=0;var resultado=recalcularSubtotal(p,tipoPedido,pedido);p.total=p.total+resultado,pedido.products.push(p),$scope.updateOrden(pedido),productoPedido=void 0,producto=void 0,p=void 0,$scope.productoPedido={cantidad:void 0,descuento:void 0,observaciones:""},$scope.stockD=!1,$scope.updateOrden(pedido)};var recalcularSubtotal=function(p,tipo,pedido){var total,descuentoPorcentaje=p.descuento;if("compra"==tipo)var precio=parseFloat(p.product.costPerUnit);else precio=parseFloat(p.product.unitPrice);var cant=parseFloat(p.cantidad),subtotal=parseFloat(precio*cant),descuentoValor=subtotal*descuentoPorcentaje/100;return p.subtotal=subtotal,total=subtotal-descuentoValor,pedido.subtotal=pedido.subtotal+total,pedido.descuentoValor=pedido.subtotal*pedido.descuentoPorcentaje/100,pedido.neto=pedido.subtotal-pedido.descuentoValor,10.5==p.product.tax&&(pedido.tax1=pedido.tax1+10.5*total/100),21==p.product.tax&&(pedido.tax2=pedido.tax2+21*total/100),27==p.product.tax&&(pedido.tax3=pedido.tax3+27*total/100),pedido.total=pedido.neto+pedido.tax1+pedido.tax2+pedido.tax3,pedido.totalTax=pedido.tax1+pedido.tax2+pedido.tax3,total};$scope.descProveedor=function(){null!==$scope.proveedor&&void 0!==$scope.proveedor?($scope.idProveedor=$scope.proveedor._id,$scope.errorProv=void 0):$scope.idProveedor=0,void 0!==this.producto&&null!==this.producto&&!1===$scope.tipeando&&(this.producto=void 0,$scope.textToSearch2=void 0)},$scope.descCliente=function(){if($scope.errorCliente=void 0,$scope.mostrarForm=!0,$scope.mostrarProductosC=!1,$scope.mostrarProductosP=!1,0==$scope.cliente.productosAsociados.length?$scope.mostrarProductosC=!1:$scope.mostrarProductosC=!0,$scope.descuentoPorcentaje=$scope.cliente.discountRate,0==$scope.subtotal)return 0;$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3,$scope.totalTax=$scope.tax1+$scope.tax2+$scope.tax3},$scope.agregar=function(item){$scope.producto=item,item=void 0},$scope.sendProduct=function($event,productoPedido,producto){13===$event.keyCode&&($event.preventDefault(),$scope.isFocused=!0,null===producto||void 0===producto?$scope.mensajeP="No seleccionaste un producto valido":"venta"===$scope.tipoPedido?null===productoPedido.cantidad||void 0===productoPedido.cantidad||0===producto.unitsInStock?0===producto.unitsInStock?$scope.mensajeP="No hay stock disponible":null!==productoPedido.cantidad&&void 0!==productoPedido.cantidad||($scope.mensajeP="No seleccionaste una cantidad para el producto"):($scope.controlStock(producto),1==$scope.stockD||($scope.stockD,$scope.mensajeP=void 0,$scope.producto=producto,$scope.agregarProducto(producto,productoPedido))):($scope.mensajeP=void 0,void 0===productoPedido&&(productoPedido={cantidad:0}),null===productoPedido.cantidad||void 0===productoPedido.cantidad||0===productoPedido.cantidad?$scope.mensajeP="No seleccionaste una cantidad para el producto":($scope.mensajeP=void 0,$scope.agregarProducto(producto,productoPedido))))},$scope.controlStock=function(p){$scope.mensajeP=void 0,$scope.productoPedido.cantidad>p.unitsInStock?(console.log(p.unitsInStock,"unidades en stock del producto"),$scope.stockD=!0,$scope.productoPedido.cantidad=p.unitsInStock):$scope.stockD=!1},$scope.agregarProducto=function(producto,productoPedido){$scope.deshabilitarProveedor=!0,$scope.deshabilitarCliente=!0,$scope.clicked=!1,$scope.errorProd=void 0;var tipoPedido=this.tipoPedido,p={product:{},cantidad:void 0,descuento:void 0,total:void 0,subtotal:void 0,observaciones:void 0};if(void 0==producto)return 0;void 0==producto.total&&(producto.total=0),p.product=producto,p.cantidad=productoPedido.cantidad,void 0==productoPedido.descuento?p.descuento=0:p.descuento=productoPedido.descuento,void 0==productoPedido.observaciones?p.observaciones="":p.observaciones=productoPedido.observaciones,p.total=0,p.subtotal=0;var resultado=calcularSubtotal(p,tipoPedido);p.total=p.total+resultado,$rootScope.productosAgregados.push(p),this.producto=void 0,$scope.producto=void 0,productoPedido=void 0,p=void 0,$scope.productoPedido={cantidad:void 0,descuento:void 0,observaciones:""},this.productoCompra.cantidad=void 0,this.productoCompra.descuento=void 0,this.productoCompra.observaciones=void 0,$scope.selectedProduct=[],$scope.selectedItem=null,$scope.textToSearch2="",$scope.stockD=!1,document.getElementById("buscaP").focus(),document.getElementById("buscaP").value=""},$scope.reverse=function(array){return[].concat(array).reverse()},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.textToSearch2=null;var calcularSubtotal=function(p,pedido){var total,descuentoPorcentaje=p.descuento;if("compra"==pedido)var precio=parseFloat(p.product.costPerUnit);else precio=parseFloat(p.product.unitPrice);var cant=parseFloat(p.cantidad),subtotal=parseFloat(precio*cant),descuentoValor=subtotal*descuentoPorcentaje/100;return p.subtotal=subtotal,total=subtotal-descuentoValor,$scope.subtotal=$scope.subtotal+total,$scope.descuentoValor=$scope.subtotal*$scope.descuentoPorcentaje/100,$scope.neto=$scope.subtotal-$scope.descuentoValor,10.5==p.product.tax&&($scope.tax1=$scope.tax1+10.5*total/100),21==p.product.tax&&($scope.tax2=$scope.tax2+21*total/100),27==p.product.tax&&($scope.tax3=$scope.tax3+27*total/100),$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3,$scope.totalTax=$scope.tax1+$scope.tax2+$scope.tax3,total};function n_with_zeroes(number,length){for(var my_string=""+number;my_string.length<length;)my_string="0"+my_string;return my_string}function CrearController($scope,$mdDialog,Modal,Providers,Clients,Products){"compra"==Modal.getTipo()?($scope.tipo="Proveedor",void 0!==$rootScope.provider&&null!==$rootScope.provider&&($scope.provider=$rootScope.provider.name),$scope.categories2=["Materia Prima","Insumo"]):($scope.tipo="Cliente",$scope.categories2=["Productos Terminados"]),$scope.contacts=Modal.getContactos(),$scope.categories=Modal.getCategorias(),$scope.subcategorias=Modal.getSubcategorias(),$scope.taxconditions=Modal.getCondiciones(),$scope.comprobantes=Modal.getComprobantes(),$scope.subs=Modal.getSubs(),$scope.proveedores=Modal.getProveedores(),$scope.taxes=Modal.getTaxes(),$scope.metrics=Modal.getMetrics(),$scope.condicionPagos=Modal.getCondicionesVentas(),$scope.taxconditions2=["Consumidor Final","Responsable Inscripto"],$scope.banco={name:void 0,account:void 0,cbu:void 0,identity:void 0},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.postalCode="1900",$scope.quantityPerUnit=0,$scope.unitsInStock=0,$scope.idealStock=0,$scope.criticalStock=0,$scope.unitPrice=0,$scope.costPerUnit=0,$scope.condicionPago="Efectivo",$scope.taxcondition="Consumidor Final",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged2=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.mostrarFormResponsable=function(){$scope.errorName=void 0,$scope.formResponsableInscripto=!1,"Responsable Inscripto"===this.taxcondition&&($scope.formResponsableInscripto=!0)},$scope.crearProveedor=function(){console.log(this.taxconditionProv,"tax"),console.log(this.condicionPagoProv,"condicion");var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==this.address){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng();if(void 0!==this.category1)if(void 0!==this.taxconditionProv)if(void 0!==this.condicionPagoProv)if(void 0!==this.comprobante){var provider=new Providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPagoProv?this.condicionPagoProv._id:void 0,comprobante:this.comprobante?this.comprobante._id:void 0,banco:this.banco,taxCondition:this.taxconditionProv?this.taxconditionProv._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter?this.costCenter:void 0,paymentMethod:this.paymentMethod?this.paymentMethod:void 0,contacts:this.contact?this.contact._id:void 0,country:this.country,city:this.city,region:this.region?this.region:void 0,postalCode:this.postalCode,address:this.address,phone:this.phone?this.phone:void 0,loc:[latitud,longitud],web:this.web?this.web:0,enterprise:empresa,category1:this.category1?this.category1._id:void 0});provider.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoProveedor=provider,console.log($rootScope.nuevoProveedor)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Indicar el tipo de comprobante";else $scope.errorCondicion="Indicar condicion de pago";else $scope.errorTax="Indicar la condicion de iva";else $scope.errorCategory="Indicar la categoria"}else $scope.errorDir="Indicar la direccion";else $scope.errorNameProv="Indicar la razón social"},$scope.crearCliente=function(){for(var i in $scope.taxconditions)if($scope.taxconditions[i].name===this.taxcondition)var condicionIva=$scope.taxconditions[i];var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==$scope.place){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),client=new Clients({name:this.name?this.name:this.razonSocial,apellido:this.apellido?this.apellido:void 0,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,taxCondition:condicionIva?condicionIva._id:void 0,discountRate:this.discountRate?this.discountRate:0,loc:[latitud,longitud],paymentMethod:this.paymentMethod?this.paymentMethod:0,contacts:this.contact?[this.contact._id]:[],country:this.country,city:this.city,region:this.region?this.region:void 0,turno:this.turno?this.turno:void 0,postalCode:this.postalCode?this.postalCode:0,address:this.address,phone:this.phone,web:this.web?this.web:void 0,category1:this.category?this.category._id:void 0,enterprise:empresa,productosAsociados:[]});client.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoCliente=client,console.log("nuevoCliente: ",$rootScope.nuevoCliente)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorDir="Se debe indicar una direccion";else!0===$scope.formResponsableInscripto?$scope.errorName="Se debe indicar la Razon Social":$scope.errorName="Se debe indicar un nombre"},$scope.eliminarMensajeError=function(){$scope.errorName=void 0,$scope.errorDir=void 0,$scope.errorNameProv=void 0,$scope.errorComprobante=void 0,$scope.errorCondicion=void 0,$scope.errorTax=void 0,$scope.errorCategory=void 0},$scope.crearMateriaPrima=function(){var esMp=!1,esI=!1;for(var i in $scope.categories)if($scope.categories[i].name===this.category1)var categoria=$scope.categories[i];for(var i in"Insumo"===categoria.name?esI=!0:esMp=!0,$scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;if(void 0===$rootScope.provider){for(var i in $scope.proveedores)if($scope.proveedores[i].name===this.provider)var idProveedorModal=$scope.proveedores[i]._id}else idProveedorModal=$rootScope.provider._id;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.costPerUnit)if(void 0!==this.tax)if(void 0!==this.sub)if(void 0!==categoria.name)if(void 0!==this.category2)if(void 0!==idProveedorModal){var product=new Products({name:this.name,description:this.description,code:this.code,brandName:this.brandName?this.brandName:void 0,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:idProveedorModal,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esInsumo:esI,esMateriaPrima:esMp,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub?this.sub._id:void 0,category1:categoria._id,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevaMateriaPrima=product,console.log($rootScope.nuevaMateriaPrima)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorCategory="Se debe indicar la subcategoria del producto";else $scope.errorCategoria="Indicar la categoria";else $scope.errorSub="Indicar UEN";else $scope.errorIva="Se debe indicar el iva";else $scope.errorCost="Se debe indicar el costo";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"},$scope.borrarErrores=function(){$scope.errorCode=void 0,$scope.errorName=void 0,$scope.errorCost=void 0,$scope.errorIva=void 0,$scope.errorSub=void 0,$scope.errorCategoria=void 0,$scope.errorCategory=void 0,$scope.errorProv=void 0},$scope.crearProducto=function(){var esProd=!1;for(var i in $scope.categories)if($scope.categories[i].name===this.category1)var categoria=$scope.categories[i];for(var i in"Productos Terminados"===categoria.name&&(esProd=!0),$scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.costPerUnit)if(void 0!==this.tax)if(void 0!==this.sub)if(void 0!==categoria.name)if(void 0!==this.category2)if(void 0!==this.provider){var product=new Products({name:this.name,description:this.description,code:this.code,brandName:this.brandName?this.brandName:0,unitPrice:this.unitPrice,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:this.provider._id,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esProducto:esProd,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub._id,category1:categoria._id,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevoProducto=product,console.log($rootScope.nuevoProducto)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorCategory="Se debe indicar la subcategoria del producto";else $scope.errorCategoria="Indicar la categoria";else $scope.errorSub="Indicar UEN";else $scope.errorIva="Se debe indicar el iva";else $scope.errorCost="Se debe indicar el costo";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"}}$scope.cantProductos=function(){if($rootScope.productosAgregados.length>0)return!0},$scope.clickSubmit=function(n){$scope.clicked=!0,$scope.create(n)},$scope.create=function(n){if(!0===$scope.clicked)if(console.log("##################"),console.log($scope.authentication),void 0!==$scope.numero&&""!==$scope.numero)if(void 0!==$scope.tipoComprobante&&""!==$scope.tipoComprobante)if(void 0!==$scope.tipoPedido&&""!==$scope.tipoPedido){if("compra"===$scope.tipoPedido)if(0!==$scope.productosAgregados.length)if(void 0!==$scope.proveedor||void 0!=this.proveedor||void 0!==$rootScope.nuevoProveedor)if(void 0!==$scope.condicionVenta&&""!==$scope.condicionVenta){if(void 0!==$scope.proveedor||void 0!=this.proveedor||void 0!==$rootScope.nuevoProveedor){if(void 0!==this.proveedor)var proveedor=this.proveedor;else proveedor=$rootScope.nuevoProveedor;if(1===n)var state="borrador";else state="pendiente evaluacion";var pedido=new Pedidos({numero:this.numero,tipoPedido:this.tipoPedido,tipoComprobante:this.tipoComprobante,estado:state,products:$rootScope.productosAgregados,category1:this.category1?this.category1._id:void 0,puesto:$scope.authentication.user.puesto,proveedor:proveedor._id,observaciones:this.observaciones,subtotal:this.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:this.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,total:this.total,myDate:this.myDate,created:$scope.created,condicionVenta:this.condicionVenta._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise})}}else $scope.errorCondicion="Se debe seleccionar una condicion de compra";else $scope.errorProveedor="Se debe seleccionar un proveedor";else $scope.errorProd="Se deben seleccionar productos para la orden de compra";else if(0!==$scope.productosAgregados.length)if(void 0!==$scope.cliente&&null!==$scope.cliente)if(void 0!==$scope.condicionVenta&&""!==$scope.condicionVenta){if(1===n)state="borrador";else state="pendiente evaluacion";$scope.created=new Date($scope.created.setTime($scope.created.getTime()+108e5));pedido=new Pedidos({numero:parseInt(this.numero),tipoPedido:this.tipoPedido,tipoComprobante:this.tipoComprobante,estado:state,category1:this.category1?this.category1._id:void 0,puesto:$scope.authentication.user.puesto,products:$rootScope.productosAgregados,cliente:$scope.cliente._id,delivery:this.delivery,observaciones:this.observaciones,subtotal:this.subtotal,descuentoPorcentaje:this.descuentoPorcentaje,descuentoValor:this.descuentoValor,neto:this.neto,tax1:this.tax1,tax2:this.tax2,tax3:this.tax3,totalTax:this.totalTax,total:this.total,myDate:this.myDate,created:$scope.created,condicionVenta:this.condicionVenta._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise})}else $scope.errorCondicion="Se debe seleccionar una condicion de venta";else $scope.errorCliente="Se debe seleccionar un cliente";else $scope.errorProd="Se deben seleccionar productos para la orden de venta";void 0!==pedido&&pedido.$save(function(response){response._id&&(pedido._id=response._id,$rootScope.pedidos.unshift(pedido)),$state.go("home.pedidos",{tipo:$scope.tipoPedido}),$scope.numero=0,$scope.tipoPedido="",$scope.tipoComprobante="",$scope.observaciones="",$scope.subtotal=0,$scope.descuentoPorcentaje=0,$scope.descuentoValor=0,$scope.neto=0,$scope.tax1=0,$scope.tax2=0,$scope.tax3=0,$scope.total=0,$scope.condicionVenta="",$rootScope.nuevoProveedor=void 0,$rootScope.nuevoCliente=void 0,$rootScope.nuevaMateriaPrima=void 0,$rootScope.nuevoProducto=void 0,$rootScope.provider=void 0},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorPedido="Se debe seleccionar un tipo de orden";else $scope.errorTipoComprobante="Se debe seleccionar un tipo de Comprobante";else $scope.errorNumero="Se debe indicar un numero para la orden"},$scope.apagarAvisos=function(){$scope.errorPedido=void 0,$scope.errorCliente=void 0,$scope.errorProveedor=void 0,$scope.errorProd=void 0,$scope.errorCondicion=void 0},$scope.editar=function(index){$scope.productoEditado[index]=!0},$scope.editarProducto=function(index,p){var tipoPedido=this.tipoPedido,subt=0,tax1=0,tax2=0,tax3=0;if("venta"==tipoPedido){var descuento=p.product.unitPrice*p.descuento/100;p.subtotal=p.cantidad*p.product.unitPrice,p.total=p.cantidad*(p.product.unitPrice-descuento)}if("compra"==tipoPedido){descuento=p.product.costPerUnit*p.descuento/100;p.subtotal=p.cantidad*p.product.costPerUnit,p.total=p.cantidad*(p.product.costPerUnit-descuento)}$rootScope.productosAgregados[index]=p;for(var i=0;i<$rootScope.productosAgregados.length;i++){subt+=$rootScope.productosAgregados[i].total;var iva=$rootScope.productosAgregados[i].product.tax;10.5==iva&&(tax1+=10.5*$rootScope.productosAgregados[i].total/100),21==iva&&(tax2+=21*$rootScope.productosAgregados[i].total/100),27==iva&&(tax3+=27*$rootScope.productosAgregados[i].total/100)}$scope.descuentoValor=subt*$scope.descuentoPorcentaje/100,$scope.subtotal=subt,$scope.neto=subt-$scope.descuentoValor,$scope.tax1=tax1,$scope.tax2=tax2,$scope.tax3=tax3,$scope.total=$scope.neto+$scope.tax1+$scope.tax2+$scope.tax3,this.p=void 0,$scope.productoEditado[index]=!1},$scope.borrarProducto=function(producto){var iva,descGen,totalIva,tipoPedido=this.tipoPedido,subt=0,descProd=0,tax1=0,tax2=0,tax3=0;"compra"==tipoPedido&&(descProd=parseFloat(producto.product.costPerUnit*producto.cantidad*producto.descuento/100),subt=parseFloat(producto.product.costPerUnit*producto.cantidad-descProd)),"venta"==tipoPedido&&(descProd=parseFloat(producto.product.unitPrice*producto.cantidad*producto.descuento/100),subt=parseFloat(producto.product.unitPrice*producto.cantidad-descProd)),descGen=parseFloat(subt*$scope.descuentoPorcentaje/100),10.5==(iva=producto.product.tax)&&(tax1=parseFloat(10.5*subt/100),$scope.tax1=parseFloat($scope.tax1-tax1)),21==iva&&(tax2=parseFloat(21*subt/100),$scope.tax2=parseFloat($scope.tax2-tax2)),27==iva&&(tax3=parseFloat(27*subt/100),$scope.tax3=parseFloat($scope.tax3-tax3)),$scope.neto=parseFloat($scope.neto-(subt-descGen)),$scope.subtotal=parseFloat($scope.subtotal-subt),totalIva=subt-descGen+tax1+tax2+tax3,$scope.descuentoValor=parseFloat($scope.descuentoValor-descGen),$scope.total=$scope.total-totalIva,$scope.totalTax=$scope.totalTax-tax1-tax2-tax3,$rootScope.productosAgregados.splice(producto,1),0==$rootScope.productosAgregados.length&&($scope.deshabilitarProveedor=!1,$scope.deshabilitarCliente=!1)},$scope.remove=function(pedido){if(pedido)for(var i in pedido.$remove(),$scope.pedidos)$scope.pedidos[i]===pedido&&$scope.pedidos.splice(i,1);else $scope.pedido.$remove(function(){$location.path("pedidos")})},$scope.showConfirm=function(ev,item,n){if(1==n){var confirm=$mdDialog.confirm().title("Aprobar Orden").content("¿Está seguro que desea aprobar esta orden?").ariaLabel("Lucky day").ok("Aprobar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item,n)},function(){$scope.status="Cancelaste aprobar"})}else if(2==n){confirm=$mdDialog.confirm().title("Rechazar Orden").content("¿Está seguro que desea rechazar esta orden?").ariaLabel("Lucky day").ok("Rechazar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item,n)},function(){$scope.status="Cancelaste rechazar"})}else if(3==n){console.log("entre 3");confirm=$mdDialog.confirm().title("Evaluar Orden").content("¿Está seguro que desea enviar la orden a evaluar?").ariaLabel("Lucky day").ok("Evaluar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item,n)},function(){$scope.status="Cancelaste evaluar"})}else if(4==n){console.log("entre 4");confirm=$mdDialog.confirm().title("Descartar Orden").content("¿Está seguro que desea descartar esta orden?").ariaLabel("Lucky day").ok("Descartar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item,n)},function(){$scope.status="Cancelaste descartar"})}},$scope.evaluar=function(item){var pedido=item;pedido.estado="pendiente aprobacion",void 0!==this.enterprise?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==this.tipoComprobante?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==this.condicionVenta?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),void 0!==$scope.category1?pedido.category1=$scope.category1._id:void 0!==pedido.category1&&null!==pedido.category1&&(pedido.category1=pedido.category1._id),pedido.$update(function(){},function(errorResponse){})},$scope.update=function(item,n){var pedido=item;if(1==n)for(var i in pedido.estado="aprobada",$scope.filtro)$scope.filtro[i]._id===pedido._id&&$scope.filtro.splice(i,1);if(2==n)for(var i in pedido.estado="rechazada",$scope.filtro)$scope.filtro[i]._id===pedido._id&&$scope.filtro.splice(i,1);3==n&&(pedido.estado="pendiente evaluacion"),4==n&&(pedido.deleted="true"),5==n&&(pedido.estado="pendiente aprobacion"),6==n&&(pedido.estado="borrador"),void 0!==this.enterprise?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==this.tipoComprobante?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==this.condicionVenta?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),void 0!==$scope.category1?pedido.category1=$scope.category1._id:void 0!==pedido.category1&&null!==pedido.category1&&(pedido.category1=pedido.category1._id),$scope.tipoPedido=$stateParams.tipo,void 0===$scope.tipoPedido&&($scope.tipoPedido=pedido.tipoPedido),pedido.$update(function(){$state.go("home.pedidos",{tipo:$scope.tipoPedido})},function(errorResponse){})},$scope.montoTotal=function(){$scope.totalBorradorVenta=0,$scope.totalBorradorCompra=0,$scope.totalAprobadasCompra=0,$scope.totalAprobadasVenta=0,$scope.totalRechazadasCompra=0,$scope.totalRechazadasVenta=0,$scope.totalPendienteACompra=0,$scope.totalPendienteAVenta=0,$scope.totalPendienteECompra=0,$scope.totalPendienteEVenta=0;for(var i=0;i<$rootScope.pedidos.length;i++)"borrador"===$rootScope.pedidos[i].estado&&"compra"===$rootScope.pedidos[i].tipoPedido&&!1===$rootScope.pedidos[i].deleted&&($scope.totalBorradorCompra=$scope.totalBorradorCompra+$rootScope.pedidos[i].total),"borrador"===$rootScope.pedidos[i].estado&&"venta"===$rootScope.pedidos[i].tipoPedido&&!1===$rootScope.pedidos[i].deleted&&($scope.totalBorradorVenta=$scope.totalBorradorVenta+$rootScope.pedidos[i].total),"pendiente evaluacion"===$rootScope.pedidos[i].estado&&"compra"===$rootScope.pedidos[i].tipoPedido&&($scope.totalPendienteECompra=$scope.totalPendienteECompra+$rootScope.pedidos[i].total),"pendiente evaluacion"===$rootScope.pedidos[i].estado&&"venta"===$rootScope.pedidos[i].tipoPedido&&($scope.totalPendienteEVenta=$scope.totalPendienteEVenta+$rootScope.pedidos[i].total),"pendiente aprobacion"===$rootScope.pedidos[i].estado&&"compra"===$rootScope.pedidos[i].tipoPedido&&($scope.totalPendienteACompra=$scope.totalPendienteACompra+$rootScope.pedidos[i].total),"pendiente aprobacion"===$rootScope.pedidos[i].estado&&"venta"===$rootScope.pedidos[i].tipoPedido&&($scope.totalPendienteAVenta=$scope.totalPendienteAVenta+$rootScope.pedidos[i].total),"aprobada"===$rootScope.pedidos[i].estado&&"compra"===$rootScope.pedidos[i].tipoPedido&&($scope.totalAprobadasCompra=$scope.totalAprobadasCompra+$rootScope.pedidos[i].total),"aprobada"===$rootScope.pedidos[i].estado&&"venta"===$rootScope.pedidos[i].tipoPedido&&($scope.totalAprobadasVenta=$scope.totalAprobadasVenta+$rootScope.pedidos[i].total),"rechazada"===$rootScope.pedidos[i].estado&&"compra"===$rootScope.pedidos[i].tipoPedido&&($scope.totalRechazadasCompra=$scope.totalRechazadasCompra+$rootScope.pedidos[i].total),"rechazada"===$rootScope.pedidos[i].estado&&"venta"===$rootScope.pedidos[i].tipoPedido&&($scope.totalRechazadasVenta=$scope.totalRechazadasVenta+$rootScope.pedidos[i].total);$scope.totalPendientesCompra=$scope.totalPendienteECompra+$scope.totalPendienteACompra,$scope.totalPendientesVenta=$scope.totalPendienteEVenta+$scope.totalPendienteAVenta},$scope.findAll=function(){$scope.find(),$scope.findTipoPedido()},$scope.find=function(){var deferred;$scope.filtrarPedidos(),(deferred=$q.defer(),setTimeout(function(){void 0!==$rootScope.pedidos?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise).then(function(response){$scope.montoTotal()})},$scope.filtrarPedidos=function(){$timeout(function(){return $scope.filtro=$filter("filter")($rootScope.pedidos,function(item){return"pendiente evaluacion"===item.estado||"pendiente aprobacion"===item.estado}),$scope.filtro},1e3)},$scope.findTipoPedido=function(){$scope.tipoPedidos=[$stateParams.tipo]},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findTipoComprobante=function(){void 0!==$scope.SEARCH&&($scope.tipoComprobante=Comprobantes.query({e:$scope.SEARCH.enterprise}))},$scope.findClientes=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/clients",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.clientes=response.data;for(var i=0;i<$scope.clientes.length;i++)$scope.clientes[i].name,$scope.cliente=$scope.clientes[i]})},$scope.findCondicionVenta=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data,Modal.setCondicionesVentas($scope.condicionVentas)})},$scope.findProductos=function(){void 0!==$scope.SEARCH&&($scope.products=Products.query({e:$scope.SEARCH.enterprise}),$scope.productosNombre=$scope.products)},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/comprobantes/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){for(var i in $scope.comprobantes=response.data,$scope.comprobantes)"Pedido"===$scope.comprobantes[i].name&&($scope.tipoComprobante=$scope.comprobantes[i],$scope.numero=n_with_zeroes(parseInt($scope.tipoComprobante.ultimoNumero)+1,8));Modal.setComprobantes($scope.comprobantes)})},$scope.findAllView=function(){$scope.findTipoPedido(),$scope.findOne(),$scope.montoTotal()},$scope.findOne=function(){Pedidos.get({pedidoId:$stateParams.pedidoId},function(res){$scope.pedido=res,$rootScope.tipoPedido=$scope.pedido.tipoPedido})},$scope.searchTextChange=function(text){angular.lowercase(text);return $filter("filter")($scope.proveedores,{name:text})},$scope.sendProvider=function($event,provider){13===$event.keyCode&&($event.preventDefault(),null===provider||void 0===provider?$scope.mensajeP="No seleccionaste un proveedor valido":$scope.proveedor=provider)},$scope.selectedItemChange=function(item){(null!==item&&void 0!==item&&($scope.idProveedor=item._id),$scope.proveedor=item,$rootScope.provider=item,$scope.descProveedor(),$scope.tipeando=!1,void 0!==$scope.proveedor)&&(void 0!==$scope.proveedor.condicionPago&&$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data;for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==$scope.proveedor.condicionPago._id&&null!==$scope.proveedor.condicionPago._id&&$scope.condicionVentas[i]._id==$scope.proveedor.condicionPago._id?$scope.condicionVenta=$scope.condicionVentas[i]:$scope.condicionVentas[i]._id==$scope.proveedor.condicionPago&&($scope.condicionVenta=$scope.condicionVentas[i])}))},$scope.searchTextChangeClient=function(text){angular.lowercase(text);return $filter("filter")($scope.clientes,{name:text})},$scope.sendClient=function($event,client){13===$event.keyCode&&($event.preventDefault(),null===client||void 0===client?$scope.mensajeP="No seleccionaste un cliente valido":$scope.cliente=client)},$scope.selectedItemChangeClient=function(item){if($scope.cliente=item,void 0!==$scope.cliente&&null!==$scope.cliente){if(void 0!==$scope.cliente.condicionPago)$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data,console.log($scope.condicionVentas,"condicion ventas");for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==$scope.cliente.condicionPago?$scope.condicionVentas[i]._id==$scope.cliente.condicionPago._id&&($scope.condicionVenta=$scope.condicionVentas[i]):$scope.condicionVentas[i]._id==$scope.cliente.condicionPago&&($scope.condicionVenta=$scope.condicionVentas[i])});$scope.descCliente()}},$scope.searchTextChangeProduct=function(text){angular.lowercase(text);$scope.productosNombre=$filter("filter")($scope.products,{name:text})},$scope.searchTextChangeProduct2=function(text){$scope.tipeando=!0;angular.lowercase(text);return 0===$scope.idProveedor?$scope.filtrados=$filter("filter")($scope.products,function(item){return!0===item.esMateriaPrima||!0===item.esInsumo}):void 0!==$scope.products&&null!==$scope.products?$scope.filtrados=$filter("filter")($scope.products,function(item){return(!0===item.esMateriaPrima||!0===item.esInsumo)&&item.provider._id===$scope.idProveedor}):console.log("[+] no hay lista de productos para filtrar!!!",$scope.products),$scope.filtroProductos=$filter("filter")($scope.filtrados,{name:text})},$scope.selectedItemChangeProduct=function(item){$scope.errorProd=void 0,$scope.mensajeP=void 0,$scope.producto=item,null!==$scope.producto&&document.getElementById("cantProd").focus(),"compra"===$scope.tipoPedido&&(null!==this.proveedor&&void 0!==this.proveedor||null!==$scope.producto&&void 0!==$scope.producto&&(this.proveedor=$scope.producto.provider,$scope.proveedor=$scope.producto.provider))},$scope.minLengthProv=0,$scope.showAdvanced=function(ev){$scope.minLengthProv=1,$scope.textToSearch=void 0,Modal.setTipo($scope.tipoPedido),$scope.findContacts(),$scope.findCategories(),$scope.findTaxConditions(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/pedidos/views/create.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLengthProv=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLengthProv=0,$scope.status="You cancelled the dialog."})},$scope.minLengthProd=0,$scope.showAdvancedProduct=function(ev){$scope.minLengthProd=1,$scope.textToSearch2=void 0,Modal.setTipo($scope.tipoPedido),$scope.findProveedores(),$scope.findCategories(),$scope.findSubs(),$scope.findMetrics(),$scope.findSubcategories(),$scope.findTaxes(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/pedidos/views/create.product.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLengthProd=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLengthProd=0,$scope.status="You cancelled the dialog."})},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}),Modal.setContactos($scope.contacts))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setCategorias($scope.categories))},$scope.findCategoriesVenta=function(){void 0!==$scope.SEARCH&&Categories.query({e:$scope.SEARCH.enterprise},function(data){$scope.categories=$filter("filter")(data,function(item){return"venta"===item.type1||"producto venta"===item.type1}),Modal.setCategorias($scope.categories)})},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}),Modal.setCondiciones($scope.taxconditions))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}),Modal.setSubs($scope.subs))},$scope.findSubcategories=function(){void 0!==$scope.SEARCH&&($scope.subcategorias=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setSubcategorias($scope.subcategorias))},$scope.findProveedores=function(){void 0!==$scope.SEARCH&&($scope.proveedores=Providers.query({e:$scope.SEARCH.enterprise}),Modal.setProveedores($scope.proveedores))},$scope.findTaxes=function(){void 0!==$scope.SEARCH&&($scope.taxes=[{value:1,name:"Iva incluido en el costo"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}],Modal.setTaxes($scope.taxes))},$scope.findMetrics=function(){void 0!==$scope.SEARCH&&($scope.metrics=Metrics.query(),Modal.setMetrics($scope.metrics))}}]),angular.module("pedidos").controller("ViewPedidosController",["$scope","$rootScope","$stateParams","$location","Authentication","Pedidos","Enterprises","$mdBottomSheet","$state","$mdDialog","pedidos","tipoOrden","tipoPedido","Products","Providers","Condicionventas","Cajas",function($scope,$rootScope,$stateParams,$location,Authentication,Pedidos,Enterprises,$mdBottomSheet,$state,$mdDialog,pedidos,tipoOrden,tipoPedido,Products,Providers,Condicionventas,Cajas){function actualizarReferencias(){for(var i in $scope.products)if(1==$scope.products[i].esProducto&&0==$scope.products[i].reseller&&0==$scope.products[i].deleted&&$scope.products[i].produccion.length>0){var product=$scope.products[i];product.enterprise=product.enterprise._id,product.category2=product.category2._id,product.provider=product.provider._id,product.$update(function(data){console.log("update referencia ok")},function(errorResponse){console.log(errorResponse,"error"),this.error=errorResponse.data.message})}}function DialogController($scope,$mdDialog,item,$rootScope,Socket,Cajas){$scope.item=item,$scope.cancel=function(){$mdDialog.cancel()},$scope.finalizarPedido=function(item,fechaE){void 0!==fechaE&&(item.myDate=fechaE,item.myDateChanged=!0);!function(pedido,estado){pedido.estado=estado,pedido.enterprise=pedido.enterprise._id,pedido.tipoComprobante=pedido.tipoComprobante._id,void 0!==pedido.cliente&&(pedido.cliente=pedido.cliente._id);void 0!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id);void 0!==pedido.category1&&(pedido.category1=pedido.category1._id);pedido.condicionVenta=pedido.condicionVenta._id,void 0!==pedido.caja&&(pedido.caja=pedido.caja._id);$mdDialog.hide(),Socket.emit("pedido.update",pedido),history.back()}(item,"aprobada")}}DialogController.$inject=["$scope","$mdDialog","item","$rootScope","Socket","Cajas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null}}),$rootScope.pedidos=pedidos,$scope.tipoOrden=tipoOrden,$scope.tipoPedido=tipoPedido,$scope.verEdicion=[],$scope.verForm=!1,$scope.cambioPrecio=!1,$scope.formAdd=!1,$scope.habilitarEditCondicion=!1,$scope.selectedMode="md-scale",$scope.selectedDirection="left",$scope.rutaVolver=function(){history.back()},$scope.findOne=function(){Pedidos.get({pedidoId:$stateParams.pedidoId},function(res){$scope.pedido=res,$rootScope.tipoPedido=$scope.pedido.tipoPedido})},$scope.showConfirm=function(ev,item,n){if(1==n){var confirm=$mdDialog.confirm().title("Aprobar Orden").content("¿Está seguro que desea aprobar esta orden?").ariaLabel("Lucky day").ok("Aprobar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item,n)},function(){$scope.status="Cancelaste aprobar"})}else if(2==n){confirm=$mdDialog.confirm().title("Rechazar Orden").content("¿Está seguro que desea rechazar esta orden?").ariaLabel("Lucky day").ok("Rechazar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.update(item,n)},function(){$scope.status="Cancelaste rechazar"})}},$scope.showConfirm2=function(ev,item,pedido){var confirm=$mdDialog.confirm().title("Eliminar productos").content("¿Está seguro que desea eliminar este producto de la orden?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.quitarProducto(item,pedido)},function(){})},$scope.showAdvancedAprobar=function(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/pedidos/views/modalAprobar.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.update=function(item,n){var pedido=item;1==n&&(pedido.estado="aprobada"),2==n&&(pedido.estado="rechazada"),void 0!==this.enterprise?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==this.tipoComprobante?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==this.condicionVenta?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),void 0!==this.caja?pedido.caja=this.caja._id:void 0!==pedido.caja&&null!==pedido.caja&&(pedido.caja=pedido.caja._id),$scope.tipoPedido=$stateParams.tipo,void 0===$scope.tipoPedido&&($scope.tipoPedido=pedido.tipoPedido),pedido.$update(function(){history.back()},function(errorResponse){})},$scope.habilitarEdicion=function(index){$scope.verEdicion[index]=!0},$scope.cambiarPrecio=function(){$scope.cambioPrecio=!0,$scope.findProductos()},$scope.editProducto=function(p,pedido,index){var impuestos=p.product.provider.impuesto1+p.product.provider.impuesto2+p.product.provider.impuesto3+p.product.provider.impuesto4,subtotal=0,iva=0;$scope.verEdicion=!1,"compra"==pedido.tipoPedido?p.subtotal=p.cantidad*p.product.costPerUnit:p.subtotal=p.cantidad*p.product.unitPrice;var descuento=p.subtotal*p.descuento/100;for(var i in p.total=p.subtotal-descuento,pedido.products)subtotal+=pedido.products[i].total,1!=pedido.products[i].product.tax&&(iva+=pedido.products[i].subtotal*pedido.products[i].product.tax/100);pedido.subtotal=subtotal,pedido.descuentoValor=subtotal*pedido.descuentoPorcentaje/100,pedido.neto=subtotal-pedido.descuentoValor;var impuestosTotal=pedido.neto*impuestos/100;if(pedido.totalImp=impuestosTotal,pedido.totalTax=iva,pedido.total=pedido.subtotal+iva,"pendiente evaluacion"==pedido.estado)var n=3;if("pendiente aprobacion"==pedido.estado)n=5;if("borrador"==pedido.estado)n=6;$scope.verEdicion=[],$scope.updatePedido(pedido,n,p)},$scope.updatePedido=function(item,n,p){!0===$scope.cambioPrecio&&($scope.modificarPrecioProducto(p.product,item),$scope.cambioPrecio=!1);var pedido=item;void 0!==this.enterprise?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==this.tipoComprobante?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),"compra"==item.tipoPedido?void 0!==$scope.proveedor?pedido.proveedor=$scope.proveedor._id:void 0!==pedido.proveedor&&null!==pedido.proveedor&&(pedido.proveedor=pedido.proveedor._id):void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==this.condicionVenta?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),$scope.tipoPedido=$stateParams.tipo,pedido.$update(function(){},function(errorResponse){})},$scope.modificarPrecioProducto=function(p,pedido){for(var i in $scope.products)if($scope.products[i]._id===p._id){if("compra"===pedido.tipoPedido){var cost=p.costPerUnit;p=$scope.products[i];var product=new Products({_id:p._id,name:p.name,description:p.description,code:p.code,brandName:p.brandName,unitPrice:cost,costPerUnit:cost,provider:p.provider._id,quantityPerUnit:p.quantityPerUnit,unitsInStock:p.unitsInStock,idealStock:p.idealStock,criticalStock:p.criticalStock,unitsOnOrder:p.unitsOnOrder,storedIn:p.storedIn,metric:p.metric,reseller:p.reseller,esProducto:p.esProducto,esMateriaPrima:p.esMateriaPrima,esInsumo:p.esInsumo,tax:p.tax,enterprise:p.enterprise,category1:p.category1,category2:p.category2})}else{var precio=p.unitPrice;p=$scope.products[i];product=new Products({_id:p._id,name:p.name,description:p.description,code:p.code,brandName:p.brandName,unitPrice:precio,costPerUnit:p.costPerUnit,provider:p.provider._id,quantityPerUnit:p.quantityPerUnit,unitsInStock:p.unitsInStock,idealStock:p.idealStock,criticalStock:p.criticalStock,unitsOnOrder:p.unitsOnOrder,storedIn:p.storedIn,metric:p.metric,reseller:p.reseller,esProducto:p.esProducto,esMateriaPrima:p.esMateriaPrima,esInsumo:p.esInsumo,tax:p.tax,enterprise:p.enterprise,category1:p.category1,category2:p.category2})}product.enterprise=product.enterprise._id,void 0!==product.category1&&null!==product.category1&&(product.category1=product.category1._id),void 0!==product.category2&&null!==product.category2&&(product.category2=product.category2?product.category2._id:void 0),void 0!==product.provider&&null!==product.provider&&(product.provider=product.provider._id),product.$update(function(response){actualizarReferencias()},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.findProductos=function(){void 0!==$scope.SEARCH&&($scope.products=Products.query({e:$scope.SEARCH.enterprise}))},$scope.verAddProductos=function(){$scope.formAdd=!0,$location.hash("agregarProd")},$scope.sumarProductoCompra=function(producto,productoPedido,pedido){void 0!==producto?void 0!==productoPedido?(void 0!==productoPedido.cantidad&&void 0==productoPedido.descuento&&(productoPedido.descuento=0),Providers.get({providerId:producto.provider[0].id},function(prov){var impuestos=prov.impuesto1+prov.impuesto2+prov.impuesto3+prov.impuesto4;console.log(impuestos,"impuestos"),$scope.formAdd=!1;var tax1,tax3,totalIva,p={product:{},cantidad:void 0,descuento:0,total:void 0,subtotal:void 0,observaciones:void 0},valorDescuento=producto.costPerUnit*productoPedido.descuento/100,tax2=0;p.product=producto,p.cantidad=productoPedido.cantidad,p.descuento=productoPedido.descuento,p.observaciones=productoPedido.observaciones,p.subtotal=producto.costPerUnit*productoPedido.cantidad,p.total=producto.costPerUnit*productoPedido.cantidad-valorDescuento,pedido.subtotal=pedido.subtotal+p.total,0!==pedido.descuentoPorcentaje?(pedido.descuentoValor=pedido.subtotal*pedido.descuentoValor/pedido.descuentoPorcentaje,pedido.neto=pedido.subtotal-pedido.descuentoValor):pedido.neto=pedido.subtotal,10.5==producto.tax&&(tax1=parseFloat(10.5*p.subtotal/100),pedido.tax1=parseFloat(pedido.tax1+tax1)),21==producto.tax&&(tax2=parseFloat(21*p.subtotal/100),pedido.tax2=parseFloat(pedido.tax2+tax2)),27==producto.tax&&(tax3=parseFloat(27*p.subtotal/100),pedido.tax3=parseFloat(pedido.tax3+tax3));var impuestosTotal=pedido.neto*impuestos/100;pedido.totalImp=impuestosTotal,totalIva=pedido.tax1+pedido.tax2+pedido.tax3,pedido.totalTax=totalIva,pedido.total=pedido.neto+pedido.totalTax+impuestosTotal,pedido.products.push(p),$scope.updatePedido(pedido)})):$scope.errorCant="Se debe indicar una cantidad":$scope.errorProd="Se debe seleccionar un producto"},$scope.sumarProductoVenta=function(producto,productoPedido,pedido){if(void 0!==producto)if(void 0!==productoPedido){void 0!==productoPedido.cantidad&&void 0==productoPedido.descuento&&(productoPedido.descuento=0),$scope.formAdd=!1;var tax1,tax3,totalIva,p={product:{},cantidad:void 0,descuento:0,total:void 0,subtotal:void 0,observaciones:void 0},valorDescuento=producto.unitPrice*productoPedido.descuento/100,tax2=0;p.product=producto,p.cantidad=productoPedido.cantidad,p.descuento=productoPedido.descuento,p.observaciones=productoPedido.observaciones,p.subtotal=producto.unitPrice*productoPedido.cantidad,p.total=producto.unitPrice*productoPedido.cantidad-valorDescuento,pedido.subtotal=pedido.subtotal+p.total,0!==pedido.descuentoPorcentaje?(pedido.descuentoValor=pedido.subtotal*pedido.descuentoPorcentaje/100,pedido.neto=pedido.subtotal-pedido.descuentoValor):pedido.neto=pedido.subtotal,10.5==producto.tax&&(tax1=parseFloat(10.5*p.subtotal/100),pedido.tax1=parseFloat(pedido.tax1+tax1)),21==producto.tax&&(tax2=parseFloat(21*p.subtotal/100),pedido.tax2=parseFloat(pedido.tax2+tax2)),27==producto.tax&&(tax3=parseFloat(27*p.subtotal/100),pedido.tax3=parseFloat(pedido.tax3+tax3)),totalIva=pedido.tax1+pedido.tax2+pedido.tax3,pedido.totalTax=totalIva,pedido.total=pedido.neto+pedido.totalTax,pedido.products.push(p),$scope.updatePedido(pedido)}else $scope.errorCant="Se debe indicar una cantidad";else $scope.errorProd="Se debe seleccionar un producto"},$scope.quitarProducto=function(p,pedido){var iva,descGen,totalIva,tipoPedido=pedido.tipoPedido,subt=0,descProd=0,tax1=0,tax2=0,tax3=0;"compra"==tipoPedido&&(descProd=parseFloat(p.product.costPerUnit*p.cantidad*p.descuento/100),subt=parseFloat(p.product.costPerUnit*p.cantidad-descProd)),"venta"==tipoPedido&&(descProd=parseFloat(p.product.unitPrice*p.cantidad*p.descuento/100),subt=parseFloat(p.product.unitPrice*p.cantidad-descProd)),descGen=parseFloat(subt*pedido.descuentoPorcentaje/100),1==(iva=p.product.tax)&&console.log("iva incluido"),10.5==iva&&(tax1=parseFloat(10.5*subt/100),pedido.tax1=parseFloat(pedido.tax1-tax1)),21==iva&&(tax2=parseFloat(21*subt/100),pedido.tax2=parseFloat(pedido.tax2-tax2)),27==iva&&(tax3=parseFloat(27*subt/100),pedido.tax3=parseFloat(pedido.tax3-tax3)),pedido.neto=parseFloat(pedido.neto-(subt-descGen)),pedido.subtotal=parseFloat(pedido.subtotal-subt),totalIva=subt-descGen+tax1+tax2+tax3,pedido.descuentoValor=parseFloat(pedido.descuentoValor-descGen),pedido.total=pedido.total-totalIva,pedido.totalTax=pedido.totalTax-tax1-tax2-tax3;for(var i=0;i<pedido.products.length;i++)pedido.products[i]._id===p._id&&pedido.products.splice(i,1);if("pendiente evaluacion"==pedido.estado)var n=3;if("pendiente aprobacion"==pedido.estado)n=5;if("borrador"==pedido.estado)n=6;$scope.updatePedido(pedido,n,p)},$scope.cambiarCondicion=function(){"pendiente aprobacion"==$scope.pedido.estado&&($scope.habilitarEditCondicion=!0)},$scope.findCondicionVenta=function(){void 0!==$scope.SEARCH&&($scope.condiciones=Condicionventas.query({e:$scope.SEARCH.enterprise}))},$scope.actualizarCondicion=function(c){$scope.pedido.condicionVenta=c._id;var pedido=$scope.pedido;void 0!==this.enterprise?pedido.enterprise=this.enterprise._id:void 0!==pedido.enterprise&&null!==pedido.enterprise&&(pedido.enterprise=pedido.enterprise._id),void 0!==this.tipoComprobante?pedido.tipoComprobante=this.tipoComprobante._id:void 0!==pedido.tipoComprobante&&(pedido.tipoComprobante=pedido.tipoComprobante._id),void 0!==$scope.cliente?pedido.cliente=$scope.cliente._id:void 0!==pedido.cliente&&null!==pedido.cliente&&(pedido.cliente=pedido.cliente._id),void 0!==this.condicionVenta?pedido.condicionVenta=this.condicionVenta._id:void 0!==pedido.condicionVenta&&null!==pedido.condicionVenta&&(pedido.condicionVenta=pedido.condicionVenta._id),void 0!==this.caja?pedido.caja=this.caja._id:void 0!==pedido.caja&&null!==pedido.caja&&(pedido.caja=pedido.caja._id),pedido.$update(function(){console.log("actualice bien la condicion")},function(errorResponse){})}}]),angular.module("pedidos").factory("Pedidos",["$resource",function($resource){return $resource("api/pedidos/:pedidoId",{pedidoId:"@_id",e:"@enterprise",w:"@filterDate.week",y:"@filterDate.year",tipoPedido:"@tipoPedido",estado:"@estado",p:"@p",pcount:"@pcount"},{update:{method:"PUT"}})}]).factory("Modal",function(){var tipo,proveedor,empresa,contactos=[],categorias=[],subcategorias=[],condiciones=[],condicionesVentas=[],comprobantes=[],subs=[],proveedores=[],taxes=[],metrics=[];return{getTipo:function(){return tipo},setTipo:function(value){tipo=value},getProveedor:function(){return proveedor},setProveedor:function(prov){proveedor=prov},getContactos:function(){return contactos},setContactos:function(value){contactos=value},getCategorias:function(){return categorias},setCategorias:function(value){categorias=value},getSubcategorias:function(){return subcategorias},setSubcategorias:function(value){subcategorias=value},getCondiciones:function(){return condiciones},setCondiciones:function(value){condiciones=value},getCondicionesVentas:function(){return condicionesVentas},setCondicionesVentas:function(value){condicionesVentas=value},getComprobantes:function(){return comprobantes},setComprobantes:function(value){comprobantes=value},getEmpresa:function(){return empresa},setEmpresa:function(value){empresa=value},getSubs:function(){return subs},setSubs:function(value){subs=value},getProveedores:function(){return proveedores},setProveedores:function(value){proveedores=value},getTaxes:function(){return taxes},setTaxes:function(value){taxes=value},getMetrics:function(){return metrics},setMetrics:function(value){metrics=value}}}),angular.module("pedidos").factory("PedidosExtra",["$http",function($http){return{select:function(estado,enterprise,tipoPedido){return $http({method:"get",url:"/api/pedidos/select",params:{e:enterprise,estado:estado,type:tipoPedido}})},loadMore:function(enterprise,tipoPedido,estado,last,limit){return $http({method:"get",url:"/api/pedidos/loadmore",params:{e:enterprise,last:last,limit:limit,estado:estado,type:tipoPedido}})},search:function(enterprise,tipoPedido,estado,search){return $http({method:"get",url:"/api/pedidos/search",params:{e:enterprise,estado:estado,tipoPedido:tipoPedido,search:search}})}}}]),angular.module("personas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Personas",state:"personas",type:"dropdown"}),Menus.addSubMenuItem("topbar","personas",{title:"List Personas",state:"personas.list"}),Menus.addSubMenuItem("topbar","personas",{title:"Create Persona",state:"personas.create"})}]),angular.module("personas").config(["$stateProvider",function($stateProvider){$stateProvider.state("personas",{abstract:!0,url:"/personas__",template:"<ui-view/>"}).state("personas.list",{url:"",templateUrl:"modules/personas/views/list-personas.client.view.html"}).state("personas.create",{url:"/create",templateUrl:"modules/personas/views/create-persona.client.view.html"}).state("personas.view",{url:"/:personaId",templateUrl:"modules/personas/views/view-persona.client.view.html"}).state("personas.edit",{url:"/:personaId/edit",templateUrl:"modules/personas/views/edit-persona.client.view.html"})}]),angular.module("personas").controller("PersonasController",["$scope","$timeout","$window","$stateParams","FileUploader","$location","Authentication","Contacts","Remuneraciones","Costcenters","$rootScope","Users","$http","Enterprises","ChangeStatusUserById","$filter","Puestos","$mdDialog","$q",function($scope,$timeout,$window,$stateParams,FileUploader,$location,Authentication,Contacts,Remuneraciones,Costcenters,$rootScope,Users,$http,Enterprises,ChangeStatusUserById,$filter,Puestos,$mdDialog,$q){function arrContains(array,value){for(var j=0;j<array.length;j++)if(array[j].email===value)return!0;return!1}$scope.authentication=Authentication,$scope.costcenterId=$stateParams.centroDeCosto,$scope.empresa="",$scope.rolesUser=["compras","ventas"],$scope.roles=["user","admin","rrhh","compras","ventas","produccion"],$scope.rolesGroso=["user","admin","rrhh","compras","ventas","produccion","groso"],$scope.sTrue=!0,$scope.sFalse=!1,$scope.switch=[],$scope.modoEditar=[],$scope.totalRemuneracion=0,$scope.addedRemuneraciones=[],$scope.puesto=void 0,$scope.puestoPersona=void 0,$scope.puestoDisabled=!0,$scope.fechaDeEntrada=new Date,$scope.showAddRemuneracion=!1,$scope.user=Authentication.user,$scope.imageURL="modules/users/img/profile/default.png",$scope.password={currentPassword:"",newPassword:"",verifyPassword:""},$scope.$watchCollection("authentication",function(){$scope.contactosDisponibles=[],$scope.contactosDisponiblesFilter=[],$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findUsers(),$scope.findCentros(),$scope.findPuestos(),$scope.findRemuneraciones()}),$scope.$watchCollection("enterpriseS",function(){$scope.findUsers()}),$scope.$watchCollection("empresa",function(){$scope.findContacts($scope.empresa)}),$scope.asignaPuesto=function(puesto){$scope.puesto=puesto},$scope.asignaRemuneracion=function(remuneracion){$scope.showAddRemuneracion=null!=remuneracion,$scope.remuneracion=remuneracion},$scope.addRemuneracion=function(remuneracion){remuneracion.total=$scope.totalRemuneracion,$scope.modoEditar.push(!1),checkIfAlreadyIn(remuneracion)||$scope.addedRemuneraciones.push(remuneracion),$scope.totalRemuneracion=0,$scope.showAddRemuneracion=!1};var checkIfAlreadyIn=function(remuneracion){for(var i=0;i<$scope.addedRemuneraciones.length;i++)if($scope.addedRemuneraciones[i]._id==remuneracion._id)return!0;return!1};$scope.editTrue=function(index){$scope.modoEditar[index]=!0},$scope.updateP=function(index,p){$scope.addedRemuneraciones[index].total=p.total,$scope.modoEditar[index]=!1},$scope.eliminarProducto=function(index){$scope.addedRemuneraciones.splice(index,1)},$scope.asignaCentro=function(centro){$scope.centroDeCosto=centro,$scope.puestoDisabled=!1},$scope.uploader=new FileUploader({url:"api/users/picture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.uploadwait=!1,$scope.uploader.onAfterAddingFile=function(fileItem){if($scope.uploadwait=!0,$window.FileReader){var fileReader=new FileReader;fileReader.onload=function(fileReaderEvent){$timeout(function(){var oldImageUrl=$scope.imageURL;$scope.imageURL=fileReaderEvent.target.result,$scope.imageURL!=oldImageUrl&&($scope.uploadwait=!1)},0)},fileReader.readAsDataURL(fileItem._file)}},$scope.uploader.onSuccessItem=function(){$scope.success=!0,$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){console.log("image upload fired!"),$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.contacto.profileImageURL},$scope.updatePassword=function(){(-1!==$scope.user.roles.indexOf("groso")||$scope.password.currentPassword)&&$scope.password.newPassword&&$scope.password.newPassword===$scope.password.verifyPassword&&(console.log("update password"),$http.post("api/users/password",$scope.password).success(function(response){$scope.passwordChangeError="",$scope.passwordChangeSuccess=response.message,console.log("response",response)}).error(function(error){$scope.passwordChangeError=error.message,$scope.passwordChangeSuccess="",console.log("ee",error)}))},$scope.create=function(){if(void 0!==$scope.contacto)if(void 0!==$scope.contacto.firstName)if(void 0!==$scope.contacto.lastName)if(void 0!==$scope.contacto.username)if($scope.puestoPersona&&"Ocupado"!==$scope.puestoPersona.estado){var persona=new Users({firstName:$scope.contacto.firstName,lastName:$scope.contacto.lastName,email:$scope.contacto.email?$scope.contacto.email:void 0,username:$scope.contacto.username,enterprise:$scope.SEARCH.enterprise,sueldo:$scope.contacto.sueldo,puesto:$scope.puesto?$scope.puesto._id:void 0,centroDeCosto:$scope.centroDeCosto?$scope.centroDeCosto._id:void 0,remuneraciones:$scope.addedRemuneraciones,cuit:$scope.contacto.cuit||void 0,telefono:$scope.contacto.telefono||void 0,fechaDeEntrada:$scope.fechaDeEntrada||void 0,roles:[$scope.rolePersona],observaciones:void 0,password:angular.lowercase(removeAccents($scope.contacto.firstName+$scope.contacto.lastName+"pass"))});$http.post("/api/auth/signup",persona).success(function(response){for(var i=0;i<$scope.contactosDisponibles.length;i++)$scope.contactosDisponibles[i].email===persona.email&&$scope.contactosDisponibles.splice(i,1);$scope.uploader.onBeforeUploadItem=function(fileItem){fileItem.formData=[response]},$scope.users.push(persona),$scope.puestoPersona=void 0,$scope.uploadProfilePicture(),$location.path("/empleados")}).error(function(err){console.log(err)})}else $scope.errorPuesto="Puesto ocupado";else $scope.errorUser="Debe indicar un nombre de usuario para el nuevo personal";else $scope.errorApellido="Debe indicar el apellido del nuevo personal";else $scope.errorName="Debe indicar el nombre del nuevo personal";else $scope.error="Ingrese los datos para el nuevo personal"},$scope.update=function(){void 0!==$scope.contacto?void 0!==$scope.contacto.firstName?void 0!==$scope.contacto.lastName?void 0!==$scope.contacto.username?$scope.contacto.puesto&&$scope.contacto.puesto._id===$scope.puestoPersona._id||$scope.puestoPersona&&"Ocupado"!==$scope.puestoPersona.estado?($scope.contacto.oldPuesto=$scope.contacto.puesto,$scope.contacto.centroDeCosto=$scope.centroDeCostoPersona,$scope.contacto.puesto=$scope.puestoPersona,$scope.contacto.fechaDeEntrada=$scope.fechaDeEntrada,$scope.contacto.roles=[$scope.rolePersona],$scope.remuneraciones=$scope.addedRemuneraciones,$scope.contacto.profileImageURL&&$scope.uploadProfilePicture(),$http.put("/api/users",$scope.contacto).success(function(){$location.path("/empleados/"+$scope.contacto.centroDeCosto._id)}).error(function(err){console.log(err)})):$scope.errorPuesto="Puesto ocupado":$scope.errorUser="Debe indicar un nombre de usuario para el nuevo personal":$scope.errorApellido="Debe indicar el apellido del nuevo personal":$scope.errorName="Debe indicar el nombre del nuevo personal":$scope.error="Ingrese los datos para el nuevo personal"},$scope.borrarError=function(){$scope.msjError=void 0,$scope.error=void 0,$scope.errorName=void 0,$scope.errorApellido=void 0,$scope.errorUser=void 0},$scope.remove=function(persona){if(persona)for(var i in persona.$remove(),$scope.personas)$scope.personas[i]===persona&&$scope.personas.splice(i,1);else $scope.persona.$remove(function(){$location.path("personas")})},$scope.find=function(){$scope.personas=Personas.query()},$scope.findRemuneraciones=function(){$http.post("/api/remuneraciones/"+$scope.addedRemuneraciones[0]._id).then(function(res){return!res.deleted}).error(function(err){console.log(err)})},$scope.findOne=function(){$http({method:"GET",url:"/api/users/byId",params:{userId:$stateParams.personaId}}).then(function(res){$scope.puestoDisabled=!1,$scope.contacto=res.data,$scope.contacto.cuit=Number($scope.contacto.cuit),$scope.rolePersona=$scope.contacto.roles[0],$scope.fechaDeEntrada=$scope.contacto.fechaDeEntrada?new Date($scope.contacto.fechaDeEntrada):new Date($scope.contacto.created),$scope.centroDeCostoPersona=$scope.contacto.centroDeCosto||$scope.contacto.puesto.centroDeCosto,$scope.puestoPersona=$scope.contacto.puesto,$scope.addedRemuneraciones=$scope.contacto.remuneraciones,$scope.modoEditar=new Array($scope.addedRemuneraciones.length).fill(!1),$scope.imageURL=$scope.contacto.profileImageURL,$scope.contacto.sueldo=Number($stateParams.sueldo);$scope.findRemuneraciones();$scope.uploader.formData=[$scope.contacto],$scope.addedRemuneraciones.forEach(function(element){$http.post("/api/remuneraciones/"+element._id).success(function(res){return res.deleted?element.deleted=!0:element.deleted=!1,!res.deleted||($scope.addedRemuneraciones.deleted=!0,!1)}).error(function(err){console.log(err)})})},function(err){console.log("Error"+err)})},$scope.findCentros=function(){void 0!==$scope.SEARCH&&($scope.centrosDeCosto=Costcenters.query({e:$scope.SEARCH.enterprise}))},$scope.findRemuneraciones=function(){void 0!==$scope.SEARCH&&($scope.remuneraciones=Remuneraciones.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findPuestos=function(){void 0!==$scope.SEARCH&&($rootScope.puestos=Puestos.query({e:$scope.SEARCH.enterprise}))},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($rootScope.contactos=Contacts.query({e:$scope.SEARCH.enterprise}))},$scope.findUsers=function(){"groso"!==$scope.authentication.user.roles[0]?void 0!==$scope.SEARCH&&(void 0!==$scope.SEARCH.enterprise&&null!==$scope.SEARCH.enterprise?Users.query({e:$scope.SEARCH.enterprise},function(res){$rootScope.users=res;for(var j=0;j<$rootScope.users.length;j++)"active"===$rootScope.users[j].status?$scope.switch[$rootScope.users[j]._id]=!0:$scope.switch[$rootScope.users[j]._id]=!1;Contacts.query({e:$scope.SEARCH.enterprise},function(res){$rootScope.contacts=res;for(var j=0;j<$rootScope.contacts.length;j++)arrContains($rootScope.users,$rootScope.contacts[j].email)||$scope.contactosDisponibles.push($rootScope.contacts[j]);$scope.contactosDisponiblesFilter=$scope.contactosDisponibles},function(error){})},function(error){}):(console.log("[+] el usuario no tiene empresa"),$rootScope.users=[])):void 0!==$scope.enterpriseS&&null!==$scope.enterpriseS?Users.query({e:$scope.enterpriseS._id},function(res){$rootScope.users=res;for(var j=0;j<$rootScope.users.length;j++)"active"===$rootScope.users[j].status?$scope.switch[$rootScope.users[j]._id]=!0:$scope.switch[$rootScope.users[j]._id]=!1;Contacts.query({e:$scope.enterpriseS._id},function(res){$rootScope.contacts=res;for(var j=0;j<$rootScope.contacts.length;j++)arrContains($rootScope.users,$rootScope.contacts[j].email)||$scope.contactosDisponibles.push($rootScope.contacts[j]);$scope.contactosDisponiblesFilter=$scope.contactosDisponibles},function(error){})},function(error){}):$rootScope.users=[]},$scope.findContacts=function(emp){void 0!==emp&&Users.query({e:emp._id},function(res){$rootScope.users=res;for(var j=0;j<$rootScope.users.length;j++)"active"===$rootScope.users[j].status?$scope.switch[$rootScope.users[j]._id]=!0:$scope.switch[$rootScope.users[j]._id]=!1;Contacts.query({e:emp._id},function(res){$rootScope.contacts=res;for(var j=0;j<$rootScope.contacts.length;j++)arrContains($rootScope.users,$rootScope.contacts[j].email)||$scope.contactosDisponibles.push($rootScope.contacts[j]);$scope.contactosDisponiblesFilter=$scope.contactosDisponibles},function(error){})},function(error){})},$scope.searchText=null,$scope.seleccionoContacto=function(){var index=$rootScope.contacts.indexOf($scope.contacto);$rootScope.contacts.splice(index,1),Users.query({},function(res){for(var b=!1,j=0;j<res.length;j++)res[j].username===angular.lowercase($scope.contacto.firstName+"."+$scope.contacto.lastName).split(" ").join("")&&(b=!0,console.log("existe uno igual"));$scope.contacto.username=!1===b?angular.lowercase($scope.contacto.firstName+"."+$scope.contacto.lastName).split(" ").join(""):angular.lowercase($scope.contacto.firstName+"."+$scope.contacto.lastName+Math.floor(6*Math.random()+1)).split(" ").join("")},function(error){})},$scope.assignSwitchValue=function(item){"active"===item.status?($scope.switch[item._id]=!1,$scope.cambiarEstado(item,"disabled")):($scope.switch[item._id]=!0,$scope.cambiarEstado(item,"active"))},$scope.showConfirm=function(ev,item,n){var confirm=$mdDialog.confirm();switch(n){case 1:confirm.title("Activar Usuario").content("¿Está seguro que desea activar este usuario?").ariaLabel("Lucky day").ok("Activar").cancel("Cancelar").targetEvent(ev),$mdDialog.show(confirm).then(function(){$scope.cambiarEstado(item,"active")},function(){console.log("cancelaste activar")});break;case 2:confirm.title("Desactivar Usuario").content("¿Está seguro que desea desactivar este usuario?").ariaLabel("Lucky day").ok("Desactivar").cancel("Cancelar").targetEvent(ev),$mdDialog.show(confirm).then(function(){$scope.cambiarEstado(item,"disabled")},function(){console.log("cancelaste desactivar")});break;case 3:confirm.title("Eliminar Usuario").content("¿Está seguro que desea eliminar este usuario?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev),$mdDialog.show(confirm).then(function(){$scope.cambiarEstado(item,"deleted")},function(){console.log("cancelaste desactivar")})}},$scope.cambiarEstado=function(user,status){var id=user._id;user.username;ChangeStatusUserById.query({userId:id,estado:status},function(){}),user.status=status,"active"===user.status?$scope.switch[user._id]=!0:$scope.switch[user._id]=!1},$scope.searchText=null,$scope.searchTextChange=function(text){angular.lowercase(text);$scope.contactosDisponiblesFilter=$filter("filter")($scope.contactosDisponibles,{displayName:text})},$scope.showAdvancedContact=function(ev){function FormContactCtr($scope,$mdDialog,Contacts){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.create=function(){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),contact=new Contacts({firstName:$scope.firstName,lastName:$scope.lastName,email:$scope.email,address:$scope.address,city:$scope.city,region:$scope.region?$scope.region:void 0,country:$scope.country,phone:$scope.phone,loc:[latitud,longitud],web:$scope.web,postalCode:$scope.postalCode,status:"active",enterprise:$scope.enterprise?$scope.enterprise._id:$parent.SEARCH.enterprise});contact.$save(function(response){response._id&&(contact._id=response._id,$rootScope.contacts.unshift(contact)),$scope.firstName="",$scope.lastName="",$scope.email="",$scope.address="",$scope.city="",$scope.region="",$scope.country="",$scope.phone="",$scope.fax="",$scope.web="",$scope.postalCode=""},function(errorResponse){$scope.error=errorResponse.data.message})}}FormContactCtr.$inject=["$scope","$mdDialog","Contacts"],$scope.searchText=void 0,$mdDialog.show({controller:FormContactCtr,templateUrl:"/modules/personas/views/create-contact-modal.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."}),$scope.types="['address']",$scope.placeChanged=function(){console.log("the place is now: ",this.getPlace())}};var characterMap={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ấ":"A","Ắ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Æ":"AE","Ầ":"A","Ằ":"A","Ȃ":"A","Ç":"C","Ḉ":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ế":"E","Ḗ":"E","Ề":"E","Ḕ":"E","Ḝ":"E","Ȇ":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ḯ":"I","Ȋ":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ố":"O","Ṍ":"O","Ṓ":"O","Ȏ":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ấ":"a","ắ":"a","ẳ":"a","ẵ":"a","ặ":"a","æ":"ae","ầ":"a","ằ":"a","ȃ":"a","ç":"c","ḉ":"c","è":"e","é":"e","ê":"e","ë":"e","ế":"e","ḗ":"e","ề":"e","ḕ":"e","ḝ":"e","ȇ":"e","ì":"i","í":"i","î":"i","ï":"i","ḯ":"i","ȋ":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ố":"o","ṍ":"o","ṓ":"o","ȏ":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","C̆":"C","c̆":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","Ǵ":"G","ĝ":"g","ǵ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ḫ":"H","ḫ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ḱ":"K","ḱ":"k","K̆":"K","k̆":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"l","ł":"l","Ḿ":"M","ḿ":"m","M̆":"M","m̆":"m","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","N̆":"N","n̆":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","P̆":"P","p̆":"p","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","R̆":"R","r̆":"r","Ȓ":"R","ȓ":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","Ș":"S","ș":"s","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","ț":"t","Ț":"T","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","T̆":"T","t̆":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ȗ":"U","ȗ":"u","V̆":"V","v̆":"v","Ŵ":"W","ŵ":"w","Ẃ":"W","ẃ":"w","X̆":"X","x̆":"x","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Y̆":"Y","y̆":"y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ứ":"U","ứ":"u","Ṹ":"U","ṹ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o","Þ":"TH","þ":"th","Ṕ":"P","ṕ":"p","Ṥ":"S","ṥ":"s","X́":"X","x́":"x","Ѓ":"Г","ѓ":"г","Ќ":"К","ќ":"к","A̋":"A","a̋":"a","E̋":"E","e̋":"e","I̋":"I","i̋":"i","Ǹ":"N","ǹ":"n","Ồ":"O","ồ":"o","Ṑ":"O","ṑ":"o","Ừ":"U","ừ":"u","Ẁ":"W","ẁ":"w","Ỳ":"Y","ỳ":"y","Ȁ":"A","ȁ":"a","Ȅ":"E","ȅ":"e","Ȉ":"I","ȉ":"i","Ȍ":"O","ȍ":"o","Ȑ":"R","ȑ":"r","Ȕ":"U","ȕ":"u","B̌":"B","b̌":"b","Č̣":"C","č̣":"c","Ê̌":"E","ê̌":"e","F̌":"F","f̌":"f","Ǧ":"G","ǧ":"g","Ȟ":"H","ȟ":"h","J̌":"J","ǰ":"j","Ǩ":"K","ǩ":"k","M̌":"M","m̌":"m","P̌":"P","p̌":"p","Q̌":"Q","q̌":"q","Ř̩":"R","ř̩":"r","Ṧ":"S","ṧ":"s","V̌":"V","v̌":"v","W̌":"W","w̌":"w","X̌":"X","x̌":"x","Y̌":"Y","y̌":"y","A̧":"A","a̧":"a","B̧":"B","b̧":"b","Ḑ":"D","ḑ":"d","Ȩ":"E","ȩ":"e","Ɛ̧":"E","ɛ̧":"e","Ḩ":"H","ḩ":"h","I̧":"I","i̧":"i","Ɨ̧":"I","ɨ̧":"i","M̧":"M","m̧":"m","O̧":"O","o̧":"o","Q̧":"Q","q̧":"q","U̧":"U","u̧":"u","X̧":"X","x̧":"x","Z̧":"Z","z̧":"z"," ":""},chars=Object.keys(characterMap).join("|"),allAccents=new RegExp(chars,"g"),removeAccents=(new RegExp(chars,""),function(string){return string.replace(allAccents,function(match){return characterMap[match]})})}]),angular.module("personas").controller("PersonasListController",["$scope","Enterprises","Authentication","Users","$timeout","ChangeStatusUserById","$mdDialog","$http","$state",function($scope,Enterprises,Authentication,Users,$timeout,ChangeStatusUserById,$mdDialog,$http,$state){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){Authentication.user&&$timeout(function(){$scope.findUsers(null)},0)}),$scope.findEnterprises=function(){Enterprises.query({},function(res){$scope.enterprises=res||[]})},$scope.findUsers=function(enterprise){"groso"===Authentication.user.roles[0]?Users.query({e:enterprise},function(res){$scope.users=res}):Authentication.user.enterprise.enterprise?Users.query({e:Authentication.user.enterprise.enterprise},function(res){$scope.users=res}):$scope.users=[]},$scope.assignSwitchValue=function(item){"active"===item.status?$scope.cambiarEstado(item,"active"):$scope.cambiarEstado(item,"disabled")},$scope.cambiarEstado=function(user,status,callback){user._id,user.username;ChangeStatusUserById.query({userId:user._id,estado:status},function(){callback&&callback()})},$scope.remove=function(event,item){console.log(item);var confirm=$mdDialog.confirm();confirm.title("Eliminar Usuario").content("¿Está seguro que desea eliminar este usuario?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(event),$mdDialog.show(confirm).then(function(){$scope.cambiarEstado(item,"deleted",function(){item.puesto&&(item.oldPuesto=item.puesto),item.puesto=void 0,item.deleted=!0,$http.put("/api/users",item).success(function(){$state.reload()}).error(function(err){console.log(err)}),$scope.findUsers($scope.selectedEnterprice||null)})})},$scope.selectedNewEnterprice=function(){$scope.selectedEnterprice&&$scope.selectedEnterprice._id&&$scope.findUsers($scope.selectedEnterprice._id)},$scope.users=[],$scope.enterprises=[]}]),angular.module("personas").factory("Personas",["$resource",function($resource){return $resource("api/personas/:personaId",{personaId:"@_id"},{update:{method:"PUT"}})}]),angular.module("posts").config(["$stateProvider",function($stateProvider){$stateProvider.state("posts",{abstract:!0,url:"/posts",template:"<ui-view/>"}).state("posts.list",{url:"",templateUrl:"modules/posts/views/list-posts.client.view.html"}).state("posts.create",{url:"/create",templateUrl:"modules/posts/views/create-post.client.view.html"}).state("posts.view",{url:"/:postId",templateUrl:"modules/posts/views/view-post.client.view.html"}).state("posts.edit",{url:"/:postId/edit",templateUrl:"modules/posts/views/edit-post.client.view.html"})}]),angular.module("posts").controller("PostsController",["$scope","$stateParams","$location","Authentication","Posts",function($scope,$stateParams,$location,Authentication,Posts){$scope.authentication=Authentication,$scope.create=function(){new Posts({name:this.name}).$save(function(response){$location.path("posts/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(post){if(post)for(var i in post.$remove(),$scope.posts)$scope.posts[i]===post&&$scope.posts.splice(i,1);else $scope.post.$remove(function(){$location.path("posts")})},$scope.update=function(){var post=$scope.post;post.$update(function(){$location.path("posts/"+post._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.posts=Posts.query()},$scope.findOne=function(){$scope.post=Posts.get({postId:$stateParams.postId})}}]),angular.module("posts").factory("Posts",["$resource",function($resource){return $resource("api/posts/:postId",{postId:"@_id"},{update:{method:"PUT"}})}]),angular.module("procedimientos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Procedimientos",state:"procedimientos",type:"dropdown"}),Menus.addSubMenuItem("topbar","procedimientos",{title:"List Procedimientos",state:"procedimientos.list"}),Menus.addSubMenuItem("topbar","procedimientos",{title:"Create Procedimiento",state:"procedimiento.create"})}]),angular.module("procedimientos").config(["$stateProvider",function($stateProvider){$stateProvider.state("procedimientos",{abstract:!0,url:"/procedimientos",template:"<ui-view/>"}).state("procedimientos.list",{url:"",templateUrl:"modules/procedimientos/views/list-procedimientos.client.view.html"}).state("procedimientos.create",{url:"/create",templateUrl:"modules/procedimientos/views/create-procedimiento.client.view.html"}).state("procedimientos.view",{url:"/:procedimientoId",templateUrl:"modules/procedimientos/views/view-procedimiento.client.view.html"}).state("procedimientos.edit",{url:"/:procedimientoId/edit",templateUrl:"modules/procedimientos/views/edit-procedimiento.client.view.html"})}]),angular.module("procedimientos").controller("ProcedimientosController",["$scope","$rootScope","$stateParams","$location","Authentication","Procedimientos","Procesos","$mdBottomSheet","Enterprises","Subs","$mdDialog","Puestos",function($scope,$rootScope,$stateParams,$location,Authentication,Procedimientos,Procesos,$mdBottomSheet,Enterprises,Subs,$mdDialog,Puestos){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findAll()}),$scope.nombreProcesoFiltro=void 0,$scope.backButton=function(){history.back()},$scope.create=function(){var procedimiento=new Procedimientos({name:this.name,description:this.description,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});procedimiento.$save(function(response){response._id&&(procedimiento._id=response._id,$rootScope.procedimientos.unshift(procedimiento)),$scope.name="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Procedimiento").content("¿Está seguro que desea eliminar este procedimiento?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(procedimiento){if(console.log(procedimiento,"procedimiento"),procedimiento)for(var i in procedimiento.$remove(),$scope.procedimientos)$scope.procedimientos[i]===procedimiento&&$scope.procedimientos.splice(i,1);else $scope.procedimientos.$remove(function(){$location.path("procedimientos")})},$scope.eliminar=function(procedimiento,proceso){for(var i in $scope.procesos)if($scope.procesos[i].name===proceso)for(var j in $scope.procesos[i].procedimientos)if($scope.procesos[i].procedimientos[j].procedimiento.name===procedimiento.name){proceso=$scope.procesos[i];$scope.procesos[i].procedimientos.splice(j,1)}console.log(proceso,"proceso"),void 0!==this.enterprise?proceso.enterprise=this.enterprise._id:proceso.enterprise=proceso.enterprise._id,void 0!==this.sub?proceso.sub=this.sub._id:void 0!==proceso.sub&&null!==proceso.sub&&(proceso.sub=proceso.sub._id),proceso.$update(function(){$location.path("procedimientos")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.update=function(){var procedimiento=$scope.procedimiento;void 0!==this.enterprise?procedimiento.enterprise=this.enterprise._id:procedimiento.enterprise=procedimiento.enterprise._id,void 0!==this.puesto?procedimiento.puesto=this.puesto._id:void 0!==procedimiento.puesto&&null!==procedimiento.puesto&&(procedimiento.puesto=procedimiento.puesto._id),procedimiento.$update(function(){history.back()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.filtrarProcesos=function(proceso){$scope.nombreProcesoFiltro=proceso.name,$scope.procedimientosFiltro=proceso.procedimientos},$scope.eliminarFiltro=function(){$scope.nombreProcesoFiltro=void 0},$scope.findAll=function(){$scope.find(),$scope.findProcesos()},$scope.find=function(){$scope.nombreProcesoFiltro=void 0,void 0!==$scope.SEARCH&&($rootScope.procedimientos=Procedimientos.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findPuestos=function(){void 0!==$scope.SEARCH&&($scope.puestos=Puestos.query({e:$scope.SEARCH.enterprise}))},$scope.findProcesos=function(){void 0!==$scope.SEARCH&&($scope.procesos=Procesos.query({e:$scope.SEARCH.enterprise}))},$scope.findOne=function(){$scope.procedimiento=Procedimientos.get({procedimientoId:$stateParams.procedimientoId})}}]),angular.module("procedimientos").factory("Procedimientos",["$resource",function($resource){return $resource("api/procedimientos/:procedimientoId",{procedimientoId:"@_id"},{update:{method:"PUT"}})}]),angular.module("procesos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Procesos",state:"procesos",type:"dropdown"}),Menus.addSubMenuItem("topbar","procesos",{title:"List Procesos",state:"procesos.list"}),Menus.addSubMenuItem("topbar","procesos",{title:"Create Proceso",state:"procesos.create"})}]),angular.module("procesos").config(["$stateProvider",function($stateProvider){$stateProvider.state("procesos",{abstract:!0,url:"/procesos",template:"<ui-view/>"}).state("procesos.list",{url:"",templateUrl:"modules/procesos/views/list-procesos.client.view.html"}).state("procesos.create",{url:"/create",templateUrl:"modules/procesos/views/create-proceso.client.view.html"}).state("procesos.view",{url:"/:procesoId",templateUrl:"modules/procesos/views/view-proceso.client.view.html"}).state("procesos.edit",{url:"/:procesoId/edit",templateUrl:"modules/procesos/views/edit-proceso.client.view.html"})}]),angular.module("procesos").controller("ProcesosCreateController",["user","proceso","enterprises","$state","procesos","procedimientos","Procedimientos","Categories","$scope","categories",function(user,proceso,enterprises,$state,procesos,procedimientos,Procedimientos,Categories,$scope,categories){this.user=user,this.proceso=proceso,this.enterprises=enterprises,this.procedimientos=procedimientos,this.seleccionHabilitada=!1,this.agregarHabilitada=!1,$scope.procedimientosAgregados=[],$scope.procedimientosVista=[],$scope.categoryType=null,this.create=function(){if(void 0!==this.name){var proceso=new procesos({name:this.name,procedimientos:$scope.procedimientosAgregados,category:$scope.categoryType,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id});proceso.$save(function(response){response._id&&(proceso._id=response._id,$scope.procedimientosAgregados=[]),$state.go("home.procesos"),$scope.name=""},function(errorResponse){this.error=errorResponse.data.message})}else this.errorName="Debe indicar el nombre del proceso"},this.habilitoSeleccion=function(){this.seleccionHabilitada=!0},this.habilitoAgregar=function(){this.agregarHabilitada=!0},this.deshabilitoSeleccion=function(){!0===this.seleccionHabilitada&&(this.seleccionHabilitada=!1);!0===this.agregarHabilitada&&(this.agregarHabilitada=!1)},this.exists=function(item,list){return list.indexOf(item._id)>-1},this.toggle=function(item,list){var p={procedimiento:{},orden:void 0},idx=list.indexOf(item._id);if(idx>-1){list.splice(idx,1);for(var i=0;i<$scope.procedimientosAgregados.length;i++)$scope.procedimientosAgregados[i].procedimiento===item&&$scope.procedimientosAgregados.splice($scope.procedimientosAgregados[i].procedimiento,1)}else list.push(item._id),p.procedimiento=item,p.orden=$scope.procedimientosAgregados.length+1,$scope.procedimientosAgregados.push(p),$scope.errorProc=void 0},this.createProcedimiento=function(){var procedimiento=new Procedimientos({name:this.nameProcedimiento,description:this.descriptionProcedimiento,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id});this.nameProcedimiento="",this.nameProcedimiento=void 0,this.descriptionProcedimiento="",this.descriptionProcedimiento=void 0;var p={procedimiento:{},orden:void 0};p.procedimiento=procedimiento,p.orden=$scope.procedimientosAgregados.length+1,procedimiento.$save(function(response){response._id&&(procedimiento._id=response._id,$scope.procedimientosAgregados.push(p),$scope.procedimientosVista.push(p),void 0!==$scope.procedimientos&&$scope.procedimientos.unshift(procedimiento))},function(errorResponse){this.error=errorResponse.data.message}),console.log($scope.procedimientosAgregados,"procedimientosAgregados"),this.agregarHabilitada=!1},$scope.findCategoryTypes=function(){$scope.categoryTypes=categories}}]),angular.module("procesos").controller("ProcesosEditController",["user","proceso","enterprises","$location","procedimientos","procesos","$mdDialog","$scope","Procedimientos","categories",function(user,proceso,enterprises,$location,procedimientos,procesos,$mdDialog,$scope,Procedimientos,categories){this.user=user,this.proceso=proceso,this.enterprises=enterprises,this.procedimientos=procedimientos,this.procesos=procesos;var procedimientosEdit=[],errorDuplicado=void 0,duplicado=!1;function update(procedimientos){var proceso2=proceso;proceso2.procedimientos=procedimientos,proceso2.enterprise=proceso2.enterprise._id,proceso2.$update(function(){},function(errorResponse){this.error=errorResponse.data.message})}this.removeProcedimiento=function(item){for(var i in procedimientosEdit=this.proceso.procedimientos)procedimientosEdit[i]===item&&procedimientosEdit.splice(i,1);update(procedimientosEdit)},this.addProcedimiento=function(item){procedimientosEdit=this.proceso.procedimientos;var max=1;for(var i in procedimientosEdit)console.log(procedimientosEdit[i].orden),procedimientosEdit[i].orden>=max&&(max=procedimientosEdit[i].orden);var p={procedimiento:{},orden:void 0},ok=!1;for(var i in this.proceso.procedimientos)this.proceso.procedimientos[i].procedimiento._id===item._id&&(ok=!0);!1===ok&&(p.procedimiento=item,max>=procedimientosEdit.length?p.orden=max+1:p.orden=procedimientosEdit.length+1,procedimientosEdit.push(p),update(procedimientosEdit))},this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title(item.procedimiento.name).content(item.procedimiento.description).ariaLabel("Lucky day").ok("Editar").cancel("Cerrar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$location.path("procedimientos/"+item.procedimiento._id+"/edit")},function(){})},this.habilitaReorden=function(){this.reorden=!0},this.guardaReorden=function(proceso){!1===duplicado?(this.reorden=!1,void 0!==this.enterprise?proceso.enterprise=this.enterprise._id:proceso.enterprise=proceso.enterprise._id,errorDuplicado=void 0,proceso.$update(function(){console.log("bien hecho")},function(errorResponse){this.error=errorResponse.data.message})):errorDuplicado="No se pueden asignar dos numeros de orden iguales"},this.controlarDuplicado=function(orden,item){this.numeroError=void 0,duplicado=!1;for(var i=0;i<this.proceso.procedimientos.length;i++)if(this.proceso.procedimientos[i].orden===orden){if(this.proceso.procedimientos[i]!==item)return duplicado=!0,this.numeroError=orden,0;errorDuplicado=void 0,this.numeroError=void 0,duplicado=!1}},this.habilitoSeleccion=function(){this.seleccionHabilitada=!0},this.habilitoAgregar=function(){this.agregarHabilitada=!0},this.deshabilitoSeleccion=function(){!0===this.seleccionHabilitada&&(this.seleccionHabilitada=!1);!0===this.agregarHabilitada&&(this.agregarHabilitada=!1)},this.createProcedimiento=function(){procedimientosEdit=this.proceso.procedimientos;var max=1;for(var i in procedimientosEdit)console.log(procedimientosEdit[i].orden),procedimientosEdit[i].orden>=max&&(max=procedimientosEdit[i].orden);var procedimiento=new Procedimientos({name:this.nameProcedimiento,description:this.descriptionProcedimiento,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id});this.nameProcedimiento="",this.nameProcedimiento=void 0,this.descriptionProcedimiento="",this.descriptionProcedimiento=void 0,void 0!==this.enterprise?proceso.enterprise=this.enterprise._id:proceso.enterprise=proceso.enterprise._id;procedimiento.$save(function(response){if(response._id){procedimiento._id=response._id;var p={procedimiento:{},orden:void 0};p.procedimiento=procedimiento,max>=procedimientosEdit.length?p.orden=max+1:p.orden=procedimientosEdit.length+1,procedimientosEdit.push(p);var proceso2=proceso;proceso2.procedimientos=procedimientosEdit,proceso2.$update(function(){},function(errorResponse){this.error=errorResponse.data.message}),void 0!==procedimientos&&procedimientos.unshift(procedimiento)}},function(errorResponse){this.error=errorResponse.data.message}),this.agregarHabilitada=!1},this.habilitarActualizar=function(){this.actualizo=!0},this.habilitarActualizarCategoria=function(category){this.actualizoCategoria=!(proceso.category&&category.id===proceso.category.id)},this.updateName=function(nombre){if(void 0!==nombre){var proceso2=proceso;proceso2.name=nombre,proceso2.enterprise=proceso2.enterprise._id,this.actualizo=!1,proceso2.$update(function(){},function(errorResponse){this.error=errorResponse.data.message})}},this.updateCategory=function(category){if(void 0!==category){var proceso2=proceso;proceso2.category=category._id,proceso2.enterprise=proceso2.enterprise._id,this.actualizoCategoria=!1,proceso2.$update(function(){},function(errorResponse){this.error=errorResponse.data.message})}},this.backButton=function(){history.back()},this.reorden=!1,this.duplicado=duplicado,this.actualizo=!1,this.actualizoCategoria=!1,this.errorDuplicado=errorDuplicado,this.seleccionHabilitada=!1,this.agregarHabilitada=!1,$scope.categoryTypes=[],$scope.categoryTypes=categories}]),angular.module("procesos").controller("ProcesosListController",["$location","user","procesos","enterprises","$mdDialog","categories",function($location,user,procesos,enterprises,$mdDialog,categories){function remove(proceso){if(proceso)for(var i in proceso.$remove(),procesos)procesos[i]===proceso&&procesos.splice(i,1);else proceso.$remove(function(){$location.path("procesos")})}this.user=user,this.procesos=procesos,this.enterprises=enterprises,this.categories=categories,console.log(procesos),this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Proceso").content("¿Está seguro que desea eliminar este proceso?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){remove(item)},function(){console.log("cancelaste borrar")})},this.remove=remove}]),angular.module("procesos").controller("ProcesosController",["$scope","$rootScope","$stateParams","$location","Authentication","Procesos","$mdBottomSheet","Enterprises","Subs","$mdDialog","Areas","Procedimientos","lodash","$http","$state",function($scope,$rootScope,$stateParams,$location,Authentication,Procesos,$mdBottomSheet,Enterprises,Subs,$mdDialog,Areas,Procedimientos,lodash,$http,$state){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findAll(),$scope.findProcedimientos()});$scope.seleccionHabilitada=!1,$scope.agregarHabilitada=!1,$rootScope.procedimientosEdit=[],$scope.habilitoSeleccion=function(){$scope.seleccionHabilitada=!0},$scope.habilitoAgregar=function(){$scope.agregarHabilitada=!0},$scope.deshabilitoSeleccion=function(){!0===$scope.seleccionHabilitada&&($scope.seleccionHabilitada=!1),!0===$scope.agregarHabilitada&&($scope.agregarHabilitada=!1)},$scope.create=function(){if(void 0!==this.name){var proceso=new Procesos({name:this.name,procedimientos:$rootScope.procedimientosAgregados,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});proceso.$save(function(response){response._id&&(proceso._id=response._id,$rootScope.procesos.unshift(proceso),$rootScope.procedimientosAgregados=[]),$state.go("home.procesos"),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorName="Debe indicar el nombre del proceso"},$scope.createProcedimiento=function(){var procedimiento=new Procedimientos({name:this.nameProcedimiento,description:this.descriptionProcedimiento,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});procedimiento.$save(function(response){response._id&&(procedimiento._id=response._id,$rootScope.procedimientosAgregados.push(procedimiento._id),$scope.procedimientosVista.push(procedimiento),console.log($rootScope.procedimientosAgregados),void 0!==$rootScope.procedimientos&&$rootScope.procedimientos.unshift(procedimiento)),$scope.nameProcedimiento="",$scope.descriptionProcedimiento=""},function(errorResponse){$scope.error=errorResponse.data.message,console.log($scope.error,"error")}),$scope.agregarHabilitada=!1},$scope.borrarErrores=function(){$scope.errorProc=void 0,$scope.errorName=void 0},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Proceso").content("¿Está seguro que desea eliminar este proceso?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(proceso){if(proceso)for(var i in proceso.$remove(),$scope.procesos)$scope.procesos[i]===proceso&&$scope.procesos.splice(i,1);else $scope.proceso.$remove(function(){$location.path("procesos")})},$scope.update=function(){var proceso=$scope.proceso;if(0!==$rootScope.procedimientosEdit.length){for(var i in $rootScope.procedimientosEdit){var id=$rootScope.procedimientosEdit[i]._id;$rootScope.procedimientosAgregados.push(id)}proceso.procedimientos=$rootScope.procedimientosAgregados}void 0!==this.enterprise?proceso.enterprise=this.enterprise._id:proceso.enterprise=proceso.enterprise._id,proceso.$update(function(){$location.path("procesos")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.procedimientosVista=[],$rootScope.procedimientosAgregados=[],$scope.selected=[],$scope.toggle=function(item,list){var idx2=$rootScope.procedimientosAgregados.indexOf(item._id),idx=list.indexOf(item._id);idx>-1?(list.splice(idx,1),$rootScope.procedimientosAgregados.splice(idx2,1),$scope.procedimientosVista.splice(idx2,1)):(list.push(item._id),$rootScope.procedimientosAgregados.push(item._id),$scope.procedimientosVista.push(item),$scope.errorProc=void 0)},$scope.exists=function(item,list){return list.indexOf(item._id)>-1},$scope.findAll=function(){$scope.find()},$scope.addProcedimiento=function(item){console.log(item,"item");var ok=!1;for(var i in $scope.proceso.procedimientos)$scope.proceso.procedimientos[i]._id===item._id&&(ok=!0);console.log(ok,"ok"),!1===ok&&($rootScope.procedimientosEdit=this.proceso.procedimientos,$rootScope.procedimientosEdit.push(item))},$scope.removeProcedimiento=function(item){for(var i in $rootScope.procedimientosEdit=this.proceso.procedimientos,$rootScope.procedimientosEdit)$rootScope.procedimientosEdit[i]===item&&$rootScope.procedimientosEdit.splice(i,1)},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.procesos=Procesos.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findAreas=function(){void 0!==$scope.SEARCH&&($scope.areas=Areas.query({e:$scope.SEARCH.enterprise}))},$scope.findProcedimientos=function(){void 0!==$scope.SEARCH&&($scope.procedimientos=Procedimientos.query({e:$scope.SEARCH.enterprise}))},$scope.findOne=function(){$scope.proceso=Procesos.get({procesoId:$stateParams.procesoId})}}]),angular.module("procesos").controller("ProcesosViewController",["user","proceso",function(user,proceso){this.user=user,this.proceso=proceso}]),angular.module("procesos").factory("Procesos",["$resource",function($resource){return $resource("api/procesos/:procesoId",{procesoId:"@_id"},{update:{method:"PUT"}})}]),angular.module("products").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Products",state:"products",type:"dropdown"}),Menus.addSubMenuItem("topbar","products",{title:"List Products",state:"products.list"}),Menus.addSubMenuItem("topbar","products",{title:"Create Product",state:"products.create"})}]),angular.module("products").config(["$stateProvider",function($stateProvider){$stateProvider.state("products",{abstract:!0,url:"/products",template:"<ui-view/>"}).state("products.list",{url:"",templateUrl:"modules/products/views/list-products.client.view.html"}).state("products.create",{url:"/create",templateUrl:"modules/products/views/create-product.client.view.html"}).state("products.view",{url:"/:productId",templateUrl:"modules/products/views/view-product.client.view.html"}).state("products.edit",{url:"/:productId/edit",templateUrl:"modules/products/views/edit-product.client.view.html"})}]),angular.module("products").controller("ProductosCreateController",["$rootScope","$scope","user","product","enterprises","$state","$timeout","products","categories","clienteCategories","providers","costCenters","tipoProducto","$filter","productos",function($rootScope,$scope,user,product,enterprises,$state,$timeout,products,categories,clienteCategories,providers,costCenters,tipoProducto,$filter,productos){$rootScope.tipoProducto=tipoProducto,this.user=user,this.product=product,this.enterprises=enterprises,this.products=products,this.productos=productos,this.categories=categories,this.clienteCategories=clienteCategories,this.providers=providers,this.tipoProducto=tipoProducto,this.metrics=[],this.taxes=[],this.selectedMode="md-scale",this.selectedDirection="left",this.proveedor=void 0;var idProveedor=0,providername="",esProducto=!1,esInsumo=!1,esMateriaPrima=!1,category1=0;function asignarTipos(){if("p"==tipoProducto)for(var i in esProducto=!0,categories)"Productos Terminados"==categories[i].name&&(category1=categories[i]._id);else if("m"==tipoProducto)for(var i in esMateriaPrima=!0,categories)"Materia Prima"==categories[i].name&&(category1=categories[i]._id);else for(var i in esInsumo=!0,categories)"Insumo"==categories[i].name&&(category1=categories[i]._id);return category1}function calculoTotal(productos){for(var i in $scope.costoTotal=0,productos)$scope.costoTotal=$scope.costoTotal+productos[i].total}this.seleccionHabilitada=!1,this.providerUnits=[],this.habilitarCheck=[],this.cantidad=[],this.selected=[],this.hayCantidad=[],this.productosAgregados=[],this.errorProducto=void 0,$scope.costoTotal=0,this.editicon="add",this.editname="crear",this.edititem=void 0,this.deleteprovider=function(item){for(var index=0;index<this.providerUnits.length;index++)this.providerUnits[index].id==item.id&&(console.log(index),this.providerUnits.splice(index,1))},this.createprovider=function(){if(!providername&&"edit"!=this.editicon)return void alert("El nombre del proveedor no está incluido");for(var index=0;index<this.providerUnits.length;index++)if(this.providerUnits[index].id==idProveedor){if("edit"==this.editicon&&index==this.edititem)continue;return void alert("El proveedor ya existe.")}if(!this.costPerUnitProvider)return void alert("El precio no puede ser cero.");if(!this.providertax)return void alert("Debes indicar impuesto.");"edit"==this.editicon?(void 0!=providername&&(this.providerUnits[this.edititem].id=idProveedor,this.providerUnits[this.edititem].name=providername),this.providerUnits[this.edititem].price=this.costPerUnitProvider,this.providerUnits[this.edititem].tax=this.providertax):this.providerUnits.push({name:providername,id:idProveedor,price:this.costPerUnitProvider,tax:this.providertax}),console.log(this.providerUnits);this.editicon="add",this.editname="clear",this.edititem=void 0},this.create=function(){var cat1=asignarTipos(),precio=void 0;1==this.reseller?precio=void 0!==this.unitPrice2?this.unitPrice2:void 0:void 0!==this.unitPrice?precio=this.unitPrice:"m"!=tipoProducto&&"i"!=tipoProducto||(precio=0);if(console.log(this.metric),void 0!==this.name)if(void 0!==this.metric)if(0!==this.providerUnits.length||"p"==this.tipoProducto){for(var newCatPrice=[],i=0;i<$scope.catPrice.length;i++)""!==$scope.catPrice[i].price&&void 0!==$scope.catPrice[i].price&&newCatPrice.push($scope.catPrice[i]);var product=new products({name:this.name,description:this.description?this.description:void 0,code:this.code?this.code:0,produccion:this.productosAgregados,brandName:this.brandName?this.brandName:void 0,unitPrice:precio,catPrice:newCatPrice,provider:this.providerUnits,stocks:$scope.stocks,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric,reseller:this.reseller,esProducto:esProducto,esMateriaPrima:esMateriaPrima,esInsumo:esInsumo,enterprise:this.enterprise?this.enterprise._id:user.enterprise._id,category1:cat1,category2:this.category2?this.category2._id:void 0});!0===this.reseller&&(product.esProducto=!0),product.$save(function(response){response._id&&($state.go("home.products",$rootScope.estadoActualParams),esProducto=!1,esInsumo=!1,esMateriaPrima=!1)},function(errorResponse){this.error=errorResponse.data.message})}else this.errorProducto="Se debe especificar el proveedor del producto";else this.errorProducto="Se debe especificar el iva para el producto";else this.errorProducto="Se debe especificar la unidad de medida"},this.findTaxes=function(){this.taxes=[{value:1,name:"Iva incluido en el precio"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}]},this.findMetrics=function(){this.metrics=["Bultos","Cajas","Cajones","Cm3","Grs","Horas","Kg","Latas","Litros","Ml","Mts2","U."]},this.findCategoriesCliente=function(){$timeout(function(){$scope.catPrice=[];for(var i=0;i<clienteCategories.length;i++)if(!clienteCategories[i].deleted){var p={category:clienteCategories[i]._id,catName:clienteCategories[i].name,price:void 0};$scope.catPrice.push(p)}},2e3)},this.initCostCenters=function(){$timeout(function(){for(var undeletedCostCenters=$filter("filter")(costCenters,{deleted:!1}),i=0;i<undeletedCostCenters.length;i++){var p={costCenter:undeletedCostCenters[i]._id,costCenterName:undeletedCostCenters[i].name,unitsInStock:0,idealStock:0,criticalStock:0};$scope.stocks.push(p)}console.log($scope.stocks)},2e3)},this.searchTextChange=function(text){angular.lowercase(text);return $filter("filter")(providers,{name:text})},this.selectedItemChange=function(item){this.proveedor=item,$rootScope.provider=item,function(item){null!==item&&void 0!==item?(idProveedor=item._id,providername=item.name):idProveedor=0}(item),this.errorProducto=void 0},this.asignarTax=function(){for(var i in this.errorProducto=void 0,this.taxes)this.taxes[i].name===this.tax&&this.taxes[i].value},this.asignarTipos=asignarTipos,this.habilitoSeleccion=function(){this.seleccionHabilitada=!0},this.habilitoCheck=function(i,p,cant){this.habilitarCheck[i]=!0},this.toggle=function(item,list,cant,index){var p={producto:void 0,nombre:void 0,cantidad:void 0,total:void 0},idx=list.indexOf(item);if(idx>-1)for(var j in list.splice(idx,1),this.productosAgregados)this.productosAgregados[j].producto===item._id&&(this.productosAgregados.splice(j,1),this.cantidad[index]=0,this.hayCantidad[index]=!1,calculoTotal(this.productosAgregados));else list.push(item),p.producto=item._id,p.nombre=item.name,p.cantidad=cant,p.total=cant*item.costPerUnit,this.productosAgregados.push(p),this.hayCantidad[index]=!0,calculoTotal(this.productosAgregados)},this.rutaVolver=function(){$state.go("home.products",$rootScope.estadoActualParams)},this.editprovider=function(index){this.editicon="edit",this.editname="Editar",this.edititem=index,providername=void 0,idProveedor=void 0,this.costPerUnitProvider=this.providerUnits[index].price,this.providertax=this.providerUnits[index].tax},this.canceledit=function(){this.editicon="add",this.editname="crear",this.edititem=void 0,idProveedor=null,providername=null,this.costPerUnitProvider=0,this.providertax=""},$scope.catPrice=[],$scope.stocks=[]}]),angular.module("products").controller("ProductosEditController",["$rootScope","$scope","$location","$timeout","user","product","tipoProducto","$filter","productos","categories","clienteCategories","costCenters","enterprises","providers","$state",function($rootScope,$scope,$location,$timeout,user,product,tipoProducto,$filter,productos,categories,clienteCategories,costCenters,enterprises,providers,$state){function asignarTipos(){void 0!==$rootScope.estadoActualParams&&("p"==tipoProducto?$rootScope.estadoActualParams.tipo="p":"m"==tipoProducto?$rootScope.estadoActualParams.tipo="m":"i"==tipoProducto&&($rootScope.estadoActualParams.tipo="i"))}function verTax(){1==product.tax?$scope.vistaTax="Iva Incluido":$scope.vistaTax=product.tax}function findProducto(id){for(var i in productos)if(productos[i]._id==id)return productos[i].costPerUnit}function getStockByCostCenter(costCenterId){if(null!==product.stocks)for(var i=0;i<product.stocks.length;i++)if(costCenterId==product.stocks[i].costCenter)return product.stocks[i];return null}$rootScope.tipoProducto=tipoProducto,this.user=user,this.product=product,this.tipoProducto=tipoProducto,this.productos=productos,this.categories=categories,this.clienteCategories=clienteCategories,this.enterprises=enterprises,this.providers=providers,this.editicon="add",this.editname="crear",this.providertax,this.productprovider=void 0,this.costPerUnitProvider=void 0,$scope.modificar=!1,$scope.verListado=!1,$scope.errorRepetido=[],$scope.errorProducto=!1,$scope.stocks=[],$scope.cambioProveedor=!1,this.selectedMode="md-scale",this.selectedDirection="left",this.update=function(product2,prov){var product=product2;1==product.esMateriaPrima&&0==product.reseller&&(product.esProducto=!1);1==this.reseller2&&(product.reseller=!0,product.esProducto=!0);if(1==product.esProducto&&0==product.reseller&&product.produccion.length>0){var costo=0;for(var i in product.produccion)costo+=product.produccion[i].total;product.costPerUnit=costo;for(var i=0;i<product.produccion.length;i++)product.produccion[i].producto=product.produccion[i].producto._id}product.esProducto?$rootScope.estadoActualParams.tipo="p":product.esMateriaPrima?$rootScope.estadoActualParams.tipo="m":product.esInsumo&&($rootScope.estadoActualParams.tipo="i");product.enterprise=product.enterprise._id;for(var newCatPrice=[],i=0;i<product.catPrice.length;i++)""!==product.catPrice[i].price&&void 0!==product.catPrice[i].price&&newCatPrice.push(product.catPrice[i]);product.catPrice=newCatPrice,product.stocks=$scope.stocks,console.log(product),product.$update(function(data){product.esProducto?($rootScope.estadoActualParams.tipo="p",history.back()):product.esMateriaPrima?($rootScope.estadoActualParams.tipo="m",history.back()):product.esInsumo&&($rootScope.estadoActualParams.tipo="i",history.back()),product.esMateriaPrima&&function(){for(var i in productos)if(1==productos[i].esProducto&&0==productos[i].reseller&&0==productos[i].deleted&&productos[i].produccion.length>0){var product=productos[i];product.enterprise=product.enterprise._id,product.provider=product.provider._id,product.$update(function(data){console.log("update referencia ok")},function(errorResponse){this.error=errorResponse.data.message})}}()},function(errorResponse){console.log(errorResponse,"error")})},this.findTaxes=function(){this.taxes=[{value:1,name:"Iva incluido en el precio"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}]},this.findMetrics=function(){this.metrics=["Bultos","Cajas","Cajones","Cm3","Grs","Horas","Kg","Latas","Litros","Ml","Mts2","U."]},this.findCategoriesCliente=function(){$timeout(function(){for(var omittedCategory=clienteCategories.filter(function(category){for(var i=0;i<product.catPrice.length;i++)if(category._id==product.catPrice[i].category)return!1;return!0}),i=0;i<omittedCategory.length;i++)if(!omittedCategory[i].deleted){var p={category:omittedCategory[i]._id,catName:omittedCategory[i].name,price:void 0};product.catPrice.push(p)}},2e3)},this.initCostCenters=function(){$timeout(function(){for(var undeletedCostCenters=$filter("filter")(costCenters,{deleted:!1}),i=0;i<undeletedCostCenters.length;i++){var stockItem=getStockByCostCenter(undeletedCostCenters[i]._id),p={costCenter:undeletedCostCenters[i]._id,costCenterName:undeletedCostCenters[i].name,unitsInStock:0,idealStock:0,criticalStock:0};null!=stockItem&&(p={costCenter:undeletedCostCenters[i]._id,costCenterName:undeletedCostCenters[i].name,unitsInStock:stockItem.unitsInStock,idealStock:stockItem.idealStock,criticalStock:stockItem.criticalStock}),$scope.stocks.push(p)}},2e3)},this.verTax=verTax,this.asignarTipos=asignarTipos,this.habilitarEdicion=function(){$scope.modificar=!0},this.habilitoLista=function(){$scope.verListado=!0},this.modificoProducto=function(id,cant){var costo=findProducto(id);for(var i in product.produccion)product.produccion[i].producto._id==id&&(product.produccion[i].total=costo*cant)},this.eliminar=function(id,cant){var costo=findProducto(id);for(var i in product.produccion)product.produccion[i].producto._id===id&&(product.produccion.splice(i,1),product.costPerUnit=product.costPerUnit-costo*cant)},this.addMateriaPrima=function(item,cant,$index){var p={producto:void 0,nombre:void 0,cantidad:void 0,total:void 0},ok=!1;for(var i in product.produccion)void 0!==product.produccion[i].producto&&null!==product.produccion[i].producto&&product.produccion[i].producto._id===item._id&&(ok=!0,$scope.errorRepetido[$index]="Materia Prima existente");!1===ok&&(p.producto=item,p.nombre=item.name,p.cantidad=cant,p.total=cant*item.costPerUnit,product.produccion.push(p),product.costPerUnit=product.costPerUnit+p.total)},this.borrarError=function(){$scope.errorProducto=void 0},this.rutaVolver=function(){history.back()},this.createprovider=function(){if(this.productprovider){for(var index=0;index<this.product.provider.length;index++)if(index!=this.edititem&&this.productprovider==this.product.provider[index].id)return void alert("El proveedor ya existe.");for(var name="",index=0;index<this.providers.length;index++)this.providers[index]._id==this.productprovider&&(name=this.providers[index].name);if("check"==this.editicon){this.product.provider[this.edititem].name=name,this.product.provider[this.edititem].id=this.productprovider,this.product.provider[this.edititem].price=this.costPerUnitProvider,this.product.provider[this.edititem].tax=this.providertax}else this.product.provider.push({id:this.productprovider,name:name,price:this.costPerUnitProvider,tax:this.providertax})}this.edititem=void 0,this.editicon="add",this.editname="crear"},this.deleteprovider=function(index){this.edititem=void 0,this.editicon="add",this.editname="crear",this.product.provider.splice(index,1)},this.editprovider=function(index){this.edititem=index,this.editicon="check",this.editname="editar",this.productprovider=this.product.provider[index].id,this.costPerUnitProvider=this.product.provider[index].price,this.providertax=this.product.provider[index].tax},this.canceledit=function(index){this.edititem=void 0,this.editicon="add",this.editname="crear"},this.cambiarProveedor=function(){$scope.cambioProveedor=!0},verTax(),asignarTipos(),console.log(product),providers.$promise.then(function(res){for(var index=0;index<product.provider.length;index++)if(!product.provider[index].id){var provider_array={},id="";for(var index_provider in product.provider[index])isNaN(index_provider)||(id+=product.provider[index][index_provider]);for(var index_providers in console.log(product.provider[index]),provider_array.id=id,res)if(id==res[index_providers]._id){provider_array.name=res[index_providers].name;break}provider_array.price=product.costPerUnit,provider_array.tax=product.tax,product.provider[index]=provider_array}})}]),angular.module("products").controller("ProductsListController",["$location","$rootScope","$http","user","products","clienteCategories","enterprises","$mdDialog","tipoProducto","$mdBottomSheet",function($location,$rootScope,$http,user,products,clienteCategories,enterprises,$mdDialog,tipoProducto,$mdBottomSheet){function DialogController($scope,$mdDialog,item,$state){$scope.item=item,$scope.goto=function(state,params){params.tipo=this.tipoProducto,void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Producto").content("¿Está seguro que desea eliminar este producto?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(product){product?product.$remove():product.$remove(function(){}),$mdBottomSheet.hide()}}DialogController.$inject=["$scope","$mdDialog","item","$state"],this.user=user,this.products=products,this.enterprises=enterprises,this.tipoProducto=tipoProducto,this.daFilter=void 0,$rootScope.tipoProducto=tipoProducto,this.totalCosto=0,this.filtrar=function(){"m"==this.tipoProducto?this.daFilter={esMateriaPrima:!0}:"p"==this.tipoProducto?this.daFilter={esProducto:!0}:this.daFilter={esInsumo:!0}},this.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({templateUrl:"/modules/core/views/menu-opciones.client.view.html",controller:DialogController,targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})},this.initTotalCostos=function(){for(var i=0;i<clienteCategories.length;i++)clienteCategories[i].totalCosto=0,clienteCategories[i].cant=0},this.costoVariable=function(products){products.$promise.then(angular.bind(this,function(data){this.totalCosto=0;var cant=0,total=0;if("p"==tipoProducto){for(var i in this.initTotalCostos(),data)if(0==data[i].deleted&&1==data[i].esProducto)for(var j in data[i].catPrice)for(var k=0;k<clienteCategories.length;k++)data[i].catPrice[j].category==clienteCategories[k].category&&data[i].catPrice[j].price>0&&(clienteCategories[k].totalCosto+=data[i].costPerUnit/data[i].catPrice[j].price*100,clienteCategories[k].cant=clienteCategories[k].cant+1);for(var k=0;k<clienteCategories.length;k++)clienteCategories[k].cant>0&&(clienteCategories[k].totalCosto=parseFloat(clienteCategories[k].totalCosto)/5,clienteCategories[k].totalCosto=Math.round(100*clienteCategories[k].totalCosto)/100)}else if("m"==tipoProducto){for(var i in data)if(0==data[i].deleted&&1==data[i].esMateriaPrima&&data[i].unitPrice>0){cant+=1;var unidad=data[i].costPerUnit/data[i].unitPrice*100;total+=unidad}}else if("i"==tipoProducto)for(var i in data)if(0==data[i].deleted&&1==data[i].esInsumo&&data[i].unitPrice>0){cant+=1;var unidad=data[i].costPerUnit/data[i].unitPrice*100;total+=unidad}0==cant?total=0:total/=cant,this.totalCosto=Math.round(100*total)/100}))},this.rutaProducto=function(id){$location.path("productos/view/"+id)},this.extraerListado=function(){var a=(theUrl="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css",xmlHttp=null,(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText),b=document.getElementById("printing-css-listado").value,c=document.getElementById("printing-data-listado").innerHTML;var theUrl,xmlHttp;window.frames.print_frame_listado.document.title="IM - Productos",window.frames.print_frame_listado.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_listado.window.focus(),window.frames.print_frame_listado.window.print()},this.clienteCategories=clienteCategories,this.priceByCategory=function(item,categoryId){for(var i=0;i<item.catPrice.length;i++)if(item.catPrice[i].category==categoryId)return item.catPrice[i].price;return 0},this.priceMixedByCategory=function(item,categoryId){var price=this.priceByCategory(item,categoryId),costPerUnit=0;0!=price&&(costPerUnit=item.costPerUnit/parseFloat(price)*100);return"$"+parseFloat(price).toFixed(2)+" - "+costPerUnit.toFixed(2)+"%"},this.filtrar(),this.costoVariable(products)}]),angular.module("products").controller("ProductsController",["$scope","$rootScope","$stateParams","$location","Authentication","Products","Enterprises","Subs","Categories","Providers","$mdBottomSheet","Metrics","$state","$mdDialog","$filter","Contacts","Taxconditions","Modal","Comprobantes","$timeout","$interval",function($scope,$rootScope,$stateParams,$location,Authentication,Products,Enterprises,Subs,Categories,Providers,$mdBottomSheet,Metrics,$state,$mdDialog,$filter,Contacts,Taxconditions,Modal,Comprobantes,$timeout,$interval){function calcularActualizacion(product){product.enterprise=product.enterprise._id,product.category1=product.category1._id,product.category2=product.category2._id,product.provider=product.provider._id,product.$update(function(){product.esMateriaPrima&&actualizarReferencias(product),$scope.waiting=!0,$state.go("home.products",$rootScope.estadoActualParams)},function(errorResponse){this.error=errorResponse.data.message})}function actualizarCosto(){var valor=0;for(var i in $scope.product.produccion)valor+=$scope.product.produccion[i].total;return $scope.product.costPerUnit=valor,valor}function actualizarReferencias(p){for(var i in $rootScope.products)if(void 0!==$rootScope.products[i].produccion&&$rootScope.products[i].produccion.length>0){for(var j in $rootScope.products[i].produccion)void 0!==$rootScope.products[i].produccion[j].producto&&$rootScope.products[i].produccion[j].producto==p._id&&($rootScope.products[i].produccion[j].producto=p._id,$rootScope.products[i].produccion[j].name=p.name,$rootScope.products[i].produccion[j].total=p.costPerUnit);var nuevoTotal=0;for(var x in $rootScope.products[i].produccion)nuevoTotal+=$rootScope.products[i].produccion[x].total*$rootScope.products[i].produccion[x].cantidad;$rootScope.products[i].costPerUnit=nuevoTotal,$scope.product=$rootScope.products[i],$scope.update()}}function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Producto").content("¿Está seguro que desea eliminar este producto?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(product){if(product)for(var i in product.$remove(),$scope.$parent.products)$scope.$parent.products[i]===product&&$scope.$parent.products.splice(i,1);else $scope.product.$remove(function(){});$mdBottomSheet.hide()}}function CrearController($scope,$mdDialog,Modal,Providers){$scope.clicked=!1,$scope.contacts=Modal.getContactos(),$scope.categories=Modal.getCategorias(),$scope.comprobantes=Modal.getComprobantes(),$scope.taxconditions=Modal.getCondiciones(),$scope.proveedores=Modal.getProveedores(),$scope.condicionPagos=["Efectivo","Cheque","Transferencia"],$scope.taxconditions2=["Consumidor Final","Responsable Inscripto"],$scope.banco={name:void 0,account:void 0,cbu:void 0,identity:void 0},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.postalCode="1900",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function($event){void 0!==$event&&0==$event.keyCode&&$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.crearProveedor=function($event){if(0==$event.keyCode){var empresa=Modal.getEmpresa();if(void 0!==this.name)if(void 0!==this.address){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng();if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.comprobante){var provider=new Providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,comprobante:this.comprobante?this.comprobante._id:void 0,banco:this.banco,taxCondition:this.taxcondition?this.taxcondition._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter,paymentMethod:this.paymentMethod,contacts:this.contact?this.contact._id:void 0,country:this.country,city:this.city,region:this.region?this.region:void 0,postalCode:this.postalCode,address:this.address,phone:this.phone?this.phone:void 0,loc:[latitud,longitud],web:this.web?this.web:void 0,enterprise:empresa,category1:this.category1?this.category1._id:void 0});provider.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoProveedor=provider},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Indicar el tipo de comprobante";else $scope.errorCondicion="Indicar condicion de pago";else $scope.errorTax="Indicar la condicion de iva"}else $scope.errorDir="Indicar la direccion";else $scope.errorNameProv="Indicar la razón social"}},$scope.borrarError=function(){$scope.errorNameProv=void 0,$scope.errorDir=void 0,$scope.errorCategory=void 0,$scope.errorTax=void 0,$scope.errorCondicion=void 0,$scope.errorComprobante=void 0}}CrearController.$inject=["$scope","$mdDialog","Modal","Providers"],DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findProveedores(),$scope.findComprobantes()}),$scope.$watchCollection("product",function(){void 0!==$scope.product&&($rootScope.tipoCategoria=$scope.product.category1.name)}),$scope.seleccionHabilitada=!1,$rootScope.tipoProducto=$stateParams.tipo,$scope.selected=[],$scope.productosAgregados=[],$scope.productosGuardar=[],$scope.habilitarCheck=[],$scope.hayCantidad=[],$scope.errorRepetido=[],$scope.valorMateriaPrima=[],$scope.costoTotal=0,$scope.modificar=!1,$scope.verListado=!1,$scope.selectedMode="md-scale",$scope.selectedDirection="up",$scope.$watchCollection("tipoProducto",function(){"p"===$scope.tipoProducto?($scope.daFilter={esProducto:!0},$scope.title="Nuevo Producto",$scope.esProducto=!0,$scope.esMateriaPrima=!1,$scope.esInsumo=!1,Categories.query({e:$scope.SEARCH.enterprise},function(res){for(var i=0;i<res.length;i++)"Productos Terminados"==res[i].name&&($scope.category=res[i])})):"m"===$scope.tipoProducto?($scope.daFilter={esMateriaPrima:!0},$scope.title="Nueva Materia Prima",$scope.esMateriaPrima=!0,$scope.esProducto=!1,$scope.esInsumo=!1,Categories.query({e:$scope.SEARCH.enterprise},function(res){for(var i=0;i<res.length;i++)"Materia Prima"==res[i].name&&($scope.category=res[i])})):"i"===$scope.tipoProducto&&($scope.daFilter={esInsumo:!0},$scope.title="Nuevo Insumo",$scope.esMateriaPrima=!1,$scope.esProducto=!1,$scope.esInsumo=!0,Categories.query({e:$scope.SEARCH.enterprise},function(res){for(var i=0;i<res.length;i++)"Insumo"==res[i].name&&($scope.category=res[i])}))}),$rootScope.$watchCollection("nuevoProveedor",function(){void 0!==$rootScope.nuevoProveedor?($scope.mostrar=!0,$scope.proveedor=$rootScope.nuevoProveedor,$scope.selectedItemChange($scope.proveedor)):$scope.mostrar=!1}),$scope.filtros=null,$scope.tipoFiltro=null,$scope.loadOptions=function(){$scope.filtros=$scope.filtros||[{id:1,name:"Proveedor"},{id:2,name:"Categoria"}]},$scope.filtrosProd=null,$scope.tipoFiltroProd=null,$scope.loadOptions2=function(){$scope.filtrosProd=$scope.filtrosProd||[{id:1,name:"Productos Terminados"},{id:2,name:"Materias Primas"},{id:3,name:"Insumos"}]},$scope.errorPrecios=void 0,$scope.waiting=!1,$scope.rutaVolver=function(){history.back()},$scope.actualizarPrecios=function(){if(void 0!==$scope.tipoFiltro&&null!==$scope.tipoFiltro)if(void 0!==$scope.tipoFiltroProd&&null!==$scope.tipoFiltroProd)if(void 0!==$scope.descuentoPorcentaje&&null!==$scope.descuentoPorcentaje)if("Proveedor"===$scope.tipoFiltro.name)if(null!==$scope.provider&&void 0!==$scope.provider){for(var i in $scope.productosProv=$filter("filter")($scope.filtrados,function(item){return item.provider._id===$scope.provider._id}),$scope.productosProv){var product=$scope.productosProv[i];if("Materias"==$scope.productosTipo||"Insumos"==$scope.productosTipo){var descuentoValor=$scope.descuentoPorcentaje*product.costPerUnit/100;"Decremento"==$scope.eleccion?product.costPerUnit=product.costPerUnit-descuentoValor:product.costPerUnit=product.costPerUnit+descuentoValor,calcularActualizacion(product)}else if("Productos"==$scope.productosTipo){descuentoValor=$scope.descuentoPorcentaje*product.unitPrice/100;"Decremento"==$scope.eleccion?product.unitPrice=product.unitPrice-descuentoValor:product.unitPrice=product.unitPrice+descuentoValor,calcularActualizacion(product)}}0==$scope.productosProv.length&&($scope.errorPrecios="No existen productos para las opciones indicadas")}else $scope.errorPrecios="Se debe indicar el proveedor ";else if(null!==$scope.category&&void 0!==$scope.category)for(var i in $scope.productosCat=$filter("filter")($scope.filtrados,function(item){return item.category2._id===$scope.category._id}),$scope.productosCat){product=$scope.productosCat[i];if("Materias"==$scope.productosTipo||"Insumos"==$scope.productosTipo){descuentoValor=$scope.descuentoPorcentaje*product.costPerUnit/100;"Decremento"==$scope.eleccion?product.costPerUnit=product.costPerUnit-descuentoValor:product.costPerUnit=product.costPerUnit+descuentoValor,calcularActualizacion(product)}else if("Productos"==$scope.productosTipo){descuentoValor=$scope.descuentoPorcentaje*product.unitPrice/100;"Decremento"==$scope.eleccion?product.unitPrice=product.unitPrice-descuentoValor:product.unitPrice=product.unitPrice+descuentoValor,calcularActualizacion(product)}}else $scope.errorPrecios="Se debe indicar la categoria";else $scope.errorPrecios="Se debe indicar el porcentaje a aumentar";else $scope.errorPrecios="Se deben indicar los tipos de productos a modificar";else $scope.errorPrecios="Se debe indicar el filtro"},$scope.seleccionProveedor=!1,$scope.seleccionCategoria=!1,$scope.seleccionarFiltro=function(){$scope.errorPrecios=void 0,"Proveedor"===$scope.tipoFiltro.name?($scope.seleccionCategoria=!1,$scope.seleccionProveedor=!0):($scope.seleccionProveedor=!1,$scope.seleccionCategoria=!0)},$scope.prodCat=void 0,$scope.filtrarProductos=function(){$scope.category=void 0,$scope.productosTipo=void 0,$scope.errorPrecios=void 0,"Productos Terminados"==$scope.tipoFiltroProd.name?($scope.prodCat="producto",$rootScope.estadoActualParams={tipo:"p"},$scope.productosTipo="Productos",$scope.filtrados=$filter("filter")($rootScope.products,function(item){return!0===item.esProducto})):"Materias Primas"==$scope.tipoFiltroProd.name?($scope.prodCat="Materia Prima",$rootScope.estadoActualParams={tipo:"m"},$scope.productosTipo="Materias",$scope.filtrados=$filter("filter")($rootScope.products,function(item){return!0===item.esMateriaPrima})):"Insumos"==$scope.tipoFiltroProd.name?($scope.prodCat="Insumo",$rootScope.estadoActualParams={tipo:"i"},$scope.productosTipo="Insumos",$scope.filtrados=$filter("filter")($rootScope.products,function(item){return!0===item.esInsumo})):($rootScope.estadoActualParams={tipo:"p"},$scope.productosTipo="Todos",$scope.filtrados=$rootScope.products)},$scope.habilitoSeleccion=function(){$scope.seleccionHabilitada=!0},$scope.asignarPrecio=function(){$scope.unitPrice=this.costPerUnit,$scope.errorCost=void 0,$scope.errorPrice=void 0},$scope.exists=function(item,list){return list.indexOf(item._id)>-1},$scope.toggle=function(item,list,cant,i,n){var p={producto:{},name:void 0,cantidad:void 0,total:void 0},p2={producto:{},cantidad:void 0,total:void 0},idx=list.indexOf(item);if(idx>-1){list.splice(idx,1);for(i=0;i<$scope.productosAgregados.length;i++)$scope.productosAgregados[i].producto._id===item._id&&($scope.hayCantidad[i]=!1,$scope.productosAgregados.splice(i,1),$scope.productosGuardar.splice(i,1))}else if(list.push(item),p.producto=item,p.name=item.name,p.cantidad=cant,p.total=$scope.valorMateriaPrima[i],p2.producto=item._id,p2.name=item.name,p2.cantidad=cant,p2.total=$scope.valorMateriaPrima[i],$scope.productosAgregados.push(p),$scope.productosGuardar.push(p2),$scope.hayCantidad[i]=!0,function(){for(var i in $scope.costoTotal=0,$scope.productosAgregados)$scope.costoTotal=$scope.costoTotal+$scope.productosAgregados[i].total}(),1===n)for(var i in $scope.productosAgregados)$scope.product.produccion.push($scope.productosAgregados[i])},$scope.addCant=function(i,p,cant){var monto=p.costPerUnit*cant;$scope.valorMateriaPrima[i]=monto,$scope.habilitarCheck[i]=!0,$scope.errorRepetido[i]=void 0},$scope.addMateria=function(item,cant,$index){this.product.produccion;var product,p={producto:{},name:void 0,cantidad:void 0,total:void 0},ok=!1;for(var i in this.product.produccion)void 0!==this.product.produccion[i].producto&&this.product.produccion[i].producto._id===item._id&&(ok=!0,$scope.errorRepetido[$index]="Materia Prima existente");!1===ok&&(p.producto=item._id,p.name=item.name,p.cantidad=cant,p.total=cant*item.costPerUnit,$scope.product.produccion.push(p),(product=$scope.product).enterprise=$scope.SEARCH.enterprise,product.costPerUnit=actualizarCosto())},$scope.create=function(){var costo=0,precio=void 0;for(var i in $scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;if(costo=1==$scope.esProducto?$scope.costoTotal:void 0!==this.costPerUnit?this.costPerUnit:void 0,precio=1==this.reseller?void 0!==this.unitPrice2?this.unitPrice2:void 0:void 0!==this.unitPrice?this.unitPrice:void 0,void 0!==this.name)if(void 0!==costo)if(void 0!==precio)if(void 0!==this.tax)if(void 0!==this.category2)if(void 0!==this.provider){var product=new Products({name:this.name,description:this.description?this.description:void 0,code:this.code?this.code:0,produccion:$scope.productosGuardar,brandName:this.brandName?this.brandName:void 0,unitPrice:precio,costPerUnit:costo,discontinued:this.discontinued,provider:this.provider._id,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock?this.unitsInStock:0,idealStock:this.idealStock?this.idealStock:0,criticalStock:this.criticalStock?this.criticalStock:0,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esProducto:$scope.esProducto,esMateriaPrima:$scope.esMateriaPrima,esInsumo:$scope.esInsumo,tax:this.tax?valorTax:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,category1:$scope.category,category2:this.category2?this.category2._id:void 0});!0===this.reseller&&(product.esProducto=!0),product.$save(function(response){response._id&&(product._id=response._id,$rootScope.products.unshift(product)),$state.go("home.products",$rootScope.estadoActualParams),$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorProv="Se debe especificar el proveedor del producto";else $scope.errorCategory="Se debe especificar la categoria para el producto";else $scope.errorTax="Se debe especificar el iva para el producto";else $scope.errorPrice="Se debe especificar un precio para el producto";else $scope.errorCost="Se debe especificar un costo para el producto";else $scope.errorName="Se debe especificar un nombre para el producto"},$scope.borrarError=function(){$scope.errorName=void 0,$scope.errorCost=void 0,$scope.errorPrice=void 0,$scope.errorTax=void 0,$scope.errorSub=void 0,$scope.errorCategory=void 0,$scope.errorPrecio=void 0,$scope.errorPrecios=void 0},$scope.habilitarEdicion=function(){$scope.modificar=!0},$scope.habilitoLista=function(){$scope.verListado=!0},$scope.eliminar=function(p,item){for(var i in p.produccion)p.produccion[i].producto===item.producto?($scope.product.costPerUnit=$scope.product.costPerUnit-item.total,p.produccion.splice(i,1)):p.produccion[i].producto=p.produccion[i].producto._id;$scope.product.produccion=p.produccion},$scope.modificoProducto=function(item){for(var i in item.total=item.cantidad*item.producto.costPerUnit,$scope.product.produccion)$scope.product.produccion[i]==item&&($scope.product.produccion[i].cantidad=item.cantidad,$scope.product.produccion[i].total=item.total,actualizarCosto())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Producto").content("¿Está seguro que desea eliminar este producto?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(product){if(product)for(var i in product.$remove(),$scope.products)$scope.products[i]===product&&$scope.products.splice(i,1);else $scope.product.$remove(function(){$location.path("products")})},$scope.update=function(){$scope.modificar=!1;var product=$scope.product;if(1==this.reseller2){if(void 0===this.unitPrice2||null===this.unitPrice2)return $scope.errorPrecio="Se debe indicar el precio de reventa del producto",0;product.reseller=!0,product.unitPrice=this.unitPrice2,product.esProducto=!0}void 0!==this.enterprise?product.enterprise=this.enterprise:product.enterprise=product.enterprise._id,void 0!==this.sub?product.sub=this.sub:void 0!==product.sub&&null!==product.sub&&(product.sub=product.sub._id),void 0!==this.category1?product.category1=this.category1:void 0!==product.category1&&null!==product.category1&&(product.category1=product.category1._id),void 0!==this.category2?product.category2=this.category2:void 0!==product.category2&&null!==product.category2&&(product.category2=product.category2?product.category2._id:void 0),void 0!==this.provider?product.provider=this.provider:void 0!==product.provider&&null!==product.provider&&(product.provider=product.provider._id),void 0!==this.tax?product.tax=this.tax:void 0!==product.tax&&null!==product.tax&&(product.tax=product.tax),void 0!==this.metric?product.metric=this.metric:void 0!==product.metric&&null!==product.metric&&(product.metric=product.metric),product.$update(function(){product.esInsumo&&($rootScope.estadoActualParams={tipo:"i"}),product.esProducto&&($rootScope.estadoActualParams={tipo:"p"}),product.esMateriaPrima&&(actualizarReferencias(product),$rootScope.estadoActualParams={tipo:"m"}),console.log($rootScope.estadoActualParams,"esatdo actual"),$state.go("home.products",$rootScope.estadoActualParams)},function(errorResponse){})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.products=Products.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&Comprobantes.query({e:$scope.SEARCH.enterprise},function(res){for(var i in $rootScope.comprobantesFiltro=res,$rootScope.comprobantesFiltro)"Pedido"===$rootScope.comprobantesFiltro[i].name&&$rootScope.comprobantesFiltro.splice(i,1);Modal.setComprobantes($rootScope.comprobantesFiltro)})},$scope.findSubcategories=function(){void 0!==$scope.SEARCH&&($scope.subcategories=Categories.query({e:$scope.SEARCH.enterprise}))},$scope.findProviders=function(){void 0!==$scope.SEARCH&&($scope.providers=Providers.query({e:$scope.SEARCH.enterprise}))},$scope.findTaxes=function(){void 0!==$scope.SEARCH&&($scope.taxes=[{value:1,name:"Iva incluido en el precio"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}])},$scope.findMetrics=function(){void 0!==$scope.SEARCH&&($scope.metrics=Metrics.query())},$scope.findOne=function(){Products.get({productId:$stateParams.productId},function(res){$scope.product=res,1==$scope.product.tax?$scope.vistaTax="Iva Incluido":$scope.vistaTax=$scope.product.tax})},$scope.findProveedores=function(){void 0!==$scope.SEARCH&&($scope.proveedores=Providers.query({e:$scope.SEARCH.enterprise}),Modal.setProveedores($scope.proveedores))},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}),Modal.setContactos($scope.contacts))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setCategorias($scope.categories))},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}),Modal.setCondiciones($scope.taxconditions))},$scope.searchTextChange=function(text){angular.lowercase(text);return $filter("filter")($scope.proveedores,{name:text})},$scope.selectedItemChange=function(item){$scope.proveedor=item,$rootScope.provider=item,$scope.descProveedor()},$scope.descProveedor=function(){null!==$scope.proveedor&&void 0!==$scope.proveedor?($scope.idProveedor=$scope.proveedor._id,$scope.errorProv=void 0):$scope.idProveedor=0},$scope.minLenghtProv=0,$scope.showAdvancedProvider=function(ev){$scope.minLenghtProv=1,$scope.textToSearch=void 0,$scope.findContacts(),$scope.findCategories(),$scope.findTaxConditions(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/products/views/create.provider.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLenghtProv=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({templateUrl:"/modules/core/views/menu-opciones.client.view.html",controller:DialogController,targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),angular.module("products").controller("ProductsViewController",["user","product","$mdDialog","$state","$rootScope","$http","providers","Authentication","$timeout",function(user,product,$mdDialog,$state,$rootScope,$http,providers,Authentication,$timeout){this.user=user,this.product=product,this.selectedMode="md-scale",this.selectedDirection="up",this.rutaVolver=function(){history.back()},$timeout((console.log(product),console.log(providers),void providers.$promise.then(function(res){for(var index=0;index<product.provider.length;index++)if(!product.provider[index].id){var provider_array={},id="";for(var index_provider in product.provider[index])isNaN(index_provider)||(id+=product.provider[index][index_provider]);for(var index_providers in console.log(product.provider[index]),provider_array.id=id,res)if(id==res[index_providers]._id){provider_array.name=res[index_providers].name;break}provider_array.price=product.costPerUnit,provider_array.tax=product.tax,product.provider[index]=provider_array}})),4e3)}]),angular.module("products").factory("Metrics",[function(){return{query:function(){return["Bultos","Cajas","Cajones","Cm3","Grs","Horas","Kg","Latas","Litros","Ml","Mts2","U."]}}}]),angular.module("products").factory("Products",["$resource",function($resource){return $resource("api/products/:productId",{productId:"@_id",e:"@enterprise",c:"@categoryOfPrice"},{update:{method:"PUT"}})}]),angular.module("providers").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Providers",state:"providers",type:"dropdown"}),Menus.addSubMenuItem("topbar","providers",{title:"List Providers",state:"providers.list"}),Menus.addSubMenuItem("topbar","providers",{title:"Create Provider",state:"providers.create"})}]),angular.module("providers").config(["$stateProvider",function($stateProvider){$stateProvider.state("providers",{abstract:!0,url:"/providers",template:"<ui-view/>"}).state("providers.list",{url:"",templateUrl:"modules/providers/views/list-providers.client.view.html"}).state("providers.create",{url:"/create",templateUrl:"modules/providers/views/create-provider.client.view.html"}).state("providers.view",{url:"/:providerId",templateUrl:"modules/providers/views/view-provider.client.view.html"}).state("providers.edit",{url:"/:providerId/edit",templateUrl:"modules/providers/views/edit-provider.client.view.html"})}]),angular.module("providers").controller("ProvidersCreateController",["user","provider","providers","enterprises","categories","contacts","taxconditions","condicionPagos","comprobantes","$scope","$state",function(user,provider,providers,enterprises,categories,contacts,taxconditions,condicionPagos,comprobantes,$scope,$state){function borrarError(){$scope.errorName=void 0,$scope.errorDir=void 0,$scope.errorCategory=void 0,$scope.errorTax=void 0,$scope.errorCondicion=void 0,$scope.errorComprobante=void 0}this.user=user,this.provider=provider,this.enterprises=enterprises,this.categories=categories,this.contacts=contacts,this.taxconditions=taxconditions,this.condicionPagos=condicionPagos,this.comprobantes=comprobantes,this.create=function(){if(void 0!==this.name)if(void 0!==this.address)if(void 0!==this.category1)if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.tipoComprobante){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),provider=new providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:void 0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,banco:this.banco?this.banco:void 0,comprobante:this.tipoComprobante?this.tipoComprobante._id:void 0,taxCondition:this.taxcondition?this.taxcondition._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter?this.costCenter:void 0,paymentMethod:this.paymentMethod?this.paymentMethod:void 0,contact:this.contact?this.contact:void 0,address:this.address?this.address:void 0,phone1:this.phone1?this.phone1:0,phone2:this.phone2?this.phone2:0,mail1:this.mail1?this.mail1:0,mail2:this.mail2?this.mail2:0,loc:[latitud,longitud],impuesto1:this.imp1?this.imp1:0,impuesto2:this.imp2?this.imp2:0,impuesto3:this.imp3?this.imp3:0,impuesto4:this.imp4?this.imp4:0,web:this.web?this.web:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,category1:this.category1?this.category1._id:void 0,observaciones:this.observaciones?this.observaciones:void 0});provider.$save(function(response){response._id&&(provider._id=response._id),$state.go("home.providers")},function(errorResponse){console.log(errorResponse,"error"),$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Se debe ingresar un tipo de comprobante";else $scope.errorCondicion="Se debe ingresar la condicion de Pago";else $scope.errorTax="Se debe ingresar la condicion de IVA";else $scope.errorCategory="Se debe ingresar la categoria";else $scope.errorDir="Se debe ingresar la direccion";else $scope.errorName="Se debe ingresar la razon social"},this.borrarError=borrarError,$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){borrarError(),$scope.place=this.getPlace()}}]),angular.module("providers").controller("ProvidersEditController",["user","provider","enterprises","categories","contacts","taxconditions","condicionPagos","comprobantes","$scope","$location","$state",function(user,provider,enterprises,categories,contacts,taxconditions,condicionPagos,comprobantes,$scope,$location,$state){this.user=user,this.provider=provider,this.enterprises=enterprises,this.categories=categories,this.contacts=contacts,this.taxconditions=taxconditions,this.condicionPagos=condicionPagos,this.comprobantes=comprobantes,this.backButton=function(){history.back()},this.update=function(){var provider=this.provider;void 0!==this.enterprise?provider.enterprise=this.enterprise:provider.enterprise=provider.enterprise._id;void 0!==this.taxcondition?provider.taxCondition=this.taxcondition:void 0!==provider.taxCondition&&null!==provider.taxCondition&&(provider.taxCondition=provider.taxCondition._id);void 0!==this.condicionPago?provider.condicionPago=this.condicionPago:void 0!==provider.condicionPago&&null!==provider.condicionPago&&(provider.condicionPago=provider.condicionPago._id);void 0!==this.tipoComprobante?provider.comprobante=this.tipoComprobante:void 0!==provider.comprobante&&null!==provider.comprobante&&(provider.comprobante=provider.comprobante._id);void 0!==this.category1?provider.category1=this.category1:void 0!==provider.category1&&null!==provider.category1&&(provider.category1=provider.category1._id);void 0!==$scope.place?provider.loc=[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()]:void 0!==provider.loc&&null!==provider.loc&&(provider.loc=provider.loc);provider.$update(function(){$state.go("home.providers")},function(errorResponse){this.error=errorResponse.data.message})},this.selectedMode="md-scale",this.selectedDirection="up",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.place=this.getPlace()}}]),angular.module("providers").controller("ProvidersListController",["$rootScope","$location","user","providers","enterprises","$mdBottomSheet","$mdDialog","$state",function($rootScope,$location,user,providers,enterprises,$mdBottomSheet,$mdDialog,$state){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Proveedor").content("¿Está seguro que desea eliminar este proveedor?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){!function(provider){provider?provider.$remove():this.provider.$remove(function(){});$mdBottomSheet.hide()}(item)},function(){console.log("cancelaste borrar")})}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],this.user=user,this.providers=providers,this.enterprises=enterprises,this.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),angular.module("providers").controller("ProvidersController",["$scope","$rootScope","$stateParams","$location","Authentication","Providers","Enterprises","Subs","$mdBottomSheet","Contacts","Taxconditions","Categories","$mdDialog","$state","Comprobantes","Pedidos","Compras","Condicionventas","Products","$timeout","$filter",function($scope,$rootScope,$stateParams,$location,Authentication,Providers,Enterprises,Subs,$mdBottomSheet,Contacts,Taxconditions,Categories,$mdDialog,$state,Comprobantes,Pedidos,Compras,Condicionventas,Products,$timeout,$filter){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Proveedor").content("¿Está seguro que desea eliminar este proveedor?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(provider){if(provider)for(var i in provider.$remove(),$scope.$parent.providers)$scope.$parent.providers[i]===provider&&$scope.$parent.providers.splice(i,1);else $scope.provider.$remove(function(){});$mdBottomSheet.hide()}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findAll()}),$scope.banco={cbu:"0"},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.postalCode="1900",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.create=function(){if(void 0!==this.name)if(void 0!==this.address)if(void 0!==this.category1)if(void 0!==this.taxcondition)if(void 0!==this.condicionPago)if(void 0!==this.tipoComprobante){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),provider=new Providers({name:this.name,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:void 0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,banco:this.banco?this.banco:void 0,comprobante:this.tipoComprobante?this.tipoComprobante._id:void 0,taxCondition:this.taxcondition?this.taxcondition._id:void 0,discountRate:this.discountRate?this.discountRate:0,costCenter:this.costCenter?this.costCenter:void 0,paymentMethod:this.paymentMethod?this.paymentMethod:void 0,contacts:this.contact?[this.contact._id]:[],country:this.country?this.country:void 0,city:this.city?this.city:void 0,region:this.region?this.region:void 0,postalCode:this.postalCode,address:this.address?this.address:void 0,phone:this.phone?this.phone:0,loc:[latitud,longitud],web:this.web?this.web:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,category1:this.category1?this.category1._id:void 0,observaciones:this.observaciones?this.observaciones:void 0});console.log(provider),provider.$save(function(response){response._id&&(provider._id=response._id,$rootScope.providers.unshift(provider)),$state.go("home.providers"),$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web=""},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorComprobante="Se debe ingresar un tipo de comprobante";else $scope.errorCondicion="Se debe ingresar la condicion de Pago";else $scope.errorTax="Se debe ingresar la condicion de IVA";else $scope.errorCategory="Se debe ingresar la categoria";else $scope.errorDir="Se debe ingresar la direccion";else $scope.errorName="Se debe ingresar la razon social"},$scope.borrarError=function(){$scope.errorName=void 0,$scope.errorDir=void 0,$scope.errorCategory=void 0,$scope.errorTax=void 0,$scope.errorCondicion=void 0,$scope.errorComprobante=void 0},$scope.update=function(){var provider=$scope.provider;void 0!==this.enterprise?provider.enterprise=this.enterprise._id:provider.enterprise=provider.enterprise._id,void 0!==this.contact?provider.contacts=[this.contact._id]:void 0!==provider.contacts[0]&&null!==provider.contacts[0]&&(provider.contacts=[provider.contacts[0]._id]),void 0!==this.taxcondition?provider.taxCondition=this.taxcondition._id:void 0!==provider.taxCondition&&null!==provider.taxCondition&&(provider.taxCondition=provider.taxCondition._id),void 0!==this.condicionPago?provider.condicionPago=this.condicionPago._id:void 0!==provider.condicionPago&&null!==provider.condicionPago&&(provider.condicionPago=provider.condicionPago),void 0!==this.tipoComprobante?provider.comprobante=this.tipoComprobante:void 0!==provider.tipoComprobante&&null!==provider.tipoComprobante&&(provider.tipoComprobante=provider.comprobante),void 0!==this.category1?provider.category1=this.category1._id:void 0!==provider.category1&&null!==provider.category1&&(provider.category1=provider.category1._id),void 0!==$scope.place?provider.loc=[$scope.place.geometry.location.lat(),$scope.place.geometry.location.lng()]:void 0!==provider.loc&&null!==provider.loc&&(provider.loc=provider.loc),void 0!==this.city?provider.city=this.city:void 0!==provider.city&&null!==provider.city&&(provider.city=provider.city),provider.$update(function(){$location.path("proveedores")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.providers=Providers.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query({e:$scope.SEARCH.enterprise}))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}))},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}))},$scope.findCondicionPagos=function(){void 0!==$scope.SEARCH&&($scope.condicionPagos=Condicionventas.query({e:$scope.SEARCH.enterprise}))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&($scope.categories=Categories.query({e:$scope.SEARCH.enterprise}))},$scope.findCitys=function(){void 0!==$scope.SEARCH&&($scope.citys=["Berisso","Ensenala","La Plata"])},$scope.findProductos=function(){void 0!==$scope.SEARCH&&($scope.products=Products.query({e:$scope.SEARCH.enterprise}))},$scope.findAll=function(){$scope.findComprobantes(),$scope.findCompras(),$scope.findPedidos(),$scope.findProductos()},$scope.findAllView=function(){$scope.findOne(),$scope.findComprobantes(),$scope.findCompras(),$scope.findPedidos()},$scope.findOne=function(){$scope.provider=Providers.get({providerId:$stateParams.providerId}),$scope.idProvider=$stateParams.providerId},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&($scope.comprobantes=Comprobantes.query({e:$scope.SEARCH.enterprise},function(res){for(var i in $rootScope.comprobantes=res,$rootScope.comprobantesFiltro=res,$rootScope.comprobantes)"Presupuesto"===$rootScope.comprobantes[i].name&&($scope.idPresupuesto=$rootScope.comprobantes[i]._id),"Factura A"===$rootScope.comprobantes[i].name&&($rootScope.idFacturaA=$rootScope.comprobantes[i]._id),"Factura B"===$rootScope.comprobantes[i].name&&($rootScope.idFacturaB=$rootScope.comprobantes[i]._id),"Factura C"===$rootScope.comprobantes[i].name&&($rootScope.idFacturaC=$rootScope.comprobantes[i]._id),"Remito"===$rootScope.comprobantes[i].name&&($rootScope.idRemito=$rootScope.comprobantes[i]._id),"Remito de Devolucion"===$rootScope.comprobantes[i].name&&($rootScope.idRemitoDev=$rootScope.comprobantes[i]._id),"Nota de Credito"===$rootScope.comprobantes[i].name&&($rootScope.idNotaC=$rootScope.comprobantes[i]._id),"Nota de Debito"===$rootScope.comprobantes[i].name&&($rootScope.idNotaD=$rootScope.comprobantes[i]._id),"Orden de Pago"===$rootScope.comprobantes[i].name&&($rootScope.idOrden=$rootScope.comprobantes[i]._id);for(var i in $rootScope.comprobantesFiltro)"Pedido"===$rootScope.comprobantesFiltro[i].name&&$rootScope.comprobantesFiltro.splice(i,1)}))},$scope.comprasA=[],$scope.comprasB=[],$scope.comprasC=[],$scope.findCompras=function(){void 0!==$scope.SEARCH&&($scope.compras=Compras.query({e:$scope.SEARCH.enterprise})),$timeout(function(){for(var i in $scope.filtro=$filter("filter")($scope.compras,function(item){return"Pendiente de pago y recepcion"===item.estado||"Pendiente de pago2"===item.estado}),$scope.deudaProveedor=0,$scope.filtro)$scope.filtro[i].proveedor._id===$scope.idProvider&&($scope.deudaProveedor=$scope.deudaProveedor+$scope.filtro[i].total);return $scope.filtro},1e3)},$scope.findPedidos=function(){void 0!==$scope.SEARCH&&($scope.pedidos=Pedidos.query({e:$scope.SEARCH.enterprise}))},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){console.log("por aqui ando")})}}]),angular.module("providers").controller("ProvidersViewController",["user","provider","products","pedidos","compras","$scope","$rootScope","Comprobantes","$location",function(user,provider,products,pedidos,compras,$scope,$rootScope,Comprobantes,$location){this.user=user,this.provider=provider,this.products=products,this.pedidos=pedidos,this.compras=compras,this.deudaProveedor=function(compras){compras.$promise.then(angular.bind(this,function(data){for(var i in this.total=0,data)void 0!==data[i].proveedor&&null!==data[i].proveedor&&data[i].proveedor._id===provider._id&&("Pendiente de pago y recepcion"!==data[i].estado&&"Pendiente de pago2"!==data[i].estado||(this.total=this.total+data[i].total))}))},this.rutaProducto=function(id){$location.path("productos/view/"+id)},this.deudaProveedor(compras),this.selectedMode="md-scale",this.selectedDirection="up"}]),angular.module("providers").factory("Providers",["$resource",function($resource){return $resource("api/providers/:providerId",{providerId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("puestos").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Puestos",state:"puestos",type:"dropdown"}),Menus.addSubMenuItem("topbar","puestos",{title:"List Puestos",state:"puestos.list"}),Menus.addSubMenuItem("topbar","puestos",{title:"Create Puesto",state:"puestos.create"})}]),angular.module("puestos").config(["$stateProvider",function($stateProvider){$stateProvider.state("puestos",{abstract:!0,url:"/puestos",template:"<ui-view/>"}).state("puestos.list",{url:"",templateUrl:"modules/puestos/views/list-puestos.client.view.html"}).state("puestos.create",{url:"/create",templateUrl:"modules/puestos/views/create-puesto.client.view.html"}).state("puestos.view",{url:"/:puestoId",templateUrl:"modules/puestos/views/view-puesto.client.view.html"}).state("puestos.edit",{url:"/:puestoId/edit",templateUrl:"modules/puestos/views/edit-puesto.client.view.html"})}]),angular.module("puestos",["dndLists"]).controller("PuestosController",["$scope","$rootScope","$stateParams","$location","Authentication","Puestos","Enterprises","Areas","Procesos","$state","Users","Personas","$mdDialog","$mdBottomSheet","$timeout","Procedimientos","Subs","$http","Costcenters","$filter",function($scope,$rootScope,$stateParams,$location,Authentication,Puestos,Enterprises,Areas,Procesos,$state,Users,Personas,$mdDialog,$mdBottomSheet,$timeout,Procedimientos,Subs,$http,Costcenters,$filter){DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.models=[],$scope.personal=$stateParams.personal,$scope.centrodecostoId=$stateParams.centroDeCosto,$scope.showProcedimientos=!0,$scope.showInteractores=!0;for(var i=1;i<=3;++i)$scope.models.push({label:"Item A"+i});function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Puesto").content("¿Está seguro que desea eliminar este puesto?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(puesto){if(puesto)for(var i in puesto.$remove(),$scope.$parent.puestos)$scope.$parent.puestos[i]===puesto&&$scope.$parent.puestos.splice(i,1);else $scope.puesto.$remove(function(){$location.path("puestos")});$mdBottomSheet.hide()}}$scope.$watchCollection("models",function(model){angular.toJson(model,!0)},!0),$scope.$watchCollection("puesto.procedimientos",function(model){angular.toJson(model,!0)},!0),$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.findAll(),$scope.findAreas(),$scope.findUsers(),$scope.findProcesos(),$scope.findProcedimientos(),$scope.findInteractores()}),$scope.nombreAreaFiltro=void 0,$rootScope.procesosAgregados=[],$rootScope.interactoresAgregados=[],$rootScope.procesosEdit=[],$rootScope.interactoresEdit=[],$scope.horarios=["06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30","00:00"],$scope.openMenu=function($mdOpenMenu,ev){ev,$mdOpenMenu(ev)},$scope.sampleAction=function(name,puesto){switch(name){case"libre":puesto.estado="Libre";break;case"ocupado":puesto.estado="Ocupado";break;case"no":puesto.estado="Sin Especificar"}$scope.updateEstado(puesto)},$scope.updateEstado=function(puesto){void 0!==this.enterprise?puesto.enterprise=this.enterprise._id:void 0!==puesto.enterprise&&null!==puesto.enterprise&&(puesto.enterprise=puesto.enterprise._id),void 0!==this.sub?puesto.sub=this.sub._id:void 0!==puesto.sub&&null!==puesto.sub&&(puesto.sub=puesto.sub._id),puesto.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.filtrarAreas=function(area){$scope.nombreAreaFiltro=area.name},$scope.eliminarFiltro=function(){$scope.nombreAreaFiltro=void 0},$scope.clickSubmit=function(){$scope.clicked=!0,$scope.create()},$scope.submitEdit=function(){this.personal&&this.personal.puesto?confirm("it is already used by another personal are you sure to update so that it will replace for other user")&&($scope.clickedEdit=!0,$scope.update()):($scope.clickedEdit=!0,$scope.update())},$scope.create=function(){if(!0===$scope.clicked)if(void 0!==this.name)if(void 0!==this.area){var puesto=new Puestos({name:this.name,area:this.area,horarioE:this.horarioE?this.horarioE:void 0,horarioS:this.horarioS?this.horarioS:void 0,sueldo:this.sueldo?this.sueldo:void 0,porcentajeVentas:this.porcentajeVentas?this.porcentajeVentas:void 0,parent:this.parent?this.parent:void 0,procedimientos:$rootScope.procesosAgregados,interaccion:$rootScope.interactoresAgregados,responsabilidades:this.responsabilidades?this.responsabilidades:void 0,requerimientos:this.requerimientos?this.requerimientos:void 0,tareas:this.observaciones?this.observaciones:void 0,criterios:this.criterios?this.criterios:void 0,objetivos:this.objetivos?this.objetivos:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,centroDeCosto:this.centroDeCosto.id?this.centroDeCosto.id:void 0});puesto.$save(function(response){response._id&&(puesto._id=response._id,$rootScope.puestos.unshift(puesto)),$state.go("home.puesto"),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorArea="Indicar Area del puesto";else $scope.errorName="Indicar nombre para el puesto"},$scope.borrarMensaje=function(){$scope.errorName=void 0,$scope.errorArea=void 0,$scope.errorSub=void 0},$scope.agregarProceso=function(proceso){var ok=!1;if(void 0!==proceso&&null!==proceso){for(var i in $rootScope.procesosAgregados)$rootScope.procesosAgregados[i]._id===proceso._id&&(ok=!0);ok||($rootScope.procesosAgregados.push(proceso),this.proceso=void 0)}},$scope.agregarProcesoEdit=function(proceso){void 0!==proceso&&($rootScope.procesosEdit=this.puesto.procedimientos,$rootScope.procesosEdit.push(proceso),$scope.proceso=void 0)},$scope.agregarInteractores=function(interactor){var ok=!1;if(void 0!==interactor&&null!==interactor){for(var i in $rootScope.interactoresAgregados)$rootScope.interactoresAgregados[i]._id===interactor._id&&(ok=!0);ok||($rootScope.interactoresAgregados.push(interactor),this.interaccion=void 0)}},$scope.agregarInteractoresEdit=function(i){void 0!==i&&($rootScope.interactoresEdit=this.puesto.interaccion,$rootScope.interactoresEdit.push(i),$scope.interaccion=void 0)},$scope.borrarProceso=function(item){for(var i in $rootScope.procesosAgregados)$rootScope.procesosAgregados[i]===item&&$rootScope.procesosAgregados.splice(i,1)},$scope.borrarProcesoEdit=function(item){for(var i in $rootScope.procesosEdit=this.puesto.procedimientos,$rootScope.procesosEdit)$rootScope.procesosEdit[i]===item&&$rootScope.procesosEdit.splice(i,1)},$scope.borrarInteractor=function(item){for(var i in $rootScope.interactoresAgregados)$rootScope.interactoresAgregados[i]===item&&$rootScope.interactoresAgregados.splice(i,1)},$scope.borrarInteractorEdit=function(item){for(var i in $rootScope.interactoresEdit=this.puesto.interaccion,$rootScope.interactoresEdit)$rootScope.interactoresEdit[i]===item&&$rootScope.interactoresEdit.splice(i,1)},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Puesto").content("¿Está seguro que desea eliminar este puesto?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(puesto){if(puesto)for(var i in puesto.$remove(),$scope.puestos)$scope.puestos[i]===puesto&&$scope.puestos.splice(i,1);else $scope.puesto.$remove(function(){$location.path("puestos")})},$scope.update=function(){if(1==$scope.clickedEdit){var puesto=$scope.puesto;if(puesto.parent=$scope.parent,puesto.horarioE=$scope.horarioE,puesto.horarioS=$scope.horarioS,void 0!==$scope.area?puesto.area=$scope.area._id:void 0!==puesto.area&&(puesto.area=puesto.area._id),0!==$rootScope.interactoresEdit.length){for(var i in $rootScope.interactoresEdit){var id=$rootScope.interactoresEdit[i]._id;$rootScope.interactoresAgregados.push(id)}puesto.interaccion=$rootScope.interactoresAgregados}if(0!==$rootScope.procesosEdit.length){for(var i in $rootScope.procesosEdit){id=$rootScope.procesosEdit[i]._id;$rootScope.procesosAgregados.push(id)}puesto.procesos=$rootScope.procesosAgregados}void 0!==this.enterprise?puesto.enterprise=this.enterprise._id:void 0!==puesto.enterprise&&null!==puesto.enterprise&&(puesto.enterprise=puesto.enterprise._id),void 0!==this.centroDeCosto?puesto.centroDeCosto=this.centroDeCosto.id:void 0!==puesto.centroDeCosto&&null!==puesto.centroDeCosto&&(puesto.centroDeCosto=puesto.centroDeCosto),void 0!==this.personal?puesto.personal=this.personal._id:void 0!==puesto.personal&&null!==puesto.personal&&(puesto.personal=puesto.personal._id),puesto.changeEstado=!0,puesto.$update(function(){puesto.personal?$location.path("puestos/view/"+puesto._id):$state.go("home.puesto")},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.findAll=function(){$scope.find(),$scope.findAreas()},$scope.find=function(){void 0!==$scope.SEARCH&&Puestos.query({e:$scope.SEARCH.enterprise},function(res){$rootScope.puestos=res})},$scope.findOne=function(){Puestos.get({puestoId:$stateParams.puestoId},function(res){$scope.puesto=res,Users.query({e:$scope.SEARCH.enterprise},function(res){$scope.users=res,$scope.users.unshift({_id:"",displayName:"",status:"active"})}),Costcenters.query({e:$scope.SEARCH.enterprise},function(data){$scope.relatedCostCenter=$filter("filter")(data,function(item){return item.id===$scope.puesto.centroDeCosto})[0]})})},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findCentroDeCostos=function(){void 0!==$scope.SEARCH&&($scope.centroDeCostos=Costcenters.query({e:$scope.SEARCH.enterprise}))},$scope.findAreas=function(){void 0!==$scope.SEARCH&&($scope.areas=Areas.query({e:$scope.SEARCH.enterprise}))},$scope.findProcesos=function(){void 0!==$scope.SEARCH&&($scope.procesos=Procesos.query({e:$scope.SEARCH.enterprise}))},$scope.findProcedimientos=function(){void 0!==$scope.SEARCH&&($scope.procedimientos=Procedimientos.query({e:$scope.SEARCH.enterprise}))},$scope.findInteractores=function(){void 0!==$scope.SEARCH&&($scope.interactores=Puestos.query({e:$scope.SEARCH.enterprise}))},$scope.findUsers=function(){void 0!==$scope.SEARCH&&($scope.usuarios=Users.query({e:$scope.SEARCH.enterprise}))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),function(dndLists){var MIME_TYPE="application/x-dnd",EDGE_MIME_TYPE="application/json",MSIE_MIME_TYPE="Text",ALL_EFFECTS=["move","copy","link"];function filterEffects(effects,effectAllowed){return"all"==effectAllowed?effects:effects.filter(function(effect){return-1!=effectAllowed.toLowerCase().indexOf(effect)})}dndLists.directive("dndDraggable",["$parse","$timeout",function($parse,$timeout){return function(scope,element,attr){element.attr("draggable","true"),attr.dndDisableIf&&scope.$watch(attr.dndDisableIf,function(disabled){element.attr("draggable",!disabled)}),element.on("dragstart",function(event){if(event=event.originalEvent||event,"false"==element.attr("draggable"))return!0;dndState.isDragging=!0,dndState.itemType=attr.dndType&&scope.$eval(attr.dndType).toLowerCase(),dndState.dropEffect="none",dndState.effectAllowed=attr.dndEffectAllowed||ALL_EFFECTS[0],event.dataTransfer.effectAllowed=dndState.effectAllowed;var item=scope.$eval(attr.dndDraggable),mimeType=MIME_TYPE+(dndState.itemType?"-"+dndState.itemType:"");try{event.dataTransfer.setData(mimeType,angular.toJson(item))}catch(e){var data=angular.toJson({item:item,type:dndState.itemType});try{event.dataTransfer.setData(EDGE_MIME_TYPE,data)}catch(e){var effectsAllowed=filterEffects(ALL_EFFECTS,dndState.effectAllowed);event.dataTransfer.effectAllowed=effectsAllowed[0],event.dataTransfer.setData(MSIE_MIME_TYPE,data)}}if(element.addClass("dndDragging"),$timeout(function(){element.addClass("dndDraggingSource")},0),event._dndHandle&&event.dataTransfer.setDragImage&&event.dataTransfer.setDragImage(element[0],0,0),$parse(attr.dndDragstart)(scope,{event:event}),attr.dndCallback){var callback=$parse(attr.dndCallback);dndState.callback=function(params){return callback(scope,params||{})}}event.stopPropagation()}),element.on("dragend",function(event){event=event.originalEvent||event,scope.$apply(function(){var dropEffect=dndState.dropEffect;$parse(attr[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[dropEffect]])(scope,{event:event}),$parse(attr.dndDragend)(scope,{event:event,dropEffect:dropEffect})}),dndState.isDragging=!1,dndState.callback=void 0,element.removeClass("dndDragging"),element.removeClass("dndDraggingSource"),event.stopPropagation(),$timeout(function(){element.removeClass("dndDraggingSource")},0)}),element.on("click",function(event){attr.dndSelected&&(event=event.originalEvent||event,scope.$apply(function(){$parse(attr.dndSelected)(scope,{event:event})}),event.stopPropagation())}),element.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),dndLists.directive("dndList",["$parse",function($parse){return function(scope,element,attr){var placeholder=function(){var placeholder;return angular.forEach(element.children(),function(childNode){var child=angular.element(childNode);child.hasClass("dndPlaceholder")&&(placeholder=child)}),placeholder||angular.element("<li class='dndPlaceholder'></li>")}();placeholder.remove();var placeholderNode=placeholder[0],listNode=element[0],listSettings={};function getMimeType(types){if(!types)return MSIE_MIME_TYPE;for(var i=0;i<types.length;i++)if(types[i]==MSIE_MIME_TYPE||types[i]==EDGE_MIME_TYPE||types[i].substr(0,MIME_TYPE.length)==MIME_TYPE)return types[i];return null}function getItemType(mimeType){return dndState.isDragging?dndState.itemType||void 0:mimeType==MSIE_MIME_TYPE||mimeType==EDGE_MIME_TYPE?null:mimeType&&mimeType.substr(MIME_TYPE.length+1)||void 0}function isDropAllowed(itemType){return!listSettings.disabled&&(!(!listSettings.externalSources&&!dndState.isDragging)&&(!listSettings.allowedTypes||null===itemType||itemType&&-1!=listSettings.allowedTypes.indexOf(itemType)))}function getDropEffect(event,ignoreDataTransfer){var effects=ALL_EFFECTS;return ignoreDataTransfer||(effects=filterEffects(effects,event.dataTransfer.effectAllowed)),dndState.isDragging&&(effects=filterEffects(effects,dndState.effectAllowed)),attr.dndEffectAllowed&&(effects=filterEffects(effects,attr.dndEffectAllowed)),effects.length?event.ctrlKey&&-1!=effects.indexOf("copy")?"copy":event.altKey&&-1!=effects.indexOf("link")?"link":effects[0]:"none"}function stopDragover(){return placeholder.remove(),element.removeClass("dndDragover"),!0}function invokeCallback(expression,event,dropEffect,itemType,index,item){return $parse(expression)(scope,{callback:dndState.callback,dropEffect:dropEffect,event:event,external:!dndState.isDragging,index:void 0!==index?index:getPlaceholderIndex(),item:item||void 0,type:itemType})}function getPlaceholderIndex(){return Array.prototype.indexOf.call(listNode.children,placeholderNode)}element.on("dragenter",function(event){event=event.originalEvent||event;var types=attr.dndAllowedTypes&&scope.$eval(attr.dndAllowedTypes);listSettings={allowedTypes:angular.isArray(types)&&types.join("|").toLowerCase().split("|"),disabled:attr.dndDisableIf&&scope.$eval(attr.dndDisableIf),externalSources:attr.dndExternalSources&&scope.$eval(attr.dndExternalSources),horizontal:attr.dndHorizontalList&&scope.$eval(attr.dndHorizontalList)};var mimeType=getMimeType(event.dataTransfer.types);if(!mimeType||!isDropAllowed(getItemType(mimeType)))return!0;event.preventDefault()}),element.on("dragover",function(event){var mimeType=getMimeType((event=event.originalEvent||event).dataTransfer.types),itemType=getItemType(mimeType);if(!mimeType||!isDropAllowed(itemType))return!0;if(placeholderNode.parentNode!=listNode&&element.append(placeholder),event.target!=listNode){for(var listItemNode=event.target;listItemNode.parentNode!=listNode&&listItemNode.parentNode;)listItemNode=listItemNode.parentNode;if(listItemNode.parentNode==listNode&&listItemNode!=placeholderNode){var rect=listItemNode.getBoundingClientRect();if(listSettings.horizontal)var isFirstHalf=event.clientX<rect.left+rect.width/2;else isFirstHalf=event.clientY<rect.top+rect.height/2;listNode.insertBefore(placeholderNode,isFirstHalf?listItemNode:listItemNode.nextSibling)}}var ignoreDataTransfer=mimeType==MSIE_MIME_TYPE,dropEffect=getDropEffect(event,ignoreDataTransfer);return"none"==dropEffect?stopDragover():attr.dndDragover&&!invokeCallback(attr.dndDragover,event,dropEffect,itemType)?stopDragover():(event.preventDefault(),ignoreDataTransfer||(event.dataTransfer.dropEffect=dropEffect),element.addClass("dndDragover"),event.stopPropagation(),!1)}),element.on("drop",function(event){var mimeType=getMimeType((event=event.originalEvent||event).dataTransfer.types),itemType=getItemType(mimeType);if(!mimeType||!isDropAllowed(itemType))return!0;event.preventDefault();try{var data=JSON.parse(event.dataTransfer.getData(mimeType))}catch(e){return stopDragover()}if((mimeType==MSIE_MIME_TYPE||mimeType==EDGE_MIME_TYPE)&&(itemType=data.type||void 0,data=data.item,!isDropAllowed(itemType)))return stopDragover();var ignoreDataTransfer=mimeType==MSIE_MIME_TYPE,dropEffect=getDropEffect(event,ignoreDataTransfer);if("none"==dropEffect)return stopDragover();var index=getPlaceholderIndex();return attr.dndDrop&&!(data=invokeCallback(attr.dndDrop,event,dropEffect,itemType,index,data))?stopDragover():(dndState.dropEffect=dropEffect,ignoreDataTransfer||(event.dataTransfer.dropEffect=dropEffect),!0!==data&&scope.$apply(function(){scope.$eval(attr.dndList).splice(index,0,data)}),invokeCallback(attr.dndInserted,event,dropEffect,itemType,index,data),stopDragover(),event.stopPropagation(),!1)}),element.on("dragleave",function(event){event=event.originalEvent||event;var newTarget=document.elementFromPoint(event.clientX,event.clientY);listNode.contains(newTarget)&&!event._dndPhShown?event._dndPhShown=!0:stopDragover()})}}]),dndLists.directive("dndNodrag",function(){return function(scope,element,attr){element.attr("draggable","true"),element.on("dragstart",function(event){(event=event.originalEvent||event)._dndHandle||(event.dataTransfer.types&&event.dataTransfer.types.length||event.preventDefault(),event.stopPropagation())}),element.on("dragend",function(event){(event=event.originalEvent||event)._dndHandle||event.stopPropagation()})}}),dndLists.directive("dndHandle",function(){return function(scope,element,attr){element.attr("draggable","true"),element.on("dragstart dragend",function(event){(event=event.originalEvent||event)._dndHandle=!0})}});var dndState={}}(angular.module("dndLists",[])),angular.module("puestos").factory("Puestos",["$resource",function($resource){return $resource("api/puestos/:puestoId",{puestoId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("remuneraciones").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Remuneraciones",state:"remuneraciones",type:"dropdown"}),Menus.addSubMenuItem("topbar","remuneraciones",{title:"List Remuneraciones",state:"remuneraciones.list"}),Menus.addSubMenuItem("topbar","remuneraciones",{title:"Create Remuneracione",state:"remuneraciones.create"})}]),angular.module("remuneraciones").config(["$stateProvider",function($stateProvider){$stateProvider.state("remuneraciones",{abstract:!0,url:"/remuneraciones",template:"<ui-view/>"}).state("remuneraciones.list",{url:"",templateUrl:"modules/remuneraciones/views/list-remuneraciones.client.view.html"}).state("remuneraciones.create",{url:"/create",templateUrl:"modules/remuneraciones/views/create-remuneracione.client.view.html"}).state("remuneraciones.view",{url:"/:remuneracioneId",templateUrl:"modules/remuneraciones/views/view-remuneracione.client.view.html"}).state("remuneraciones.edit",{url:"/:remuneracioneId/edit",templateUrl:"modules/remuneraciones/views/edit-remuneracione.client.view.html"})}]),angular.module("remuneraciones").controller("RemuneracioneCreateController",["user","$state","categories","Remuneraciones",function(user,$state,categories,Remuneraciones){var that=this;this.user=user,this.categories=categories,this.units=["U","Hs"],this.errorRemuneracione=void 0,this.selectedMode="md-scale",this.selectedDirection="left",this.create=function(){if(void 0!==that.name)if(void 0!==that.category){var remuneracione=new Remuneraciones({name:that.name,description:that.description,category:that.category._id,enterprise:that.enterprise?that.enterprise._id:user.enterprise._id,unit:that.unit});remuneracione.$save(function(response){response._id&&$state.go("home.remuneraciones")},function(errorResponse){that.error=errorResponse.data.message})}else that.errorRemuneracione="Se debe especificar una categoría para la remuneración";else that.errorRemuneracione="Se debe especificar un nombre para la remuneración"},this.rutaVolver=function(){history.back()}}]),angular.module("remuneraciones").controller("RemuneracioneEditController",["$state","$scope","user","remuneracione","categories",function($state,$scope,user,remuneracione,categories){$scope.remuneracione=remuneracione,$scope.categories=categories,$scope.units=["U","Hs"],$scope.update=function(){var updatedRemuneracione=$scope.remuneracione;void 0!==$scope.category&&(updatedRemuneracione.category=$scope.category._id),void 0!==$scope.unit&&(updatedRemuneracione.unit=$scope.unit),updatedRemuneracione.$update(function(){$state.go("home.remuneraciones")},function(errorResponse){$scope.error=errorResponse.data.message})}}]),angular.module("remuneraciones").controller("RemuneracioneListController",["$state","$scope","$rootScope","$mdDialog","$filter","Authentication","user","Remuneraciones","$mdBottomSheet",function($state,$scope,$rootScope,$mdDialog,$filter,Authentication,user,Remuneraciones,$mdBottomSheet){DialogController.$inject=["$scope","$mdDialog","item","$state"],this.authentication=Authentication,this.user=user,this.extraerListado=function(){var a=(theUrl="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css",xmlHttp=null,(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText),b=document.getElementById("printing-css-listado").value,c=document.getElementById("printing-data-listado").innerHTML;var theUrl,xmlHttp;window.frames.print_frame_listado.document.title="IM - Remuneraciones",window.frames.print_frame_listado.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_listado.window.focus(),window.frames.print_frame_listado.window.print()},this.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({templateUrl:"/modules/core/views/menu-opciones.client.view.html",controller:DialogController,targetEvent:$event,resolve:{item:function(){return item}}})};var enterprise=this.user.enterprise.enterprise,global=this;function DialogController($scope,$mdDialog,item,$state){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar remuneraciones").content("¿Está seguro que desea eliminar este remuneraciones?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(remuneracione){remuneracione.$remove(function(){}),$mdBottomSheet.hide()}}$scope.$watchCollection("authentication",function(){Remuneraciones.query({e:enterprise},function(data){global.remuneraciones=data})})}]),angular.module("remuneraciones").controller("RemuneracioneViewController",["user","remuneracione",function(user,remuneracione){this.user=user,this.remuneracione=remuneracione}]),angular.module("remuneraciones").factory("Remuneraciones",["$resource",function($resource){return $resource("api/remuneraciones/:remuneracioneId",{remuneracioneId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("reportes").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Reportes",state:"reportes",type:"dropdown"}),Menus.addSubMenuItem("topbar","reportes",{title:"List Reportes",state:"reportes.list"}),Menus.addSubMenuItem("topbar","reportes",{title:"Create Reporte",state:"reportes.create"})}]),angular.module("reportes").config(["$stateProvider",function($stateProvider){$stateProvider.state("reportes",{abstract:!0,url:"/reportes",template:"<ui-view/>"}).state("reportes.list",{url:"",templateUrl:"modules/reportes/views/dashboard-reportes.client.view.html"}).state("reportes.create",{url:"/create",templateUrl:"modules/reportes/views/create-reporte.client.view.html"}).state("reportes.view",{url:"/:reporteId",templateUrl:"modules/reportes/views/view-reporte.client.view.html"}).state("reportes.edit",{url:"/:reporteId/edit",templateUrl:"modules/reportes/views/edit-reporte.client.view.html"})}]),angular.module("reportes").controller("ReportesComprasPorMesController",["$scope","$stateParams","$location","Authentication","ReportesCompras","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesCompras,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesCompras.getDataYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"quarter":vm.modelo=void 0,ReportesCompras.getDataQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo1=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"month":ReportesCompras.getDataMonth(vm.monthValue,vm.SEARCH.enterprise).then(function(data){console.log("data in month is: ",data),vm.performanceChartData=data.data.resultado.balanceDia.map(function(item){var p=item.resultado.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return{label:d=d.setDate(w),value:item.balance||0}}),vm.performanceChartData2=data.data.resultado.balanceDia.map(function(item){var p=item.resultado.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return{label:d=d.setDate(w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo2=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesComprasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="month",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)},vm.yearValue="2015",vm.quarterValue="2015-4Q",vm.monthValue="2015-10",vm.chartOptions={chart:{type:"lineChart",objectequality:!0,height:350,duration:500,isArea:!0,x:function(d){return d.label},y:function(d){return d.value},showLabels:!1,showLegend:!1,title:"Compras año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Día",tickFormat:function(d){return d3.time.format("%Y-%m-%d")(new Date(d))}},yAxis:{axisLabel:"Ingresos ($)",tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!1}}}]),angular.module("reportes").controller("ReportesComprasPorQController",["$scope","$stateParams","$location","Authentication","ReportesCompras","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesCompras,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesCompras.getDataYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"quarter":vm.modelo=void 0,ReportesCompras.getDataQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo1=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"month":ReportesCompras.getDataMonth(vm.monthValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){return{label:item.resultado.month,value:item.balance,estado:item.resultado.estado}}),vm.performanceChartData2=data.data.map(function(item){return{label:item.resultado.month,value:-1*item.balance,estado:item.resultado.estado}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,{estado:"Finalizada"}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return"Finalizada"===item.estado&&(item.value=0),item}),"label"),vm.modelo=[{key:"No finalizadas",color:"#d62728",values:vm.filteredData2},{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesComprasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="quarter",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)},vm.yearValue="2016",vm.quarterValue="2016-1Q",vm.monthValue="2016-3",vm.chartOptions={chart:{type:"lineChart",objectequality:!0,height:350,duration:500,isArea:!0,x:function(d){return d.label},y:function(d){return d.value},showLabels:!1,showLegend:!1,title:"Compras año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Semana",tickFormat:function(d){return d3.time.format("%Y-%W")(new Date(d))}},yAxis:{axisLabel:"Ingresos ($)",tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!1}}}]),angular.module("reportes").controller("ReportesComprasController",["$scope","$stateParams","$location","Authentication","ReportesCompras","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesCompras,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesCompras.getDataYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"quarter":vm.modelo=void 0,ReportesCompras.getDataQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){return{label:item.resultado.month,value:item.balance,estado:item.resultado.estado}}),vm.performanceChartData2=data.data.map(function(item){return{label:item.resultado.month,value:-1*item.balance,estado:item.resultado.estado}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,{estado:"Finalizada"}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return"Finalizada"===item.estado&&(item.value=0),item}),"label"),vm.modelo=[{key:"No finalizadas",color:"#d62728",values:vm.filteredData2},{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"month":ReportesCompras.getDataMonth(vm.monthValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){return{label:item.resultado.month,value:item.balance,estado:item.resultado.estado}}),vm.performanceChartData2=data.data.map(function(item){return{label:item.resultado.month,value:-1*item.balance,estado:item.resultado.estado}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,{estado:"Finalizada"}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return"Finalizada"===item.estado&&(item.value=0),item}),"label"),vm.modelo=[{key:"No finalizadas",color:"#d62728",values:vm.filteredData2},{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesComprasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="year",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)},vm.yearValue="2016",vm.quarterValue="2016-1Q",vm.monthValue="2016-3",vm.chartOptions={chart:{type:"lineChart",objectequality:!0,height:350,duration:500,isArea:!0,x:function(d){return d.label},y:function(d){return d.value},showLabels:!1,showLegend:!1,title:"Compras año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Mes",tickFormat:function(d){return d3.time.format("%Y-%m")(new Date(d))}},yAxis:{axisLabel:"Ingresos ($)",tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!1}}}]),angular.module("reportes").controller("ReportesVentasPorMesController",["$scope","$stateParams","$location","Authentication","ReportesVentas","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesVentas,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesVentas.getDataYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"quarter":vm.modelo=void 0,ReportesVentas.getDataQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo1=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"month":ReportesVentas.getDataMonth(vm.monthValue,vm.SEARCH.enterprise).then(function(data){console.log("data in month is: ",data),vm.performanceChartData=data.data.resultado.balanceDia.map(function(item){var p=item.resultado.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return{label:d=d.setDate(w),value:item.balance||0}}),vm.performanceChartData2=data.data.resultado.balanceDia.map(function(item){var p=item.resultado.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return{label:d=d.setDate(w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo2=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesVentasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="month",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)},vm.yearValue="2016",vm.quarterValue="2016-1Q",vm.monthValue="2016-3",vm.chartOptions={chart:{type:"lineChart",objectequality:!0,height:350,duration:500,isArea:!0,x:function(d){return d.label},y:function(d){return d.value},showLabels:!1,showLegend:!1,title:"Ventas año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Día",tickFormat:function(d){return d3.time.format("%Y-%m-%d")(new Date(d))}},yAxis:{axisLabel:"Ingresos ($)",tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!1}}}]),angular.module("reportes").controller("ReportesVentasPorQController",["$scope","$stateParams","$location","Authentication","ReportesVentas","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesVentas,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesVentas.getDataYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"quarter":vm.modelo=void 0,ReportesVentas.getDataQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo1=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"month":ReportesVentas.getDataMonth(vm.monthValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){return{label:item.resultado.month,value:item.balance,estado:item.resultado.estado}}),vm.performanceChartData2=data.data.map(function(item){return{label:item.resultado.month,value:-1*item.balance,estado:item.resultado.estado}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,{estado:"Finalizada"}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return"Finalizada"===item.estado&&(item.value=0),item}),"label"),vm.modelo=[{key:"No finalizadas",color:"#d62728",values:vm.filteredData2},{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesVentasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="quarter",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)},vm.yearValue="2016",vm.quarterValue="2016-1Q",vm.monthValue="2015-3",vm.chartOptions={chart:{type:"lineChart",objectequality:!0,height:350,duration:500,isArea:!0,x:function(d){return d.label},y:function(d){return d.value},showLabels:!1,showLegend:!1,title:"Ventas año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Semana",tickFormat:function(d){return d3.time.format("%Y-%W")(new Date(d))}},yAxis:{axisLabel:"Ingresos ($)",tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!1}}}]),angular.module("reportes").controller("ReportesVentasProductosPorMesController",["$scope","$stateParams","$location","Authentication","ReportesVentas","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesVentas,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesVentas.getDataProductYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.month.split("-"),year=parseInt(p[0]),month=parseInt(p[1]);return{label:new Date(year,month),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")}),console.log("xvcc"),console.log(vm),vm.yearValue||(vm.yearValue=2016),ReportesVentas.getDataCategoriasYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){console.log("=======categoriesd=========="),console.log(data),vm.modelcatyear=data.data});break;case"quarter":vm.modelo=void 0,ReportesVentas.getDataProductQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataProductQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.week.split("-"),year=parseInt(p[0]),w=parseInt(p[1]);return{label:new Date(year,0,1+7*w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo1=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")}),vm.yearValue||(vm.yearValue=2016),ReportesVentas.getDataCategoriasYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){console.log("=======categoriesd=========="),console.log(data),vm.modelcatyear=data.data});break;case"month":ReportesVentas.getDataProductYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){console.log("data in month is: ",data),vm.performanceChartData=data.data.map(function(item){var dvalues=item.values.map(function(dvalue){var p=dvalue.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return d=d.setDate(w),{cantidad:dvalue.cantidad,day:d}});return{key:item.key,values:dvalues||[]}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"key"),vm.modelo2=vm.filteredData1,console.log("esta es la posta: ",vm.modelo2)):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesVentasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="month",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)}(),vm.chartOptions={chart:{type:"lineWithFocusChart",objectequality:!0,height:450,duration:500,isArea:!1,x:function(d){return d.day},y:function(d){return d.cantidad},showLabels:!0,showLegend:!0,useInteractiveGuideline:!0,title:"Ventas año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Día",tickFormat:function(d){return d3.time.format("%Y-%m-%d")(new Date(d))}},x2Axis:{tickFormat:function(d){return d3.time.format("%Y-%m-%d")(new Date(d))}},yAxis:{axisLabel:"Cantidad",tickFormat:function(d){return d3.format(",.2f")(d)}},y2Axis:{tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!0}}}]),angular.module("reportes").controller("ReportesVentasController",["$scope","$stateParams","$location","Authentication","ReportesVentas","Comprobantes","Products","Enterprises","Condicionventas","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Subs","Providers","Reportes","$q",function($scope,$stateParams,$location,Authentication,ReportesVentas,Comprobantes,Products,Enterprises,Condicionventas,Clients,$rootScope,$state,$filter,$http,$timeout,Subs,Providers,Reportes,$q){var vm=this;function loadData(periodo){if(void 0!==vm.SEARCH)switch(periodo){case"year":ReportesVentas.getDataYear(vm.yearValue,vm.SEARCH.enterprise).then(function(data){console.log("algo",data.data),vm.performanceChartData=data.data.map(function(item){var p=item.resultado.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return{label:d=d.setDate(w),value:item.balance||0}}),vm.performanceChartData2=data.data.map(function(item){var p=item.resultado.day.split("-"),year=parseInt(p[0]),w=parseInt(p[1]),d=new Date(year,0);return{label:d=d.setDate(w),value:item.balance||0}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,function(item){return item}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return item}),"label"),vm.modelo=[{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"quarter":vm.modelo=void 0,ReportesVentas.getDataQuarter(vm.quarterValue,vm.SEARCH.enterprise).then(function(data){console.log("[+] getDataQuarter::data: ",data),vm.performanceChartData=data.data.map(function(item){return{label:item.resultado.month,value:item.balance,estado:item.resultado.estado}}),vm.performanceChartData2=data.data.map(function(item){return{label:item.resultado.month,value:-1*item.balance,estado:item.resultado.estado}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,{estado:"Finalizada"}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return"Finalizada"===item.estado&&(item.value=0),item}),"label"),vm.modelo=[{key:"No finalizadas",color:"#d62728",values:vm.filteredData2},{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")});break;case"month":ReportesVentas.getDataMonth(vm.monthValue,vm.SEARCH.enterprise).then(function(data){vm.performanceChartData=data.data.map(function(item){return{label:item.resultado.month,value:item.balance,estado:item.resultado.estado}}),vm.performanceChartData2=data.data.map(function(item){return{label:item.resultado.month,value:-1*item.balance,estado:item.resultado.estado}}),void 0!==vm.performanceChartData?(vm.filteredData1=$filter("orderBy")($filter("filter")(vm.performanceChartData,{estado:"Finalizada"}),"label"),vm.filteredData2=$filter("orderBy")($filter("filter")(vm.performanceChartData2,function(item){return"Finalizada"===item.estado&&(item.value=0),item}),"label"),vm.modelo=[{key:"No finalizadas",color:"#d62728",values:vm.filteredData2},{key:"Finalizadas",color:"#1f77b4",values:vm.filteredData1}]):console.log("[+] la concha de su madre")})}}$scope.authentication=Authentication,console.log("[+] ReportesVentasController::fired!"),$scope.$watchCollection("authentication",function(){vm.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},loadData(vm.performancePeriod)}),$scope.$watchCollection(angular.bind(this,function(){return this.modelo}),function(){console.log("modelo changed to "+vm.modelo)}),vm.find=function(){void 0!==vm.SEARCH&&(vm.reportes=Reportes.query({e:vm.SEARCH.enterprise}))},vm.findOne=function(){Reportes.get({},function(res){},function(err){})},vm.performanceChartData=[],vm.performancePeriod="year",vm.changePeriod=function(){console.log("[+] changePeriod::fired! ",vm.performancePeriod);loadData(vm.performancePeriod)},vm.yearValue="2016",vm.quarterValue="2016-1Q",vm.monthValue="2016-3",vm.chartOptions={chart:{type:"lineWithFocusChart",objectequality:!0,height:450,duration:500,isArea:!0,x:function(d){return d.label},y:function(d){return d.value},showLabels:!1,showLegend:!1,useInteractiveGuideline:!0,title:"Ventas año "+vm.yearValue,xAxis:{showMaxMin:!1,axisLabel:"Mes",tickFormat:function(d){return d3.time.format("%Y-%m-%d")(new Date(d))}},x2Axis:{tickFormat:function(d){return d3.time.format("%Y-%m-%d")(new Date(d))}},yAxis:{axisLabel:"Ingresos ($)",tickFormat:function(d){return d3.format(",.2f")(d)}},y2Axis:{tickFormat:function(d){return d3.format(",.2f")(d)}},showControls:!1}}}]),angular.module("reportes").controller("ReportesController",["$scope","$stateParams","$location","$filter","user","tipoReporte","reportesVentas","ReportesCompras","Puestos","Costcenters","$q","lodash",function($scope,$stateParams,$location,$filter,user,tipoReporte,reportesVentas,ReportesCompras,Puestos,Costcenters,$q,lodash){this.user=user,this.isDayLoading=!0,this.isWeekLoading=!0,this.isMonthLoading=!0,this.isRangeLoading=!1;var now=new Date,day=getDay(now),month=getMonth(now),week=getWeek(now);this.tipo=$stateParams.tipo,this.date=now,this.weekInput=now,this.monthInput=now,this.costcenteritem=null,this.category=null,this.products=null,this.clients=null,this.clientName="Clientes","compra"==$stateParams.tipo&&(this.clientName="Proveedors"),this.puesto=function(item_detail,item){"initial"!=item?(this.costcenteritem=item.from,"rangepickerSelected"==item_detail?this.rangepickerSelected():this.loadReportes(item_detail)):this.costcenteritem=null},this.showByCategory=function(tab){this.category="category",this.costcenteritem=null,"rangepickerSelected"==tab?this.rangepickerSelected():this.loadReportes(tab)},this.showByProducts=function(tab){this.products="product",this.costcenteritem=null,"rangepickerSelected"==tab?this.rangepickerSelected():this.loadReportes(tab)},this.showByClients=function(tab){this.clients="clients",this.costcenteritem=null,"rangepickerSelected"==tab?this.rangepickerSelected():this.loadReportes(tab)},this.showByPuestCategory=function(item,item_detail){this.category="category",this.costcenteritem=item.from,"rangepickerSelected"==item_detail?this.rangepickerSelected():this.loadReportes(item_detail)},this.showByPuestProducts=function(item,item_detail){this.products="product",this.costcenteritem=item.from,this.loadReportes(item_detail)},this.showByPuestClients=function(item,item_detail){this.clients="client",this.costcenteritem=item.from,this.loadReportes(item_detail)},this.rangepickerSelected=function(){this.dateStart&&this.dateEnd&&(this.isRangeLoading=!0,"venta"===$stateParams.tipo?(reportesVentas.getDataRange(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id,this.category,this.products,this.clients,this.costcenter).then(angular.bind(this,function(data){if(null==this.costcenteritem)this.isRangeLoading=!1,this.range.balance=data.data.balance,this.range.byCategory=data.data.byCategory,this.range.byProduct=data.data.byProduct,this.range.byPuesto=data.data.byPuesto,this.range.byClients=data.data.byClients,this.selectedIndex=0;else if(null!=this.costcenteritem){this.isRangeLoading=!1,this.range.puestProduct=[],this.range.puestCategory=[],this.range.puestClients=[];for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.range.puestCategory=data.data.byPuesto[index].byCategory,this.range.puestProduct=data.data.byPuesto[index].byProduct,this.range.puestClients=data.data.byPuesto[index].byClients)}})),null==this.costcenteritem&&(reportesVentas.getDataCategoriasRange(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesd=========="),console.log(data),this.range.modelcat=data.data})),reportesVentas.getDataCategoriasRangePuesto(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesdFilter=========="),console.log(data),this.range.modelcatPuesto=data.data})),reportesVentas.getDataCondiVentaRange(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesd=========="),console.log(data),this.range.modelCondiVenta=data.data})),reportesVentas.getDataCondiVentaRangePuesto(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesdFilter=========="),console.log(data),this.range.modelCondiVentaPuesto=data.data})),reportesVentas.getDataComprobanteRange(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesd=========="),console.log(data),this.range.modelComprobante=data.data})),reportesVentas.getDataComprobanteRangePuesto(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesdFilter=========="),console.log(data),this.range.modelComprobantePuesto=data.data}))),this.category=null,this.products=null,this.clients=null):(ReportesCompras.getDataRange(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id,this.category,this.products).then(angular.bind(this,function(data){this.isRangeLoading=!1,this.range.balance=data.data.balance,this.range.byCategory=data.data.byCategory,this.range.byProduct=data.data.byProduct,this.range.byPuesto=data.data.byPuesto})),ReportesCompras.getDataCategoriasRange(getDay(this.dateStart),getDay(this.dateEnd),this.user.enterprise._id).then(angular.bind(this,function(data){this.range.modelcat=data.data})),this.category=null,this.products=null))},this.monthSelected=function(){this.monthInput&&(this.costcenteritem=null,this.isMonthLoading=!0,this.monthValue=getMonth(this.monthInput),this.loadReportes("mes"))},this.weekSelected=function(){this.weekInput&&(this.costcenteritem=null,this.isWeekLoading=!0,this.weekValue=getWeek(this.weekInput),this.loadReportes("semana"))},this.datepickerSelected=function(){this.date&&(this.costcenteritem=null,this.isDayLoading=!0,this.dayValue=getDay(this.date),this.loadReportes("dia"))},this.findPuestoById=function(puestoId){return lodash.find($scope.puestos,function(puesto){return puesto._id===puestoId})},this.findCostcenterByPuesto=function(puesto){return lodash.find($scope.costcenters,function(costcenter){return costcenter._id===puesto.centroDeCosto})},this.findTabName=function(puestoVetas){return"others"===puestoVetas.from?puestoVetas.from:this.findCostcenterByPuesto(this.findPuestoById(puestoVetas.from)).name},this.dayValue=day,this.monthValue=month,this.weekValue=week,this.day={},this.week={},this.month={},this.range={},this.tipoReporte=tipoReporte,this.getPuestos=function(){var deferred=$q.defer();return Puestos.query({},function(res){$scope.puestos=res,Costcenters.query({},function(data){$scope.costcenters=data,deferred.resolve(!0)})}),deferred.promise};function getDay(date){var diff=date-new Date(date.getFullYear(),0,0),day=Math.floor(diff/864e5);return date.getFullYear()+"-"+day}function getWeek(date){var temp=new Date(date);return temp.setHours(0,0,0),temp.setDate(temp.getDate()+4-(temp.getDay()||7)),date.getFullYear()+"-"+Math.ceil(((temp-new Date(temp.getFullYear(),0,1))/864e5+1)/7)}function getMonth(date){var month=date.getMonth();return date.getFullYear()+"-"+month}this.loadReportes=function(tab){this.getPuestos().then(angular.bind(this,function(){"venta"===$stateParams.tipo?"dia"==tab?(reportesVentas.getDataDay(this.dayValue,this.user.enterprise._id,this.category,this.products,this.clients,this.costcenter).then(angular.bind(this,function(data){if(null==this.costcenteritem)this.day.balance=data.data.balance,this.day.byCategory=data.data.byCategory,this.day.byProduct=data.data.byProduct,this.day.byPuesto=data.data.byPuesto,this.day.byClients=data.data.byClients,this.isDayLoading=!1;else{this.isRangeLoading=!1,this.day.puestProduct=[],this.day.puestCategory=[],this.day.puestClients=[],console.log(this.costcenteritem);for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.day.puestCategory=data.data.byPuesto[index].byCategory,this.day.puestProduct=data.data.byPuesto[index].byProduct,this.day.puestClients=data.data.byPuesto[index].byClients)}})),null==this.costcenteritem&&(reportesVentas.getDataCategoriasDay(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesday!aa=========="),console.log(data),this.day.modelcat=data.data})),reportesVentas.getDataCondiVentaDay(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======CondiVentaday!aa=========="),console.log(data),this.day.modelCondiVenta=data.data})),reportesVentas.getDataComprobanteDay(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======Comprobanteday!aa=========="),console.log(data),this.day.modelComprobante=data.data})),reportesVentas.getDataCondiVentaDayPuesto(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======CondiVentadayPusto!aa=========="),console.log(data),this.day.modelCondiVentaPuesto=data.data})),reportesVentas.getDataComprobanteDayPuesto(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======ComprobantedayPuesto!aa=========="),console.log(data),this.day.modelComprobantePuesto=data.data})),reportesVentas.getDataCategoriasDayPuesto(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesdayFilter=========="),console.log(data),this.day.modelcatPuesto=data.data}))),this.category=null,this.products=null,this.clients=null):"semana"==tab?(reportesVentas.getDataWeek(this.weekValue,this.user.enterprise._id,this.category,this.products,this.clients,this.costcenter).then(angular.bind(this,function(data){if(null==this.costcenteritem)this.week.balance=data.data.balance,this.week.byCategory=data.data.byCategory,this.week.byProduct=data.data.byProduct,this.week.byPuesto=data.data.byPuesto,this.week.byClients=data.data.byClients,this.isWeekLoading=!1;else{this.isWeekLoading=!1,this.week.puestProduct=[],this.week.puestCategory=[],this.week.puestClients=[],console.log(this.costcenteritem);for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.week.puestCategory=data.data.byPuesto[index].byCategory,this.week.puestProduct=data.data.byPuesto[index].byProduct,this.week.puestClients=data.data.byPuesto[index].byClients)}})),null==this.costcenteritem&&(reportesVentas.getDataCategoriasWeek(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweek=========="),console.log(data),this.week.modelcat=data.data})),reportesVentas.getDataCategoriasWeekPuesto(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweekFilter=========="),console.log(data),this.week.modelcatPuesto=data.data})),reportesVentas.getDataCondiVentaWeek(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweek=========="),console.log(data),this.week.modelCondiVenta=data.data})),reportesVentas.getDataCondiVentaWeekPuesto(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweekFilter=========="),console.log(data),this.week.modelCondiVentaPuesto=data.data})),reportesVentas.getDataComprobanteWeek(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweek=========="),console.log(data),this.week.modelComprobante=data.data})),reportesVentas.getDataComprobanteWeekPuesto(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweekFilter=========="),console.log(data),this.week.modelComprobantePuesto=data.data}))),this.category=null,this.products=null,this.clients=null):(reportesVentas.getDataDetailedMonth(this.monthValue,this.user.enterprise._id,this.category,this.products,this.clients,this.costcenter).then(angular.bind(this,function(data){if(console.log("_______month DATA______"),null==this.costcenteritem)console.log(data),this.month.balance=data.data.balance,this.month.byCategory=data.data.byCategory,this.month.byProduct=data.data.byProduct,this.month.byPuesto=data.data.byPuesto,this.month.byClients=data.data.byClients,this.isMonthLoading=!1;else{this.month.puestProduct=[],this.month.puestCategory=[],this.month.puestClients=[],console.log(this.costcenteritem);for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.month.puestCategory=data.data.byPuesto[index].byCategory,this.month.puestProduct=data.data.byPuesto[index].byProduct,this.month.puestClients=data.data.byPuesto[index].byClients)}})),null==this.costcenteritem&&(reportesVentas.getDataCategoriasMonth(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonth=========="),console.log(data),this.month.modelcat=data.data})),reportesVentas.getDataCategoriasMonthPuesto(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonthFilter=========="),console.log(data),this.month.modelcatPuesto=data.data})),reportesVentas.getDataCondiVentaMonth(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonth=========="),console.log(data),this.month.modelCondiVenta=data.data})),reportesVentas.getDataCondiVentaMonthPuesto(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonthFilter=========="),console.log(data),this.month.modelCondiVentaPuesto=data.data})),reportesVentas.getDataComprobanteMonth(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonth=========="),console.log(data),this.month.modelComprobante=data.data})),reportesVentas.getDataComprobanteMonthPuesto(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonthFilter=========="),console.log(data),this.month.modelComprobantePuesto=data.data}))),this.category=null,this.products=null,this.clients=null):"dia"==tab?(ReportesCompras.getDataDay(this.dayValue,this.user.enterprise._id,this.category,this.products,this.clients).then(angular.bind(this,function(data){if(console.log("=======categoriesday!faaaa=========="),console.log("===============Compras Da============"),null==this.costcenteritem)console.log(data),this.day.balance=data.data.balance,this.day.byCategory=data.data.byCategory,this.day.byProduct=data.data.byProduct,this.day.byClients=data.data.byClients,this.day.byPuesto=data.data.byPuesto,this.isDayLoading=!1;else{this.day.puestProduct=[],this.day.puestCategory=[],this.day.puestClients=[],console.log(this.costcenteritem);for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.day.puestCategory=data.data.byPuesto[index].byCategory,this.day.puestProduct=data.data.byPuesto[index].byProduct,this.day.puestClients=data.data.byPuesto[index].byClients)}})),ReportesCompras.getDataCategoriasDay(this.dayValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesday!aa=========="),console.log(data),this.day.modelcat=data.data})),this.category=null,this.products=null):"semana"==tab?(ReportesCompras.getDataWeek(this.weekValue,this.user.enterprise._id,this.category,this.products,this.clients).then(angular.bind(this,function(data){if(null==this.costcenteritem)console.log(data),this.week.balance=data.data.balance,this.week.byCategory=data.data.byCategory,this.week.byProduct=data.data.byProduct,this.week.byPuesto=data.data.byPuesto,this.week.byClients=data.data.byClients,this.isWeekLoading=!1;else{this.isWeekLoading=!1,this.week.puestProduct=[],this.week.puestCategory=[],this.week.puestClients=[],console.log(this.costcenteritem);for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.week.puestCategory=data.data.byPuesto[index].byCategory,this.week.puestProduct=data.data.byPuesto[index].byProduct,this.week.puestClients=data.data.byPuesto[index].byClients)}})),ReportesCompras.getDataCategoriasWeek(this.weekValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesweek=========="),console.log(data),this.week.modelcat=data.data})),this.category=null,this.products=null):(ReportesCompras.getDataDetailedMonth(this.monthValue,this.user.enterprise._id,this.category,this.products,this.clients).then(angular.bind(this,function(data){if(null==this.costcenteritem)console.log(data),this.month.balance=data.data.balance,this.month.byCategory=data.data.byCategory,this.month.byProduct=data.data.byProduct,this.month.byPuesto=data.data.byPuesto,this.month.byClients=data.data.byClients,this.isMonthLoading=!1;else{this.month.puestProduct=[],this.month.puestCategory=[],this.month.puestClients=[],console.log(this.costcenteritem);for(var index=0;index<data.data.byPuesto.length;index++)this.costcenteritem==data.data.byPuesto[index].from&&(this.month.puestCategory=data.data.byPuesto[index].byCategory,this.month.puestProduct=data.data.byPuesto[index].byProduct,this.month.puestClients=data.data.byPuesto[index].byClients)}})),ReportesCompras.getDataCategoriasMonth(this.monthValue,this.user.enterprise._id).then(angular.bind(this,function(data){console.log("=======categoriesmonth=========="),console.log(data),this.month.modelcat=data.data})),this.category=null,this.products=null)}))}}]),angular.module("reportes").factory("ReportesCompras",["$http",function($http){return{getDataYear:function(year,enterprise){return console.log("[+] reportes::ReportesCompras::getDataYear:fired!"),$http({method:"get",url:"/api/reportes/compras/byYear/"+year,params:{e:enterprise}})},getDataQuarter:function(quarter,enterprise){return $http({method:"get",url:"/api/reportes/compras/byQ/"+quarter,params:{e:enterprise}})},getDataMonth:function(month,enterprise){return $http({method:"get",url:"/api/reportes/compras/byMonth/"+month,params:{e:enterprise}})},getDataDetailedMonth:function(month,enterprise,category,products,clients){return $http({method:"get",url:"/api/reportes/compras/byMonthDetailed/"+month,params:{e:enterprise,category:category,products:products,clients:clients}})},getDataWeek:function(week,enterprise,category,products,clients){return $http({method:"get",url:"/api/reportes/compras/byWeek/"+week,params:{e:enterprise,category:category,products:products,clients:clients}})},getDataDay:function(day,enterprise,category,products,clients){return $http({method:"get",url:"/api/reportes/compras/byDay/"+day,params:{e:enterprise,category:category,products:products,clients:clients}})},getDataRange:function(start,end,enterprise,category,products,clients){return $http({method:"get",url:"/api/reportes/compras/byRange",params:{e:enterprise,start:start,end:end,category:category,products:products,clients:clients}})},getDataCategoriasDay:function(day,enterprise){return $http({method:"get",url:"/api/reportes/compras/categorias/byDay/"+day,params:{e:enterprise}})},getDataCategoriasMonth:function(month,enterprise){return $http({method:"get",url:"/api/reportes/compras/categorias/byMonth/"+month,params:{e:enterprise}})},getDataCategoriasWeek:function(week,enterprise){return $http({method:"get",url:"/api/reportes/compras/categorias/byWeek/"+week,params:{e:enterprise}})},getDataCategoriasRange:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/compras/categorias/byRange/",params:{e:enterprise,Start:start,End:end}})}}}]),angular.module("reportes").factory("ReportesVentas",["$http",function($http){return{getDataYear:function(year,enterprise){return console.log("[+] reportes::ReportesVentas::getDataYear:fired!"),$http({method:"get",url:"/api/reportes/ventas/byYear/"+year,params:{e:enterprise}})},getDataQuarter:function(quarter,enterprise){return $http({method:"get",url:"/api/reportes/ventas/byQ/"+quarter,params:{e:enterprise}})},getDataMonth:function(month,enterprise){return $http({method:"get",url:"/api/reportes/ventas/byMonth/"+month,params:{e:enterprise}})},getDataProductYear:function(year,enterprise){return console.log("[+] reportes::ReportesVentas::getDataYear:fired!"),$http({method:"get",url:"/api/reportes/ventas/productos/byYear/"+year,params:{e:enterprise}})},getDataProductQuarter:function(quarter,enterprise){return $http({method:"get",url:"/api/reportes/ventas/productos/byQ/"+quarter,params:{e:enterprise}})},getDataProductMonth:function(month,enterprise){return $http({method:"get",url:"/api/reportes/ventas/productos/byMonth/"+month,params:{e:enterprise}})},getDataDetailedMonth:function(month,enterprise,category,products,client,costcenter){return console.log("Category: "+category),$http({method:"get",url:"/api/reportes/ventas/byMonthDetailed/"+month,params:{e:enterprise,category:category,products:products,client:client,costcenter:costcenter}})},getDataWeek:function(week,enterprise,category,products,client,costcenter){return $http({method:"get",url:"/api/reportes/ventas/byWeek/"+week,params:{e:enterprise,category:category,products:products,client:client,costcenter:costcenter}})},getDataDay:function(day,enterprise,category,products,client,costcenter){return $http({method:"get",url:"/api/reportes/ventas/byDay/"+day,params:{e:enterprise,category:category,products:products,client:client,costcenter:costcenter}})},getDataRange:function(start,end,enterprise,category,products,client,costcenter){return $http({method:"get",url:"/api/reportes/ventas/byRange",params:{e:enterprise,start:start,end:end,category:category,products:products,client:client,costcenter:costcenter}})},getDataCategoriasDay:function(Day,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasDay:fired!"),$http({method:"get",url:"/api/reportes/ventas/categorias/byDay/"+Day,params:{e:enterprise}})},getDataCondiVentaDay:function(Day,enterprise){return console.log("[+] reportes::ReportesVentasCondiVenta::getDataCondiVentaDay:fired!"),$http({method:"get",url:"/api/reportes/ventas/condiventa/byDay/"+Day,params:{e:enterprise}})},getDataComprobanteDay:function(Day,enterprise){return console.log("[+] reportes::ReportesVentasCondiVenta::getDataCondiVentaDay:fired!"),$http({method:"get",url:"/api/reportes/ventas/comprobante/byDay/"+Day,params:{e:enterprise}})},getDataComprobanteDayPuesto:function(Day,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasDay:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/comprobante/byDay/"+Day,params:{e:enterprise}})},getDataCondiVentaDayPuesto:function(Day,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasDay:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/condiVenta/byDay/"+Day,params:{e:enterprise}})},getDataCategoriasDayPuesto:function(Day,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasDay:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/byDay/"+Day,params:{e:enterprise}})},getDataCategoriasWeek:function(Week,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasWeek:fired!"),$http({method:"get",url:"/api/reportes/ventas/categorias/byWeek/"+Week,params:{e:enterprise}})},getDataCategoriasWeekPuesto:function(Week,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasWeek:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/byWeek/"+Week,params:{e:enterprise}})},getDataCondiVentaWeek:function(Week,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasWeek:fired!"),$http({method:"get",url:"/api/reportes/ventas/condiVenta/byWeek/"+Week,params:{e:enterprise}})},getDataCondiVentaWeekPuesto:function(Week,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasWeek:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/condiVenta/byWeek/"+Week,params:{e:enterprise}})},getDataComprobanteWeek:function(Week,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasWeek:fired!"),$http({method:"get",url:"/api/reportes/ventas/comprobante/byWeek/"+Week,params:{e:enterprise}})},getDataComprobanteWeekPuesto:function(Week,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasWeek:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/comprobante/byWeek/"+Week,params:{e:enterprise}})},getDataCategoriasMonth:function(Month,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasMonth:fired!"),$http({method:"get",url:"/api/reportes/ventas/categorias/byMonth/"+Month,params:{e:enterprise}})},getDataCategoriasMonthPuesto:function(Month,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasMonth:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/byMonth/"+Month,params:{e:enterprise}})},getDataCondiVentaMonth:function(Month,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasMonth:fired!"),$http({method:"get",url:"/api/reportes/ventas/condiVenta/byMonth/"+Month,params:{e:enterprise}})},getDataCondiVentaMonthPuesto:function(Month,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasMonth:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/condiVenta/byMonth/"+Month,params:{e:enterprise}})},getDataComprobanteMonth:function(Month,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasMonth:fired!"),$http({method:"get",url:"/api/reportes/ventas/comprobante/byMonth/"+Month,params:{e:enterprise}})},getDataComprobanteMonthPuesto:function(Month,enterprise){return console.log("[+] reportes::ReportesVentasCategorias::getDataCategoriasMonth:fired!"),$http({method:"get",url:"/api/reportes/ventas/puestos/comprobante/byMonth/"+Month,params:{e:enterprise}})},getDataCategoriasRange:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/ventas/categorias/byRange",params:{e:enterprise,start:start,end:end}})},getDataCategoriasRangePuesto:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/ventas/puestos/byRange",params:{e:enterprise,start:start,end:end}})},getDataCondiVentaRange:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/ventas/condiVenta/byRange",params:{e:enterprise,start:start,end:end}})},getDataCondiVentaRangePuesto:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/ventas/puestos/condiVenta/byRange",params:{e:enterprise,start:start,end:end}})},getDataComprobanteRange:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/ventas/comprobante/byRange",params:{e:enterprise,start:start,end:end}})},getDataComprobanteRangePuesto:function(start,end,enterprise){return $http({method:"get",url:"/api/reportes/ventas/puestos/comprobante/byRange",params:{e:enterprise,start:start,end:end}})}}}]),angular.module("reportes").factory("Reportes",["$resource",function($resource){return $resource("api/reportes/:reporteId",{reporteId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("rrhhs").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Rrhhs",state:"rrhhs",type:"dropdown"}),Menus.addSubMenuItem("topbar","rrhhs",{title:"List Rrhhs",state:"rrhhs.list"}),Menus.addSubMenuItem("topbar","rrhhs",{title:"Create Rrhh",state:"rrhhs.create"})}]),angular.module("rrhhs").config(["$stateProvider",function($stateProvider){$stateProvider.state("rrhhs",{abstract:!0,url:"/rrhhs",template:"<ui-view/>"}).state("rrhhs.list",{url:"",templateUrl:"modules/rrhhs/views/list-rrhhs.client.view.html"}).state("rrhhs.create",{url:"/create",templateUrl:"modules/rrhhs/views/create-rrhh.client.view.html"}).state("rrhhs.view",{url:"/:rrhhId",templateUrl:"modules/rrhhs/views/view-rrhh.client.view.html"}).state("rrhhs.edit",{url:"/:rrhhId/edit",templateUrl:"modules/rrhhs/views/edit-rrhh.client.view.html"})}]),angular.module("rrhhs").controller("RrhhsController",["$scope","$stateParams","$location","Authentication","Rrhhs","Areas","Puestos","$rootScope","$http","$compile","$mdBottomSheet","ShowAreaInfo","Modal","$mdDialog",function($scope,$stateParams,$location,Authentication,Rrhhs,Areas,Puestos,$rootScope,$http,$compile,$mdBottomSheet,ShowAreaInfo,Modal,$mdDialog){function AreaModalController($scope,$mdDialog,ShowAreaInfo){var areaActive=ShowAreaInfo.getArea();$http({method:"GET",url:"/api/findAreaById",params:{areaId:areaActive}}).then(function(response){$scope.areaActive=response.data,$scope.parent=$scope.areaActive.parent,$http({method:"GET",url:"/api/puestoByAreaId",params:{areaId:$scope.areaActive._id}}).then(function(res){null==res.data[0]?$scope.puestosActive=null:($scope.puestosActive=res.data,console.log($scope.puestosActive))},function(response){console.log("error")})},function(response){console.log("error")}),$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)}}AreaModalController.$inject=["$scope","$mdDialog","ShowAreaInfo"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){new Rrhhs({name:this.name}).$save(function(response){$location.path("rrhhs/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(rrhh){if(rrhh)for(var i in rrhh.$remove(),$scope.rrhhs)$scope.rrhhs[i]===rrhh&&$scope.rrhhs.splice(i,1);else $scope.rrhh.$remove(function(){$location.path("rrhhs")})},$scope.update=function(){var rrhh=$scope.rrhh;rrhh.$update(function(){$location.path("rrhhs/"+rrhh._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.bindOrganigrama=function(id,elemento){var el=angular.element(document.getElementById(id)),newElem=angular.element(elemento);el.append(newElem),$compile(newElem)($scope)},$scope.find=function(){void 0!==$scope.SEARCH&&Areas.query({e:$scope.SEARCH.enterprise},function(res1){var nivelMax=0;$scope.organigrama=[],$rootScope.areas=res1;for(var i=0;i<$rootScope.areas.length;i++)0===$rootScope.areas[i].nivel&&($scope.organigrama[0]=$rootScope.areas[i]),parseInt($rootScope.areas[i].nivel)>nivelMax&&(nivelMax=$rootScope.areas[i].nivel);for(i=1;i<=nivelMax;i++){$scope.organigrama[i]=[];for(var j=0;j<$rootScope.areas.length;j++)$rootScope.areas[j].nivel===i&&$scope.organigrama[i].push($rootScope.areas[j])}for(i=1;i<=nivelMax;i++)for(var element in $scope.organigrama[i])if(0==$scope.organigrama[i][element].deleted)if(1==i){var id="organigrama";if(1==document.getElementById(id).children.length){var elemento='<ul id="nivel0"><li id="nivel'+i+element+'" ><a ng-click="showAdvancedArea($event)" id="'+$scope.organigrama[i][element]._id+'">'+$scope.organigrama[i][element].name+"</a></li></ul>";$scope.bindOrganigrama(id,elemento)}else{elemento='<li id="nivel'+i+element+'" ><a ng-click="showAdvancedArea($event)" id="'+$scope.organigrama[i][element]._id+'">'+$scope.organigrama[i][element].name+"</a></li>";$scope.bindOrganigrama("nivel0",elemento)}}else for(var value in $scope.organigrama[i-1])if($scope.organigrama[i][element].parent._id==$scope.organigrama[i-1][value]._id){var res="nivel".concat(i-1,value);if(1==document.getElementById(res).children.length){elemento='<ul id="itemsNivel'+res+'"><li id="nivel'+i+element+'" ><a href="#" ng-click="showAdvancedArea($event)" id="'+$scope.organigrama[i][element]._id+'">'+$scope.organigrama[i][element].name+"</a></li></ul>";$scope.bindOrganigrama(res,elemento)}else{console.log("!!!!!",$scope.organigrama[i][element]);elemento='<li id="nivel'+i+element+'" ><a href="#" ng-click="showAdvancedArea($event)" id="'+$scope.organigrama[i][element]._id+'">'+$scope.organigrama[i][element].name+"</a></li>",id="itemsNivel"+res;$scope.bindOrganigrama(id,elemento)}}})},$scope.findOne=function(){$scope.rrhh=Rrhhs.get({rrhhId:$stateParams.rrhhId})},$scope.showAdvancedArea=function(ev){var areaActive=ev.toElement.id;ShowAreaInfo.setArea(areaActive),$mdDialog.show({controller:AreaModalController,templateUrl:"/modules/rrhhs/views/view-area.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})}}]),angular.module("rrhhs").factory("Rrhhs",["$resource",function($resource){return $resource("api/rrhhs/:rrhhId",{rrhhId:"@_id"},{update:{method:"PUT"}})}]).factory("ShowAreaInfo",function(){var actualArea;return{getArea:function(){return actualArea},setArea:function(id){actualArea=id}}}),angular.module("servicios").config(["$stateProvider",function($stateProvider){$stateProvider.state("servicios",{abstract:!0,url:"/servicios",template:"<ui-view/>"}).state("servicios.create",{url:"/create",templateUrl:"modules/servicios/client/views/create-servicio.client.view.html"})}]),function(){function ServiciosListController(ServiciosService){this.servicios=ServiciosService.query()}angular.module("servicios").controller("ServiciosListController",ServiciosListController),ServiciosListController.$inject=["ServiciosService"]}(),function(){function ServiciosController($scope,$state,$window,Authentication,servicio){var vm=this;vm.authentication=Authentication,vm.servicio=servicio,vm.error=null,vm.form={},vm.remove=function(){$window.confirm("Are you sure you want to delete?")&&vm.servicio.$remove($state.go("servicios.list"))},vm.save=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","vm.form.servicioForm"),!1;vm.servicio._id?vm.servicio.$update(successCallback,errorCallback):vm.servicio.$save(successCallback,errorCallback);function successCallback(res){$state.go("servicios.view",{servicioId:res._id})}function errorCallback(res){vm.error=res.data.message}}}angular.module("servicios").controller("ServiciosController",ServiciosController),ServiciosController.$inject=["$scope","$state","$window","Authentication","servicioResolve"]}(),function(){function ServiciosService($resource){return $resource("api/servicios/:servicioId",{servicioId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}angular.module("servicios").factory("ServiciosService",ServiciosService),ServiciosService.$inject=["$resource"]}(),angular.module("servicios").factory("CustomServicios",["$http",function($http){return{getCentroByServicios:function(e){return $http({method:"get",url:"api/servicios/getCentroByServicios",params:{e:e}})}}}]),angular.module("stocks").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Stocks",state:"stocks",type:"dropdown"}),Menus.addSubMenuItem("topbar","stocks",{title:"List Stocks",state:"stocks.list"}),Menus.addSubMenuItem("topbar","stocks",{title:"Create Stock",state:"stocks.create"})}]),angular.module("stocks").config(["$stateProvider",function($stateProvider){$stateProvider.state("stocks",{abstract:!0,url:"/stocks",template:"<ui-view/>"}).state("stocks.list",{url:"",templateUrl:"modules/stocks/views/list-stocks.client.view.html"}).state("stocks.create",{url:"/create",templateUrl:"modules/stocks/views/create-stock.client.view.html"}).state("stocks.view",{url:"/:stockId",templateUrl:"modules/stocks/views/view-stock.client.view.html"}).state("stocks.edit",{url:"/:stockId/edit",templateUrl:"modules/stocks/views/edit-stock.client.view.html"})}]),angular.module("stocks",["infinite-scroll"]).controller("StocksController",["$scope","$rootScope","$stateParams","$location","$timeout","Authentication","Stocks","Products","Enterprises","$mdBottomSheet","$mdDialog","StockFactory","$filter","$state","costCenters","Providers","categories",function($scope,$rootScope,$stateParams,$location,$timeout,Authentication,Stocks,Products,Enterprises,$mdBottomSheet,$mdDialog,StockFactory,$filter,$state,costCenters,Providers,categories){function DialogController($scope,$mdDialog,item,SEARCH,action,costCenter,currentTab,Stocks,StockFactory){console.log("DialogController"),$scope.botonApagado=!1,$scope.item=item,$scope.SEARCH=SEARCH,$scope.errorStock=void 0,$scope.create=function(action,$event,reference){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!=this.stockToAdd&&null!=this.stockToAdd&&""!=this.stockToAdd){if(void 0==action||null===action)return console.log("No se especificó una acción al intentar modificar stock");$scope.botonApagado=!0,new Stocks({action:action,amount:this.stockToAdd,product:$scope.item._id,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,reference:reference||void 0,observations:this.observations,costCenter:costCenter}).$save(function(response){var idxStock=getStockByCostCenter(costCenter,item);null!=idxStock&&(item.stocks[idxStock].unitsInStock=response.newValue),getStockState(item,currentTab),$scope.closeDialog()},function(errorResponse){$scope.closeDialog(),$scope.error=errorResponse.data.message})}else $scope.errorStock="agregar"==action?"Debe indicar el stock a agregar":"Debe indicar el stock a suprimir"},$scope.registerOrder=function(order){if(console.log("registerOrder"),void 0==order||null===order)return console.log("No se especificó una acción al intentar modificar stock");new Stocks({action:"pedido recibido",amount:order.amount,product:$scope.item,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,received:!0,reference:order._id||void 0,observations:"Pedido con id "+order._id+"recibido!"}).$save(function(response){$scope.closeDialog()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.findStock=function(product){console.log("findStock"),void 0!==$scope.SEARCH&&(StockFactory.getStockOrdersForProduct(product,$scope.SEARCH.enterprise).success(function(data){$scope.stocks=data}).error(function(error){console.error("Fuck!!! -> ",error)}),console.log("sock: ",$scope.stocks))},$scope.action=action,$scope.closeDialog=function(){console.log("closeDialog"),$mdDialog.hide()},$scope.add=function(value1,value2){console.log("add"),$scope.newValue=value1+value2,$scope.errorStock=void 0},$scope.sup=function(value1,value2){console.log("sup"),$scope.newValue=value1-value2,$scope.errorStock=void 0}}function getStockState(item,tabIndex){var idxStock=getStockByCostCenter($scope.costCenter[tabIndex]._id,item);return null!=idxStock?item.stocks[idxStock].unitsInStock<=item.stocks[idxStock].criticalStock?{color:"red",percentage:100*item.stocks[idxStock].unitsInStock/item.stocks[idxStock].idealStock,stock:item.stocks[idxStock]}:item.stocks[idxStock].unitsInStock>=item.stocks[idxStock].idealStock?{color:"green",percentage:100,stock:item.stocks[idxStock]}:{color:"yellow",percentage:100*item.stocks[idxStock].unitsInStock/item.stocks[idxStock].idealStock,stock:item.stocks[idxStock]}:{color:"yellow",percentage:0,stock:{unitsInStock:0,idealStock:0,criticalStock:0}}}function getStockByCostCenter(id,product){if(null!=product.stocks)for(var i=0;i<product.stocks.length;i++)if(product.stocks[i].costCenter==id)return i;return null}DialogController.$inject=["$scope","$mdDialog","item","SEARCH","action","costCenter","currentTab","Stocks","StockFactory"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find(),$scope.findProveedores()}),$scope.tipoProducto=$stateParams.tipo,$rootScope.productosAPedir=[],$rootScope.products=[],$scope.filtroActivo=!1,$scope.productsLength=0,$scope.greenItems=[],$scope.yellowItems=[],$scope.redItems=[],$scope.costCenter=[],$scope.show_category=[],$scope.show_provider=[],$scope.categories=categories,$scope.catProducts=[],$scope.provProducts=[],$scope.currentTab=0,$scope.currentChildTab=0,$scope.status=[],$scope.$watchCollection("tipoProducto",function(){console.log("tipoProducto"),"p"===$scope.tipoProducto?($scope.daFilter={esProducto:!0},$scope.title="Stock de productos",$scope.esProducto=!0,$scope.esMateriaPrima=!1,$scope.esInsumo=!1):"m"===$scope.tipoProducto?($scope.daFilter={esMateriaPrima:!0,esInsumo:!0},$scope.title="Stock de materia prima e insumos",$scope.esMateriaPrima=!0,$scope.esProducto=!1,$scope.esInsumo=!1):"i"===$scope.tipoProducto&&($scope.daFilter={esInsumo:!0},$scope.title="Stock de insumos",$scope.esMateriaPrima=!1,$scope.esProducto=!1,$scope.esInsumo=!0)}),$scope.filtrarProveedores=function(proveedor){console.log("filtrarProveedores"),$scope.nombreProveedorFiltro=proveedor.name,$scope.idProveedorFiltro=proveedor._id,$rootScope.nuevoProveedor=proveedor,$scope.filtroActivo=!0},$scope.eliminarFiltro=function(){console.log("eliminarFiltro"),$scope.nombreProveedorFiltro=void 0,$scope.filtroActivo=!1,$scope.setStatus("")},$scope.validate=function(item){var user=$scope.authentication.user;return"user"!=user.roles[0]||user.centroDeCosto==item._id},$scope.create=function(action,reference){if(console.log(action,"action"),void 0==action||null===action)return console.log("No se especificó una acción al intentar modificar stock");new Stocks({action:action,amount:this.stockToAdd,product:$scope.item,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,reference:reference||void 0,observations:this.observations}).$save(function(response){$scope.closeDialog()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(stock){if(stock)for(var i in stock.$remove(),$scope.stocks)$scope.stocks[i]===stock&&$scope.stocks.splice(i,1);else $scope.stock.$remove(function(){$location.path("stocks")})},$scope.update=function(){$scope.stock.$update(function(){$location.path("stocks")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&$scope.costCenter.length>0&&Products.query({e:$scope.SEARCH.enterprise,p:0,pcount:40},function(data){console.log("find() product query : "+$scope.SEARCH.enterprise+","+data.length);for(var i=0;i<$scope.costCenter.length;i++)$scope.greenItems[i][0]=$filter("filter")(data,function(item){switch($scope.tipoProducto){case"p":return!0===item.esProducto&&"green"===item.stockState.color&&!1===item.deleted;case"m":return(!0===item.esMateriaPrima||!0===item.esInsumo)&&"green"===item.stockState.color&&!1===item.deleted}}),$scope.yellowItems[i][0]=$filter("filter")(data,function(item){switch($scope.tipoProducto){case"p":return!0===item.esProducto&&"yellow"===item.stockState.color&&!1===item.deleted;case"m":return(!0===item.esMateriaPrima||!0===item.esInsumo)&&"yellow"===item.stockState.color&&!1===item.deleted}}),$scope.redItems[i][0]=$filter("filter")(data,function(item){switch($scope.tipoProducto){case"p":return!0===item.esProducto&&"red"===item.stockState.color&&!1===item.deleted;case"m":return(!0===item.esMateriaPrima||!0===item.esInsumo)&&"red"===item.stockState.color&&!1===item.deleted}})})},$scope.$watchCollection("greenItems",function(){console.log("greenItems"),$scope.greenItems}),$scope.$watchCollection("redItems",function(){console.log("redItems"),$scope.redItems}),$scope.$watchCollection("yellowItems",function(){console.log("yellowItems"),$scope.yellowItems}),$scope.cambiar=function(producto){console.log("cambiar"),$rootScope.nuevoProducto=producto,console.log($rootScope.nuevoProducto,"nuevo producto"),$state.go("home.createPedido",{tipo:"compra"})},$scope.cambioCheckbox=function(item){console.log("cambioCheckbox");var product=angular.copy(item);if(1==item.checkbox){var cant=1;delete product.checkbox;var idxStock=getStockByCostCenter($scope.costCenter[$scope.currentTab]._id,product);null!=idxStock&&void 0!==product.stocks[idxStock]&&void 0!==product.stocks[idxStock].idealStock&&product.stocks[idxStock].idealStock>product.stocks[idxStock].unitsInStock&&(cant=product.stocks[idxStock].idealStock-product.stocks[idxStock].unitsInStock);var tot=cant*product.costPerUnit,p={product:product,cantidad:cant,descuento:0,total:tot,subtotal:tot,observaciones:""};$rootScope.productosAPedir.push(p),$rootScope.providerStock=product.provider}else for(var i=$rootScope.productosAPedir.length-1;i>=0;i--)$rootScope.productosAPedir[i].product._id==item._id&&$rootScope.productosAPedir.splice(i,1)},$scope.verProd=function(item){console.log("verProd"),$location.path("productos/view/"+item._id).search({back:"home.stock",tipo:$stateParams.tipo})},$scope.setStatus=function(s){console.log("setStatus"),$scope.status[$scope.currentTab][$scope.currentChildTab]=""!==s?{stockState:{color:s}}:void 0,$scope.numberToDisplay=17},$scope.findOne=function(){console.log("findOne"),$scope.stock=Stocks.get({stockId:$stateParams.stockId})},$scope.findProveedores=function(){console.log("findProveedores"),void 0!==$scope.SEARCH&&($scope.proveedores=Providers.query({e:$scope.SEARCH.enterprise}))},$scope.showDialog=function($event,item,action){console.log("showDialog");var parentEl=angular.element(document.body),template="";switch(action){case"agregar":template="modules/stocks/views/add-stock.client.view.html";break;case"suprimir":template="modules/stocks/views/remove-stock.client.view.html";break;case"pedido":template="modules/pedidos/views/create-pedido.client.view.html";break;case"pedido recibido":template="modules/stocks/views/received-stock.client.view.html";break;default:template="modules/stocks/views/add-stock.client.view.html"}$mdDialog.show({parent:parentEl,targetEvent:$event,templateUrl:template,locals:{item:item,SEARCH:$scope.SEARCH,action:action,costCenter:$scope.costCenter[$scope.currentTab]._id,currentTab:$scope.currentTab},controller:DialogController}).then(function(answer){$scope.find()},function(){})},$scope.initCostCenters=function(){$scope.startLoding=!0,console.log("initCostCenters"),$timeout(function(){var filter={deleted:!1};"user"==$scope.authentication.user.roles[0]&&(filter._id=$scope.authentication.user.centroDeCosto),$scope.costCenter=$filter("filter")(costCenters,filter);for(var i=0;i<$scope.costCenter.length;i++){$scope.show_category[i]=!0,$scope.show_provider[i]=!0,$scope.greenItems[i]=[],$scope.yellowItems[i]=[],$scope.redItems[i]=[];for(var j=0;j<2;j++)$scope.greenItems[i][j]=[],$scope.yellowItems[i][j]=[],$scope.redItems[i][j]=[];$rootScope.products[i]=[],$scope.catProducts[i]=[],$scope.provProducts[i]=[],$scope.categories=$filter("filter")(categories,function(item){return"p"==$scope.tipoProducto?"Producto"===item.type1:"m"==$scope.tipoProducto?"Materia Prima"===item.type1:void 0}),$scope.status[i]=[]}!function loadmoreProducts(){console.log("loadmoreProducts"),$scope.loadingFinal=!0,$scope.doneFinal||setTimeout(function(){Products.query({e:$scope.SEARCH.enterprise,p:$scope.productsLength,pcount:30},function(data){if(0!==data.length){$scope.productsLength+=data.length,console.log("load more data lenth : "+data.length);for(var i=0;i<$scope.costCenter.length;i++){var greenItems=$filter("filter")(data,function(item){switch($scope.tipoProducto){case"p":return!0===item.esProducto&&"green"===getStockState(item,i).color&&!1===item.deleted;case"m":return(!0===item.esMateriaPrima||!0===item.esInsumo)&&"green"===getStockState(item,i).color&&!1===item.deleted}});$scope.greenItems[i][0]=$scope.greenItems[i][0].concat(greenItems);var yellowItems=$filter("filter")(data,function(item){switch($scope.tipoProducto){case"p":return!0===item.esProducto&&"yellow"===getStockState(item,i).color&&!1===item.deleted;case"m":return(!0===item.esMateriaPrima||!0===item.esInsumo)&&"yellow"===getStockState(item,i).color&&!1===item.deleted}});$scope.yellowItems[i][0]=$scope.yellowItems[i][0].concat(yellowItems);var redItems=$filter("filter")(data,function(item){switch($scope.tipoProducto){case"p":return!0===item.esProducto&&"red"===getStockState(item,i).color&&!1===item.deleted;case"m":return(!0===item.esMateriaPrima||!0===item.esInsumo)&&"red"===getStockState(item,i).color&&!1===item.deleted}});$scope.redItems[i][0]=$scope.redItems[i][0].concat(redItems);var products=$filter("filter")(data,function(item){switch(console.log("obteniendo data:",$scope.tipoProducto),$scope.tipoProducto){case"p":if(!0===item.esProducto)return item.stockState=getStockState(item,i),!0;break;case"m":if(!0===item.esMateriaPrima||!0===item.esInsumo)return item.stockState=getStockState(item,i),!0}});$rootScope.products[i]=$rootScope.products[i].concat(angular.copy(products))}$scope.loadingFinal=!1,loadmoreProducts()}else $scope.doneFinal=!0})},500)}(),$scope.startLoding=!1},500)},$scope.tab_Index=[],$scope.showloading=!1,$scope.setCurrentTab=function(index){console.log("setCurrentTab"),$scope.currentTab=index,$filter("filter")($scope.proveedores,{deleted:!1}).length>10&&2==$scope.tab_Index[index]?($scope.proveedoresLoding=!0,$timeout(function(){$scope.proveedoresLoding=!1,$scope.currentTab=index},500)):$filter("filter")($scope.categories,{deleted:!1}).length>10&&0==$scope.tab_Index[index]?$timeout(function(){$scope.currentTab=index},500):1==$scope.tab_Index[index]?($scope.showloading=!0,$timeout(function(){$scope.showloading=!1,$scope.currentTab=index},2e3)):$scope.currentTab=index,$scope.numberToDisplay=17},$scope.setCurrentChildTab=function(index){console.log("setCurrentChildTab"),$scope.currentChildTab=index,$filter("filter")($scope.proveedores,{deleted:!1}).length>10&&2==index?$timeout(function(){$scope.tab_Index[$scope.currentTab]=index},500):$filter("filter")($scope.categories,{deleted:!1}).length>10&&0==index?$timeout(function(){$scope.tab_Index[$scope.currentTab]=index},500):1==index?($scope.showloading=!0,$timeout(function(){$scope.showloading=!1,$scope.tab_Index[$scope.currentTab]=index},1e3)):$scope.tab_Index[$scope.currentTab]=index,$scope.numberToDisplay=17},$scope.onClickCategory=function(item){$scope.current_item=item,$scope.catProducts[$scope.currentTab]=$filter("filter")($rootScope.products[$scope.currentTab],{category2:{category:item._id}}),$scope.greenItems[$scope.currentTab][1]=$filter("filter")($scope.catProducts[$scope.currentTab],function(item){return"green"==item.stockState.color&&0==item.deleted}),$scope.yellowItems[$scope.currentTab][1]=$filter("filter")($scope.catProducts[$scope.currentTab],function(item){return"yellow"==item.stockState.color&&0==item.deleted}),$scope.redItems[$scope.currentTab][1]=$filter("filter")($scope.catProducts[$scope.currentTab],function(item){return"red"==item.stockState.color&&0==item.deleted}),$scope.show_category[$scope.currentTab]=!1,$scope.numberToDisplay=17},$scope.onClickProvider=function(item){console.log("onClickProvider"),$scope.current_item_provider=item,$scope.provProducts[$scope.currentTab]=$filter("filter")($rootScope.products[$scope.currentTab],{provider:{id:item.provider}}),$scope.greenItems[$scope.currentTab][2]=$filter("filter")($scope.provProducts[$scope.currentTab],function(item){return"green"==item.stockState.color&&0==item.deleted}),$scope.yellowItems[$scope.currentTab][2]=$filter("filter")($scope.provProducts[$scope.currentTab],function(item){return"yellow"==item.stockState.color&&0==item.deleted}),$scope.redItems[$scope.currentTab][2]=$filter("filter")($scope.provProducts[$scope.currentTab],function(item){return"red"==item.stockState.color&&0==item.deleted}),$scope.show_provider[$scope.currentTab]=!1,$scope.numberToDisplay=17},$scope.backToCategory=function(tabIndex){console.log("backToCategory"),$scope.show_category[tabIndex]=!0},$scope.backToProvider=function(tabIndex){console.log("backToProvider"),$scope.show_provider[tabIndex]=!0},$scope.numberToDisplay=14,$scope.loadMore=function(){switch($scope.currentChildTab){case 0:$scope.numberToDisplay+3<$scope.catProducts[$scope.currentTab].length?$scope.numberToDisplay+=3:$scope.numberToDisplay=$scope.catProducts[$scope.currentTab].length;break;case 1:$scope.numberToDisplay+3<$scope.products[$scope.currentTab].length?$scope.numberToDisplay+=3:$scope.numberToDisplay=$scope.products[$scope.currentTab].length;break;case 2:$scope.numberToDisplay+3<$scope.provProducts[$scope.currentTab].length?$scope.numberToDisplay+=3:$scope.numberToDisplay=$scope.provProducts[$scope.currentTab].length}}}]),angular.module("stocks").factory("StockFactory",["$http",function($http){return{getStockOrdersForProduct:function(productID,enterpriseID){return console.log("productID: "+productID+" enterpriseID: "+enterpriseID),productID&&enterpriseID?$http({url:"/api/stocks/orders/"+productID,method:"GET",params:{e:enterpriseID},headers:{},data:{}}).success(function(data){}).error(function(data){}):[]}}}]),angular.module("stocks").factory("Stocks",["$resource",function($resource){return $resource("api/stocks/:stockId",{stockId:"@_id"},{update:{method:"PUT"}})}]),angular.module("subs").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Subs",state:"subs",type:"dropdown"}),Menus.addSubMenuItem("topbar","subs",{title:"List Subs",state:"subs.list"}),Menus.addSubMenuItem("topbar","subs",{title:"Create Sub",state:"subs.create"})}]),angular.module("subs").config(["$stateProvider",function($stateProvider){$stateProvider.state("subs",{abstract:!0,url:"/subs",template:"<ui-view/>"}).state("subs.list",{url:"",templateUrl:"modules/subs/views/list-subs.client.view.html"}).state("subs.create",{url:"/create",templateUrl:"modules/subs/views/create-sub.client.view.html"}).state("subs.view",{url:"/:subId",templateUrl:"modules/subs/views/view-sub.client.view.html"}).state("subs.edit",{url:"/:subId/edit",templateUrl:"modules/subs/views/edit-sub.client.view.html"})}]),angular.module("subs").controller("SubsController",["$scope","$rootScope","$stateParams","$location","Authentication","Subs","Enterprises","$mdBottomSheet","$mdDialog","$state",function($scope,$rootScope,$stateParams,$location,Authentication,Subs,Enterprises,$mdBottomSheet,$mdDialog,$state){function DialogController($scope,$mdDialog,item,Areas){$scope.item=item,$scope.goto=function(state,params){void 0!==state&&($state.go(state,params),$mdBottomSheet.hide())},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar UEN").content("¿Está seguro que desea eliminar esta UEN?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(sub){if(sub)for(var i in sub.$remove(),$scope.subs)$scope.subs[i]===sub&&$scope.subs.splice(i,1);else $scope.sub.$remove(function(){$location.path("subs")});$mdBottomSheet.hide()}}DialogController.$inject=["$scope","$mdDialog","item","Areas"],$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){if(void 0!==this.name){var sub=new Subs({name:this.name,description:this.description?this.description:void 0,goals:this.goals?this.goals:void 0,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});sub.$save(function(response){response._id&&(sub._id=response._id,$rootScope.subs.unshift(sub)),$scope.name="",$scope.description="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorName="Indique el nombre para la nueva UEN"},$scope.update=function(){var sub=$scope.sub;void 0!==this.enterprise?sub.enterprise=this.enterprise._id:sub.enterprise=sub.enterprise._id,sub.$update(function(){$location.path("UENs")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.subs=Subs.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){void 0!==$scope.SEARCH&&($scope.enterprises=Enterprises.query())},$scope.findOne=function(){$scope.sub=Subs.get({subId:$stateParams.subId})},$scope.showBottomSheet=function($event,item,model,param){$rootScope.currentItem=item,$rootScope.currentModel=model,$rootScope.currentParam=param,$mdBottomSheet.show({controller:DialogController,templateUrl:"/modules/core/views/menu-opciones.client.view.html",targetEvent:$event,resolve:{item:function(){return item}}}).then(function(clickedItem){})}}]),angular.module("subs").factory("Subs",["$resource",function($resource){return $resource("api/subs/:subId",{subId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("sucursales").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Sucursales",state:"sucursales",type:"dropdown"}),Menus.addSubMenuItem("topbar","sucursales",{title:"List Sucursales",state:"sucursales.list"}),Menus.addSubMenuItem("topbar","sucursales",{title:"Create Sucursal",state:"sucursales.create"})}]),angular.module("sucursales").config(["$stateProvider",function($stateProvider){$stateProvider.state("sucursales",{abstract:!0,url:"/sucursales",template:"<ui-view/>"}).state("sucursales.list",{url:"",templateUrl:"modules/sucursales/views/list-sucursales.client.view.html"}).state("sucursales.create",{url:"/create",templateUrl:"modules/sucursales/views/create-sucursal.client.view.html"}).state("sucursales.view",{url:"/:sucursalId",templateUrl:"modules/sucursales/views/view-sucursal.client.view.html"}).state("sucursales.edit",{url:"/:sucursalId/edit",templateUrl:"modules/sucursales/views/edit-sucursal.client.view.html"})}]),angular.module("sucursales").controller("SucursalesCreateController",["user","sucursal","enterprises","$state","sucursales",function(user,sucursal,enterprises,$state,sucursales){this.user=user,this.sucursal=sucursal,this.enterprises=enterprises,this.create=function(){new sucursales({name:this.name,descripcion:this.descripcion?this.descripcion:void 0,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.sucursales")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("sucursales").controller("SucursalesEditController",["user","sucursal","enterprises","$location",function(user,sucursal,enterprises,$location){this.user=user,this.sucursal=sucursal,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.update=function(){var sucursal=this.sucursal;void 0!==this.enterprise?sucursal.enterprise=this.enterprise._id:sucursal.enterprise=sucursal.enterprise._id;void 0!==this.modoFacturacion?sucursal.modoFacturacion=this.modoFacturacion:sucursal.modoFacturacion=sucursal.modoFacturacion}}]),angular.module("sucursales").controller("SucursalesListController",["$location","user","sucursales","enterprises","$mdDialog","cajas","ServiceNavigation","$rootScope",function($location,user,sucursales,enterprises,$mdDialog,cajas,ServiceNavigation,$rootScope){function deleteCajas(item){for(var i in item)if(item[i])for(var i in cajas)cajas[i]._id===item[i]&&cajas.splice(i,1);else cajas.$remove(function(){})}this.user=user,this.sucursales=sucursales,this.enterprises=enterprises,this.sucuraleId=void 0,this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la sucursal?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){if(item)for(var i in item.$remove(),sucursales)sucursales[i]===item&&(deleteCajas(sucursales[i].cajas),sucursales.splice(i,1));else sucursales.$remove(function(){})}(item)},function(){})},this.editingCaja=function(item){this.editing=item},this.editSucursal=function(item){for(var i in this.editing=!1,item.enterprise=item.enterprise._id,item.cajas)item.cajas[i]=item.cajas[i]._id;item.$update(function(){console.log("todo ok")},function(errorResponse){console.log("error")})},this.findUsuarios=function(cajas){"admin"!==this.user.roles[0]&&"groso"!==this.user.roles[0]?(this.sucuraleId="",cajas.$promise.then(angular.bind(this,function(data){for(var i in data)if(!data[i].deleted&&void 0!==data[i].puestos&&0!==data[i].puestos.length)for(var j in console.log(data[i].puestos),data[i].puestos)data[i].puestos[j]._id===user.puesto&&(this.sucuraleId=data[i].sucursal)}))):this.arrayCajas=cajas},this.findUsuarios(cajas),ServiceNavigation.navInit(),this.getName=function(name){ServiceNavigation.addNav({name:name}),$rootScope.$broadcast("nav change",!0)}}]),angular.module("sucursales").controller("SucursalesViewController",["PagosExtra","ComprasExtra","TransferenciasExtra","ArqueosExtra","user","sucursal","$mdDialog","cajas","Socket","Cajas","MovimientosExtra","$http","CajasExtra","Arqueos",function(PagosExtra,ComprasExtra,TransferenciasExtra,ArqueosExtra,user,sucursal,$mdDialog,cajas,Socket,Cajas,MovimientosExtra,$http,CajasExtra,Arqueos){DialogController.$inject=["$scope","$mdDialog","item","user","Puestos","Cajas","Transferencias","Arqueos","$filter","$location","Socket"],this.user=user,this.sucursal=sucursal,this.cajas=cajas,console.log("Tele"),this.arrayCajas=[],this.editing=!1,this.cueid=!0,this.selectedMode="md-scale",this.selectedDirection="up",this.showDialog=function($event,item){var parentEl=angular.element(document.body);$mdDialog.show({parent:parentEl,targetEvent:$event,templateUrl:"modules/cajas/views/create-caja.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.showDialogTransferencia=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/transferencias/views/create-transferencia.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.showDialogArqueo=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/arqueos/views/create-arqueo.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.findUsuarios=function(cajas){"admin"!==this.user.roles[0]&&"groso"!==this.user.roles[0]?cajas.$promise.then(angular.bind(this,function(data){for(var i in data)if(void 0!==data[i].puestos&&0!==data[i].puestos.length)for(var j in data[i].puestos)data[i].puestos[j]._id===user.puesto&&this.arrayCajas.push(data[i])})):(this.arrayCajas=cajas,this.arqueo={},$http.get("api/condicionventas/loadmore",{enterprise:enterprise,name:"Cuenta Corriente"}).then(function(res){angular.bind(this,function(res){res.data.length>0&&(this.cueid=res.data[0]._id)})}),this.ingresos={},this.egresos={},this.arrayCajas.$promise.then(angular.bind(this,function(data){var id_array=[],update_array={};for(var i in data)data[i].deleted||data[i].sucursal!=this.sucursal._id||(id_array.push(data[i]._id),update_array[data[i]._id]=data[i].updated);Arqueos.query({e:enterprise}).$promise.then(angular.bind(this,function(data){for(var groupedDataByCajaId=function(data){return data.reduce(function(results,item){return(results[item.caja]=results[item.caja]||[]).push(item),results},{})}(data),index=id_array.length-1;index>=0;index--){var lastCierreDeCajaByDate=findLastCierreDeCajaByDate(groupedDataByCajaId[id_array[index]]),lastAperturaDeCajaByDate=findLastAperturaDeCajaByDate(groupedDataByCajaId[id_array[index]]);lastAperturaDeCajaByDate&&lastAperturaDeCajaByDate.total&&(this.arqueo[lastAperturaDeCajaByDate.caja]=lastAperturaDeCajaByDate.total),lastAperturaDeCajaByDate&&lastCierreDeCajaByDate&&lastAperturaDeCajaByDate.created&&lastCierreDeCajaByDate.created&&new Date(lastAperturaDeCajaByDate.created)<new Date(lastCierreDeCajaByDate.created)&&(this.arqueo[lastAperturaDeCajaByDate.caja]=0)}})),this.getdebe_from_cajaid(id_array,update_array)})))},this.openMenu=function($mdOpenMenu,ev){ev,$mdOpenMenu(ev)},this.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("¿Eliminar la caja?").ariaLabel("Lucky day").targetEvent(ev).ok("Aceptar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){!function(item){if(item)for(var i in item.$remove(),cajas)cajas[i]===item&&cajas.splice(i,1);else cajas.$remove(function(){})}(item)},function(){})},this.editingCaja=function(item){this.editing=item},this.editCaja=function(item){for(var i in this.editing=!1,item.enterprise=item.enterprise._id,item.puestos)item.puestos[i]=item.puestos[i]._id;item.$update(function(){console.log("todo ok")},function(errorResponse){console.log("error")})},this.showDialogPuestos=function($event,item){$mdDialog.show({targetEvent:$event,templateUrl:"modules/sucursales/views/add-puesto.client.view.html",locals:{item:item,user:this.user},controller:DialogController}).then(function(answer){},function(){})},this.findFromArray=function(array,object){if(!array)return!1;if(!object)return!1;var checker=!1;return array.forEach(function(entry){entry._id===object._id&&(checker=!0)}),checker},this.getdebe_from_cajaid=function(id_array,date_array){var end_date=new Date,start_date=function(date_array){var allHaveAperturaDate=!0,minDate=new Date,oneWeekAgo=new Date;for(var idProperty in oneWeekAgo.setDate(oneWeekAgo.getDate()-7),date_array)idProperty&&date_array.hasOwnProperty(idProperty)&&date_array[idProperty]?(new Date(date_array[idProperty])<new Date(minDate)&&(minDate=date_array[idProperty]),allHaveAperturaDate=allHaveAperturaDate&&!0):allHaveAperturaDate=allHaveAperturaDate&&!1;return allHaveAperturaDate?minDate:oneWeekAgo}(date_array);ArqueosExtra.loadMoreByDate(enterprise,start_date,end_date,id_array).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].caja]||new Date(data[i].created)>new Date(date_array[data[i].caja]))&&(this.sumeggresos(data[i].caja,"arque",data[i]),this.sumingresos(data[i].caja,"arque",data[i]))})),TransferenciasExtra.loadMoreByDate(enterprise,start_date,end_date,id_array).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].cajaO._id]||new Date(data[i].created)>new Date(date_array[data[i].cajaO._id]))&&this.sumeggresos(data[i].cajaO._id,"arque",data[i]),(!date_array[data[i].cajaD._id]||new Date(data[i].created)>new Date(date_array[data[i].cajaD._id]))&&this.sumingresos(data[i].cajaD._id,"arque",data[i])})),MovimientosExtra.loadMoreByDate(enterprise,"haber",id_array,start_date,end_date).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].caja]||new Date(data[i].created)>new Date(date_array[data[i].caja]))&&(this.sumeggresos(data[i].caja,"arque",data[i]),this.sumingresos(data[i].caja,"arque",data[i]))})),MovimientosExtra.loadMoreByDate(enterprise,"debe",id_array,start_date,end_date).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].caja]||new Date(data[i].created)>new Date(date_array[data[i].caja]))&&(this.sumeggresos(data[i].caja,"arque",data[i]),this.sumingresos(data[i].caja,"arque",data[i]))})),ComprasExtra.loadMoreByCajaDate(enterprise,"Finalizada",start_date,end_date,id_array).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].caja]||new Date(data[i].created)>new Date(date_array[data[i].caja]))&&(this.sumeggresos(data[i].caja,"arque",data[i]),this.sumingresos(data[i].caja,"arque",data[i]))})),PagosExtra.loadMoreByCajaDate(enterprise,start_date,end_date,id_array).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].cajaD._id]||new Date(data[i].created)>new Date(date_array[data[i].cajaD._id]))&&(this.sumeggresos(data[i].cajaD._id,"arque",data[i]),this.sumingresos(data[i].cajaD._id,"arque",data[i]))})),CajasExtra.loadMoreByDate(enterprise,"Anulada",start_date,end_date,id_array).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].caja]||new Date(data[i].created)>new Date(date_array[data[i].caja]))&&(this.sumeggresos(data[i].caja,"arque",data[i]),this.sumingresos(data[i].caja,"arque",data[i]))})),CajasExtra.loadMoreByDate(enterprise,"Finalizada",start_date,end_date,id_array).then(angular.bind(this,function(res){for(var data=res.data,i=0;i<data.length;i++)(!date_array[data[i].caja]||new Date(data[i].created)>new Date(date_array[data[i].caja]))&&(this.sumeggresos(data[i].caja,"arque",data[i]),this.sumingresos(data[i].caja,"arque",data[i]))}))},this.arqueo={};var enterprise=this.user?this.user.enterprise.enterprise:authentication.user.enterprise.enterprise;function findLastAperturaDeCajaByDate(data){data=data||[];for(var lastAperturaDeCajaDate=new Date("0"),lastAperturaDeCaja={},index=data.length-1;index>=0;index--)"Apertura de Caja"===data[index].operacion&&new Date(data[index].created)>lastAperturaDeCajaDate&&(lastAperturaDeCaja=data[index]);return lastAperturaDeCaja}function findLastCierreDeCajaByDate(data){data=data||[];for(var lastCierreDeCajaDate=new Date("0"),lastCierreDeCaja={},index=data.length-1;index>=0;index--)"Cierre de Caja"===data[index].operacion&&new Date(data[index].created)>lastCierreDeCajaDate&&(lastCierreDeCaja=data[index]);return lastCierreDeCaja}function DialogController($scope,$mdDialog,item,user,Puestos,Cajas,Transferencias,Arqueos,$filter,$location,Socket){function roundToTwo(num){return+(Math.round(num+"e+2")+"e-2")}$scope.apagarBoton=!1,$scope.$watchCollection("Cajas",function(){$scope.findCajas(),$scope.findCajasTotal(),$scope.findTransferencias(),$scope.findArqueos()}),$scope.operaciones=[{id:3,name:"Ajustes"},{id:1,name:"Apertura de Caja"},{id:2,name:"Cierre de Caja"}],$scope.efectivo=item.efectivo,$scope.cheques=item.cheques,$scope.credito=item.credito,$scope.debito=item.debito,$scope.dolares=item.dolares,$scope.totalCaja=item.total,$scope.efectivoAjuste=0,$scope.chequeAjuste=0,$scope.creditoAjuste=0,$scope.debitoAjuste=0,$scope.dolaresAjuste=0,$scope.mostrar=!0,$scope.item=item,$scope.puestosAgregados=[],$scope.montoE=0,$scope.montoC=0,$scope.montoD=0,$scope.montoTD=0,$scope.montoTC=0,$scope.newSaldo=roundToTwo(item.total),$scope.errorCaja=void 0,$scope.closeDialog=function(){$mdDialog.hide()},$scope.findPuestos=function(){$scope.puestos=Puestos.query({e:user.enterprise._id})},$scope.findCajas=function(){Cajas.query({e:user.enterprise._id},function(data){$scope.cajas=$filter("filter")(data,function(item){return item._id!==$scope.item._id})})},$scope.cajasIDArray=[],$scope.findCajasTotal=function(){$scope.cajasTotal=Cajas.query({e:user.enterprise._id})},$scope.findTransferencias=function(){$scope.transferencias=Transferencias.query({e:user.enterprise._id})},$scope.findArqueos=function(){$scope.arqueos=Arqueos.query({e:user.enterprise._id})},$scope.addEfectivo=function(value){$scope.errorCaja=void 0,$scope.montoE=value,$scope.newSaldo=roundToTwo($scope.item.total-value-$scope.montoC-$scope.montoTD-$scope.montoTC-$scope.montoD)},$scope.addCheque=function(value){$scope.errorCaja=void 0,$scope.montoC=value,$scope.newSaldo=roundToTwo($scope.item.total-value-$scope.montoE-$scope.montoTD-$scope.montoTC-$scope.montoD)},$scope.addTarCre=function(value){$scope.errorCaja=void 0,$scope.montoTC=value,$scope.newSaldo=roundToTwo($scope.item.total-value-$scope.montoE-$scope.montoTD-$scope.montoC-$scope.montoD)},$scope.addtarDeb=function(value){$scope.errorCaja=void 0,$scope.montoTD=value,$scope.newSaldo=roundToTwo($scope.item.total-value-$scope.montoE-$scope.montoTC-$scope.montoC-$scope.montoD)},$scope.addDolares=function(value){$scope.errorCaja=void 0,$scope.montoD=value,$scope.newSaldo=roundToTwo($scope.item.total-value-$scope.montoE-$scope.montoTC-$scope.montoC-$scope.montoTD)},$scope.createCaja=function($event){$scope.apagarBoton=!0;var num=$scope.cajasTotal.length+1,caja={name:"Caja ".concat(num),descripcion:this.descripcion,puestos:$scope.puestosAgregados,sucursal:$scope.item._id,enterprise:user.enterprise._id},sucursal=$scope.item;sucursal.enterprise=sucursal.enterprise._id,Socket.emit("caja.create",caja),$mdDialog.hide(),Cajas.query({e:user.enterprise._id},function(data){for(var i in data)data[i].sucursal==$scope.item._id&&0==data[i].deleted&&$scope.cajasIDArray.push(data[i]._id);sucursal.cajas=$scope.cajasIDArray,sucursal.$update(function(){console.log("sucursal ok")},function(errorResponse){console.log("sucursal error")})})},$scope.agregarPuesto=function(puesto){var ok=!1;if(void 0!==puesto&&null!==puesto){for(var i in $scope.puestosAgregados)if($scope.puestosAgregados[i]._id===puesto._id)ok=!0;ok||$scope.puestosAgregados.push(puesto)}},$scope.addPuestoCaja=function(puesto){var ok=!1;if(void 0!==puesto&&null!==puesto){for(var i in item.puestos)if(item.puestos[i]._id===puesto._id)ok=!0;ok||item.puestos.push(puesto)}},$scope.borrarPuesto=function(item){if(item)for(var i in $scope.puestosAgregados)$scope.puestosAgregados[i]===item&&$scope.puestosAgregados.splice(i,1);else console.log("ningun puesto")},$scope.suprimirPuesto=function(p){if(p)for(var i in item.puestos)item.puestos[i]._id===p._id&&item.puestos.splice(i,1);else console.log("ningun puesto")},$scope.transType="",$scope.editPuestosCaja=function(item){for(var i in item.enterprise=item.enterprise._id,item.puestos)item.puestos[i]=item.puestos[i]._id;item.$update(function(){console.log("todo ok"),$mdDialog.hide()},function(errorResponse){console.log("error")})},$scope.changeTrans=function(){},$scope.createTransferencia=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.caja&&null!==$scope.caja){$scope.apagarBoton=!0;var newSaldoDestino=$scope.caja.total+$scope.montoE+$scope.montoC+$scope.montoD+$scope.montoTD+$scope.montoTC,transferencia={numero:$scope.transferencias.length+1,cajaO:item._id,cajaD:$scope.caja._id,montoE:$scope.montoE,montoC:$scope.montoC,montoD:$scope.montoD,montoTD:$scope.montoTD,montoTC:$scope.montoTC,saldo:$scope.newSaldo,saldoDestino:newSaldoDestino,observaciones:$scope.observaciones,enterprise:user.enterprise._id};Socket.emit("transferencia.create",transferencia),$mdDialog.hide()}else $scope.errorCaja="Se debe seleccionar la caja destino"},$scope.createArqueo=function($event,item){if(13===$event.keyCode||0===$event.keyCode||void 0===$event.keyCode)if(void 0!==$scope.operacion){$scope.apagarBoton=!0;var ajuste=$scope.efectivoAjuste+$scope.chequeAjuste+$scope.creditoAjuste+$scope.debitoAjuste+$scope.dolaresAjuste,numero=$scope.arqueos.length+1,arqueo={caja:item._id,numero:numero,operacion:$scope.operacion,observaciones:$scope.observaciones,efectivo:$scope.efectivo,cheques:$scope.cheques,debito:$scope.debito,credito:$scope.credito,dolares:$scope.dolares,efectivoAjuste:$scope.efectivoAjuste,chequeAjuste:$scope.chequeAjuste,debitoAjuste:$scope.debitoAjuste,creditoAjuste:$scope.creditoAjuste,dolaresAjuste:$scope.dolaresAjuste,ajuste:ajuste,total:$scope.totalCaja,enterprise:user.enterprise._id};Socket.emit("arqueo.create",{data:arqueo,operacion:$scope.operacion}),$mdDialog.hide()}else $scope.errorOperacion="Se debe indicar la operacion"},$scope.addAjuste=function(tipo){"efectivo"==tipo?$scope.efectivo=item.efectivo+$scope.efectivoAjuste:"cheque"==tipo?$scope.cheques=item.cheques+$scope.chequeAjuste:"credito"==tipo?$scope.credito=item.credito+$scope.creditoAjuste:"debito"==tipo?$scope.debito=item.debito+$scope.debitoAjuste:"dolares"==tipo&&($scope.dolares=item.dolares+$scope.dolaresAjuste),$scope.totalCaja=$scope.efectivo+$scope.cheques+$scope.credito+$scope.debito+$scope.dolares}}this.sumingresos=function(id,name,data){this.ingresos[id]||(this.ingresos[id]={});this.ingresos[id][name]||(this.ingresos[id][name]=0);(data.servicios||data.impuestos||data.personal||data.cajaD)&&(this.ingresos[id][name]+=data.montoE+data.montoC+data.montoD+data.montoTD+data.montoTC);data.operacion&&data.ajuste>0?this.ingresos[id][name]+=data.ajuste:"haber"==data.estado?this.ingresos[id][name]+=data.saldoCaja:data.cliente&&"Finalizada"==data.estado&&(this.ingresos[id][name]+=data.total)},this.sumeggresos=function(id,name,data){this.egresos[id]||(this.egresos[id]={});this.egresos[id][name]||(this.egresos[id][name]=0);data.servicios||data.impuestos||data.personal||data.cajaD?this.egresos[id][name]+=data.montoE+data.montoC+data.montoD+data.montoTD+data.montoTC:data.operacion&&data.ajuste<0?this.egresos[id][name]-=data.ajuste:data.cliente&&"Anulada"==data.estado?this.egresos[id][name]+=data.total:data.proveedor?this.egresos[id][name]+=data.total:"debe"==data.estado&&(this.egresos[id][name]+=data.monto)},this.getingressos=function(id){var total=0;for(var item in this.ingresos[id])total+=this.ingresos[id][item];return total},this.getemgressos=function(id){var total=0;for(var item in this.egresos[id])total+=this.egresos[id][item];return-total},this.ingresos={},this.egresos={},this.findUsuarios(cajas),Socket.on("sucursal.update",angular.bind(this,function(message){message.enterprise===this.user.enterprise.enterprise&&(this.cajas=Cajas.query({e:this.user.enterprise.enterprise}).$promise.then(angular.bind(this,function(data){this.findUsuarios(data)})))}))}]),angular.module("sucursales").controller("SucursalesController",["$scope","$rootScope","$stateParams","$location","Authentication","Sucursales","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Sucursales,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var sucursal=new Sucursales({name:this.name,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});sucursal.$save(function(response){response._id&&(sucursal._id=response._id,$rootScope.sucursales.unshift(sucursal))},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(sucursal){if(sucursal)for(var i in sucursal.$remove(),$scope.sucursales)$scope.sucursales[i]===sucursal&&$scope.sucursales.splice(i,1);else $scope.sucursal.$remove(function(){$location.path("sucursales")})},$scope.update=function(){var sucursal=$scope.sucursal;void 0!==this.enterprise?sucursal.enterprise=this.enterprise._id:sucursal.enterprise=sucursal.enterprise._id,sucursal.$update(function(){$location.path("sucursales/view/"+sucursal._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.sucursales=Sucursales.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findOne=function(){$scope.sucursal=Sucursales.get({sucursalId:$stateParams.sucursalId})}}]),angular.module("sucursales").factory("Sucursales",["$resource",function($resource){return $resource("api/sucursales/:sucursalId",{sucursalId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]).factory("ServiceNavigation",["$location",function($location){var inneNavList=[];return{addNav:function(navObj){inneNavList.length>0?-1===inneNavList.map(function(x){return x.name}).indexOf(navObj.name)&&inneNavList.push(navObj):inneNavList.push(navObj);window.localStorage.setItem("subNav",JSON.stringify(inneNavList))},getNav:function(){return inneNavList.length>0?inneNavList:JSON.parse(window.localStorage.getItem("subNav"))},navInit:function(val){"single"!==val?(inneNavList.splice(0),window.localStorage.removeItem("subNav")):inneNavList.splice(0)},back:function(){window.localStorage.getItem("subNav")&&(inneNavList=JSON.parse(window.localStorage.getItem("subNav")),window.localStorage.removeItem("subNav")),inneNavList.splice(inneNavList.length-1,1),window.localStorage.setItem("subNav",JSON.stringify(inneNavList))},unIntended:!1}}]),angular.module("tareas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Tareas",state:"tareas",type:"dropdown"}),Menus.addSubMenuItem("topbar","tareas",{title:"List Tareas",state:"tareas.list"}),Menus.addSubMenuItem("topbar","tareas",{title:"Create Tarea",state:"tareas.create"})}]),angular.module("tareas").config(["$stateProvider",function($stateProvider){$stateProvider.state("tareas",{abstract:!0,url:"/tareas",template:"<ui-view/>"}).state("tareas.list",{url:"",templateUrl:"modules/tareas/views/list-tareas.client.view.html"}).state("tareas.create",{url:"/create",templateUrl:"modules/tareas/views/create-tarea.client.view.html"}).state("tareas.view",{url:"/:tareaId",templateUrl:"modules/tareas/views/view-tarea.client.view.html"}).state("tareas.edit",{url:"/:tareaId/edit",templateUrl:"modules/tareas/views/edit-tarea.client.view.html"})}]),angular.module("tareas").controller("TareasController",["$scope","$stateParams","$location","Authentication","Tareas",function($scope,$stateParams,$location,Authentication,Tareas){$scope.authentication=Authentication,$scope.create=function(){new Tareas({title:this.title,content:this.content}).$save(function(response){$location.path("tareas/"+response._id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(tarea){if(tarea)for(var i in tarea.$remove(),$scope.tareas)$scope.tareas[i]===tarea&&$scope.tareas.splice(i,1);else $scope.tarea.$remove(function(){$location.path("tareas")})},$scope.update=function(){var tarea=$scope.tarea;tarea.$update(function(){$location.path("tareas/"+tarea._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.tareas=Tareas.query()},$scope.findOne=function(){$scope.tarea=Tareas.get({tareaId:$stateParams.tareaId})}}]),angular.module("tareas").factory("Tareas",["$resource",function($resource){return $resource("api/tareas/:tareaId",{tareaId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("taxconditions").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Taxconditions",state:"taxconditions",type:"dropdown"}),Menus.addSubMenuItem("topbar","taxconditions",{title:"List Taxconditions",state:"taxconditions.list"}),Menus.addSubMenuItem("topbar","taxconditions",{title:"Create Taxcondition",state:"taxconditions.create"})}]),angular.module("taxconditions").config(["$stateProvider",function($stateProvider){$stateProvider.state("taxconditions",{abstract:!0,url:"/taxconditions",template:"<ui-view/>"}).state("taxconditions.list",{url:"",templateUrl:"modules/taxconditions/views/list-taxconditions.client.view.html"}).state("taxconditions.create",{url:"/create",templateUrl:"modules/taxconditions/views/create-taxcondition.client.view.html"}).state("taxconditions.view",{url:"/:taxconditionId",templateUrl:"modules/taxconditions/views/view-taxcondition.client.view.html"}).state("taxconditions.edit",{url:"/:taxconditionId/edit",templateUrl:"modules/taxconditions/views/edit-taxcondition.client.view.html"})}]),angular.module("taxconditions").controller("TaxconditionsController",["$scope","$rootScope","$stateParams","$location","Authentication","Taxconditions","Enterprises","$mdBottomSheet","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Taxconditions,Enterprises,$mdBottomSheet,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){var taxcondition=new Taxconditions({name:this.name,taxPercentage:this.taxPercentage,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise});taxcondition.$save(function(response){response._id&&(taxcondition._id=response._id,$rootScope.taxconditions.unshift(taxcondition)),$scope.name="",$scope.taxPercentage="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar Condicion de IVA").content("¿Está seguro que desea eliminar esta condicion de IVA?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(taxcondition){if(taxcondition)for(var i in taxcondition.$remove(),$scope.taxconditions)$scope.taxconditions[i]===taxcondition&&$scope.taxconditions.splice(i,1);else $scope.taxcondition.$remove(function(){$location.path("taxconditions")})},$scope.update=function(){var taxcondition=$scope.taxcondition;void 0!==this.enterprise?taxcondition.enterprise=this.enterprise._id:taxcondition.enterprise=taxcondition.enterprise._id,taxcondition.$update(function(){$location.path("condiciones-impuesto")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findOne=function(){$scope.taxcondition=Taxconditions.get({taxconditionId:$stateParams.taxconditionId})}}]),angular.module("taxconditions").factory("Taxconditions",["$resource",function($resource){return $resource("api/taxconditions/:taxconditionId",{taxconditionId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("transferencias").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Transferencias",state:"transferencias",type:"dropdown"}),Menus.addSubMenuItem("topbar","transferencias",{title:"List Transferencias",state:"transferencias.list"}),Menus.addSubMenuItem("topbar","transferencias",{title:"Create Transferencia",state:"transferencias.create"})}]),angular.module("transferencias").config(["$stateProvider",function($stateProvider){$stateProvider.state("transferencias",{abstract:!0,url:"transferencias",template:"<ui-view/>"}).state("transferencias.list",{url:"",templateUrl:"modules/transferencias/views/list-transferencias.client.view.html"}).state("transferencias.create",{url:"/create",templateUrl:"modules/transferencias/views/create-transferencia.client.view.html"}).state("transferencias.view",{url:"/:transfereciaId",templateUrl:"modules/transferencias/views/view-transferencia.client.view.html"}).state("transferencias.edit",{url:"/:transferenciaId/edit",templateUrl:"modules/transferencias/views/edit-transferencia.client.view.html"})}]),angular.module("transferencias").controller("CreateTransferenciasController",["user","transferencia","enterprises","$state","transferencias",function(user,transferencia,enterprises,$state,transferencias){this.user=user,this.transferencia=transferencia,this.enterprises=enterprises,this.create=function(){new transferencias({name:this.name,enterprise:this.enterprise?this.enterprise._id:this.user.enterprise._id}).$save(function(response){response._id&&$state.go("home.transferencias")},function(errorResponse){this.error=errorResponse.data.message})}}]),angular.module("transferencias").controller("EditTransferenciasController",["user","transferencia","enterprises","modosFacturacion","$location",function(user,transferencia,enterprises,modosFacturacion,$location){this.user=user,this.transferencia=transferencia,this.enterprises=enterprises,this.modosFacturacion=modosFacturacion,this.update=function(){var transferencia=this.transferencia;void 0!==this.enterprise?transferencia.enterprise=this.enterprise._id:transferencia.enterprise=transferencia.enterprise._id;void 0!==this.modoFacturacion?transferencia.modoFacturacion=this.modoFacturacion:transferencia.modoFacturacion=comprobante.modoFacturacion}}]),angular.module("transferencias").controller("ListTransferenciasController",["$location","user","transferencias","enterprises","$mdDialog",function($location,user,transferencias,enterprises,$mdDialog){this.user=user,this.transferencias=transferencias,this.enterprises=enterprises,this.remove=function(transferencia){transferencia?transferencia.$remove():this.transferencia.$remove(function(){$location.path("transferencias")})}}]),angular.module("transferencias").controller("ViewTransferenciaController",["user","transferencia",function(user,transferencia){this.user=user,this.transferencia=transferencia}]),angular.module("transferencias").controller("TransferenciasController",["$scope","$rootScope","$stateParams","$location","Authentication","Comprobantes","$mdBottomSheet","Enterprises","$mdDialog",function($scope,$rootScope,$stateParams,$location,Authentication,Comprobantes,$mdBottomSheet,Enterprises,$mdDialog){$scope.authentication=Authentication,$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},$scope.find()}),$scope.create=function(){new Transferencias({name:this.name,letra:this.letra,puntoDeVenta:this.puntoDeVenta,modoFacturacion:this.modo,movimientoStock:this.movimientoStock,movimientoCC:this.movimientoCC,movimientoOperacionInversa:this.movimientoOperacionInversa,funcionalidadSituacion:this.funcionalidadSituacion,autoAprobar:this.autoAprobar,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise}).$save(function(response){response._id&&(transferencias._id=response._id,$rootScope.transferencias.unshift(transferencias)),$scope.name="",$scope.letra="",$scope.puntoDeVenta="",$scope.modoFacturacion="",$mdBottomSheet.hide()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.showConfirm=function(ev,item){var confirm=$mdDialog.confirm().title("Eliminar tipo de Comprobante").content("¿Está seguro que desea eliminar este tipo de Comprobante?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.remove(item)},function(){console.log("cancelaste borrar")})},$scope.remove=function(transferencias){if(transferencias)for(var i in transferencias.$remove(),$scope.transferencias)$scope.transferencias[i]===transferencias&&$scope.transferencias.splice(i,1);else $scope.transferencias.$remove(function(){$location.path("transferencias")})},$scope.update=function(){var transferencias=$scope.transferencias;void 0!==this.enterprise?transferencias.enterprise=this.enterprise._id:transferencias.enterprise=transferencias.enterprise._id,transferencias.$update(function(){$location.path("transferencias/view/"+transferencias._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){void 0!==$scope.SEARCH&&($rootScope.transferencias=Transferencias.query({e:$scope.SEARCH.enterprise}))},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findModosF=function(){void 0!==$scope.SEARCH&&($scope.modosF=["Comprobante interno","Talonario fiscal manual o pre-impreso","Factura electronica"])},$scope.findOne=function(){$scope.transferencia=Transferencias.get({transferenciaId:$stateParams.transferenciaId})}}]),angular.module("transferencias").factory("Transferencias",["$resource",function($resource){return $resource("api/transferencias/:transferenciaId",{transferenciaId:"@_id",e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("transferencias").factory("TransferenciasExtra",["$http",function($http){return{loadMore:function(enterprise,pagina,limit,cajaId){return $http({method:"get",url:"/api/transferencias/loadmorebycaja",params:{e:enterprise,caja:cajaId,pagina:pagina,limit:limit}})},loadMoreByDate:function(enterprise,startdate,enddate,cajaId){return $http({method:"get",url:"/api/transferencias/loadmorebycaja_date",params:{e:enterprise,caja:cajaId,start:startdate,end:enddate}})}}}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin")}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("settings",{abstract:!0,url:"/settings",templateUrl:"modules/users/views/settings/settings.client.view.html"}).state("settings.profile",{url:"/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("settings.password",{url:"/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("settings.accounts",{url:"/accounts",templateUrl:"modules/users/views/settings/manage-social-accounts.client.view.html"}).state("settings.picture",{url:"/picture",templateUrl:"modules/users/views/settings/change-profile-picture.client.view.html"}).state("authentication",{abstract:!0,url:"/authentication",templateUrl:"modules/users/views/authentication/authentication.client.view.html"}).state("authentication.signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("authentication.signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("password",{abstract:!0,url:"/password",template:"<ui-view/>"}).state("password.forgot",{url:"/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("password.reset",{abstract:!0,url:"/reset",template:"<ui-view/>"}).state("password.reset.invalid",{url:"/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("password.reset.success",{url:"/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("password.reset.form",{url:"/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication","$state",function($scope,$http,$location,Authentication,$state){$scope.authentication=Authentication,$scope.authentication.user&&"cliente"!==$scope.authentication.user.roles[0]&&$location.path("/welcome"),$scope.authentication.user&&"cliente"===$scope.authentication.user.roles[0]&&$state.go("home.createPedido",{tipo:"venta"}),$scope.signup=function(){console.log($scope.credentials),$http.post("/api/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,console.log(response),"cliente"!==response.roles[0]?$location.path("/welcome"):$state.go("home.createPedido",{tipo:"venta"})}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/api/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,"cliente"!==response.roles[0]?$location.path("/welcome"):$state.go("home.createPedido",{tipo:"venta"})}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/api/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/api/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){isValid?($scope.success=$scope.error=null,new Users($scope.user).$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})):$scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("ChangePasswordController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("ChangeProfilePictureController",["$scope","$timeout","$window","Authentication","FileUploader",function($scope,$timeout,$window,Authentication,FileUploader){$scope.user=Authentication.user,$scope.imageURL=$scope.user.profileImageURL,$scope.uploader=new FileUploader({url:"api/users/picture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,$scope.user=Authentication.user=response,$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){console.log("image upload fired!"),$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.user.profileImageURL}}]),angular.module("users").controller("EditProfileController",["$scope","$http","$location","Users","Authentication","$q",function($scope,$http,$location,Users,Authentication,$q){$scope.user=Authentication.user,$scope.updateUserProfile=function(isValid){isValid?($scope.success=$scope.error=null,new Users($scope.user).$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})):$scope.submitted=!0},$scope.findOne=function(){console.log($stateParams)}}]).controller("EditUserController",["$scope","$http","$location","Users","Authentication","$stateParams","Puestos","$rootScope","$timeout","$q",function($scope,$http,$location,Users,Authentication,$stateParams,Puestos,$rootScope,$timeout,$q){$scope.roles=["user","admin","rrhh","compras","ventas","produccion","cliente"],$scope.editadoOk=!1,$scope.selectedMode="md-scale",$scope.selectedDirection="up",$scope.updateUserProfile=function(){$scope.success=$scope.error=null;var user=new Users($scope.user);void 0!==this.puesto?user.puesto=this.puesto._id:void 0!==user.puesto&&null!==user.puesto&&(user.puesto=user.puesto._id),void 0!==this.rol?user.roles[0]=this.rol:void 0!==user.roles[0]&&null!==user.roles[0]&&(user.roles[0]=user.roles[0]),user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})},$scope.asignarUsuario=function(){Users.query({},function(res){$scope.users=res;for(var i=0;i<$scope.users.length;i++)$scope.users[i]._id===$stateParams.personaId&&($scope.user=$scope.users[i])})},$scope.editarPuesto=function(){if(void 0!==$scope.puesto&&null!==$scope.puesto)var nuevoPuesto=$scope.puesto._id;else if(null!==$scope.user.puesto&&void 0!==$scope.user.puesto)nuevoPuesto=$scope.user.puesto._id;else nuevoPuesto=void 0;if(void 0===$scope.rol)var nuevoRol=$scope.user.roles[0];else nuevoRol=$scope.rol;if(null!==$scope.user.observaciones&&void 0!==$scope.user.observaciones)var nuevaObservacion=$scope.user.observaciones;else nuevaObservacion=void 0;$http({method:"POST",url:"/api/users/changePuesto",params:{userId:$stateParams.personaId,puestoId:nuevoPuesto,rol:nuevoRol,obs:nuevaObservacion}}).then(function(response){$scope.user.observaciones=nuevaObservacion,$scope.user.puesto=nuevoPuesto,$scope.user.roles[0]=nuevoRol,$scope.modoEdicion=!1,$scope.editadoOk=!0,$timeout(function(){$scope.editadoOk=!1},4e3)},function(response){console.log("error")})},$scope.findPuestos=function(){void 0!==$scope.SEARCH&&($rootScope.puestos=Puestos.query({e:$scope.SEARCH.enterprise}))}}]),angular.module("users").controller("SocialAccountsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/api/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication","$mdSidenav","$q",function($scope,$http,$location,Users,Authentication,$mdSidenav,$q){$scope.user=Authentication.user,$scope.toggleList=function(){$q.when(!0).then(function(){$mdSidenav("left").toggle()})},$scope.user||$location.path("/")}]),angular.module("users").factory("Authentication",[function(){return this._data={user:window.user},this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("api/users",{e:"@enterprise"},{update:{method:"PUT"}})}]),angular.module("users").factory("ChangeStatusUserById",["$resource",function($resource){return $resource("/api/users/changeStatus",{userId:"@_id",estado:"@_estado"},{update:{method:"PUT"}})}]),angular.module("users").factory("FindUserById",["$resource",function($resource){return $resource("/api/users/byId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("ventas").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Ventas",state:"ventas",type:"dropdown"}),Menus.addSubMenuItem("topbar","ventas",{title:"List Ventas",state:"ventas.list"}),Menus.addSubMenuItem("topbar","ventas",{title:"Create Venta",state:"ventas.create"})}]),angular.module("ventas").config(["$stateProvider",function($stateProvider){$stateProvider.state("ventas",{abstract:!0,url:"/ventas",template:"<ui-view/>"}).state("ventas.list",{url:"",templateUrl:"modules/ventas/views/list-ventas.client.view.html"}).state("ventas.create",{url:"/create",templateUrl:"modules/ventas/views/create-venta.client.view.html"}).state("ventas.view",{url:"/:ventaId",templateUrl:"modules/ventas/views/view-venta.client.view.html"}).state("ventas.edit",{url:"/:ventaId/edit",templateUrl:"modules/ventas/views/edit-venta.client.view.html"}).state("ventas.mostrador",{url:"/mostrador",templateUrl:"modules/ventas/views/ventas-mostrador.client.view.html"})}]),angular.module("ventas").controller("ListVentasController",["$scope","$state","$http","$stateParams","$location","user","$rootScope","$mdBottomSheet","$mdDialog","$q","$filter","Ventas","Socket","BottomSheetService","VentasExtra",function($scope,$state,$http,$stateParams,$location,user,$rootScope,$mdBottomSheet,$mdDialog,$q,$filter,Ventas,Socket,BottomSheetService,VentasExtra){switch(DialogController.$inject=["$scope","$mdDialog","item","Ventas","Socket","Cajas"],$scope.tabParams=$state.params.tab,$state.params.tab){case"realizada":$scope.realizada=!0;break;case"proceso":$scope.proceso=!0;break;case"finalizada":$scope.finalizada=!0;break;case"anulada":$scope.anulada=!0;default:$scope.realizada=!0}var cambio=this;function showAdvanced(ev,item){console.log(item),$mdDialog.show({controller:DialogController,templateUrl:"/modules/ventas/views/modal.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})}function showAdvancedFinalizar(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/ventas/views/modalAprobar.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})}function showConfirmAnular(ev,item){var confirm=$mdDialog.confirm().title("Anular Venta").content("¿Está seguro que desea anular esta venta?").ariaLabel("Lucky day").ok("Aceptar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(angular.bind(this,function(){cambio.cambiarEstadoVenta("Anulada",item)}),function(){console.log("cancelaste anular")})}function extraerVenta(item){(function(item){var deferred=$q.defer();return $scope.venta=item,setTimeout(function(){void 0!==$scope.venta?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})(item).then(angular.bind(this,function(response){cambio.printIt()}))}function DialogController($scope,$mdDialog,item,Ventas,Socket,Cajas){function updateVenta(venta,estado){venta.estado=estado,venta.enterprise=venta.enterprise._id,venta.tipoComprobante=venta.tipoComprobante._id,venta.cliente&&venta.cliente._id&&(venta.cliente=venta.cliente._id),venta.category1&&venta.category1._id&&(venta.category1=venta.category1._id),venta.condicionVenta=venta.condicionVenta._id,void 0!==venta.caja&&(venta.caja=venta.caja._id),$mdDialog.hide(),Socket.emit("venta.update",venta)}$scope.item=item,$scope.seleccionCaja=!1,$scope.findCajas=function(){$scope.cajas=[],Cajas.query({e:item.enterprise._id},function(foundCaja){foundCaja.forEach(function(entry){!1===entry.deleted&&$scope.cajas.push(entry)}),1===$scope.cajas.length&&($scope.caja=$scope.cajas[0])})},$scope.findCajas(),$scope.finalizarVenta=function(item){"Cuenta Corriente"!==item.condicionVenta.name?void 0!==this.caja?(item.caja=this.caja,updateVenta(item,"Finalizada")):$scope.errorCaja="Debe seleccionar la caja":(item.caja=void 0,updateVenta(item,"Finalizada"))},$scope.montoTotal=function(){console.log("mototoal?????"),Ventas.query({e:$scope.item.enterprise},function(){for(var i in $scope.$parent.ventas)"Pendiente de pago y entrega"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.$parent.totalPendientesPA=$scope.$parent.totalPendientesPA+$scope.ventas[i].total),"Pendiente de pago2"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.$parent.totalPendientesPago=$scope.$parent.totalPendientesPago+$scope.ventas[i].total),"Pendiente de entrega"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.$parent.totalPendientesEntrega=$scope.$parent.totalPendientesEntrega+$scope.ventas[i].total),"Finalizada"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.$parent.totalFinalizadas=$scope.$parent.totalFinalizadas+$scope.ventas[i].total,$scope.$parent.ventasFinalizadas.push($scope.ventas[i])),"Anulada"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.$parent.totalAnuladas=$scope.$parent.totalAnuladas+$scope.ventas[i].total)})},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.habilitoCaja=function(n){$scope.seleccionCaja=n},$scope.actualizarVenta=function(data){var venta=$scope.item;if("pagado"===data)var estado="Pendiente de entrega";if("entregado"===data)estado="Pendiente de pago2";if("pYa"===data)estado="Finalizada";venta.estado=estado,venta.enterprise=venta.enterprise._id,void 0!==venta.tipoComprobante&&(venta.tipoComprobante=venta.tipoComprobante._id),venta.cliente=venta.cliente._id,venta.condicionVenta=venta.condicionVenta._id,$mdDialog.hide(),Socket.emit("venta.update",venta)}}this.user=user,this.ventasPendientes=[],this.ventasPendientesPago=[],this.ventasPendientesEntrega=[],this.ventasFinalizadas=[],this.ventasAnuladas=[],this.verVentasFecha=!1,this.totalPendientesPA=0,this.totalPendientesPago=0,this.totalPendientesEntrega=0,this.totalFinalizadas=0,this.totalAnuladas=0,this.theDate=new Date,this.currentPage=0,this.ventasFinalizadas=[],this.arrayFechas=[],this.fechasFiltro=[],this.mostrarDetalle=function(i){!1===this.verVentasFecha?this.verVentasFecha=!0:this.verVentasFecha=!1},this.showAdvanced=showAdvanced,this.showAdvancedFinalizar=showAdvancedFinalizar,this.showConfirmAnular=showConfirmAnular,this.showConfirmEntrega=function(ev,item){var confirm=$mdDialog.confirm().title("Finalizar venta").content("¿Está seguro que desea finalizar esta venta?").ariaLabel("Lucky day").ok("Aceptar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(angular.bind(this,function(){cambio.cambiarEstadoVenta("Finalizada",item)}),function(){console.log("cancelaste cerrar")})},this.showConfirmPago=function(ev,item){var confirm=$mdDialog.confirm().title("Pagar venta").content("¿Está seguro que desea pagar esta venta?").ariaLabel("Lucky day").ok("Aceptar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(angular.bind(this,function(){cambio.cambiarEstadoVenta("Finalizada",item)}),function(){console.log("cancelaste cerrar")})},this.cambiarEstadoVenta=function(estado,v){var venta=v;venta.estado=estado,void 0!==this.enterprise?venta.enterprise=this.enterprise._id:venta.enterprise=venta.enterprise._id;void 0!==this.tipoComprobante?venta.tipoComprobante=this.tipoComprobante._id:void 0!==venta.tipoComprobante&&null!==venta.tipoComprobante&&(venta.tipoComprobante=venta.tipoComprobante._id);void 0!==venta.cliente&&null!==venta.cliente?venta.cliente=venta.cliente._id:void 0!==this.client&&(venta.cliente=this.client._id);void 0!==this.condicionVenta?venta.condicionVenta=this.condicionVenta._id:void 0!==venta.condicionVenta&&null!==venta.condicionVenta&&(venta.condicionVenta=venta.condicionVenta._id);Socket.emit("venta.update",venta)},this.extraerVenta=extraerVenta,this.printIt=function(){var a=(theUrl="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css",xmlHttp=null,(xmlHttp=new XMLHttpRequest).open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText),b=document.getElementById("printing-css-venta").value,c=document.getElementById("printing-data-venta").innerHTML;var theUrl,xmlHttp;window.frames.print_frame_venta.document.title="IM - Venta",window.frames.print_frame_venta.document.body.innerHTML="<style>"+a+b+"</style>"+c,window.frames.print_frame_venta.window.focus(),window.frames.print_frame_venta.window.print()},this.refresh=function(){this.ventasPendientes=Ventas.query({e:this.user.enterprise.enterprise,estado:"Pendiente de pago y entrega",p:0,pcount:20}),this.ventasPendientesPago=Ventas.query({e:this.user.enterprise.enterprise,estado:"Pendiente de pago2",p:0,pcount:20}),this.ventasPendientesEntrega=Ventas.query({e:this.user.enterprise.enterprise,estado:"Pendiente de entrega",p:0,pcount:20}),this.ventasFinalizadas=Ventas.query({e:this.user.enterprise.enterprise,estado:"Finalizada",p:0,pcount:20}),this.ventasAnuladas=Ventas.query({e:this.user.enterprise.enterprise,estado:"Anulada",p:0,pcount:20})},this.borrarVenta=function(venta){if(venta.$remove(),"Finalizada"==venta.estado)for(var i in ventasFinalizadas)ventasFinalizadas[i]===venta&&ventasFinalizadas.splice(i,1);else for(var i in ventasAnuladas)ventasAnuladas[i]===venta&&ventasAnuladas.splice(i,1)},this.showBottomSheetRealizada=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"edit",label:"Estado",icon:"call_made"},{name:"remove",label:"Anular",icon:"remove_circle"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"edit":showAdvanced($event,item);break;case"view":$state.go("home.viewVenta",{ventaId:item._id});break;case"remove":showConfirmAnular($event,item);break;case"print":extraerVenta(item);break;default:console.log("something went wrong")}})},this.showBottomSheetProceso=function($event,item){BottomSheetService.sheet($event,[{name:"finalize",label:"Finalizar",icon:"done"},{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Anular",icon:"close"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"finalize":showAdvancedFinalizar($event,item);break;case"view":$state.go("home.viewVenta",{ventaId:item._id});break;case"remove":showConfirmAnular($event,item);break;case"print":extraerVenta(item);break;default:console.log("something went wrong")}})},this.showBottomSheetFinalizada=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"remove",label:"Eliminar",icon:"remove_circle"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"view":$state.go("home.viewVenta",{ventaId:item._id});break;case"remove":showConfirmAnular($event,item);break;case"print":extraerVenta(item);break;default:console.log("something went wrong")}})},this.showBottomSheetAnulada=function($event,item){BottomSheetService.sheet($event,[{name:"view",label:"Ver",icon:"visibility"},{name:"print",label:"Imprimir",icon:"print"}],function(err,clicked){if(err)return console.log("canceled",err);switch(clicked){case"view":$state.go("home.viewVenta",{ventaId:item._id});break;case"print":extraerVenta(item);break;default:console.log("something went wrong")}})},this.startReal=!0,this.startFinal=!0,this.startProcess=!0,this.startCancel=!0,this.validate=function(item){return console.log(user.roles[0]),console.log(user.centroDeCosto),console.log(item.user.centroDeCosto),"user"!=user.roles[0]||user.centroDeCosto==item.user.centroDeCosto},this.loadmoreReal=function(){cambio.loadingReal=!0,cambio.startReal=!1,VentasExtra.loadMore(cambio.user.enterprise.enterprise,"Pendiente de pago y entrega",cambio.ventasPendientes.length?cambio.ventasPendientes[cambio.ventasPendientes.length-1].created:null,cambio.ventasPendientes.length<40?40:20).then(angular.bind(cambio,function(data){console.log(data.data),cambio.ventasPendientes=cambio.ventasPendientes.concat(data.data),cambio.loadingReal=!1,cambio.startFinal=!1,0===data.data.length&&(cambio.doneReal=!0)}))},this.loadmoreFinal=function(){cambio.loadingFinal=!0,VentasExtra.loadMore(cambio.user.enterprise.enterprise,"Finalizada",cambio.ventasFinalizadas.length?cambio.ventasFinalizadas[cambio.ventasFinalizadas.length-1].created:null,cambio.ventasFinalizadas.length<40?40:20).then(angular.bind(cambio,function(data){cambio.ventasFinalizadas=cambio.ventasFinalizadas.concat(data.data),cambio.loadingFinal=!1,cambio.startFinal=!1,0===data.data.length&&(cambio.doneFinal=!0)}))},this.loadmoreProcess=function(){cambio.loadingProcess=!0,VentasExtra.loadMore(cambio.user.enterprise.enterprise,"Pendiente de entrega",cambio.ventasPendientesEntrega.length?cambio.ventasPendientesEntrega[cambio.ventasPendientesEntrega.length-1].created:null,cambio.ventasPendientesEntrega.length<40?40:20).then(angular.bind(cambio,function(data){cambio.ventasPendientesEntrega=cambio.ventasPendientesEntrega.concat(data.data),cambio.loadingProcess=!1,cambio.startProcess=!1,0===data.data.length&&(cambio.doneProcess=!0)}))},this.loadmoreCancel=function(){cambio.loadingCancel=!0,VentasExtra.loadMore(this.user.enterprise.enterprise,"Anulada",this.ventasAnuladas.length?this.ventasAnuladas[this.ventasAnuladas.length-1].created:null,this.ventasAnuladas.length<40?40:20).then(angular.bind(this,function(data){cambio.ventasAnuladas=cambio.ventasAnuladas.concat(data.data),cambio.loadingCancel=!1,cambio.startCancel=!1,0===data.data.length&&(cambio.doneCancel=!0)}))},Socket.on("ventas.update",angular.bind(this,function(message){message.enterprise===this.user.enterprise.enterprise&&("Finalizada"===message.estado&&$http.post("/api/impuestos/updateTotal",{month:(new Date).getMonth(),year:(new Date).getFullYear()}),this.refresh())}))}]),angular.module("ventas").controller("VentasMostradorController",["$scope","$rootScope","$state","$http","$filter","$q","Authentication","Cajas","Categories","Condicionventas","Enterprises","Modal","Ventas","user","$mdDialog",function($scope,$rootScope,$state,$http,$filter,$q,Authentication,Cajas,Categories,Condicionventas,Enterprises,Modal,Ventas,user,$mdDialog){DialogController.$inject=["$scope","$mdDialog","$state","item","productosDeVenta","calcularTotales"],$scope.authentication=Authentication,$scope.impuesto=!1,$scope.$watchCollection("authentication",function(){$scope.find(),$scope.findCategories(),$scope.findProducts(),$scope.findClients(),$scope.findCajas(),Condicionventas.query({e:$scope.user.enterprise.enterprise},function(res){$scope.condicionVentas=res,Modal.setCondicionesVentas($scope.condicionVentas)}),$scope.findComprobantes()}),$scope.$watchCollection("condicionVenta",function(){$scope.condicionVenta&&$scope.verCondicionVenta($scope.condicionVenta),console.log($scope.condicionVenta)});var global=this;this.productList=[],this.itemList={},this.total=0,this.unit={},$scope.user=user,$scope.elegirCaja=!0,$scope.tax1=[],$scope.tax2=[],$scope.tax3=[],$scope.productosDeVenta=[],$scope.descuento_porcentaje=0,$scope.descuento_valor=0,$scope.vistaTotal=0,$scope.vistaSubtotal=0,$scope.vistaNeto=0,$scope.vistaTax1=0,$scope.vistaTax2=0,$scope.vistaTax3=0,$scope.botonApagado=!1,$scope.mensajeSinVentas=!1,$scope.mostrarUltimaVenta=!1,$scope.minLengthClient=0;var created=new Date;function DialogController($scope,$mdDialog,$state,item,productosDeVenta,calcularTotales){$scope.item=item,$scope.countvalue=0,$scope.productosDeVenta=productosDeVenta,$scope.calcularTotales=calcularTotales,$scope.closeDialog=function(){$mdDialog.hide()},$scope.createventas=function($event,item){if(global.itemList.hasOwnProperty(item.name)){global.itemList[item.name]+=$scope.countvalue;for(var i=0;i<$scope.productosDeVenta.length;i++)if($scope.productosDeVenta[i].item.name===item.name){$scope.productosDeVenta.splice(i,1);break}}else global.itemList[item.name]=$scope.countvalue;$scope.mensajeProd=void 0,$scope.productosDeVenta.push({product:item,cantidad:global.itemList[item.name],total:parseFloat(global.itemList[item.name])*parseFloat(item.price)}),$scope.calcularTotales(),$mdDialog.hide(),global.total=global.total+parseFloat(item.price)*$scope.countvalue}}function n_with_zeroes(number,length){for(var my_string=""+number;my_string.length<length;)my_string="0"+my_string;return my_string}function createVenta(venta){var item;item=venta,$http({method:"POST",url:"/api/ventas/print/",data:{storeName:user.storeName,orden:item}}),venta.user=$scope.authentication.user._id,venta.$save(function(response){response._id&&($scope.find(),$scope.ventas.push(venta)),$state.go($state.current,{},{reload:!0}),$scope.name="",$scope.producto=""},function(errorResponse){console.log("errorResponse",errorResponse)}),$scope.clicked=!1}$scope.created=new Date(created.setTime(created.getTime()+108e5)),$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findProducts=function(){(global.productList=[],$scope.client)&&$http({method:"GET",url:"/api/products/mostrador/",params:{e:$scope.user.enterprise.enterprise,c:$scope.client.category1.category}}).then(function(response){for(var p=0;p<response.data.length;p++){response.data[p].price=0;for(var m=0;m<response.data[p].catPrice.length;m++)response.data[p].catPrice[m].category==$scope.client.category1.category&&(response.data[p].price=response.data[p].catPrice[m].price);global.productList[response.data[p].category2.name]?global.productList[response.data[p].category2.name].push(response.data[p]):(global.productList[response.data[p].category2.name]=[],global.productList[response.data[p].category2.name].push(response.data[p]))}})},$scope.findComprobantes=function(){$http({method:"GET",url:"/api/comprobantes/mostrador/",params:{e:$scope.user.enterprise.enterprise,exclude:"Pedido"}}).then(function(response){$scope.comprobantes=response.data,Modal.setComprobantes($scope.comprobantes)})},$scope.findCategories=function(){$http({method:"GET",url:"/api/categories/mostrador/",params:{e:$scope.user.enterprise.enterprise}}).then(function(response){$scope.categories=response.data,console.log($scope.categories)})},$scope.findCategories2=function(){Categories.query({e:$scope.user.enterprise.enterprise},function(data){$scope.categories2=$filter("filter")(data,function(item){return"Tipo de Venta"===item.type1}),Modal.setCategorias($scope.categories2)})},$scope.findClients=function(){$http({method:"GET",url:"/api/clients",params:{e:$scope.user.enterprise.enterprise}}).then(function(response){$scope.clients=response.data;for(var i=0;i<$scope.clients.length;i++)"Consumidor Final"===$scope.clients[i].name&&($scope.client=$scope.clients[i])})},$scope.findCajas=function(){$scope.cajas=[],Cajas.query({e:$scope.user.enterprise.enterprise},function(foundCaja){foundCaja.forEach(function(entry){!1===entry.deleted&&$scope.cajas.push(entry),entry.puestos.length>0&&entry.puestos.map(puesto=>puesto._id).includes(user.puesto)&&($scope.caja=entry)}),1===$scope.cajas.length&&($scope.caja=$scope.cajas[0])})},$scope.find=function(){$rootScope.nuevoCliente=void 0,function(){$scope.ventas=Ventas.query({e:$scope.user.enterprise.enterprise});var deferred=$q.defer();setTimeout(function(){void 0!==$scope.ventas?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise}()},$scope.searchTextChangeClients=function(text){return $filter("filter")($scope.clients,{name:angular.lowercase(text)})},$scope.selectedItemChange=function(item){if($scope.mensajeCli=void 0,$scope.client=item,$scope.ultimaVenta=[],$scope.productosDeVenta=[],global.itemList={},$scope.calcularTotales(),$scope.mensajeSinVentas=!1,void 0!==$scope.client&&null!==$scope.client){void 0!==$scope.client.condicionPago&&null!==$scope.client.condicionPago&&$http({method:"GET",url:"/api/condicionventas",params:{e:$scope.user.enterprise.enterprise}}).then(function(response){$scope.condicionVentas=response.data;for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==$scope.client.condicionPago._id&&null!==$scope.client.condicionPago._id&&$scope.condicionVentas[i]._id==$scope.client.condicionPago._id?$scope.condicionVenta=$scope.condicionVentas[i]:$scope.condicionVentas[i]._id==$scope.client.condicionPago&&($scope.condicionVenta=$scope.condicionVentas[i])}),void 0!==$scope.client.comprobante&&null!==$scope.client.comprobante&&$http({method:"GET",url:"/api/comprobantes",params:{e:$scope.user.enterprise.enterprise}}).then(function(response){$scope.comprobantes=response.data;for(var i=0;i<$scope.comprobantes.length;i++)void 0!==$scope.client.comprobante._id&&null!==$scope.client.comprobante._id&&$scope.comprobantes[i]._id==$scope.client.comprobante._id?($scope.tipoComprobante=$scope.comprobantes[i],$scope.actualizarN()):$scope.comprobantes[i]._id==$scope.client.comprobante&&($scope.tipoComprobante=$scope.comprobantes[i],$scope.actualizarN())}),$scope.findProducts(),$scope.mostrarUltimaVenta=!0}},$scope.sendClient=function($event,client){13===$event.keyCode&&($event.preventDefault(),null===client||void 0===client?$scope.mensajeC="No seleccionaste un cliente valido":($scope.client=client,console.log("todo ok: ",client)))},$scope.addToList=function(product){if(global.unit[product.name]=product.metric,"U."==product.metric){if(global.itemList.hasOwnProperty(product.name)){global.itemList[product.name]+=1;for(var i=0;i<$scope.productosDeVenta.length;i++)if($scope.productosDeVenta[i].product.name===product.name){$scope.productosDeVenta.splice(i,1);break}}else global.itemList[product.name]=1;$scope.mensajeProd=void 0,$scope.productosDeVenta.push({product:product,cantidad:global.itemList[product.name],total:parseFloat(global.itemList[product.name])*parseFloat(product.price)}),$scope.calcularTotales(),global.total=global.total+parseFloat(product.price)}else $mdDialog.show({targetEvent:document.querySelector("body"),templateUrl:"modules/ventas/views/model.quantity.select.html",locals:{item:product,productosDeVenta:$scope.productosDeVenta,calcularTotales:$scope.calcularTotales},controller:DialogController})},$scope.removeFromList=function(productName){var product=null;if(global.itemList.hasOwnProperty(productName)){for(var i=0;i<$scope.productosDeVenta.length;i++)if($scope.productosDeVenta[i].product.name===productName){product=$scope.productosDeVenta[i].product,$scope.productosDeVenta.splice(i,1);break}global.itemList[productName]>1?(global.itemList[productName]-=1,$scope.productosDeVenta.push({product:product,cantidad:global.itemList[productName],total:parseFloat(global.itemList[productName])*parseFloat(product.price)})):delete global.itemList[productName],global.total=global.total-parseFloat(product.price),$scope.vistaNeto=global.total}},$scope.roundTotal=function(num){return parseInt(100*num)/100},$scope.verCondicionVenta=function(c){$scope.mensajeCond=void 0,"Cuenta Corriente"==c.name?($scope.elegirCaja=!1,$scope.caja=void 0):$scope.elegirCaja=!0},$scope.actualizarN=function(){$scope.letra_comprobante=$scope.tipoComprobante.letra,$scope.puntoVenta_comprobante=n_with_zeroes(parseInt($scope.tipoComprobante.puntoDeVenta),4),$scope.comprobante=n_with_zeroes(parseInt($scope.tipoComprobante.ultimoNumero)+1,8),$scope.mensajeTipoC=void 0;var comprobante=$scope.tipoComprobante.name;$scope.impuesto="Factura A"==comprobante||"Factura B"==comprobante||"Factura C"==comprobante},$scope.calcularTotales=function(){var i,sub=0,totTax1=0,totTax2=0,totTax3=0;for($scope.tax1=[],$scope.tax2=[],$scope.tax3=[],i=0;i<$scope.productosDeVenta.length;i++){void 0===$scope.productosDeVenta[i].descuento&&($scope.productosDeVenta[i].descuento=0);var desc=parseFloat($scope.productosDeVenta[i].descuento)*$scope.productosDeVenta[i].product.price/100,finalPrice=$scope.productosDeVenta[i].product.price-desc,additionalIva=parseFloat(1-1/(1+$scope.productosDeVenta[i].product.tax/100))*parseFloat(finalPrice);10.5===parseFloat($scope.productosDeVenta[i].product.tax)&&$scope.tax1.push(additionalIva*parseFloat($scope.productosDeVenta[i].cantidad)),21===parseFloat($scope.productosDeVenta[i].product.tax)&&$scope.tax2.push(additionalIva*parseFloat($scope.productosDeVenta[i].cantidad)),27===parseFloat($scope.productosDeVenta[i].product.tax)&&$scope.tax3.push(additionalIva*parseFloat($scope.productosDeVenta[i].cantidad)),sub+=parseFloat($scope.productosDeVenta[i].cantidad)*finalPrice}if($scope.tax1.length>0)for(i=0;i<$scope.tax1.length;i++)totTax1+=parseFloat($scope.tax1[i]);if($scope.tax2.length>0)for(i=0;i<$scope.tax2.length;i++)totTax2+=parseFloat($scope.tax2[i]);if($scope.tax3.length>0)for(i=0;i<$scope.tax3.length;i++)totTax3+=parseFloat($scope.tax3[i]);$scope.vistaSubtotal=sub;var d=$scope.descuento_porcentaje*$scope.vistaSubtotal/100;$scope.descuento_valor=d,$scope.vistaNeto=$scope.vistaSubtotal-d,$scope.vistaTax1=totTax1,$scope.vistaTax2=totTax2,$scope.vistaTax3=totTax3,$scope.vistaTotal=$scope.vistaNeto},$scope.clickSubmit=function(){$scope.botonApagado=!0,$scope.clicked=!0,$scope.create()},$scope.create=function(){if(!0===$scope.clicked)if(0!==$scope.productosDeVenta.length)if(void 0!==$scope.client&&""!==$scope.client&&null!==$scope.client)if(void 0!==$scope.tipoComprobante&&""!==$scope.tipoComprobante)if(void 0!==$scope.condicionVenta&&""!==$scope.condicionVenta){var totalTax=$scope.vistaTax1+$scope.vistaTax2+$scope.vistaTax3,total=$scope.vistaNeto;"Cuenta Corriente"==$scope.condicionVenta.name?($scope.mensajeError=void 0,$scope.calcularTotales(),createVenta(new Ventas({created:$scope.created,caja:void 0,tipoComprobante:this.tipoComprobante,comprobante:this.comprobante,enterprise:this.enterprise?this.enterprise._id:$scope.user.enterprise.enterprise,puesto:$scope.authentication.user.puesto,category1:this.category1?this.category1._id:void 0,cliente:$scope.client,impuesto:$scope.impuesto,condicionVenta:this.condicionVenta,products:$scope.productosDeVenta,subtotal:$scope.vistaSubtotal,descuentoPorcentaje:this.descuento_porcentaje,descuentoValor:$scope.vistaSubtotal*this.descuento_porcentaje/100,neto:$scope.vistaNeto,tax1:$scope.vistaTax1,tax2:$scope.vistaTax2,tax3:$scope.vistaTax3,totalTax:totalTax,total:total}))):void 0!==$scope.caja&&""!==$scope.caja?($scope.mensajeError=void 0,$scope.calcularTotales(),createVenta(new Ventas({created:$scope.created,caja:this.caja,tipoComprobante:this.tipoComprobante,comprobante:this.comprobante,enterprise:this.enterprise?this.enterprise._id:$scope.user.enterprise.enterprise,category1:this.category1?this.category1._id:void 0,puesto:$scope.authentication.user.puesto,cliente:$scope.client,impuesto:$scope.impuesto,condicionVenta:this.condicionVenta,products:$scope.productosDeVenta,subtotal:$scope.vistaSubtotal,descuentoPorcentaje:this.descuento_porcentaje,descuentoValor:$scope.vistaSubtotal*this.descuento_porcentaje/100,neto:$scope.vistaNeto,tax1:$scope.vistaTax1,tax2:$scope.vistaTax2,tax3:$scope.vistaTax3,totalTax:totalTax,total:total}))):($scope.botonApagado=!1,$scope.mensajeCaja="Debe elegir una caja")}else $scope.botonApagado=!1,$scope.mensajeCond="No seleccionaste una condicion de venta";else $scope.botonApagado=!1,$scope.mensajeTipoC="No seleccionaste un tipo de comprobante";else $scope.botonApagado=!1,$scope.mensajeCli="No seleccionaste un cliente";else $scope.botonApagado=!1,$scope.mensajeProd="No seleccionaste productos para la venta"}}]),angular.module("ventas").controller("VentasController",["$scope","$stateParams","$location","Authentication","Ventas","Comprobantes","Products","Enterprises","Condicionventas","$mdBottomSheet","Clients","$rootScope","$state","$filter","$mdDialog","$http","$timeout","Modal","Categories","Subs","Metrics","Providers","Contacts","Taxconditions","$window","$q","Cajas","Socket",function($scope,$stateParams,$location,Authentication,Ventas,Comprobantes,Products,Enterprises,Condicionventas,$mdBottomSheet,Clients,$rootScope,$state,$filter,$mdDialog,$http,$timeout,Modal,Categories,Subs,Metrics,Providers,Contacts,Taxconditions,$window,$q,Cajas,Socket){CrearController.$inject=["$scope","$mdDialog","Modal","Products","Clients","Categories"],DialogController.$inject=["$scope","$mdDialog","item","Ventas","$state","Cajas"],$scope.authentication=Authentication,$scope.impuesto=!1,void 0!==localStorage.getItem("search")&&($scope.SEARCH=JSON.parse(localStorage.getItem("search"))),$scope.$watchCollection("authentication",function(){$scope.SEARCH={enterprise:$scope.authentication.user.enterprise?$scope.authentication.user.enterprise.enterprise:null},localStorage.setItem("search",JSON.stringify($scope.SEARCH)),$scope.find(),$scope.findClients(),$scope.findCajas(),Condicionventas.query({e:$scope.SEARCH.enterprise},function(res){$scope.condicionVentas=res,Modal.setCondicionesVentas($scope.condicionVentas)}),console.log($scope.condicionVenta),$scope.findComprobantes()}),$scope.$watchCollection("condicionVenta",function(){$scope.condicionVenta&&$scope.verCondicionVenta($scope.condicionVenta),console.log($scope.condicionVenta)});var created=new Date;function n_with_zeroes(number,length){for(var my_string=""+number;my_string.length<length;)my_string="0"+my_string;return my_string}function createVenta(venta){console.log("----create venta----"),console.log(venta),venta.user=$scope.authentication.user._id,venta.$save(function(response){response._id&&($scope.find(),$scope.ventas.push(venta)),$state.go("home.ventas",{tab:"finalizada"}),$scope.name="",$scope.producto=""},function(errorResponse){console.log("errorResponse",errorResponse)}),$scope.clicked=!1}function DialogController($scope,$mdDialog,item,Ventas,$state,Cajas){function updateVenta(venta,estado){venta.estado=estado,venta.enterprise=venta.enterprise._id,venta.tipoComprobante=venta.tipoComprobante._id,void 0!==venta.cliente&&(venta.cliente=venta.cliente._id),void 0!==venta.category1&&(venta.category1=venta.category1._id),venta.condicionVenta=venta.condicionVenta._id,void 0!==venta.caja&&(venta.caja=venta.caja._id),$mdDialog.hide(),venta.$update(function(){$mdDialog.hide(),$state.go("home.ventas")},function(errorResponse){$scope.error=errorResponse.data.message})}$scope.item=item,$scope.seleccionCaja=!1,$scope.findCajas=function(){$scope.cajas=[],Cajas.query({e:item.enterprise._id},function(foundCaja){foundCaja.forEach(function(entry){!1===entry.deleted&&$scope.cajas.push(entry)}),1===$scope.cajas.length&&($scope.caja=$scope.cajas[0])})},$scope.findCajas(),$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.habilitoCaja=function(n){$scope.seleccionCaja=n},$scope.finalizarVenta=function(item){console.log(item,"itemmmmm");"Cuenta Corriente"!==item.condicionVenta.name?void 0!==this.caja?(item.caja=this.caja,updateVenta(item,"Finalizada")):$scope.errorCaja="Debe seleccionar la caja":(item.caja=void 0,updateVenta(item,"Finalizada"))},$scope.actualizarVenta=function(data){var venta=$scope.item;if("pagado"===data)var estado="Pendiente de entrega";if("entregado"===data)estado="Pendiente de pago2";if("pYa"===data)estado="Finalizada";venta.estado=estado,venta.enterprise=venta.enterprise._id,venta.tipoComprobante=venta.tipoComprobante._id,venta.cliente=venta.cliente._id,venta.condicionVenta=venta.condicionVenta._id,venta.$update(function(){$mdDialog.hide(),$state.go("home.ventas")},function(errorResponse){$scope.error=errorResponse.data.message})}}function CrearController($scope,$mdDialog,Modal,Products,Clients,Categories){$scope.contacts=Modal.getContactos(),$scope.taxconditions=Modal.getCondiciones(),$scope.comprobantes=Modal.getComprobantes(),$scope.categories2=["Productos Terminados","Materia Prima"],$scope.categories=Modal.getCategorias(),$scope.subcategorias=Modal.getSubcategorias(),$scope.subs=Modal.getSubs(),$scope.proveedores=Modal.getProveedores(),$scope.taxes=Modal.getTaxes(),$scope.metrics=Modal.getMetrics(),$scope.quantityPerUnit=0,$scope.unitsInStock=0,$scope.idealStock=0,$scope.criticalStock=0,$scope.unitPrice=0,$scope.costPerUnit=0,$scope.condicionPagos=Modal.getCondicionesVentas(),$scope.taxconditions2=["Consumidor Final","Responsable Inscripto"],$scope.banco={name:void 0,account:void 0,cbu:void 0,identity:void 0},$scope.creditLimit=0,$scope.discountRate=0,$scope.country="Argentina",$scope.city="La Plata",$scope.region="Buenos Aires",$scope.condicionPago="Efectivo",$scope.taxcondition="Consumidor Final",$scope.$on("mapInitialized",function(evt,evtMap){evtMap.markers[0]}),$scope.types="['address']",$scope.placeChanged=function(){$scope.errorDir=void 0,$scope.place=this.getPlace()},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function($event){void 0!==$event&&0==$event.keyCode&&$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.mostrarFormResponsable=function(){$scope.errorName=void 0,$scope.formResponsableInscripto=!1,"Responsable Inscripto"===this.taxcondition&&($scope.formResponsableInscripto=!0)},$scope.crearProducto=function($event){if(0==$event.keyCode){var esProd=!1;for(var i in $scope.categories)if("Productos Terminados"===$scope.categories[i].name){var categoria=$scope.categories[i];esProd=!0}if(void 0!==this.tax)for(var i in $scope.taxes)if($scope.taxes[i].name===this.tax)var valorTax=$scope.taxes[i].value;var empresa=Modal.getEmpresa();if(void 0!==this.code)if(void 0!==this.name)if(void 0!==this.tax)if(void 0!==this.category2)if(void 0!==this.provider)if(void 0!==this.sub){var product=new Products({name:this.name,description:this.description?this.description:void 0,code:this.code,brandName:this.brandName?this.brandName:void 0,unitPrice:this.unitPrice,costPerUnit:this.costPerUnit,discontinued:this.discontinued,provider:this.provider._id,quantityPerUnit:this.quantityPerUnit,unitsInStock:this.unitsInStock,idealStock:this.idealStock,criticalStock:this.criticalStock,unitsOnOrder:this.unitsOnOrder,storedIn:this.storedIn?this.storedIn:void 0,metric:this.metric?this.metric:"u.",reseller:this.reseller,visible:this.visible,esProducto:esProd,tax:this.tax?valorTax:void 0,enterprise:empresa,sub:this.sub._id,category1:categoria,category2:this.category2?this.category2._id:void 0});product.$save(function(response){$scope.name="",$scope.description="",$scope.brandName="",$scope.unitPrice=0,$scope.costPerUnit=0,$scope.sku="",$scope.discontinued=!1,$scope.quantityPerUnit=1,$scope.unitsInStock=0,$scope.unitsOnOrder=0,$scope.visible=!0,$scope.storedIn="",$scope.metric="",$scope.reseller=!1,$scope.hide(),$rootScope.nuevoProducto=product,console.log($rootScope.nuevoProducto)},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorSub="Se debe especificar la UEN para el producto";else $scope.errorProv="Se debe elegir un proveedor";else $scope.errorCategory="Se debe especificar la categoria para el producto";else $scope.errorTax="Se debe especificar el iva para el producto";else $scope.errorName="Se debe indicar el nombre del producto";else $scope.errorCode="Se debe indicar el codigo del producto"}},$scope.borrarError=function(){$scope.errorCode=void 0,$scope.errorProv=void 0,$scope.errorName=void 0,$scope.errorTax=void 0,$scope.errorSub=void 0,$scope.errorCategory=void 0},$scope.crearCliente=function($event){if(0==$event.keyCode){for(var i in $scope.taxconditions)if($scope.taxconditions[i].name===this.taxcondition)var condicionIva=$scope.taxconditions[i];if("Consumidor Final"===condicionIva.name&&void 0===this.apellido)var errorApellido=!0;else errorApellido=!1;var empresa=Modal.getEmpresa();if(console.log(condicionIva),void 0!==this.name)if(!0!==errorApellido)if(void 0!==$scope.place){var latitud=$scope.place.geometry.location.lat(),longitud=$scope.place.geometry.location.lng(),client=new Clients({name:this.name?this.name:this.razonSocial,apellido:this.apellido?this.apellido:void 0,condicionPago:this.condicionPago?this.condicionPago._id:void 0,comprobante:this.tipoComprobante?this.tipoComprobante._id:void 0,taxCondition:condicionIva,creditLimit:this.creditLimit?this.creditLimit:0,fiscalNumber:this.fiscalNumber?this.fiscalNumber:0,discountRate:this.discountRate?this.discountRate:0,loc:[latitud,longitud],paymentMethod:this.paymentMethod?this.paymentMethod:0,contacts:this.contact?[this.contact._id]:[],country:this.country,city:this.city,region:this.region?this.region:void 0,turno:this.turno?this.turno:void 0,postalCode:this.postalCode?this.postalCode:0,address:this.address,phone:this.phone,web:this.web?this.web:void 0,category1:this.category?this.category._id:void 0,enterprise:empresa,productosAsociados:[]});client.$save(function(response){$scope.name="",$scope.creditLimit=0,$scope.fiscalNumber="",$scope.discountRate=0,$scope.contacts=[],$scope.country="",$scope.city="",$scope.region="",$scope.postalCode="",$scope.address="",$scope.phone="",$scope.fax="",$scope.web="",$scope.hide(),$rootScope.nuevoCliente=client},function(errorResponse){$scope.error=errorResponse.data.message})}else $scope.errorDir="Se debe indicar una direccion";else $scope.errorApellido="Se debe indicar el apellido del cliente";else!0===$scope.formResponsableInscripto?$scope.errorNameClient="Se debe indicar la Razon Social":$scope.errorNameClient="Se debe indicar un nombre"}},$scope.eliminarMensajeError=function(){$scope.errorNameClient=void 0,$scope.errorApellido=void 0}}$scope.created=new Date(created.setTime(created.getTime()-216e5)),$scope.selectedMode="md-scale",$scope.selectedDirection="up",$scope.botonApagado=!1,$scope.rutaVolver=function(){$state.go("home.pedidos",{tipo:"venta"})},$scope.initAutocomplete=function(){$scope.findProductos()},$rootScope.$watchCollection("nuevoProducto",function(){void 0!==$rootScope.nuevoProducto?($scope.mostrarProducto=!0,$http({method:"GET",url:"/api/products/"+$rootScope.nuevoProducto._id,params:{}}).then(function(response){$scope.producto=response.data},function(response){console.log("error")}),$scope.selectedItemChangeProduct($scope.producto)):$scope.mostrarProducto=!1}),$rootScope.$watchCollection("nuevoCliente",function(){void 0!==$rootScope.nuevoCliente?($scope.mostrar=!0,$scope.cliente=$rootScope.nuevoCliente,$scope.selectedItemChange($scope.cliente)):$scope.mostrar=!1}),$scope.user=$scope.authentication.user,$scope.productoVenta={cantidad:void 0,descuento:void 0,observaciones:""},$scope.mostrarPoductosFavoritos=!0,$scope.productosDeVenta=[],$scope.tax1=[],$scope.tax2=[],$scope.tax3=[],$scope.descuento_porcentaje=0,$scope.descuento_valor=0,$scope.vistaSubtotal=0,$scope.vistaNeto=0,$scope.vistaTax1=0,$scope.vistaTax2=0,$scope.vistaTax3=0,$scope.elegirCaja=!0,$scope.isFocused=!1,$scope.verCondicionVenta=function(c){$scope.mensajeCond=void 0,"Cuenta Corriente"==c.name?$scope.elegirCaja=!1:$scope.elegirCaja=!0},$scope.showConfirmAnular=function(ev,item){var confirm=$mdDialog.confirm().title("Anular Venta").content("¿Está seguro que desea anular esta venta?").ariaLabel("Lucky day").ok("Anular").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.cambiarEstadoVenta("Anulada",item)},function(){console.log("cancelaste anular")})},$scope.showConfirmPago=function(ev,item){var confirm=$mdDialog.confirm().title("Pagar venta").content("¿Está seguro que desea pagar esta venta?").ariaLabel("Lucky day").ok("Pagar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.cambiarEstadoVenta("Finalizada",item)},function(){console.log("cancelaste cerrar")})},$scope.showConfirmEntrega=function(ev,item){var confirm=$mdDialog.confirm().title("Entregar venta").content("¿Está seguro que desea entregar esta venta?").ariaLabel("Lucky day").ok("Entregar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.cambiarEstadoVenta("Finalizada",item)},function(){console.log("cancelaste cerrar")})},$scope.actualizarN=function(){$scope.letra_comprobante=$scope.tipoComprobante.letra,$scope.puntoVenta_comprobante=n_with_zeroes(parseInt($scope.tipoComprobante.puntoDeVenta),4),$scope.comprobante=n_with_zeroes(parseInt($scope.tipoComprobante.ultimoNumero)+1,8),$scope.mensajeTipoC=void 0;var comprobante=$scope.tipoComprobante.name;$scope.impuesto="Factura A"==comprobante||"Factura B"==comprobante||"Factura C"==comprobante},$scope.modoEditar=[],$scope.mostrarP=!1,$scope.cambiarMostrarP=function(){!1===$scope.mostrarP?$scope.mostrarP=!0:$scope.mostrarP=!1},$scope.editTrue=function(id,p){$scope.modoEditar[id]=!0},$scope.updateP=function(index,p){var unitWithDiscount=parseFloat(p.product.unitPrice)-parseFloat(p.descuento)*parseFloat(p.product.unitPrice)/100,sub=parseFloat(p.cantidad)*parseFloat(unitWithDiscount);p.total=sub,p.totalSinD=parseFloat(p.cantidad)*parseFloat(p.product.unitPrice),$scope.productosDeVenta[index]=p,$scope.modoEditar[index]=!1,$scope.calcularTotales()},$scope.calcularTotales=function(){var i,sub=0,totTax1=0,totTax2=0,totTax3=0;for($scope.tax1=[],$scope.tax2=[],$scope.tax3=[],void 0!==$scope.descuento_porcentaje&&parseFloat($scope.descuento_porcentaje),i=0;i<$scope.productosDeVenta.length;i++){void 0===$scope.productosDeVenta[i].descuento&&($scope.productosDeVenta[i].descuento=0);var desc=parseFloat($scope.productosDeVenta[i].descuento)*$scope.productosDeVenta[i].product.price/100,finalPrice=$scope.productosDeVenta[i].product.price-desc,additionalIva=parseFloat(1-1/(1+$scope.productosDeVenta[i].product.tax/100))*parseFloat(finalPrice);10.5===parseFloat($scope.productosDeVenta[i].product.tax)&&$scope.tax1.push(additionalIva*parseFloat($scope.productosDeVenta[i].cantidad)),21===parseFloat($scope.productosDeVenta[i].product.tax)&&$scope.tax2.push(additionalIva*parseFloat($scope.productosDeVenta[i].cantidad)),27===parseFloat($scope.productosDeVenta[i].product.tax)&&$scope.tax3.push(additionalIva*parseFloat($scope.productosDeVenta[i].cantidad)),sub+=parseFloat($scope.productosDeVenta[i].cantidad)*finalPrice}if($scope.tax1.length>0)for(i=0;i<$scope.tax1.length;i++)totTax1+=parseFloat($scope.tax1[i]);if($scope.tax2.length>0)for(i=0;i<$scope.tax2.length;i++)totTax2+=parseFloat($scope.tax2[i]);if($scope.tax3.length>0)for(i=0;i<$scope.tax3.length;i++)totTax3+=parseFloat($scope.tax3[i]);$scope.vistaSubtotal=sub;var d=$scope.descuento_porcentaje*$scope.vistaSubtotal/100;$scope.descuento_valor=d,$scope.vistaNeto=$scope.vistaSubtotal-d,$scope.vistaTax1=totTax1,$scope.vistaTax2=totTax2,$scope.vistaTax3=totTax3,$scope.vistaTotal=$scope.vistaNeto},$scope.clienteAsignado=function(){$scope.mensajeCli=void 0,$scope.descuento_porcentaje=$scope.client.discountRate,$scope.mostrarPoductosFavoritos=!0,$scope.calcularTotales()},$scope.asignarProducto=function(p){$scope.stockD=!1,$scope.producto=p},$scope.controlStock=function(p){var stockItem=$scope.getUserStock(p);null!=stockItem&&($scope.productoVenta.cantidad>stockItem.unitsInStock&&$scope.productoVenta.cantidad>0?$scope.stockD=!0:$scope.stockD=!1)},$scope.getUserStock=function(p){if(null!=p&&p.hasOwnProperty("stocks"))for(var i=0;i<p.stocks.length;i++)if(p.stocks[i].costCenter==$scope.authentication.user.centroDeCosto)return p.stocks[i];return null},$scope.getUserUnitsStock=function(p){if(null!=p&&p.hasOwnProperty("stocks"))for(var i=0;i<p.stocks.length;i++)if(p.stocks[i].costCenter==$scope.authentication.user.centroDeCosto)return p.stocks[i].unitsInStock;return 0},$scope.create=function(){if(!0===$scope.clicked)if(0!==$scope.productosDeVenta.length)if(void 0!==$scope.client&&""!==$scope.client&&null!==$scope.client)if(void 0!==$scope.tipoComprobante&&""!==$scope.tipoComprobante)if(void 0!==$scope.condicionVenta&&""!==$scope.condicionVenta)if(console.log($scope.impuesto),"Cuenta Corriente"==$scope.condicionVenta.name){$scope.mensajeError=void 0,$scope.calcularTotales();var totalTax=$scope.vistaTax1+$scope.vistaTax2+$scope.vistaTax3,total=$scope.vistaNeto;createVenta(new Ventas({created:$scope.created,caja:void 0,tipoComprobante:this.tipoComprobante,comprobante:this.comprobante,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,category1:this.category1?this.category1._id:void 0,puesto:$scope.authentication.user.puesto,myDate:$scope.myDate,cliente:$scope.client,impuesto:$scope.impuesto,delivery:this.delivery,condicionVenta:this.condicionVenta,products:$scope.productosDeVenta,observaciones:this.observaciones,subtotal:$scope.vistaSubtotal,descuentoPorcentaje:this.descuento_porcentaje,descuentoValor:$scope.vistaSubtotal*this.descuento_porcentaje/100,neto:$scope.vistaNeto,tax1:$scope.vistaTax1,tax2:$scope.vistaTax2,tax3:$scope.vistaTax3,totalTax:totalTax,total:total}))}else if(void 0!==$scope.caja&&""!==$scope.caja){$scope.mensajeError=void 0,$scope.calcularTotales();totalTax=$scope.vistaTax1+$scope.vistaTax2+$scope.vistaTax3,total=$scope.vistaNeto;createVenta(new Ventas({created:$scope.created,caja:this.caja,tipoComprobante:this.tipoComprobante,comprobante:this.comprobante,enterprise:this.enterprise?this.enterprise._id:$scope.SEARCH.enterprise,category1:this.category1?this.category1._id:void 0,puesto:$scope.authentication.user.puesto,myDate:$scope.myDate,cliente:$scope.client,impuesto:$scope.impuesto,delivery:this.delivery,condicionVenta:this.condicionVenta,products:$scope.productosDeVenta,observaciones:this.observaciones,subtotal:$scope.vistaSubtotal,descuentoPorcentaje:this.descuento_porcentaje,descuentoValor:$scope.vistaSubtotal*this.descuento_porcentaje/100,neto:$scope.vistaNeto,tax1:$scope.vistaTax1,tax2:$scope.vistaTax2,tax3:$scope.vistaTax3,totalTax:totalTax,total:total}))}else $scope.botonApagado=!1,$scope.mensajeCaja="Debe elegir una caja";else $scope.botonApagado=!1,$scope.mensajeCond="No seleccionaste una condicion de venta";else $scope.botonApagado=!1,$scope.mensajeTipoC="No seleccionaste un tipo de comprobante";else $scope.botonApagado=!1,$scope.mensajeCli="No seleccionaste un cliente";else $scope.botonApagado=!1,$scope.mensajeProd="No seleccionaste productos para la venta";else console.log("no action")},$scope.clickSubmit=function(){$scope.botonApagado=!0,$scope.clicked=!0,$scope.create()},$scope.remove=function(venta){if(venta)for(var i in venta.$remove(),$scope.ventas)$scope.ventas[i]===venta&&$scope.ventas.splice(i,1);else $scope.venta.$remove(function(){$location.path("ventas")})},$scope.update=function(){var venta=$scope.venta;void 0!==this.enterprise?venta.enterprise=this.enterprise._id:venta.enterprise=venta.enterprise._id,void 0!==this.tipoComprobante?venta.tipoComprobante=this.tipoComprobante._id:void 0!==venta.tipoComprobante&&null!==venta.tipoComprobante&&(venta.tipoComprobante=venta.tipoComprobante._id),void 0!==this.client?venta.cliente=this.client._id:void 0!==venta.cliente&&null!==venta.cliente&&(venta.cliente=venta.cliente._id),void 0!==this.condicionVenta?venta.condicionVenta=this.condicionVenta._id:void 0!==venta.condicionVenta&&null!==venta.condicionVenta&&(venta.condicionVenta=venta.condicionVenta._id),venta.$update(function(){$location.path("ventas/"+venta._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.cambiarEstadoVenta=function(estado,v){var venta=v;venta.estado=estado,void 0!==this.enterprise?venta.enterprise=this.enterprise._id:venta.enterprise=venta.enterprise._id,void 0!==this.tipoComprobante?venta.tipoComprobante=this.tipoComprobante._id:void 0!==venta.tipoComprobante&&null!==venta.tipoComprobante&&(venta.tipoComprobante=venta.tipoComprobante._id),void 0!==venta.cliente&&null!==venta.cliente?venta.cliente=venta.cliente._id:void 0!==this.client&&(venta.cliente=this.client._id),void 0!==this.condicionVenta?venta.condicionVenta=this.condicionVenta._id:void 0!==venta.condicionVenta&&null!==venta.condicionVenta&&(venta.condicionVenta=venta.condicionVenta._id),Socket.emit("venta.update",venta)},Socket.on("ventas.update",angular.bind(this,function(message){console.log("MOZDA OVDE"),$scope.montoTotal(),$state.go("home.ventas")})),$scope.find=function(){$rootScope.nuevoCliente=void 0,function(item){void 0!==$scope.SEARCH&&($scope.ventas=Ventas.query({e:$scope.SEARCH.enterprise}));var deferred=$q.defer();return setTimeout(function(){void 0!==$scope.ventas?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise}().then(function(response){$scope.montoTotal()})},$scope.ventasFinalizadas=[],$scope.montoTotal=function(){$scope.totalPendientesPA=0,$scope.totalPendientesPago=0,$scope.totalPendientesEntrega=0,$scope.totalFinalizadas=0,$scope.totalAnuladas=0;for(var i=0;i<$scope.ventas.length;i++)"Pendiente de pago y entrega"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.totalPendientesPA=$scope.totalPendientesPA+$scope.ventas[i].total),"Pendiente de pago2"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.totalPendientesPago=$scope.totalPendientesPago+$scope.ventas[i].total),"Pendiente de entrega"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.totalPendientesEntrega=$scope.totalPendientesEntrega+$scope.ventas[i].total),"Finalizada"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.totalFinalizadas=$scope.totalFinalizadas+$scope.ventas[i].total,$scope.ventasFinalizadas.push($scope.ventas[i])),"Anulada"===$scope.ventas[i].estado&&!1===$scope.ventas[i].deleted&&($scope.totalAnuladas=$scope.totalAnuladas+$scope.ventas[i].total)},$scope.findOne=function(){Ventas.get({ventaId:$stateParams.ventaId},function(res){$scope.venta=res;var ptoVenta=n_with_zeroes(parseInt($scope.venta.tipoComprobante.puntoDeVenta),4);$scope.ptoVenta=ptoVenta},function(err){})},$scope.findComprobantes=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/comprobantes/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){for(var i in $scope.comprobantes=response.data,$scope.comprobantes)"Pedido"===$scope.comprobantes[i].name&&$scope.comprobantes.splice(i,1);Modal.setComprobantes($scope.comprobantes)})},$scope.findEnterprises=function(){$scope.enterprises=Enterprises.query()},$scope.findProductos=function(){void 0!==this.client&&(void 0!==$scope.SEARCH?$scope.productos=Products.query({e:$scope.SEARCH.enterprise,c:this.client.category1.category}):$scope.productos=Products.query(),$scope.productosFilter=$scope.productos,$scope.selectedItemChangeProduct($scope.producto))},$scope.findCondicionesventas=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/condicionventas/",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data,Modal.setCondicionesVentas($scope.condicionVentas)})},$scope.findClients=function(){void 0!==$scope.SEARCH&&$http({method:"GET",url:"/api/clients",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.clients=response.data;for(var i=0;i<$scope.clients.length;i++)"Consumidor Final"===$scope.clients[i].name&&($scope.client=$scope.clients[i])})},$scope.sendClient=function($event,client){13===$event.keyCode&&($event.preventDefault(),null===client||void 0===client?$scope.mensajeC="No seleccionaste un cliente valido":($scope.client=client,console.log("todo ok: ",client)))},$scope.mostrarUltimaVenta=!1,$scope.selectedItemChange=function(item,ev){if($scope.mensajeCli=void 0,$scope.client=item,$scope.productosDeVenta=[],$scope.calcularTotales(),$scope.productosDeVenta=[],$scope.mensajeSinVentas=!1,void 0!==$scope.client&&null!==$scope.client){if(void 0!==$scope.client.condicionPago&&null!==$scope.client.condicionPago)$http({method:"GET",url:"/api/condicionventas",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.condicionVentas=response.data;for(var i=0;i<$scope.condicionVentas.length;i++)void 0!==$scope.client.condicionPago._id&&null!==$scope.client.condicionPago._id&&$scope.condicionVentas[i]._id==$scope.client.condicionPago._id?$scope.condicionVenta=$scope.condicionVentas[i]:$scope.condicionVentas[i]._id==$scope.client.condicionPago&&($scope.condicionVenta=$scope.condicionVentas[i]);$scope.findProductos(),$scope.productosNombre=$scope.productos,$scope.producto=null,$scope.searchText2=null});if(void 0!==$scope.client.comprobante&&null!==$scope.client.comprobante)$http({method:"GET",url:"/api/comprobantes",params:{e:$scope.SEARCH.enterprise}}).then(function(response){$scope.comprobantes=response.data;for(var i=0;i<$scope.comprobantes.length;i++)void 0!==$scope.client.comprobante._id&&null!==$scope.client.comprobante._id&&$scope.comprobantes[i]._id==$scope.client.comprobante._id?($scope.tipoComprobante=$scope.comprobantes[i],$scope.actualizarN()):$scope.comprobantes[i]._id==$scope.client.comprobante&&($scope.tipoComprobante=$scope.comprobantes[i],$scope.actualizarN())});$scope.mostrarUltimaVenta=!0}},$scope.mensajeSinVentas=!1,$scope.verUltimaVenta=function(client){$scope.ultimaVenta=[],$scope.mostrarUltimaVenta=!1;var idCliente=client._id;$scope.ultimaVenta=$filter("filter")($scope.ventas,function(item){if(0!==$scope.ventas.length)return item.cliente.id===idCliente}),$scope.ultimaVenta.length>0?(0!==$scope.productosDeVenta.length?($scope.productosDeVenta=[],$scope.productosDeVenta=$scope.ultimaVenta[0].products):$scope.productosDeVenta=$scope.ultimaVenta[0].products,this.descuento_porcentaje=0,this.vistaTax1=$scope.ultimaVenta[0].tax1,this.vistaTax2=$scope.ultimaVenta[0].tax2,this.vistaTax3=$scope.ultimaVenta[0].tax3,this.vistaSubtotal=$scope.ultimaVenta[0].subtotal,this.vistaNeto=$scope.ultimaVenta[0].subtotal,this.vistaTotal=$scope.ultimaVenta[0].total,$scope.ventaRecordada=!0):($scope.ventaRecordada=!1,$scope.mensajeSinVentas=!0)},$scope.reverse=function(array){return[].concat(array).reverse()},$scope.selectedItemChangeProduct=function(item){$scope.mensajeProd=void 0,$scope.producto=item,null!==$scope.producto&&document.getElementById("inputCantidad").focus()},$scope.sendProduct=function($event,productoVenta,producto){13!==$event.keyCode&&0!==$event.keyCode&&void 0!==$event.keyCode||($event.preventDefault(),null===producto||void 0===producto?$scope.mensajeP="No seleccionaste un producto valido":null===productoVenta.cantidad||void 0===productoVenta.cantidad?$scope.mensajeP="No seleccionaste una cantidad para el producto":($scope.controlStock(producto),$scope.stockD=!1,$scope.mensajeP=void 0,$scope.producto=producto,$scope.addProduct(producto,productoVenta)))},$scope.addProduct=function(producto,productoVenta){$scope.mensajeProd=void 0;var p={product:{},cantidad:void 0,descuento:void 0,total:void 0,observaciones:void 0};p.product=producto,p.product.price=0;for(var i=0;i<p.product.catPrice.length;i++)p.product.catPrice[i].category==this.client.category1.category&&(p.product.price=p.product.catPrice[i].price);if(void 0==producto)return 0;""===productoVenta.descuento||void 0===productoVenta.descuento?p.descuento="0":p.descuento=productoVenta.descuento,""===productoVenta.cantidad||void 0===productoVenta.cantidad?p.cantidad="0":p.cantidad=productoVenta.cantidad,void 0===productoVenta.observaciones?p.observaciones="":p.observaciones=productoVenta.observaciones;var unitWithDiscount=parseFloat(p.product.price)-parseFloat(p.descuento)*parseFloat(p.product.price)/100,sub=parseFloat(p.cantidad)*parseFloat(unitWithDiscount);p.totalSinD=parseFloat(p.cantidad)*parseFloat(p.product.price),p.total=sub,$scope.productosDeVenta.splice(0,0,p),$scope.calcularTotales(),productoVenta=void 0,p=void 0,$scope.productoVenta={cantidad:void 0,descuento:void 0,observaciones:""},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.searchText2="",document.getElementById("buscaVenta").focus()},$scope.eliminarProducto=function(index){$scope.productosDeVenta.splice(index,1),$scope.calcularTotales()},$scope.selectedProduct=[],$scope.selectedItem=null,$scope.searchText2=null,$scope.searchTextChange=function(text){angular.lowercase(text);$scope.productosFilter=$filter("filter")($scope.productos,{code:text})},$scope.searchTextChange2=function(text){angular.lowercase(text);$scope.productosNombre=$filter("filter")($scope.productos,{name:text})},$scope.searchTextChangeClients=function(text){angular.lowercase(text);return $filter("filter")($scope.clients,{name:text})},$scope.round=function(total){return"$"+parseFloat(total).toFixed(2)},$scope.minLengthClient=0,$scope.showAdvancedClient=function(ev){$scope.minLengthClient=1,$scope.textToSearch=void 0,$scope.findContacts(),$scope.findCategories(),$scope.findTaxConditions(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/ventas/views/create.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLengthClient=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLengthClient=0,$scope.status="You cancelled the dialog."})},$scope.findContacts=function(){void 0!==$scope.SEARCH&&($scope.contacts=Contacts.query({e:$scope.SEARCH.enterprise}),Modal.setContactos($scope.contacts))},$scope.findCategories=function(){void 0!==$scope.SEARCH&&Categories.query({e:$scope.SEARCH.enterprise},function(data){$scope.categories=$filter("filter")(data,function(item){return"Tipo de Venta"===item.type1}),Modal.setCategorias($scope.categories)})},$scope.findCajas=function(){void 0!==$scope.SEARCH&&($scope.cajas=[],Cajas.query({e:$scope.user.enterprise.enterprise},function(foundCaja){foundCaja.forEach(function(entry){!1===entry.deleted&&$scope.cajas.push(entry),entry.puestos.length>0&&user.puesto==entry.puestos[0]._id&&($scope.caja=entry)}),1===$scope.cajas.length&&($scope.caja=$scope.cajas[0])}))},$scope.findTaxConditions=function(){void 0!==$scope.SEARCH&&($scope.taxconditions=Taxconditions.query({e:$scope.SEARCH.enterprise}),Modal.setCondiciones($scope.taxconditions))},$scope.showAdvanced=function(ev,item){$mdDialog.show({controller:DialogController,templateUrl:"/modules/ventas/views/modal.client.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{item:function(){return item}}}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.minLength=0,$scope.showAdvancedProduct=function(ev){$scope.minLength=1,$scope.searchText2=void 0,$scope.findProveedores(),$scope.findCategories(),$scope.findSubs(),$scope.findMetrics(),$scope.findSubcategories(),$scope.findTaxes(),Modal.setEmpresa($scope.SEARCH.enterprise),$mdDialog.show({controller:CrearController,templateUrl:"/modules/ventas/views/create.product.view.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$scope.minLength=0,$scope.status='You said the information was "'+answer+'".'},function(){$scope.minLength=0,$scope.status="You cancelled the dialog."})},$scope.findProveedores=function(){void 0!==$scope.SEARCH&&($scope.proveedores=Providers.query({e:$scope.SEARCH.enterprise}),Modal.setProveedores($scope.proveedores))},$scope.findSubs=function(){void 0!==$scope.SEARCH&&($scope.subs=Subs.query({e:$scope.SEARCH.enterprise}),Modal.setSubs($scope.subs))},$scope.findSubcategories=function(){void 0!==$scope.SEARCH&&($scope.subcategorias=Categories.query({e:$scope.SEARCH.enterprise}),Modal.setSubcategorias($scope.subcategorias))},$scope.findTaxes=function(){void 0!==$scope.SEARCH&&($scope.taxes=[{value:1,name:"Iva incluido en el precio"},{value:10.5,name:"10.50%"},{value:21,name:"21.00%"},{value:27,name:"27.00%"}],Modal.setTaxes($scope.taxes))},$scope.findMetrics=function(){void 0!==$scope.SEARCH&&($scope.metrics=Metrics.query(),Modal.setMetrics($scope.metrics))},$scope.verEdicion=[],$scope.habilitarEdicion=function(index){$scope.verEdicion[index]=!0},$scope.editProducto=function(p,venta,index){var subtotal=0,iva=0;$scope.verEdicion=!1,p.subtotal=p.cantidad*p.product.unitPrice;var descuento=p.subtotal*p.descuento/100;for(var i in p.total=p.subtotal-descuento,venta.products)subtotal+=venta.products[i].total,1!=venta.products[i].product.tax&&(iva+=venta.products[i].subtotal*(1-1/(1+venta.products[i].product.tax/100)));venta.subtotal=subtotal,venta.descuentoValor=subtotal*venta.descuentoPorcentaje/100,venta.neto=subtotal-venta.descuentoValor,venta.totalTax=iva,venta.total=venta.neto,$scope.verEdicion=[],$scope.updateVenta(venta,p)},$scope.updateVenta=function(item,p){!0===$scope.cambioPrecio&&($scope.modificarPrecioProducto(p.product,item),$scope.cambioPrecio=!1);var venta=item;venta.enterprise=venta.enterprise._id,venta.tipoComprobante=venta.tipoComprobante._id,venta.cliente=venta.cliente._id,venta.condicionVenta=venta.condicionVenta._id,venta.$update(function(){},function(errorResponse){})},$scope.cambiarPrecio=function(){$scope.cambioPrecio=!0,$scope.findProductos()},$scope.modificarPrecioProducto=function(p,venta){for(var i in $scope.productos)if($scope.productos[i]._id===p._id){var precio=p.unitPrice;p=$scope.productos[i];var product=new Products({_id:p._id,name:p.name,description:p.description,code:p.code,brandName:p.brandName,unitPrice:precio,costPerUnit:p.costPerUnit,discontinued:p.discontinued,provider:p.provider._id,quantityPerUnit:p.quantityPerUnit,unitsInStock:p.unitsInStock,idealStock:p.idealStock,criticalStock:p.criticalStock,unitsOnOrder:p.unitsOnOrder,storedIn:p.storedIn,metric:p.metric,reseller:p.reseller,visible:p.visible,esProducto:p.esProducto,esMateriaPrima:p.esMateriaPrima,esInsumo:p.esInsumo,tax:p.tax,enterprise:p.enterprise,sub:p.sub._id,category1:p.category1,category2:p.category2});product.enterprise=product.enterprise._id,void 0!==product.sub&&null!==product.sub&&(product.sub=product.sub._id),void 0!==product.category1&&null!==product.category1&&(product.category1=product.category1._id),void 0!==product.category2&&null!==product.category2&&(product.category2=product.category2?product.category2._id:void 0),void 0!==product.provider&&null!==product.provider&&(product.provider=product.provider._id),product.$update(function(response){},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.showConfirm2=function(ev,item,venta){var confirm=$mdDialog.confirm().title("Eliminar productos").content("¿Está seguro que desea eliminar este producto de la venta?").ariaLabel("Lucky day").ok("Eliminar").cancel("Cancelar").targetEvent(ev);$mdDialog.show(confirm).then(function(){$scope.quitarProducto(item,venta)},function(){})},$scope.quitarProducto=function(p,venta){var subt,iva,descProd,descGen,tax1=0,tax2=0,tax3=0;descProd=parseFloat(p.product.unitPrice*p.cantidad*p.descuento/100),subt=parseFloat(p.product.unitPrice*p.cantidad-descProd),descGen=parseFloat(subt*venta.descuentoPorcentaje/100),10.5==(iva=p.product.tax)&&(tax1=parseFloat(subt*(1-1/1.105)/100),venta.tax1=parseFloat(venta.tax1-tax1)),21==iva&&(tax2=parseFloat(subt*(1-1/1.21)/100),venta.tax2=parseFloat(venta.tax2-tax2)),27==iva&&(tax3=parseFloat(subt*(1-1/1.27)/100),venta.tax3=parseFloat(venta.tax3-tax3)),venta.neto=parseFloat(venta.neto-(subt-descGen)),venta.subtotal=parseFloat(venta.subtotal-subt),venta.descuentoValor=parseFloat(venta.descuentoValor-descGen),venta.total=venta.total,venta.totalTax=venta.totalTax-tax1-tax2-tax3;for(var i=0;i<venta.products.length;i++)venta.products[i]._id===p._id&&venta.products.splice(i,1);$scope.updateVenta(venta,p)},$scope.extraerVenta=function(item){(function(item){var deferred=$q.defer();return $scope.venta=item,setTimeout(function(){void 0!==$scope.venta?deferred.resolve("Hello"):deferred.reject("Greeting")},1e3),deferred.promise})(item).then(function(response){$scope.printIt()})},$scope.printIt=function(){var b=document.getElementById("printing-css-venta").value,c=document.getElementById("printing-data-venta").innerHTML;window.frames.print_frame_venta.document.title="•",window.frames.print_frame_venta.document.body.innerHTML="<style>"+b+"</style>"+c,window.frames.print_frame_venta.window.focus(),window.frames.print_frame_venta.window.print()}}]),angular.module("ventas").factory("Ventas",["$resource",function($resource){return $resource("api/ventas/:ventaId",{ventaId:"@_id",e:"@enterprise",w:"@filterDate.week",y:"@filterDate.year"},{update:{method:"PUT"}})}]),angular.module("ventas").factory("VentasExtra",["$http",function($http){return{select:function(estado,enterprise){return $http({method:"get",url:"/api/ventas/select",params:{e:enterprise,estado:estado}})},loadMore:function(enterprise,estado,last,limit,caja){return $http({method:"get",url:"/api/ventas/loadmore",params:{e:enterprise,last:last,limit:limit,estado:estado,caja:caja}})},loadMoreImpuestos:function(impuesto,last,limit,year,month){return $http({method:"get",url:"/api/ventas/loadmoreImpuestos",params:{impuesto:impuesto,last:last,limit:limit,year:year,month:month}})}}}]);